(function(k){var h={};(function(a){var i,c=a.name+" | EVENT EMITTER | ";i=function(){};i.prototype={initEvents:function(a){var f=a.length;this.events={};this.onceNotFired=[];this.maxListeners=10;for(this.events.newListener=function(a){console.log(c+"new listener added to event "+a)};f--;)console.log(c+"adding event "+a[f]),this.events[a[f]]=[]},checkEvent:function(a){if(this.events[a])return!0;console.error(c+"no event named "+a);return!1},addListener:function(a,f){this.checkEvent(a)&&(this.events[a].length>=
this.maxListeners&&console.warn(c+"max listeners exceeded for event "+a),this.events[a].push(f),this.events.newListener.call(null,a))},on:function(a,c){this.addListener(a,c)},once:function(a,c){this.events[a].unshift(c);this.onceNotFired.push(a)},removeListener:function(a,c){if(this.checkEvent(a))for(var n=this.events[a],A=0,v=n.length;A<v;)n[A]&&n[A].toString()===c.toString()?n.splice(A,1):A++},removeAllListener:function(a){this.checkEvent(a)&&(this.events[a]=[])},setMaxListeners:function(a){Number(a)&&
(this.maxListeners=a)},listeners:function(a){return this.events[a]},emit:function(g,f,n){var A,v,l=0;if(this.checkEvent(g)){console.log(c+"emitting event "+g);A=this.events[g];v=A.length;if(f=new a.Event(g,f,n))for(l;l<v;l++)A[l].apply(null,[f]);else for(l;l<v;l++)A[l].call();l=this.onceNotFired.indexOf(g);-1!==l&&(this.onceNotFired.splice(l,1),this.events[g].shift())}},newListener:function(a){this.events.newListener=a}};a.EventEmitter=i;a.Event=function(a,c,n){this.type=a;this.sender=c;this.data=
n}})(h);h.C={USER_AGENT:h.name+" "+h.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",
WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",
BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",
403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",
433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",
493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}};(function(a){var i;i={ConfigurationError:function(){var a=function(a,c){this.code=1;this.name="CONFIGURATION_ERROR";this.parameter=a;this.value=c;this.message=!this.value?
"Missing parameter: "+this.parameter:"Invalid value "+k.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"'};a.prototype=Error();return a}(),InvalidTargetError:function(){var a=function(a){this.code=2;this.name="INVALID_TARGET_ERROR";this.target=a;this.message="Invalid target: "+this.target};a.prototype=Error();return a}(),InvalidStateError:function(){var a=function(a){this.code=3;this.name="INVALID_STATE_ERROR";this.status=a};a.prototype=Error();return a}()};a.Exceptions=i})(h);h.Timers=
{T1:500,T2:4E3,T4:5E3,TIMER_B:32E3,TIMER_D:0,TIMER_F:32E3,TIMER_H:32E3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32E3,TIMER_M:32E3,TIMER_N:90};(function(a){var i,c=a.name+" | TRANSPORT | ";i=function(a,c){this.ua=a;this.ws=null;this.server=c;this.reconnection_attempts=0;this.connected=this.closed=!1;this.reconnectTimer=null;this.lastTransportError={};this.ua.transport=this;this.connect()};i.prototype={send:function(a){a=a.toString();if(this.ws&&this.ws.readyState===WebSocket.OPEN)return!0===this.ua.configuration.trace_sip&&
console.log(Date()+c+"sending WebSocket message:\n\n"+a+"\n"),this.ws.send(a),!0;console.warn(Date()+c+"unable to send message, WebSocket is not open");return!1},disconnect:function(){this.ws&&(this.closed=!0,console.log(Date()+c+"closing WebSocket "+this.server.ws_uri),this.ws.close())},connect:function(){var a=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return console.log(c+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&
this.ws.close();console.log(c+"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new WebSocket(this.server.ws_uri,"sip")}catch(f){console.warn(c+"error connecting to WebSocket "+this.server.ws_uri+": "+f)}this.ws.binaryType="arraybuffer";this.ws.onopen=function(){a.onOpen()};this.ws.onclose=function(c){a.onClose(c)};this.ws.onmessage=function(c){a.onMessage(c)};this.ws.onerror=function(c){a.onError(c)}},onOpen:function(){this.connected=!0;console.log(c+"WebSocket "+this.server.ws_uri+" connected");
k.clearTimeout(this.reconnectTimer);this.closed=!1;this.ua.onTransportConnected(this)},onClose:function(a){var f=this.connected;this.connected=!1;this.lastTransportError.code=a.code;this.lastTransportError.reason=a.reason;console.warn(c+"WebSocket disconnected (code: "+a.code+(a.reason?"| reason: "+a.reason:"")+")");!1===a.wasClean&&console.warn(c+"WebSocket abrupt disconnection");if(!0===f)this.ua.onTransportClosed(this),this.closed||(this.reconnection_attempts=0,this.reConnect()),this.ua.emit("disconnected",
this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason});else this.ua.onTransportError(this)},onMessage:function(g){var f,g=g.data;if("\r\n"===g)!0===this.ua.configuration.trace_sip&&console.log(c+"received WebSocket message with CRLF Keep Alive response");else{if("string"!==typeof g){try{g=String.fromCharCode.apply(null,new Uint8Array(g))}catch(n){console.warn(c+"received WebSocket binary message failed to be converted into string, message discarded");return}!0===
this.ua.configuration.trace_sip&&console.log(c+"received WebSocket binary message:\n\n"+g+"\n")}else!0===this.ua.configuration.trace_sip&&console.log(Date()+c+"received WebSocket text message:\n\n"+g+"\n");g=a.Parser.parseMessage(g);if(!(this.ua.status===a.UA.C.STATUS_USER_CLOSED&&g instanceof a.IncomingRequest)&&g&&a.sanityCheck(g,this.ua,this))if(g instanceof a.IncomingRequest)g.transport=this,this.ua.receiveRequest(g);else if(g instanceof a.IncomingResponse)switch(g.method){case a.C.INVITE:(f=
this.ua.transactions.ict[g.via_branch])&&f.receiveResponse(g);break;case a.C.ACK:break;default:(f=this.ua.transactions.nict[g.via_branch])&&f.receiveResponse(g)}}},onError:function(a){console.warn(c+"WebSocket connection error: "+a)},reConnect:function(){var a=this;this.reconnection_attempts+=1;this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(console.warn(c+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(console.log(c+
"trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=k.setTimeout(function(){a.connect()},1E3*this.ua.configuration.ws_server_reconnection_timeout))}};i.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};a.Transport=i})(h);(function(a){var i=a.name+" | PARSER | ";a.Parser={parseMessage:function(c){var g,f,n,A,v=0;f=c.indexOf("\r\n");if(-1===f)console.warn(i+"no CRLF found, not a SIP message, discarded");else if(g=
c.substring(0,f),A=a.Grammar.parse(g,"Request_Response"),-1===A)console.warn(i+'error parsing first line of SIP message: "'+g+'"');else{A.status_code?(g=new a.IncomingResponse,g.status_code=A.status_code,g.reason_phrase=A.reason_phrase):(g=new a.IncomingRequest,g.method=A.method,g.ruri=A.uri);g.data=c;for(v=f+2;;){a:{f=c;A=v;var l=0,x=0;if(f.substring(A,A+2).match(/(^\r\n)/))f=-2;else{for(;0===l;){x=f.indexOf("\r\n",A);if(-1===x){f=x;break a}!f.substring(x+2,x+4).match(/(^\r\n)/)&&f.charAt(x+2).match(/(^\s+)/)?
A=x+2:l=x}f=l}}if(-2===f){n=v+2;break}else if(-1===f)return;A=g;var l=c,p=v,x=f,r=void 0,h=v=void 0,r=l.indexOf(":",p),p=l.substring(p,r).trim(),l=l.substring(r+1,x).trim();switch(p.toLowerCase()){case "via":case "v":A.addHeader("via",l);if(1===A.countHeader("via")){if(h=A.parseHeader("Via"))A.via=h,A.via_branch=h.branch}else h=0;break;case "from":case "f":A.setHeader("from",l);if(h=A.parseHeader("from"))A.from=h,A.from_tag=h.getParam("tag");break;case "to":case "t":A.setHeader("to",l);if(h=A.parseHeader("to"))A.to=
h,A.to_tag=h.getParam("tag");break;case "record-route":h=a.Grammar.parse(l,"Record_Route");-1===h&&(h=void 0);for(v in h)r=h[v],A.addHeader("record-route",l.substring(r.possition,r.offset)),A.headers["Record-Route"][A.countHeader("record-route")-1].parsed=r.parsed;break;case "call-id":case "i":A.setHeader("call-id",l);if(h=A.parseHeader("call-id"))A.call_id=l;break;case "contact":case "m":h=a.Grammar.parse(l,"Contact");-1===h&&(h=void 0);for(v in h)r=h[v],A.addHeader("contact",l.substring(r.possition,
r.offset)),A.headers.Contact[A.countHeader("contact")-1].parsed=r.parsed;break;case "content-length":case "l":A.setHeader("content-length",l);h=A.parseHeader("content-length");break;case "content-type":case "c":A.setHeader("content-type",l);h=A.parseHeader("content-type");break;case "cseq":A.setHeader("cseq",l);if(h=A.parseHeader("cseq"))A.cseq=h.value;A instanceof a.IncomingResponse&&(A.method=h.method);break;case "max-forwards":A.setHeader("max-forwards",l);h=A.parseHeader("max-forwards");break;
case "www-authenticate":A.setHeader("www-authenticate",l);h=A.parseHeader("www-authenticate");break;case "proxy-authenticate":A.setHeader("proxy-authenticate",l);h=A.parseHeader("proxy-authenticate");break;default:A.setHeader(p,l),h=0}A=void 0===h?!1:!0;if(!A)return;v=f+2}g.hasHeader("content-length")?(f=g.getHeader("content-length"),g.body=c.substr(n,f)):g.body=c.substring(n);return g}}}})(h);(function(a){var i,c,g,f,n=a.name+" | SIP MESSAGE | ";i=function(c,f,g,x,p,n){x=x||{};if(!c||!f||!g)return null;
this.headers={};this.method=c;this.ruri=f;this.body=n;this.extraHeaders=p||[];x.route_set?this.setHeader("route",x.route_set):g.configuration.use_preloaded_route&&this.setHeader("route",g.transport.server.sip_uri);this.setHeader("via","");this.setHeader("max-forwards",a.UA.C.MAX_FORWARDS);p=x.to_display_name||0===x.to_display_name?'"'+x.to_display_name+'" ':"";p+="<"+(x.to_uri||f)+">";p+=x.to_tag?";tag="+x.to_tag:"";this.to=new a.NameAddrHeader.parse(p);this.setHeader("to",p);f=x.from_display_name||
0===x.from_display_name?'"'+x.from_display_name+'" ':g.configuration.display_name?'"'+g.configuration.display_name+'" ':"";f+="<"+(x.from_uri||g.configuration.uri)+">;tag=";f+=x.from_tag||a.Utils.newTag();this.from=new a.NameAddrHeader.parse(f);this.setHeader("from",f);this.call_id=g=x.call_id||g.configuration.jssip_id+a.Utils.createRandomToken(15);this.setHeader("call-id",g);this.cseq=x=x.cseq||Math.floor(1E4*Math.random());this.setHeader("cseq",x+" "+c)};i.prototype={setHeader:function(c,f){this.headers[a.Utils.headerize(c)]=
f instanceof Array?f:[f]},toString:function(){var c,f,g;c=""+(this.method+" "+this.ruri+" SIP/2.0\r\n");for(f in this.headers)for(g in this.headers[f])c+=f+": "+this.headers[f][g]+"\r\n";f=this.extraHeaders.length;for(g=0;g<f;g++)c+=this.extraHeaders[g]+"\r\n";c+="Supported: "+a.UA.C.SUPPORTED+"\r\n";c+="User-Agent: "+a.C.USER_AGENT+"\r\n";this.body?(f=a.Utils.str_utf8_length(this.body),c=c+("Content-Length: "+f+"\r\n\r\n")+this.body):c+="Content-Length: 0\r\n\r\n";return c}};c=function(){this.body=
this.to_tag=this.to=this.from_tag=this.from=this.cseq=this.call_id=this.via_branch=this.via=this.method=this.headers=this.data=null};c.prototype={addHeader:function(c,f){var g={raw:f},c=a.Utils.headerize(c);this.headers[c]?this.headers[c].push(g):this.headers[c]=[g]},countHeader:function(c){return(c=this.headers[a.Utils.headerize(c)])?c.length:0},getHeader:function(c,f){var g=this.headers[a.Utils.headerize(c)],f=f||0;if(g&&g[f])return g[f].raw},getHeaderAll:function(c){var f,c=this.headers[a.Utils.headerize(c)],
g=[];if(!c)return[];for(f in c)g.push(c[f].raw);return g},hasHeader:function(c){return this.headers[a.Utils.headerize(c)]?!0:!1},parseHeader:function(c,f){var g,x,p,c=a.Utils.headerize(c),f=f||0;if(this.headers[c])if(f>=this.headers[c].length)console.log(n+'not so many "'+c+'" headers present');else{g=this.headers[c][f];x=g.raw;if(g.parsed)return g.parsed;p=a.Grammar.parse(x,c.replace(/-/g,"_"));if(-1===p)this.headers[c].splice(f,1),console.warn(n+'error parsing "'+c+'" header field with value "'+
x+'"');else return g.parsed=p}else console.log(n+'header "'+c+'" not present')},s:function(a,c){return this.parseHeader(a,c)},setHeader:function(c,f){var g={raw:f};this.headers[a.Utils.headerize(c)]=[g]},toString:function(){return this.data}};g=function(){this.headers={};this.server_transaction=this.transport=this.ruri=null};g.prototype=new c;g.prototype.reply=function(c,f,g,x,p,n){var i,h,k,z;k=this.getHeader("To");z=h=0;c=c||null;f=f||null;if(!c||100>c||699<c)throw new TypeError("Invalid status_code: "+
c);if(f&&"string"!==typeof f&&!(f instanceof String))throw new TypeError("Invalid reason_phrase: "+f);f=f||a.C.REASON_PHRASE[c]||"";g=g||[];f="SIP/2.0 "+c+" "+f+"\r\n";if(this.method===a.C.INVITE&&100<c&&200>=c){i=this.countHeader("record-route");for(h;h<i;h++)f+="Record-Route: "+this.getHeader("record-route",h)+"\r\n"}h=this.countHeader("via");for(z;z<h;z++)f+="Via: "+this.getHeader("via",z)+"\r\n";this.to_tag?this.to_tag&&!this.s("to").hasParam("tag")&&(k+=";tag="+this.to_tag):k+=";tag="+a.Utils.newTag();
f=f+("To: "+k+"\r\n")+("From: "+this.getHeader("From")+"\r\n");f+="Call-ID: "+this.call_id+"\r\n";f+="CSeq: "+this.cseq+" "+this.method+"\r\n";k=g.length;for(z=0;z<k;z++)f+=g[z]+"\r\n";f+="Supported: "+a.UA.C.SUPPORTED+"\r\n";x?(k=a.Utils.str_utf8_length(x),f=f+"Content-Type: application/sdp\r\n"+("Content-Length: "+k+"\r\n\r\n")+x):f+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(c,f,p,n)};g.prototype.reply_sl=function(c,f){var g,x;g=this.countHeader("via");c=c||null;f=f||null;
if(!c||100>c||699<c)throw new TypeError("Invalid status_code: "+c);if(f&&"string"!==typeof f&&!(f instanceof String))throw new TypeError("Invalid reason_phrase: "+f);f=f||a.C.REASON_PHRASE[c]||"";x="SIP/2.0 "+c+" "+f+"\r\n";for(var n=0;n<g;n++)x+="Via: "+this.getHeader("via",n)+"\r\n";g=this.getHeader("To");this.to_tag?this.to_tag&&!this.s("to").hasParam("tag")&&(g+=";tag="+this.to_tag):g+=";tag="+a.Utils.newTag();x=x+("To: "+g+"\r\n")+("From: "+this.getHeader("From")+"\r\n");x+="Call-ID: "+this.call_id+
"\r\n";x+="CSeq: "+this.cseq+" "+this.method+"\r\n";this.transport.send(x+"Content-Length: 0\r\n\r\n")};f=function(){this.headers={};this.reason_phrase=this.status_code=null};f.prototype=new c;a.OutgoingRequest=i;a.IncomingRequest=g;a.IncomingResponse=f})(h);(function(a){var i;i=function(c,g,f,n,i,h){var l,x;if(!f)throw new TypeError('missing or invalid "host" parameter');c=c||a.C.SIP;this.parameters={};this.headers={};for(l in i)this.setParam(l,i[l]);for(x in h)this.setHeader(x,h[x]);Object.defineProperties(this,
{scheme:{get:function(){return c},set:function(a){c=a.toLowerCase()}},user:{get:function(){return g},set:function(a){g=a}},host:{get:function(){return f},set:function(a){f=a.toLowerCase()}},port:{get:function(){return n},set:function(a){n=0===a?a:parseInt(a,10)||null}}})};i.prototype={setParam:function(a,g){a&&(this.parameters[a.toLowerCase()]="undefined"===typeof g||null===g?null:g.toString().toLowerCase())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&
!0||!1},deleteParam:function(a){var g,a=a.toLowerCase();if(this.parameters.hasOwnProperty(a))return g=this.parameters[a],delete this.parameters[a],g},clearParams:function(){this.parameters={}},setHeader:function(c,g){this.headers[a.Utils.headerize(c)]=g instanceof Array?g:[g]},getHeader:function(c){if(c)return this.headers[a.Utils.headerize(c)]},hasHeader:function(c){if(c)return this.headers.hasOwnProperty(a.Utils.headerize(c))&&!0||!1},deleteHeader:function(c){var g,c=a.Utils.headerize(c);if(this.headers.hasOwnProperty(c))return g=
this.headers[c],delete this.headers[c],g},clearHeaders:function(){this.headers={}},clone:function(){return new i(this.scheme,this.user,this.host,this.port,k.JSON.parse(k.JSON.stringify(this.parameters)),k.JSON.parse(k.JSON.stringify(this.headers)))},toString:function(){var c,g,f,n,i=[];n=this.scheme+":";this.user&&(n+=a.Utils.escapeUser(this.user)+"@");n+=this.host;if(this.port||0===this.port)n+=":"+this.port;for(g in this.parameters)n+=";"+g,null!==this.parameters[g]&&(n+="="+this.parameters[g]);
for(c in this.headers)for(f in this.headers[c])i.push(c+"="+this.headers[c][f]);0<i.length&&(n+="?"+i.join("&"));return n},toAor:function(c){var g;g=this.scheme+":";this.user&&(g+=a.Utils.escapeUser(this.user)+"@");g+=this.host;if(c&&(this.port||0===this.port))g+=":"+this.port;return g}};i.parse=function(c){c=a.Grammar.parse(c,"SIP_URI");if(-1!==c)return c};a.URI=i})(h);(function(a){var i;i=function(c,g,f){var n;if(!c||!(c instanceof a.URI))throw new TypeError('missing or invalid "uri" parameter');
this.uri=c;this.parameters={};for(n in f)this.setParam(n,f[n]);Object.defineProperties(this,{display_name:{get:function(){return g},set:function(a){g=0===a?"0":a}}})};i.prototype={setParam:function(a,g){a&&(this.parameters[a.toLowerCase()]="undefined"===typeof g||null===g?null:g.toString())},getParam:function(a){if(a)return this.parameters[a.toLowerCase()]},hasParam:function(a){if(a)return this.parameters.hasOwnProperty(a.toLowerCase())&&!0||!1},deleteParam:function(a){var g,a=a.toLowerCase();if(this.parameters.hasOwnProperty(a))return g=
this.parameters[a],delete this.parameters[a],g},clearParams:function(){this.parameters={}},clone:function(){return new i(this.uri.clone(),this.display_name,k.JSON.parse(k.JSON.stringify(this.parameters)))},toString:function(){var a,g;a=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"";a+="<"+this.uri.toString()+">";for(g in this.parameters)a+=";"+g,null!==this.parameters[g]&&(a+="="+this.parameters[g]);return a}};i.parse=function(c){c=a.Grammar.parse(c,"Name_Addr_Header");if(-1!==
c)return c};a.NameAddrHeader=i})(h);(function(a){var i,c=a.name+" | TRANSACTION | ",g={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};i={};var f=function(){this.init=function(a,c,f){this.transport=f;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=a;this.request=c;c="SIP/2.0/"+(a.ua.configuration.hack_via_tcp?"TCP":f.server.scheme);c+=" "+a.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",
c)}},n=function(){this.send=function(){var c=this;this.state=g.STATUS_TRYING;this.F=k.setTimeout(function(){c.timer_F()},a.Timers.TIMER_F);if(!this.transport.send(this.request))this.onTransportError()};this.onTransportError=function(){console.log(c+"transport error occurred, deleting non-INVITE client transaction "+this.id);k.clearTimeout(this.F);k.clearTimeout(this.K);delete this.request_sender.ua.transactions.nict[this.id];this.request_sender.onTransportError()};this.timer_F=function(){console.log(c+
"Timer F expired for non-INVITE client transaction "+this.id);this.state=g.STATUS_TERMINATED;this.request_sender.onRequestTimeout();delete this.request_sender.ua.transactions.nict[this.id]};this.timer_K=function(){this.state=g.STATUS_TERMINATED;delete this.request_sender.ua.transactions.nict[this.id]};this.receiveResponse=function(c){var f=this,l=c.status_code;if(200>l)switch(this.state){case g.STATUS_TRYING:case g.STATUS_PROCEEDING:this.state=g.STATUS_PROCEEDING,this.request_sender.receiveResponse(c)}else switch(this.state){case g.STATUS_TRYING:case g.STATUS_PROCEEDING:this.state=
g.STATUS_COMPLETED;k.clearTimeout(this.F);if(408===l)this.request_sender.onRequestTimeout();else this.request_sender.receiveResponse(c);this.K=k.setTimeout(function(){f.timer_K()},a.Timers.TIMER_K)}}};n.prototype=new f;var h=function(){this.send=function(){var c=this;this.state=g.STATUS_CALLING;this.B=k.setTimeout(function(){c.timer_B()},a.Timers.TIMER_B);if(!this.transport.send(this.request))this.onTransportError()};this.onTransportError=function(){console.log(c+"transport error occurred, deleting INVITE client transaction "+
this.id);k.clearTimeout(this.B);k.clearTimeout(this.D);k.clearTimeout(this.M);delete this.request_sender.ua.transactions.ict[this.id];this.request_sender.onTransportError()};this.timer_M=function(){console.log(c+"Timer M expired for INVITE client transaction "+this.id);this.state===g.STATUS_ACCEPTED&&(this.state=g.STATUS_TERMINATED,k.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])};this.timer_B=function(){console.log(c+"Timer B expired for INVITE client transaction "+
this.id);this.state===g.STATUS_CALLING&&(this.state=g.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])};this.timer_D=function(){console.log(c+"Timer D expired for INVITE client transaction "+this.id);this.state=g.STATUS_TERMINATED;k.clearTimeout(this.B);delete this.request_sender.ua.transactions.ict[this.id]};this.sendACK=function(c){var f=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+
"\r\n";this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n");this.ack+="To: "+c.getHeader("to")+"\r\n";this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n\r\n";this.D=k.setTimeout(function(){f.timer_D()},a.Timers.TIMER_D);this.transport.send(this.ack)};this.cancel_request=function(c,f){var l=
c.request;this.cancel=a.C.CANCEL+" "+l.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+l.headers.Via.toString()+"\r\n";this.request.headers.Route&&(this.cancel+="Route: "+l.headers.Route.toString()+"\r\n");this.cancel+="To: "+l.headers.To.toString()+"\r\n";this.cancel+="From: "+l.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+l.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+l.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";f&&(this.cancel+="Reason: "+f+"\r\n");this.cancel+="Content-Length: 0\r\n\r\n";
this.state===g.STATUS_PROCEEDING&&this.transport.send(this.cancel)};this.receiveResponse=function(c){var f=this,l=c.status_code;if(100<=l&&199>=l)switch(this.state){case g.STATUS_CALLING:this.state=g.STATUS_PROCEEDING;this.request_sender.receiveResponse(c);this.cancel&&this.transport.send(this.cancel);break;case g.STATUS_PROCEEDING:this.request_sender.receiveResponse(c)}else if(200<=l&&299>=l)switch(this.state){case g.STATUS_CALLING:case g.STATUS_PROCEEDING:this.state=g.STATUS_ACCEPTED;this.M=k.setTimeout(function(){f.timer_M()},
a.Timers.TIMER_M);this.request_sender.receiveResponse(c);break;case g.STATUS_ACCEPTED:this.request_sender.receiveResponse(c)}else if(300<=l&&699>=l)switch(this.state){case g.STATUS_CALLING:case g.STATUS_PROCEEDING:this.state=g.STATUS_COMPLETED;this.sendACK(c);this.request_sender.receiveResponse(c);break;case g.STATUS_COMPLETED:this.sendACK(c)}}};h.prototype=new f;var f=function(){this.init=function(a,c){this.id=a.via_branch;this.request=a;this.transport=a.transport;this.ua=c;this.last_response="";
a.server_transaction=this}},v=function(){this.timer_J=function(){console.log(c+"Timer J expired for non-INVITE server transaction "+this.id);this.state=g.STATUS_TERMINATED;delete this.ua.transactions.nist[this.id]};this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(c+"transport error occurred, deleting non-INVITE server transaction "+this.id),k.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])};this.receiveResponse=function(c,f,l,n){var i=this;
if(100===c)switch(this.state){case g.STATUS_TRYING:this.state=g.STATUS_PROCEEDING;if(!this.transport.send(f))this.onTransportError();break;case g.STATUS_PROCEEDING:this.last_response=f,this.transport.send(f)?l&&l():(this.onTransportError(),n&&n())}else if(200<=c&&699>=c)switch(this.state){case g.STATUS_TRYING:case g.STATUS_PROCEEDING:this.state=g.STATUS_COMPLETED,this.last_response=f,this.J=k.setTimeout(function(){i.timer_J()},a.Timers.TIMER_J),this.transport.send(f)?l&&l():(this.onTransportError(),
n&&n())}}};v.prototype=new f;var l=function(){this.timer_H=function(){console.log(c+"Timer H expired for INVITE server transaction "+this.id);this.state===g.STATUS_COMPLETED&&(console.warn(c+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=g.STATUS_TERMINATED);delete this.ua.transactions.ist[this.id]};this.timer_I=function(){this.state=g.STATUS_TERMINATED;delete this.ua.transactions.ist[this.id]};this.timer_L=function(){console.log(c+"Timer L expired for INVITE server transaction "+
this.id);this.state===g.STATUS_ACCEPTED&&(this.state=g.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])};this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(c+"transport error occurred, deleting INVITE server transaction "+this.id),k.clearTimeout(this.reliableProvisionalTimer),k.clearTimeout(this.L),k.clearTimeout(this.H),k.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])};this.timer_reliableProvisional=function(c){var f=this,g=this.last_response,
l=a.Timers.T1*Math.pow(2,c+1);if(8<c)k.clearTimeout(this.reliableProvisionalTimer);else{c+=1;if(!this.transport.send(g))this.onTransportError();this.reliableProvisionalTimer=k.setTimeout(function(){f.timer_reliableProvisional(c)},l)}};this.receiveResponse=function(c,f,l,n){var i=this;if(100<=c&&199>=c)switch(this.state){case g.STATUS_PROCEEDING:if(!this.transport.send(f))this.onTransportError();this.last_response=f}if(!(100<c&&199>=c))if(200<=c&&299>=c)switch(this.state){case g.STATUS_PROCEEDING:this.state=
g.STATUS_ACCEPTED,this.last_response=f,this.L=k.setTimeout(function(){i.timer_L()},a.Timers.TIMER_L),k.clearTimeout(this.reliableProvisionalTimer);case g.STATUS_ACCEPTED:this.transport.send(f)?l&&l():(this.onTransportError(),n&&n())}else if(300<=c&&699>=c)switch(this.state){case g.STATUS_PROCEEDING:k.clearTimeout(this.reliableProvisionalTimer),this.transport.send(f)?(this.state=g.STATUS_COMPLETED,this.H=k.setTimeout(function(){i.timer_H()},a.Timers.TIMER_H),l&&l()):(this.onTransportError(),n&&n())}}};
l.prototype=new f;i.NonInviteClientTransaction=function(a,c,f){this.init(a,c,f);this.request_sender.ua.transactions.nict[this.id]=this};i.NonInviteClientTransaction.prototype=new n;i.InviteClientTransaction=function(a,c,f){var g=this;this.init(a,c,f);this.request_sender.ua.transactions.ict[this.id]=this;this.request.cancel=function(a){g.cancel_request(g,a)}};i.InviteClientTransaction.prototype=new h;i.AckClientTransaction=function(a,c,f){this.init(a,c,f);this.send=function(){this.transport.send(c)}};
i.AckClientTransaction.prototype=new n;i.NonInviteServerTransaction=function(a,c){this.init(a,c);this.state=g.STATUS_TRYING;c.transactions.nist[this.id]=this};i.NonInviteServerTransaction.prototype=new v;i.InviteServerTransaction=function(a,c){this.init(a,c);this.state=g.STATUS_PROCEEDING;c.transactions.ist[this.id]=this;this.reliableProvisionalTimer=null;a.reply(100)};i.InviteServerTransaction.prototype=new l;i.checkTransaction=function(c,f){var l;switch(f.method){case a.C.INVITE:if(l=c.transactions.ist[f.via_branch]){switch(l.state){case g.STATUS_PROCEEDING:l.transport.send(l.last_response)}return!0}break;
case a.C.ACK:if(l=c.transactions.ist[f.via_branch]){if(l.state===g.STATUS_ACCEPTED)return!1;if(l.state===g.STATUS_COMPLETED)return l.state=g.STATUS_CONFIRMED,l.I=k.setTimeout(function(){l.timer_I()},a.Timers.TIMER_I),!0}else return!1;break;case a.C.CANCEL:if(l=c.transactions.ist[f.via_branch])return l.state===g.STATUS_PROCEEDING?!1:!0;f.reply_sl(481);return!0;default:if(l=c.transactions.nist[f.via_branch]){switch(l.state){case g.STATUS_PROCEEDING:case g.STATUS_COMPLETED:l.transport.send(l.last_response)}return!0}}};
i.C=g;a.Transactions=i})(h);(function(a){var i,c=a.name+" | DIALOG | ",g={STATUS_EARLY:1,STATUS_CONFIRMED:2};i=function(f,n,i,h){var l;if(!n.hasHeader("contact"))return console.error(c+"unable to create a Dialog without Contact header field"),!1;h=n instanceof a.IncomingResponse?200>n.status_code?g.STATUS_EARLY:g.STATUS_CONFIRMED:h||g.STATUS_CONFIRMED;l=n.parseHeader("contact");"UAS"===i?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+
this.remote_tag}},this.state=h,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=l.uri,this.route_set=n.getHeaderAll("record-route")):"UAC"===i&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=h,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.remote_uri=n.parseHeader("to").uri,this.remote_target=
l.uri,this.route_set=n.getHeaderAll("record-route").reverse());this.session=f;f.ua.dialogs[this.id.toString()]=this;console.log(c+"new "+i+" dialog created with status "+(this.state===g.STATUS_EARLY?"EARLY":"CONFIRMED"))};i.prototype={update:function(a,n){this.state=g.STATUS_CONFIRMED;console.log(c+"dialog "+this.id.toString()+"  changed to CONFIRMED state");"UAC"===n&&(this.route_set=a.getHeaderAll("record-route").reverse())},terminate:function(){console.log(c+"dialog "+this.id.toString()+" deleted");
delete this.session.ua.dialogs[this.id.toString()]},createRequest:function(c,g){var i,g=g||[];this.local_seqnum||(this.local_seqnum=Math.floor(1E4*Math.random()));i=c===a.C.CANCEL||c===a.C.ACK?this.local_seqnum:this.local_seqnum+=1;i=new a.OutgoingRequest(c,this.remote_target,this.session.ua,{cseq:i,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},g);i.dialog=this;return i},checkInDialogRequest:function(c){this.remote_seqnum?
c.cseq>this.remote_seqnum&&(this.remote_seqnum=c.cseq):this.remote_seqnum=c.cseq;switch(c.method){case a.C.INVITE:if(c.cseq<this.remote_seqnum){if(this.state===g.STATUS_EARLY){var n=(10*Math.random()|0)+1;c.reply(500,null,["Retry-After:"+n])}else c.reply(500);return!1}if(this.session&&this.session.isMcu)break;if(this.state===g.STATUS_EARLY)return c.reply(491),!1;c.hasHeader("contact")&&(this.remote_target=c.parseHeader("contact").uri);break;case a.C.NOTIFY:c.hasHeader("contact")&&(this.remote_target=
c.parseHeader("contact").uri)}return!0},receiveRequest:function(a){this.checkInDialogRequest(a)&&this.session.receiveRequest(a)}};i.C=g;a.Dialog=i})(h);(function(a){var i,c=a.name+" | REQUEST SENDER | ";i=function(c,f){this.ua=f;this.applicant=c;this.method=c.request.method;this.request=c.request;this.credentials=null;this.staled=this.challenged=!1;if(f.status===a.UA.C.STATUS_USER_CLOSED&&(this.method!==a.C.BYE||this.method!==a.C.ACK))this.onTransportError()};i.prototype={send:function(){switch(this.method){case "INVITE":this.clientTransaction=
new a.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case "ACK":this.clientTransaction=new a.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new a.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(g){var f,
n;n=g.status_code;(401===n||407===n)&&null!==this.ua.configuration.password?(401===g.status_code?(f=g.parseHeader("www-authenticate"),n="authorization"):(f=g.parseHeader("proxy-authenticate"),n="proxy-authorization"),f)?!this.challenged||!this.staled&&!0===f.stale?(this.credentials||(this.credentials=new a.DigestAuthentication(this.ua)),this.credentials.authenticate(this.request,f))?(this.challenged=!0,f.stale&&(this.staled=!0),g.method===a.C.REGISTER?g=this.applicant.cseq+=1:this.request.dialog?
g=this.request.dialog.local_seqnum+=1:(g=this.request.cseq+1,this.request.cseq=g),this.request.setHeader("cseq",g+" "+this.method),this.request.setHeader(n,this.credentials.toString()),this.send()):this.applicant.receiveResponse(g):this.applicant.receiveResponse(g):(console.warn(c+g.status_code+" with wrong or missing challenge, cannot authenticate"),this.applicant.receiveResponse(g)):this.applicant.receiveResponse(g)}};a.RequestSender=i})(h);(function(a){var i;i=function(a){this.applicant=a;this.request=
a.request};i.prototype={send:function(){(new a.RequestSender(this,this.applicant.session.ua)).send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout();this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError();this.applicant.onTransportError()},receiveResponse:function(c){(408===c.status_code||481===c.status_code)&&this.applicant.session.ended("remote",c,a.C.causes.DIALOG_ERROR);this.applicant.receiveResponse(c)}};a.InDialogRequestSender=
i})(h);(function(a){var i,c=a.name+" | REGISTRATOR | ";i=function(c,f){this.ua=c;this.transport=f;this.registrar=c.configuration.registrar_server;this.expires=c.configuration.register_expires;this.min_expires=c.configuration.register_min_expires;this.call_id=a.Utils.createRandomToken(22);this.cseq=80;this.to_uri=c.configuration.uri;this.registrationTimer=null;this.registered=this.registered_before=!1;this.ua.registrator=this;this.contact=this.ua.contact.toString();this.contact+=";reg-id=1";this.contact+=
';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'};i.prototype={register:function(g){var f,n=this,g=g||{},g=g.extraHeaders||[];g.push("Contact: "+this.contact+";expires="+this.expires);g.push("Allow: "+a.Utils.getAllowedMethods(this.ua));this.request=new a.OutgoingRequest(a.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},g);g=new a.RequestSender(this,this.ua);this.receiveResponse=function(g){var i,l,x=g.countHeader("contact");if(g.cseq===
this.cseq)switch(!0){case /^1[0-9]{2}$/.test(g.status_code):break;case /^2[0-9]{2}$/.test(g.status_code):g.hasHeader("expires")&&(l=g.getHeader("expires"));if(!x){console.warn(c+"no Contact header in response to REGISTER, response ignored");break}for(;x--;)if(i=g.parseHeader("contact",x),i.uri.user===this.ua.contact.uri.user){l=i.getParam("expires");break}else i=null;if(!i){console.warn(c+"no Contact header pointing to us, response ignored");break}l||(l=this.expires);this.registrationTimer=k.setTimeout(function(){n.register()},
1E3*l-3E3);i.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=i.getParam("temp-gruu").replace(/"/g,""));i.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=i.getParam("pub-gruu").replace(/"/g,""));this.registered=!0;this.ua.emit("registered",this.ua,{response:g});break;case /^423$/.test(g.status_code):g.hasHeader("min-expires")?(g=g.getHeader("min-expires"),l=g-this.expires,this.registrationTimer=k.setTimeout(function(){n.register()},1E3*this.expires)):(console.warn(c+"423 response received for REGISTER without Min-Expires"),
this.registrationFailure(g,a.C.causes.SIP_FAILURE_CODE));break;default:f=a.Utils.sipErrorCause(g.status_code),this.registrationFailure(g,f)}};this.onRequestTimeout=function(){this.registrationFailure(null,a.C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,a.C.causes.CONNECTION_ERROR)};g.send()},unregister:function(g){var f;this.registered?(g=g||{},f=g.extraHeaders||[],this.registered=!1,k.clearTimeout(this.registrationTimer),g.all?(f.push("Contact: *"),f.push("Expires: 0")):
f.push("Contact: "+this.contact+";expires=0"),this.request=new a.OutgoingRequest(a.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},f),g=new a.RequestSender(this,this.ua),this.receiveResponse=function(c){var f;switch(true){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):this.unregistered(c);break;default:f=a.Utils.sipErrorCause(c.status_code);this.unregistered(c,f)}},this.onRequestTimeout=function(){this.unregistered(null,
a.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,a.C.causes.CONNECTION_ERROR)},g.send()):console.warn(c+"already unregistered")},registrationFailure:function(a,c){this.ua.emit("registrationFailed",this.ua,{response:a||null,cause:c});this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:a||null,cause:c}))},unregistered:function(a,c){this.registered=!1;this.ua.emit("unregistered",this.ua,{response:a||null,cause:c||null})},onTransportClosed:function(){this.registered_before=
this.registered;k.clearTimeout(this.registrationTimer);this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered;this.unregister()}};a.Registrator=i})(h);(function(a){var i=function(a){var c=function(c,f){this.applicant=c;this.request=f||c.request;this.session=c instanceof a.RTCSession?c:c.session;this.reattempt=!1;this.reatemptTimer=null;this.request_sender=new a.InDialogRequestSender(this)};
c.prototype={receiveResponse:function(c){var f=this,g=c.status_code;c.method===a.C.INVITE&&491===g?this.reattempt?this.applicant.receiveResponse(c):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=k.setTimeout(function(){f.session.status!==a.RTCSession.C.STATUS_TERMINATED&&(f.reattempt=!0,f.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(c)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},
onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}};return c}(a),c=function(a){var c=function(a,c){c=c||{};this.session=a;this.peerConnection=this.localMedia=null;this.init(c)};c.prototype={createOffer:function(a,c,f){var g=this,l=!1;g.offerMediaOptions=f;this.onIceCompleted=function(){if(!l){l=!0;if(g.offerMediaOptions)a(g.mSdp);else{var c=g.peerConnection.localDescription.sdp;
if(-1!==c.indexOf("tcp")){c=c.replace(/a=candidate.*tcp.*\r\n/g,"");if(0<g.relayNet.length){var f=g.relayNet.match(/\d+/);null!=f&&(c=c.replace(RegExp("a=candidate.*network-id (?!"+f+")\\d+.*\\r\\n","g"),""));console.log("retain relayNet id:"+f)}c=c.replace(/Content-Length.*\r\n/,"Content-Length= "+c.length+"\r\n")}a(c)}console.log("peerConnetcion.localDescription")}};this.peerConnection.createOffer(function(a){g.setLocalDescription(a,c)},function(a){console.error(n+"unable to create offer");console.error(a);
c()})},createAnswer:function(a,c){var f=this,g=!1;this.onIceCompleted=function(){if(!g){g=!0;var c=f.peerConnection.localDescription.sdp;if(-1!==c.indexOf("tcp")){c=c.replace(/a=candidate.*tcp.*\r\n/g,"");if(0<f.relayNet.length){var l=f.relayNet.match(/\d+/);null!=l&&(c=c.replace(RegExp("a=candidate.*network-id (?!"+l+")\\d+.*\\r\\n","g"),""));console.log("retain relayNet id:"+l)}c=c.replace(/Content-Length.*\r\n/,"Content-Length= "+c.length+"\r\n")}a(c)}};this.peerConnection.createAnswer(function(a){f.setRemoteDescription(a,
c)},function(a){console.error(n+"unable to create answer");console.error(a);c()})},setLocalDescription:function(a,c){var f=a.sdp;this.offerMediaOptions&&this.offerMediaOptions.video.width&&this.offerMediaOptions.video.height&&-1!=a.sdp.search("VP[89]")&&(f=f.replace(/(a=rtpmap:(\d*) VP[89]\/90000\r\n)/,"$1a=fmtp:$2 max-fr="+this.offerMediaOptions.video.framerate+"; max-fs="+this.offerMediaOptions.video.width*this.offerMediaOptions.video.height/256+"\r\n"),this.mSdp=a.sdp=f);-1!==f.indexOf("UDP/TLS/RTP/SAVPF")&&
(f=f.replace(/UDP\/TLS\/RTP\/SAVPF/g,"RTP/SAVPF"),this.mSdp=a.sdp=f);this.peerConnection.setLocalDescription(a,function(){console.log("Set localDscription success")},function(a){console.error(n+"unable to set local description");console.error(a);c()})},setRemoteDescription:function(a,c){this.peerConnection.setLocalDescription(a,function(){console.log("Create Answer")},function(a){console.error(n+"unable to set remote description");console.error(a);c()})},addStream:function(a,c,f){try{this.peerConnection.addStream(a)}catch(g){console.error(n+
"error adding stream");console.error(g);f();return}c()},init:function(c){var f,g,l,i,h=!1;timerGathering=null;self=this;servers=[];for(f in this.session.ua.configuration.stun_servers)g=this.session.ua.configuration.stun_servers[f],i=g.server,l=i.substr(0,i.indexOf(":")),servers.push({url:l+":"+g.username+"@"+i.substr(l.length+1),credential:g.password}),console.log(n+"iceServers : "+g.server);for(f in this.session.ua.configuration.turn_servers)g=this.session.ua.configuration.turn_servers[f],i=g.server,
l=i.substr(0,i.indexOf(":")),servers.push({url:l+":"+g.username+"@"+i.substr(l.length+1),credential:g.password});this.peerConnection="undefined"!==typeof mozRTCPeerConnection?new a.WebRTC.RTCPeerConnection(servers,c):new a.WebRTC.RTCPeerConnection({iceServers:servers,bundlePolicy:"balanced",rtcpMuxPolicy:"negotiate"},c);this.peerConnection.onaddstream=function(a){console.log(n+"stream added: "+a.stream.id)};this.peerConnection.onremovestream=function(a){console.log(n+"stream removed: "+a.stream.id)};
this.peerConnection.onicecandidate=function(a){console.log(a.candidate);if(a.candidate){a=a.candidate.candidate;console.log(n+"ICE candidate received: "+a);var c=a.match(/network-id \d*/);null!=c&&-1!=a.indexOf("relay")&&!1==h&&(self.relayNet=c.toString(),-1==a.indexOf("network-cost")&&(h=!0));null==timerGathering&&(timerGathering=setTimeout(function(){console.log("ice gathering timeout !");self.onIceCompleted();h=false},5E3))}else self.onIceCompleted(),clearTimeout(timerGathering),h=!1};this.peerConnection.onicegatheringstatechange=
function(){console.log(n+'ICE gathering state changed to "'+this.iceGatheringState+'"')};this.peerConnection.oniceconnectionstatechange=function(){console.log(n+'ICE connection state changed to "'+this.iceConnectionState+'"')};this.peerConnection.onconnectionstatechange=function(){console.log(n+'PeerConnection state changed to "'+this.connectionState+'"')}},close:function(){console.log(n+"closing PeerConnection");this.peerConnection&&(this.peerConnection.close(),this.localMedia&&this.localMedia.active&&
(0<this.localMedia.getAudioTracks().length&&this.localMedia.getAudioTracks()[0].stop(),0<this.localMedia.getVideoTracks().length&&this.localMedia.getVideoTracks()[0].stop()))},getUserMedia:function(c,f,g){var l=this;console.log(n+"requesting access to local media");g&&g.screen?getScreenId(function(i,h,A){g.multi&&(A.video.mandatory.maxWidth=g.video.mandatory.maxWidth,A.video.mandatory.maxHeight=g.video.mandatory.maxHeight,delete g.multi);a.WebRTC.getUserMedia(A,function(a){console.log(n+"got local media stream");
l.localMedia=a;c(a)},function(a){alert(JSON.stringify(a,null,"\t"));console.error(n+"unable to get user media");console.error(e);f()})}):(delete g.screen,a.WebRTC.getUserMedia(g,function(a){console.log(n+"got local media stream");l.localMedia=a;c(a)},function(a){console.error(n+"unable to get user media");console.error(a);f()}))},onMessage:function(c,f,g,l){f=f.replace(/RTP\/SAVPF 100\r\n/,"RTP/SAVPF 100 116 117\r\na=rtpmap:116 red/90000\r\na=rtpmap:117 ulpfec/90000\r\n");this.peerConnection.setRemoteDescription(new a.WebRTC.RTCSessionDescription({type:c,
sdp:f}),g,l)}};return c}(a),g=function(a){var c,f={MIN_DURATION:70,MAX_DURATION:6E3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};c=function(a){this.session=a;this.duration=this.tone=this.direction=null;this.initEvents(["succeeded","failed"])};c.prototype=new a.EventEmitter;c.prototype.send=function(c,g){var l,h,A;if(void 0===c)throw new TypeError("Not enough arguments");this.direction="outgoing";if(this.session.status!==a.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==
a.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.session.status);g=g||{};A=g.extraHeaders?g.extraHeaders.slice():[];h=g.eventHandlers||{};if("string"===typeof c)c=c.toUpperCase();else if("number"===typeof c)c=c.toString();else throw new TypeError("Invalid tone: "+c);if(c.match(/^[0-9A-D#*]$/))this.tone=c;else throw new TypeError("Invalid tone: "+c);if(g.duration&&!a.Utils.isDecimal(g.duration))throw new TypeError("Invalid tone duration: "+g.duration);g.duration?
g.duration<f.MIN_DURATION?(console.warn(n+'"duration" value is lower than the minimum allowed, setting it to '+f.MIN_DURATION+" milliseconds"),g.duration=f.MIN_DURATION):g.duration>f.MAX_DURATION?(console.warn(n+'"duration" value is greater than the maximum allowed, setting it to '+f.MAX_DURATION+" milliseconds"),g.duration=f.MAX_DURATION):g.duration=Math.abs(g.duration):g.duration=f.DEFAULT_DURATION;this.duration=g.duration;for(l in h)this.on(l,h[l]);A.push("Content-Type: application/dtmf-relay");
this.request=this.session.dialog.createRequest(a.C.INFO,A);this.request.body="Signal= "+this.tone+"\r\n";this.request.body+="Duration= "+this.duration;l=new i(this);this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request});l.send()};c.prototype.receiveResponse=function(c){var f;switch(!0){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):this.emit("succeeded",this,{originator:"remote",response:c});break;default:f=a.Utils.sipErrorCause(c.status_code),
this.emit("failed",this,{originator:"remote",response:c,cause:f})}};c.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})};c.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:a.C.causes.CONNECTION_ERROR})};c.prototype.init_incoming=function(a){var c,f=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,g=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming";this.request=a;a.reply(200);if(a.body&&
(c=a.body.split("\r\n"),2===c.length&&(f.test(c[0])&&(this.tone=c[0].replace(f,"$2")),g.test(c[1]))))this.duration=parseInt(c[1].replace(g,"$2"),10);!this.tone||!this.duration?console.warn(n+"invalid INFO DTMF received, discarded"):this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:a})};c.C=f;return c}(a),f,n=a.name+" | RTC SESSION | ",h={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_WAITING_FOR_ACK:5,
STATUS_CANCELED:6,STATUS_TERMINATED:7,STATUS_CONFIRMED:8};f=function(a){this.ua=a;this.status=h.STATUS_NULL;this.dialog=null;this.earlyDialogs=[];this.rtcMediaHandler=null;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,updateTimer:null};this.end_time=this.start_time=this.remote_identity=this.local_identity=this.direction=null;this.data={};this.initEvents("progress,failed,started,ended,newDTMF,startRecordLocal,endRecordLocal,startRecordRemote,endRecordRemote".split(","))};
f.prototype=new a.EventEmitter;f.prototype.terminate=function(c){var c=c||{},f,g=c.status_code,i=c.reason_phrase,r=c.extraHeaders||[],k=c.body;if(this.status===h.STATUS_TERMINATED)throw new a.Exceptions.InvalidStateError(this.status);switch(this.status){case h.STATUS_NULL:case h.STATUS_INVITE_SENT:case h.STATUS_1XX_RECEIVED:console.log(n+"canceling RTCSession");if(g&&(200>g||700<=g))throw new TypeError("Invalid status_code: "+g);g&&(i=i||a.C.REASON_PHRASE[g]||"",f="SIP ;cause="+g+' ;text="'+i+'"');
this.status===h.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=f):this.status===h.STATUS_INVITE_SENT?this.received_100?this.request.cancel(f):(this.isCanceled=!0,this.cancelReason=f):this.status===h.STATUS_1XX_RECEIVED&&this.request.cancel(f);this.failed("local",null,a.C.causes.CANCELED);break;case h.STATUS_WAITING_FOR_ANSWER:console.log(n+"rejecting RTCSession");g=g||603;if(300>g||700<=g)throw new TypeError("Invalid status_code: "+g);this.request.reply(g,i,r,k);this.failed("local",null,a.C.causes.REJECTED);
break;case h.STATUS_WAITING_FOR_ACK:case h.STATUS_CONFIRMED:console.log(n+"terminating RTCSession"),this.sendBye(c),this.ended("local",null,a.C.causes.BYE)}c.unNormal&&!0==c.unNormal&&this.ua.unregister();this.close()};f.prototype.answer=function(c){var c=c||{},f=this,g=this.request,i=c.extraHeaders||[],r=c.mediaConstraints||{audio:!0,video:!0},y=function(){f.isMcu?"video"==f.roomInfo.remoteMedia&&r.video?f.rtcMediaHandler.createOffer(w,z,{audio:{},video:{width:640,height:480,framerate:30}}):f.rtcMediaHandler.createOffer(w,
z):f.rtcMediaHandler.createAnswer(w,z,r)},o=function(){f.status!==h.STATUS_TERMINATED&&f.failed("local",null,a.C.causes.WEBRTC_ERROR)},w=function(c){i.push("Contact: "+f.contact);i.push("Session-Expires:"+a.Timers.TIMER_N+";refresher=uac");i.push("Allow: "+a.Utils.getAllowedMethods(f.ua));g.reply(200,null,i,c,function(){f.status=h.STATUS_WAITING_FOR_ACK;f.timers.invite2xxTimer=k.setTimeout(function I(i){var i=i||1,n=a.Timers.T1*Math.pow(2,i);i*a.Timers.T1<=a.Timers.T2?(i+=1,g.reply(200,null,["Contact: "+
f.contact],c),f.timers.invite2xxTimer=k.setTimeout(I(i),n)):k.clearTimeout(f.timers.invite2xxTimer)},a.Timers.T1);f.timers.ackTimer=k.setTimeout(function(){f.status===h.STATUS_WAITING_FOR_ACK&&(console.log(n+"no ACK received, terminating the call"),k.clearTimeout(f.timers.invite2xxTimer),f.sendBye(),f.ended("remote",null,a.C.causes.NO_ACK))},a.Timers.TIMER_H);f.started("local")},function(){f.failed("system",null,a.C.causes.CONNECTION_ERROR)})},z=function(){f.status!==h.STATUS_TERMINATED&&f.failed("local",
null,a.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');if(this.status!==h.STATUS_WAITING_FOR_ANSWER)throw new a.Exceptions.InvalidStateError(this.status);this.createDialog(g,"UAS")?(k.clearTimeout(this.timers.userNoAnswerTimer),this.rtcMediaHandler.getUserMedia(function(a){f.rtcMediaHandler.addStream(a,y,o)},function(){g.reply(480);f.failed("local",null,a.C.causes.USER_DENIED_MEDIA_ACCESS)},r)):g.reply(500,"Missing Contact header field")};
f.prototype.sendDTMF=function(c,f){function i(){var a,n=new g(o);n.on("failed",function(){w=!1});a=c[y];y+=1;n.send(a,f)}var p,r,y=0,o=this,w=!0,f=f||{};r=f.interToneGap||null;if(void 0===c)throw new TypeError("Not enough arguments");if(this.status!==h.STATUS_CONFIRMED&&this.status!==h.STATUS_WAITING_FOR_ACK)throw new a.Exceptions.InvalidStateError(this.status);if(!c||"string"!==typeof c&&"number"!==typeof c||!c.toString().match(/^[0-9A-D#*]+$/i))throw new TypeError("Invalid tones: "+c);c=c.toString();
if(r&&!a.Utils.isDecimal(r))throw new TypeError("Invalid interToneGap: "+r);r?r<g.C.MIN_INTER_TONE_GAP?(console.warn(n+'"interToneGap" value is lower than the minimum allowed, setting it to '+g.C.MIN_INTER_TONE_GAP+" milliseconds"),r=g.C.MIN_INTER_TONE_GAP):r=Math.abs(r):r=g.C.DEFAULT_INTER_TONE_GAP;i();p=k.setInterval(function(){o.status!==h.STATUS_TERMINATED&&w&&c.length>y?i():k.clearInterval(p)},r)};f.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&
this.rtcMediaHandler.peerConnection.getLocalStreams()||[]};f.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]};f.prototype.init_incoming=function(f,g){var i,p=this,r=f.getHeader("Content-Type");if(f.headers["Alert-Info"]&&-1!=f.headers["Alert-Info"][0].raw.indexOf("gvcname")){this.isMcu=!0;this.roomInfo={};var y=/^.*gvctype=(.*);gvcid=(.*);gvcname=(.*)$/.exec(f.headers["Alert-Info"][0].raw);
this.roomInfo.gvctype=y[1];this.roomInfo.gvcid=y[2];this.roomInfo.gvcname=y[3];switch(this.roomInfo.gvctype){case "0":this.roomInfo.gvctype_cn="\u8bed\u97f3\u7fa4\u804a";break;case "1":this.roomInfo.gvctype_cn="\u8bed\u97f3\u5bf9\u8bb2";break;case "2":this.roomInfo.gvctype_cn="\u4e24\u65b9\u8bed\u97f3";break;case "9":this.roomInfo.gvctype_cn="\u8bed\u97f3\u76f4\u64ad";break;case "20":this.roomInfo.gvctype_cn="\u89c6\u9891\u7fa4\u804a";break;case "21":this.roomInfo.gvctype_cn="\u89c6\u9891\u5bf9\u8bb2";
break;case "22":this.roomInfo.gvctype_cn="\u4e24\u65b9\u89c6\u9891";break;case "29":this.roomInfo.gvctype_cn="\u89c6\u9891\u76f4\u64ad"}this.roomInfo.remoteMedia=2==this.roomInfo.gvctype.length?"video":"audio"}!this.isMcu&&(!f.body||"application/sdp"!==r)?f.reply(415):(this.status=h.STATUS_INVITE_RECEIVED,this.from_tag=f.from_tag,this.id=f.call_id+this.from_tag,this.request=f,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,f.hasHeader("expires")&&(i=1E3*f.getHeader("expires")),
f.to_tag=a.Utils.newTag(),this.createDialog(f,"UAS",!0)?this.isMcu?(f.reply(180,null,["Contact: "+p.contact]),p.status=h.STATUS_WAITING_FOR_ANSWER,p.timers.userNoAnswerTimer=k.setTimeout(function(){f.reply(408);p.failed("local",null,a.C.causes.NO_ANSWER)},p.ua.configuration.no_answer_timeout),i&&(p.timers.expiresTimer=k.setTimeout(function(){p.status===h.STATUS_WAITING_FOR_ANSWER&&(f.reply(487),p.failed("system",null,a.C.causes.EXPIRES))},i)),this.rtcMediaHandler=new c(this),p.newRTCSession("remote",
f)):(this.rtcMediaHandler=new c(this,g),this.rtcMediaHandler.onMessage("offer",f.body,function(){f.reply(180,null,["Contact: "+p.contact]);p.status=h.STATUS_WAITING_FOR_ANSWER;p.timers.userNoAnswerTimer=k.setTimeout(function(){f.reply(408);p.failed("local",null,a.C.causes.NO_ANSWER)},p.ua.configuration.no_answer_timeout);i&&(p.timers.expiresTimer=k.setTimeout(function(){p.status===h.STATUS_WAITING_FOR_ANSWER&&(f.reply(487),p.failed("system",null,a.C.causes.EXPIRES))},i));p.newRTCSession("remote",
f)},function(a){console.warn(n+"invalid SDP");console.warn(a);f.reply(488)})):f.reply(500,"Missing Contact header field"))};f.prototype.connect=function(f,g){var g=g||{},i,n=!1,r=g.eventHandlers||{},k=g.extraHeaders||[],o=g.mediaConstraints||{audio:!0,video:!0},w=g.RTCConstraints||{};console.log("RTCConstraints:"+w);if(void 0===f)throw new TypeError("Not enough arguments");if(this.status!==h.STATUS_NULL)throw new a.Exceptions.InvalidStateError(this.status);for(i in r)this.on(i,r[i]);try{f=a.Utils.normalizeURI(f,
this.ua.configuration.hostport_params)}catch(z){f=a.URI.parse(a.C.INVALID_TARGET_URI),n=!0}this.from_tag=a.Utils.newTag();this.rtcMediaHandler=new c(this,w);this.anonymous=g.anonymous;this.received_100=this.isCanceled=!1;i={from_tag:this.from_tag};this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0});this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",k.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),k.push("Privacy: id"));
k.push("Contact: "+this.contact);k.push("Allow: "+a.Utils.getAllowedMethods(this.ua));k.push("Call-Info: "+g.extraParas);k.push("Content-Type: application/sdp");k.push("Session-Expires: "+a.Timers.TIMER_N);this.request=new a.OutgoingRequest(a.C.INVITE,f,this.ua,i,k);this.id=this.request.call_id+this.from_tag;this.ua.sessions[this.id]=this;this.newRTCSession("local",this.request);n?this.failed("local",null,a.C.causes.INVALID_TARGET):a.WebRTC.isSupported?this.sendInitialRequest(o):this.failed("local",
null,a.C.causes.WEBRTC_NOT_SUPPORTED)};f.prototype.close=function(){var a;if(this.status!==h.STATUS_TERMINATED){console.log(n+"closing INVITE session "+this.id);this.rtcMediaHandler&&this.rtcMediaHandler.close();for(a in this.timers)k.clearTimeout(this.timers[a]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(a in this.earlyDialogs)this.earlyDialogs[a].terminate(),delete this.earlyDialogs[a];this.status=h.STATUS_TERMINATED;this.ua.curSession=null;delete this.ua.sessions[this.id]}};
f.prototype.createDialog=function(c,f,g){var i,n=c.call_id+("UAS"===f?c.to_tag:c.from_tag)+("UAS"===f?c.from_tag:c.to_tag);i=this.earlyDialogs[n];if(g){if(i)return!0;i=new a.Dialog(this,c,f,a.Dialog.C.STATUS_EARLY);if(i.id)return this.earlyDialogs[n]=i,!0;this.failed("remote",c,a.C.causes.INTERNAL_ERROR);return!1}if(i)return i.update(c,f),this.dialog=i,delete this.earlyDialogs[n],!0;f=new a.Dialog(this,c,f);if(f.id)return this.to_tag=c.to_tag,this.dialog=f,!0;this.failed("remote",c,a.C.causes.INTERNAL_ERROR);
return!1};f.prototype.receiveRequest=function(c){var f,i=this;if(c.method===a.C.CANCEL)this.request.reply(487),this.status===h.STATUS_WAITING_FOR_ANSWER&&(this.status=h.STATUS_CANCELED,this.failed("remote",c,a.C.causes.CANCELED));else switch(c.method){case a.C.ACK:if(this.status===h.STATUS_WAITING_FOR_ACK&&(k.clearTimeout(this.timers.ackTimer),k.clearTimeout(this.timers.invite2xxTimer),this.status=h.STATUS_CONFIRMED,i.isMcu))this.rtcMediaHandler.onMessage("answer",c.body,function(){i.status=h.STATUS_CONFIRMED;
i.started("remote")},function(c){console.warn(c);session.acceptAndTerminate(response,488,"Not Acceptable Here");session.failed("remote",response,a.C.causes.BAD_MEDIA_DESCRIPTION)});break;case a.C.BYE:this.status===h.STATUS_CONFIRMED&&(c.reply(200),this.ended("remote",c,a.C.causes.BYE));break;case a.C.INVITE:this.status===h.STATUS_WAITING_FOR_ACK&&c.reply(491);if(this.status===h.STATUS_CONFIRMED||this.isMcu)f=[],f.push("Session-Expires:"+a.Timers.TIMER_N+";refresher=uac"),f.push("Allow: ACK,CANCEL,BYE,OPTIONS,UPDATE,INVITE"),
c.reply(200,null,f,this.rtcMediaHandler.peerConnection.localDescription.sdp),console.log(n+"re-INVITE received");break;case a.C.INFO:if(this.status===h.STATUS_CONFIRMED||this.status===h.STATUS_WAITING_FOR_ACK)(f=c.getHeader("content-type"))&&f.match(/^application\/dtmf-relay/i)&&(new g(this)).init_incoming(c);break;case a.C.UPDATE:f=[];f.push("Session-Expires:"+a.Timers.TIMER_N+";refresher=uac");c.reply(200,null,f);k.clearTimeout(this.timers.updateTimer);this.timers.updateTimer=k.setTimeout(function(c){cause=
a.C.causes.UNAVAILABLE;c.failed("remote",null,cause)},2E3*a.Timers.TIMER_N,this);break;case a.C.NOTIFY:-1!=c.body.indexOf("kickedBy")?(this.ua.unregister(),this.ua.emit("notifyKickby",this,{body:c.body})):-1!=c.body.indexOf("multiLogin")&&this.ua.emit("notifyMultiLogin",this,{body:c.body})}};f.prototype.sendInitialRequest=function(c){var f=this,g=new a.RequestSender(f,this.ua),i=function(){f.rtcMediaHandler.createOffer(k,o)},n=function(){f.status!==h.STATUS_TERMINATED&&f.failed("local",null,a.C.causes.WEBRTC_ERROR)},
k=function(a){f.isCanceled||f.status===h.STATUS_TERMINATED||(a=a.replace(/sendrecv/g,c.direction),f.request.body=a,f.status=h.STATUS_INVITE_SENT,g.send())},o=function(){f.status!==h.STATUS_TERMINATED&&f.failed("local",null,a.C.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(function(a){f.rtcMediaHandler.addStream(a,i,n)},function(){f.status!==h.STATUS_TERMINATED&&f.failed("local",null,a.C.causes.USER_DENIED_MEDIA_ACCESS)},c)};f.prototype.receiveResponse=function(c){var f,g=this;500==c.status_code&&
(f=a.C.causes.UNAVAILABLE,this.failed("remote",null,f));403==c.status_code&&this.failed("remote",null,"Forbidden");if(!(this.status!==h.STATUS_INVITE_SENT&&this.status!==h.STATUS_1XX_RECEIVED))if(this.isCanceled)100<=c.status_code&&200>c.status_code?this.request.cancel(this.cancelReason):200<=c.status_code&&299>c.status_code&&this.acceptAndTerminate(c);else switch(!0){case /^100$/.test(c.status_code):this.received_100=!0;break;case /^1[0-9]{2}$/.test(c.status_code):if(!c.to_tag){console.warn(n+"1xx response received without to tag");
break}c.hasHeader("contact")&&this.createDialog(c,"UAC",!0);this.status=h.STATUS_1XX_RECEIVED;this.progress("remote",c);break;case /^2[0-9]{2}$/.test(c.status_code):if(this.dialog||g.status==h.STATUS_CONFIRMED)break;g.status=h.STATUS_CONFIRMED;if(!c.body){this.acceptAndTerminate(c,400,"Missing session description");this.failed("remote",c,a.C.causes.BAD_MEDIA_DESCRIPTION);break}this.rtcMediaHandler.onMessage("answer",c.body,function(){if(g.createDialog(c,"UAC")){g.sendACK();g.sendUPDATE();g.status=
h.STATUS_CONFIRMED;g.started("remote",c)}},function(f){console.warn(f);g.acceptAndTerminate(c,488,"Not Acceptable Here");g.failed("remote",c,a.C.causes.BAD_MEDIA_DESCRIPTION)});break;default:f=a.Utils.sipErrorCause(c.status_code),this.failed("remote",c,f)}};f.prototype.acceptAndTerminate=function(a,c,f){if(this.dialog||this.createDialog(a,"UAC"))this.sendACK(),this.sendBye({status_code:c,reason_phrase:f})};f.prototype.sendACK=function(){this.sendRequest(this.dialog.createRequest(a.C.ACK))};f.prototype.sendUPDATE=
function(){var c=[];c.push("Session-Expires:"+a.Timers.TIMER_N+";refresher=uas");this.sendRequest(this.dialog.createRequest(a.C.UPDATE,c));this.timers.updateTimer=k.setTimeout(function(a){a.sendUPDATE()},1E3*a.Timers.TIMER_N,this)};f.prototype.sendBye=function(c){var c=c||{},f;f=c.status_code;var g=c.reason_phrase||a.C.REASON_PHRASE[f]||"",i=c.extraHeaders||[],c=c.body;if(f&&(200>f||700<=f))throw new TypeError("Invalid status_code: "+f);f&&i.push("Reason: "+("SIP ;cause="+f+'; text="'+g+'"'));f=this.dialog.createRequest(a.C.BYE,
i);f.body=c;this.sendRequest(f)};f.prototype.sendRequest=function(a){(new i(this,a)).send()};f.prototype.onTransportError=function(){this.status!==h.STATUS_TERMINATED&&(this.status===h.STATUS_CONFIRMED?this.ended("system",null,a.C.causes.CONNECTION_ERROR):this.failed("system",null,a.C.causes.CONNECTION_ERROR))};f.prototype.onRequestTimeout=function(){this.status!==h.STATUS_TERMINATED&&(this.status===h.STATUS_CONFIRMED?this.ended("system",null,a.C.causes.REQUEST_TIMEOUT):this.failed("system",null,
a.C.causes.CONNECTION_ERROR))};f.prototype.newRTCSession=function(a,c){"remote"===a?(this.direction="incoming",this.local_identity=c.to,this.remote_identity=c.from):"local"===a&&(this.direction="outgoing",this.local_identity=c.from,this.remote_identity=c.to);this.ua.emit("newRTCSession",this.ua,{originator:a,session:this,request:c})};f.prototype.connecting=function(a,c){this.emit("connecting",this,{originator:"local",request:c})};f.prototype.progress=function(a,c){this.emit("progress",this,{originator:a,
response:c||null})};f.prototype.started=function(a,c){this.start_time=new Date;this.emit("started",this,{response:c||null})};f.prototype.ended=function(a,c,f){this.end_time=new Date;this.emit("ended",this,{originator:a,message:c||null,cause:f});this.close()};f.prototype.failed=function(a,c,f){this.emit("failed",this,{originator:a,message:c||null,cause:f});this.close()};f.C=h;a.RTCSession=f})(h);(function(a){var i;i=function(a){this.ua=a;this.remote_identity=this.local_identity=this.direction=null;
this.data={}};i.prototype=new a.EventEmitter;i.prototype.send=function(c,g,f){var i,h,k,l=!1;if(void 0===c||void 0===g)throw new TypeError("Not enough arguments");this.initEvents(["succeeded","failed"]);f=f||{};k=f.extraHeaders||[];h=f.eventHandlers||{};f=f.contentType||"text/plain";for(i in h)this.on(i,h[i]);try{c=a.Utils.normalizeURI(c,this.ua.configuration.hostport_params)}catch(x){c=a.URI.parse(a.C.INVALID_TARGET_URI),l=!0}this.direction="outgoing";this.local_identity=this.ua.configuration.uri;
this.remote_identity=c;this.closed=!1;this.ua.applicants[this]=this;k.push("Content-Type: "+f);this.request=new a.OutgoingRequest(a.C.MESSAGE,c,this.ua,null,k);g&&(this.request.body=g);c=new a.RequestSender(this,this.ua);this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request});l?this.emit("failed",this,{originator:"local",cause:a.C.causes.INVALID_TARGET}):c.send()};i.prototype.receiveResponse=function(c){var g;if(!this.closed)switch(!0){case /^1[0-9]{2}$/.test(c.status_code):break;
case /^2[0-9]{2}$/.test(c.status_code):delete this.ua.applicants[this];this.emit("succeeded",this,{originator:"remote",response:c});break;default:delete this.ua.applicants[this],g=a.Utils.sipErrorCause(c.status_code),this.emit("failed",this,{originator:"remote",response:c,cause:g})}};i.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:a.C.causes.REQUEST_TIMEOUT})};i.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",
cause:a.C.causes.CONNECTION_ERROR})};i.prototype.close=function(){this.closed=!0;delete this.ua.applicants[this]};i.prototype.init_incoming=function(c){var g;g=c.getHeader("content-type");this.direction="incoming";this.request=c;this.local_identity=c.to.uri;this.remote_identity=c.from.uri;g&&(g.match(/^text\/plain(\s*;\s*.+)*$/i)||g.match(/^text\/html(\s*;\s*.+)*$/i))?(this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,request:c}),(g=this.ua.transactions.nist[c.via_branch])&&(g.state===
a.Transactions.C.STATUS_TRYING||g.state===a.Transactions.C.STATUS_PROCEEDING)&&c.reply(200)):c.reply(415,null,["Accept: text/plain, text/html"])};i.prototype.accept=function(a){var a=a||{},g=a.extraHeaders||[],a=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,g,a)};i.prototype.reject=function(a){var a=a||{},g=a.status_code||480,f=a.reason_phrase,i=a.extraHeaders||[],a=a.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');
if(300>g||700<=g)throw new TypeError("Invalid status_code: "+g);this.request.reply(g,f,i,a)};a.Message=i})(h);(function(a){var i,c=a.name+" | UA | ",g={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE",newMessage:"MESSAGE"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS","UPDATE"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED:"path, outbound, gruu, timer",MAX_FORWARDS:69,TAG_LENGTH:10};
i=function(a){var c="connected,disconnected,registered,unregistered,registrationFailed,newRTCSession,newMessage,notifyKickby,notifyMultiLogin,notifyRoom".split(",");g.ACCEPTED_BODY_TYPES=g.ACCEPTED_BODY_TYPES.toString();this.cache={credentials:{}};this.configuration={};this.dialogs={};this.curSession=this.registrator=null;this.applicants={};this.sessions={};this.contact=this.transport=null;this.status=g.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.transportRecoverAttempts=
0;if(void 0===a)throw new TypeError("Not enough arguments");try{this.loadConfig(a),this.initEvents(c)}catch(i){throw this.status=g.STATUS_NOT_READY,this.error=g.CONFIGURATION_ERROR,i;}};i.prototype=new a.EventEmitter;i.prototype.register=function(a){this.configuration.register=!0;this.registrator.register(a)};i.prototype.unregister=function(a){this.configuration.register=!1;this.registrator.unregister(a)};i.prototype.isRegistered=function(){return this.registrator&&this.registrator.registered?!0:
!1};i.prototype.isConnected=function(){return this.transport?this.transport.connected:!1};i.prototype.call=function(c,g){var i;i=new a.RTCSession(this);i.connect(c,g);this.curSession=i};i.prototype.sendMessage=function(c,g,i){(new a.Message(this)).send(c,g,i)};i.prototype.startRecordLocal=function(a){var c=this.curSession;c.emit("startRecordLocal",c,{type:a})};i.prototype.stopRecordLocal=function(){var a=this.curSession;a.emit("endRecordLocal",a,{response:null})};i.prototype.startRecordRemote=function(a){var c=
this.curSession;c.emit("startRecordRemote",c,{type:a})};i.prototype.stopRecordRemote=function(){var a=this.curSession;a.emit("endRecordRemote",a,{response:null})};i.prototype.stop=function(){var a,i,h=this;console.log(c+"user requested closure...");if(this.status===g.STATUS_USER_CLOSED)console.warn("UA already closed");else{this.registrator&&(console.log(c+"closing registrator"),this.registrator.close());for(a in this.sessions)console.log(c+"closing session "+a),this.sessions[a].terminate();for(i in this.applicants)this.applicants[i].close();
this.status=g.STATUS_USER_CLOSED;this.shutdownGraceTimer=k.setTimeout(function(){h.transport.disconnect()},"5000")}};i.prototype.start=function(){var f;console.log(c+"user requested startup...");this.status===g.STATUS_INIT?(f=this.getNextWsServer(),new a.Transport(this,f)):this.status===g.STATUS_USER_CLOSED?(console.log(c+"resuming"),this.status=g.STATUS_READY,this.transport.connect()):this.status===g.STATUS_READY?console.log(c+"UA is in READY status, not resuming"):console.error("Connection is down. Auto-Recovery system is trying to connect")};
i.prototype.saveCredentials=function(a){this.cache.credentials[a.realm]=this.cache.credentials[a.realm]||{};this.cache.credentials[a.realm][a.uri]=a};i.prototype.getCredentials=function(a){var c,g;c=a.ruri.host;this.cache.credentials[c]&&this.cache.credentials[c][a.ruri]&&(g=this.cache.credentials[c][a.ruri],g.method=a.method);return g};i.prototype.onTransportClosed=function(f){var g,i,h=["nict","ict","nist","ist"];f.server.status=a.Transport.C.STATUS_DISCONNECTED;console.log(c+"connection state set to "+
a.Transport.C.STATUS_DISCONNECTED);for(g in h)for(i in this.transactions[h[g]])this.transactions[h[g]][i].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()};i.prototype.onTransportError=function(f){console.log(c+"transport "+f.server.ws_uri+" failed | connection state set to "+a.Transport.C.STATUS_ERROR);f.server.status=a.Transport.C.STATUS_ERROR;this.emit("disconnected",this,{transport:f,code:f.lastTransportError.code,reason:f.lastTransportError.reason});if(f=this.getNextWsServer())new a.Transport(this,
f);else{this.closeSessionsOnTransportError();if(!this.error||this.error!==g.NETWORK_ERROR)this.status=g.STATUS_NOT_READY,this.error=g.NETWORK_ERROR;this.recoverTransport()}};i.prototype.onTransportConnected=function(f){this.transport=f;this.transportRecoverAttempts=0;f.server.status=a.Transport.C.STATUS_READY;console.log(c+"connection state set to "+a.Transport.C.STATUS_READY);if(this.status!==g.STATUS_USER_CLOSED)if(this.status=g.STATUS_READY,this.error=null,this.emit("connected",this,{transport:f}),
this.configuration.register)if(this.registrator)this.registrator.onTransportConnected();else this.registrator=new a.Registrator(this,f),this.register();else this.registrator=new a.Registrator(this,f)};i.prototype.setSE=function(c){a.Timers.TIMER_N=c};i.prototype.receiveRequest=function(f){var i,h=f.method;if(f.ruri.user!==this.configuration.uri.user&&f.ruri.user!==this.contact.uri.user)console.warn(c+"Request-URI does not point to us"),f.method!==a.C.ACK&&f.reply_sl(404);else if(!a.Transactions.checkTransaction(this,
f)){h===a.C.INVITE?new a.Transactions.InviteServerTransaction(f,this):h!==a.C.ACK&&new a.Transactions.NonInviteServerTransaction(f,this);if(h===a.C.OPTIONS)f.reply(200,null,["Allow: "+a.Utils.getAllowedMethods(this),"Accept: "+g.ACCEPTED_BODY_TYPES]);else if(h===a.C.MESSAGE){if(!this.checkEvent("newMessage")||0===this.listeners("newMessage").length){f.reply(405,null,["Allow: "+a.Utils.getAllowedMethods(this)]);return}i=new a.Message(this);i.init_incoming(f);return}if(f.to_tag)(i=this.findDialog(f))?
i.receiveRequest(f):h===a.C.NOTIFY?(i=this.findSession(f))?i.receiveRequest(f):(console.warn(c+"received NOTIFY request for a non existent session"),f.reply(481,"Subscription does not exist")):h!==a.C.ACK&&f.reply(481);else if(this.isRegistered())switch(h){case a.C.INVITE:if(a.WebRTC.isSupported){if(this.curSession){f.reply(486);break}this.curSession=i=new a.RTCSession(this);i.init_incoming(f,{optional:[{DtlsSrtpKeyAgreement:"false"}]});i=f.headers["Session-Expires"];f=f.getHeader("Min-SE");i=parseInt(i[0].raw);
a.Timers.TIMER_N>i?a.Timers.TIMER_N=i:a.Timers.TIMER_N<parseInt(f)&&(a.Timers.TIMER_N=parseInt(f))}else console.warn(c+"INVITE received but WebRTC is not supported"),f.reply(488);break;case a.C.BYE:f.reply(481);break;case a.C.CANCEL:f.reply(200);(i=this.findSession(f))?i.receiveRequest(f):console.warn(c+"received CANCEL request for a non existent session");break;case a.C.ACK:break;case a.C.NOTIFY:f.reply(200);-1!=f.body.indexOf("kickedBy")?(this.stop(),this.emit("notifyKickby",this,{body:f.body})):
-1!=f.body.indexOf("multiLogin")&&this.emit("notifyMultiLogin",this,{body:f.body});-1!=f.body.indexOf("ChangedInfo")&&this.emit("notifyRoom",this,{body:f.body});break;default:f.reply(405)}else f.reply(410)}};i.prototype.findSession=function(a){var c=this.sessions[a.call_id+a.from_tag],a=this.sessions[a.call_id+a.to_tag];return c?c:a?a:null};i.prototype.findDialog=function(a){var c=a.call_id+a.from_tag+a.to_tag;if(c=this.dialogs[c])return c;c=a.call_id+a.to_tag+a.from_tag;return(c=this.dialogs[c])?
c:null};i.prototype.getNextWsServer=function(){var c,g,i=[];for(c in this.configuration.ws_servers)g=this.configuration.ws_servers[c],g.status!==a.Transport.C.STATUS_ERROR&&(0===i.length?i.push(g):g.weight>i[0].weight?i=[g]:g.weight===i[0].weight&&i.push(g));c=Math.floor(Math.random()*i.length);return i[c]};i.prototype.closeSessionsOnTransportError=function(){for(var a in this.sessions)this.sessions[a].onTransportError();if(this.registrator)this.registrator.onTransportClosed()};i.prototype.recoverTransport=
function(f){var g,i,h,f=f||this;i=f.transportRecoverAttempts;for(g in f.configuration.ws_servers)f.configuration.ws_servers[g].status=0;h=f.getNextWsServer();g=Math.floor(Math.random()*Math.pow(2,i)+1)*f.configuration.connection_recovery_min_interval;g>f.configuration.connection_recovery_max_interval&&(console.log(c+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),g=f.configuration.connection_recovery_min_interval,i=0);console.log(c+"next connection attempt in "+
g+" seconds");k.setTimeout(function(){f.transportRecoverAttempts=i+1;new a.Transport(f,h)},1E3*g)};i.prototype.loadConfig=function(f){var g,h,v,l={via_host:a.Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register_min_expires:120,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:"",turn_servers:"",trace_sip:!1,
hack_via_tcp:!1,hack_ip_in_contact:!1};for(g in i.configuration_check.mandatory)if(f.hasOwnProperty(g))if(h=f[g],v=i.configuration_check.mandatory[g](h),void 0!==v)l[g]=v;else throw new a.Exceptions.ConfigurationError(g,h);else throw new a.Exceptions.ConfigurationError(g);for(g in i.configuration_check.optional)if(f.hasOwnProperty(g)&&(h=f[g],!(null===h||""===h||void 0===h)&&!("number"===typeof h&&k.isNaN(h))))if(v=i.configuration_check.optional[g](h),void 0!==v)l[g]=v;else throw new a.Exceptions.ConfigurationError(g,
h);if(l.connection_recovery_max_interval<l.connection_recovery_min_interval)throw new a.Exceptions.ConfigurationError("connection_recovery_max_interval",l.connection_recovery_max_interval);0===l.display_name&&(l.display_name="0");l.instance_id=a.Utils.newUUID();l.jssip_id=a.Utils.createRandomToken(5);f=l.uri.clone();f.user=null;l.hostport_params=f.toString().replace(/^sip:/i,"");l.authorization_user||(l.authorization_user=l.uri.user);l.registrar_server||(f=l.uri.clone(),f.user=null,l.registrar_server=
f);l.no_answer_timeout*=1E3;l.hack_ip_in_contact&&(l.via_host=a.Utils.getRandomTestNetIP());this.contact={pub_gruu:null,temp_gruu:null,uri:new a.URI("sip",a.Utils.createRandomToken(8),l.via_host,null,{transport:"ws"}),toString:function(a){var a=a||{},c=a.outbound||null,f="<",f=a.anonymous?f+(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws"):f+(this.pub_gruu||this.uri.toString());c&&(f=f+";ob");return f+">"}};console.log(c+"configuration parameters after validation:");for(g in l){switch(g){case "uri":case "registrar_server":!0===
l.trace_sip&&console.log("\u00b7 "+g+": "+l[g]);break;case "stun_servers":case "turn_servers":break;default:!0===l.trace_sip&&console.log("\u00b7 "+g+": "+k.JSON.stringify(l[g]))}i.configuration_skeleton[g].value=l[g]}Object.defineProperties(this.configuration,i.configuration_skeleton);for(g in l)i.configuration_skeleton[g].value=""};i.configuration_skeleton=function(){var a,c,g={},i="instance_id,jssip_id,register_min_expires,ws_server_max_reconnection,ws_server_reconnection_timeout,hostport_params,uri,ws_servers,authorization_user,connection_recovery_max_interval,connection_recovery_min_interval,display_name,hack_via_tcp,hack_ip_in_contact,no_answer_timeout,password,register_expires,registrar_server,stun_servers,trace_sip,turn_servers,use_preloaded_route,via_core_value,via_host".split(",");
for(a in i)c=i[a],g[c]={value:"",writable:!1,configurable:!1};g.register={value:"",writable:!0,configurable:!1};return g}();i.configuration_check={mandatory:{uri:function(c){/^sip:/i.test(c)||(c=a.C.SIP+":"+c);if((c=a.URI.parse(c))&&c.user)return c},ws_servers:function(f){var g,i;if("string"===typeof f)f=[{ws_uri:f}];else if(f instanceof Array)for(g in f)"string"===typeof f[g]&&(f[g]={ws_uri:f[g]});else return;if(0===f.length)return!1;for(g in f){if(!f[g].ws_uri){console.error(c+'missing "ws_uri" attribute in ws_servers parameter');
return}if(f[g].weight&&!Number(f[g].weight)){console.error(c+'"weight" attribute in ws_servers parameter must be a Number');return}i=a.Grammar.parse(f[g].ws_uri,"absoluteURI");if(-1===i){console.error(c+'invalid "ws_uri" attribute in ws_servers parameter: '+f[g].ws_uri);return}if("wss"!==i.scheme&&"ws"!==i.scheme){console.error(c+"invalid URI scheme in ws_servers parameter: "+i.scheme);return}f[g].sip_uri="<sip:"+i.host+(i.port?":"+i.port:"")+";transport=ws;lr>";f[g].weight||(f[g].weight=0);f[g].status=
0;f[g].scheme=i.scheme.toUpperCase()}return f}},optional:{authorization_user:function(c){if(-1!==a.Grammar.parse('"'+c+'"',"quoted_string"))return c},connection_recovery_max_interval:function(c){if(a.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},connection_recovery_min_interval:function(c){if(a.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},display_name:function(c){if(-1!==a.Grammar.parse('"'+c+'"',"display_name"))return c},hack_via_tcp:function(a){if("boolean"===typeof a)return a},hack_ip_in_contact:function(a){if("boolean"===
typeof a)return a},no_answer_timeout:function(c){if(a.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},password:function(a){return""+a},register:function(a){if("boolean"===typeof a)return a},register_expires:function(c){if(a.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},registrar_server:function(c){/^sip:/i.test(c)||(c=a.C.SIP+":"+c);if((c=a.URI.parse(c))&&!c.user)return c},stun_servers:function(c){var g,i;c instanceof Array||(c=[c]);for(g in c){i=c[g];if(!i.server||!i.username||!i.password)return;
/^stuns?:/.test(i.server)||(i.server="stun:"+i.server);if(-1===a.Grammar.parse(i.server,"stun_URI"))break;else if(-1===a.Grammar.parse(i.username,"user"))break;else if(-1===a.Grammar.parse(i.password,"password"))break}return c},trace_sip:function(a){if("boolean"===typeof a)return a},turn_servers:function(c){var g,i;c instanceof Array||(c=[c]);for(g in c){i=c[g];if(!i.server||!i.username||!i.password)return;/^turns?:/.test(i.server)||(i.server="turn:"+i.server);if(-1===a.Grammar.parse(i.server,"turn_URI"))break;
else if(-1===a.Grammar.parse(i.username,"user"))break;else if(-1===a.Grammar.parse(i.password,"password"))break}return c},use_preloaded_route:function(a){if("boolean"===typeof a)return a}}};i.C=g;a.UA=i})(h);(function(a){a.Utils={str_utf8_length:function(a){return k.unescape(encodeURIComponent(a)).length},isFunction:function(a){return void 0!==a?"[object Function]"===Object.prototype.toString.call(a)?!0:!1:!1},isDecimal:function(a){return!isNaN(a)&&parseFloat(a)===parseInt(a,10)},createRandomToken:function(a,
c){var g,f,h="",c=c||32;for(g=0;g<a;g++)f=Math.random()*c|0,h+=f.toString(c);return h},newTag:function(){return a.Utils.createRandomToken(a.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var c=16*Math.random()|0;return("x"===a?c:c&3|8).toString(16)})},hostType:function(i){if(i&&(i=a.Grammar.parse(i,"host"),-1!==i))return i.host_type},normalizeURI:function(i,c){var g,f,h=i;if(i){if(i instanceof a.URI)return i;if("string"===typeof i){f=
i.split("@");switch(f.length){case 1:if(!c)throw new a.Exceptions.InvalidTargetError(h);g=i;f=c;break;case 2:g=f[0];f=f[1];break;default:g=f.slice(0,f.length-1).join("@"),f=f[f.length-1]}g=g.replace(/^(sips?|tel):/i,"");/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(g)&&(g=g.replace(/[\-\.\(\)]/g,""));i=a.C.SIP+":"+a.Utils.escapeUser(g)+"@"+f;if(g=a.URI.parse(i))return g}}throw new a.Exceptions.InvalidTargetError(h);},escapeUser:function(a){return k.encodeURIComponent(k.decodeURIComponent(a)).replace(/%3A/ig,
":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")},headerize:function(a){var c={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},a=a.toLowerCase().replace(/_/g,"-").split("-"),g="",f;for(f in a)"0"!==f&&(g+="-"),g+=a[f].charAt(0).toUpperCase()+a[f].substring(1);c[g]&&(g=c[g]);return g},sipErrorCause:function(i){for(var c in a.C.SIP_ERROR_CAUSES)if(-1!==a.C.SIP_ERROR_CAUSES[c].indexOf(i))return a.C.causes[c];return a.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){return"192.0.2."+
k.Math.floor(254*k.Math.random()+1)},getAllowedMethods:function(i){var c,g=a.UA.C.ALLOWED_METHODS.toString();for(c in a.UA.C.EVENT_METHODS)i.checkEvent(c)&&0<i.listeners(c).length&&(g+=","+a.UA.C.EVENT_METHODS[c]);return g},calculateMD5:function(a){function c(a,c){var f,g,h,i,l;h=a&2147483648;i=c&2147483648;f=a&1073741824;g=c&1073741824;l=(a&1073741823)+(c&1073741823);return f&g?l^2147483648^h^i:f|g?l&1073741824?l^3221225472^h^i:l^1073741824^h^i:l^h^i}function g(a,f,g,h,i,l,n){a=c(a,c(c(f&g|~f&h,
i),n));return c(a<<l|a>>>32-l,f)}function f(a,f,g,h,i,l,n){a=c(a,c(c(f&h|g&~h,i),n));return c(a<<l|a>>>32-l,f)}function h(a,f,g,i,l,n,k){a=c(a,c(c(f^g^i,l),k));return c(a<<n|a>>>32-n,f)}function k(a,f,g,h,i,l,n){a=c(a,c(c(g^(f|~h),i),n));return c(a<<l|a>>>32-l,f)}function v(a){var c="",f="",g;for(g=0;3>=g;g++)f=a>>>8*g&255,f="0"+f.toString(16),c+=f.substr(f.length-2,2);return c}var l=[],x,p,r,y,o,w,z,t,a=function(a){for(var a=a.replace(/\r\n/g,"\n"),c="",f=0;f<a.length;f++){var g=a.charCodeAt(f);
128>g?c+=String.fromCharCode(g):(127<g&&2048>g?c+=String.fromCharCode(g>>6|192):(c+=String.fromCharCode(g>>12|224),c+=String.fromCharCode(g>>6&63|128)),c+=String.fromCharCode(g&63|128))}return c}(a),l=function(a){var c,f=a.length;c=f+8;for(var g=16*((c-c%64)/64+1),h=Array(g-1),i=0,l=0;l<f;)c=(l-l%4)/4,i=8*(l%4),h[c]|=a.charCodeAt(l)<<i,l++;c=(l-l%4)/4;h[c]|=128<<8*(l%4);h[g-2]=f<<3;h[g-1]=f>>>29;return h}(a);o=1732584193;w=4023233417;z=2562383102;t=271733878;for(a=0;a<l.length;a+=16)x=o,p=w,r=z,y=
t,o=g(o,w,z,t,l[a+0],7,3614090360),t=g(t,o,w,z,l[a+1],12,3905402710),z=g(z,t,o,w,l[a+2],17,606105819),w=g(w,z,t,o,l[a+3],22,3250441966),o=g(o,w,z,t,l[a+4],7,4118548399),t=g(t,o,w,z,l[a+5],12,1200080426),z=g(z,t,o,w,l[a+6],17,2821735955),w=g(w,z,t,o,l[a+7],22,4249261313),o=g(o,w,z,t,l[a+8],7,1770035416),t=g(t,o,w,z,l[a+9],12,2336552879),z=g(z,t,o,w,l[a+10],17,4294925233),w=g(w,z,t,o,l[a+11],22,2304563134),o=g(o,w,z,t,l[a+12],7,1804603682),t=g(t,o,w,z,l[a+13],12,4254626195),z=g(z,t,o,w,l[a+14],17,2792965006),
w=g(w,z,t,o,l[a+15],22,1236535329),o=f(o,w,z,t,l[a+1],5,4129170786),t=f(t,o,w,z,l[a+6],9,3225465664),z=f(z,t,o,w,l[a+11],14,643717713),w=f(w,z,t,o,l[a+0],20,3921069994),o=f(o,w,z,t,l[a+5],5,3593408605),t=f(t,o,w,z,l[a+10],9,38016083),z=f(z,t,o,w,l[a+15],14,3634488961),w=f(w,z,t,o,l[a+4],20,3889429448),o=f(o,w,z,t,l[a+9],5,568446438),t=f(t,o,w,z,l[a+14],9,3275163606),z=f(z,t,o,w,l[a+3],14,4107603335),w=f(w,z,t,o,l[a+8],20,1163531501),o=f(o,w,z,t,l[a+13],5,2850285829),t=f(t,o,w,z,l[a+2],9,4243563512),
z=f(z,t,o,w,l[a+7],14,1735328473),w=f(w,z,t,o,l[a+12],20,2368359562),o=h(o,w,z,t,l[a+5],4,4294588738),t=h(t,o,w,z,l[a+8],11,2272392833),z=h(z,t,o,w,l[a+11],16,1839030562),w=h(w,z,t,o,l[a+14],23,4259657740),o=h(o,w,z,t,l[a+1],4,2763975236),t=h(t,o,w,z,l[a+4],11,1272893353),z=h(z,t,o,w,l[a+7],16,4139469664),w=h(w,z,t,o,l[a+10],23,3200236656),o=h(o,w,z,t,l[a+13],4,681279174),t=h(t,o,w,z,l[a+0],11,3936430074),z=h(z,t,o,w,l[a+3],16,3572445317),w=h(w,z,t,o,l[a+6],23,76029189),o=h(o,w,z,t,l[a+9],4,3654602809),
t=h(t,o,w,z,l[a+12],11,3873151461),z=h(z,t,o,w,l[a+15],16,530742520),w=h(w,z,t,o,l[a+2],23,3299628645),o=k(o,w,z,t,l[a+0],6,4096336452),t=k(t,o,w,z,l[a+7],10,1126891415),z=k(z,t,o,w,l[a+14],15,2878612391),w=k(w,z,t,o,l[a+5],21,4237533241),o=k(o,w,z,t,l[a+12],6,1700485571),t=k(t,o,w,z,l[a+3],10,2399980690),z=k(z,t,o,w,l[a+10],15,4293915773),w=k(w,z,t,o,l[a+1],21,2240044497),o=k(o,w,z,t,l[a+8],6,1873313359),t=k(t,o,w,z,l[a+15],10,4264355552),z=k(z,t,o,w,l[a+6],15,2734768916),w=k(w,z,t,o,l[a+13],21,
1309151649),o=k(o,w,z,t,l[a+4],6,4149444226),t=k(t,o,w,z,l[a+11],10,3174756917),z=k(z,t,o,w,l[a+2],15,718787259),w=k(w,z,t,o,l[a+9],21,3951481745),o=c(o,x),w=c(w,p),z=c(z,r),t=c(t,y);return(v(o)+v(w)+v(z)+v(t)).toLowerCase()}}})(h);(function(a){function h(c){var f,c="SIP/2.0 "+c+" "+a.C.REASON_PHRASE[c]+"\r\n";f=g.countHeader("via");var i=0;for(i;i<f;i++)c+="Via: "+g.getHeader("via",i)+"\r\n";f=g.getHeader("To");g.to_tag||(f+=";tag="+a.Utils.newTag());c=c+("To: "+f+"\r\n")+("From: "+g.getHeader("From")+
"\r\n");c+="Call-ID: "+g.call_id+"\r\n";c+="CSeq: "+g.cseq+" "+g.method+"\r\n";n.send(c+"\r\n")}var c=a.name+" | SANITY CHECK | ",g,f,n,k=[],v=[],l=[];k.push(function(){if("sip"!==g.s("to").uri.scheme)return h(416),!1});k.push(function(){if(!g.to_tag&&g.call_id.substr(0,5)===f.configuration.jssip_id)return h(482),!1});k.push(function(){var c=a.Utils.str_utf8_length(g.body),f=g.getHeader("content-length");if(c<f)return h(400),!1});k.push(function(){var c,l,n=g.from_tag,k=g.call_id,o=g.cseq;if(!g.to_tag)if(g.method===
a.C.INVITE){if(c=f.transactions.ist[g.via_branch])for(l in f.transactions.ist)if(c=f.transactions.ist[l],c.request.from_tag===n&&c.request.call_id===k&&c.request.cseq===o)return h(482),!1}else if(c=f.transactions.nist[g.via_branch])for(l in f.transactions.nist)if(c=f.transactions.nist[l],c.request.from_tag===n&&c.request.call_id===k&&c.request.cseq===o)return h(482),!1});v.push(function(){if(1<g.countHeader("via"))return console.warn(c+"More than one Via header field present in the response. Dropping the response"),
!1});v.push(function(){if(g.via.host!==f.configuration.via_host)return console.warn(c+"Via host in the response does not match UA Via host value. Dropping the response"),!1});v.push(function(){var f=a.Utils.str_utf8_length(g.body),h=g.getHeader("content-length");if(f<h)return console.warn(c+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1});l.push(function(){for(var a=["from","to","call_id","cseq","via"],f=a.length;f--;)if(!g.hasHeader(a[f]))return console.warn(c+
"Missing mandatory header field : "+a[f]+". Dropping the response"),!1});a.sanityCheck=function(c,h,i){g=c;f=h;n=i;for(c=l.length;c--;)if(h=l[c](g),!1===h)return!1;if(g instanceof a.IncomingRequest)for(c=k.length;c--;){if(h=k[c](g),!1===h)return!1}else if(g instanceof a.IncomingResponse)for(c=v.length;c--;)if(h=v[c](g),!1===h)return!1;console.log("sanitycheck true");return!0}})(h);(function(a){var h,c=a.name+" | DIGEST AUTHENTICATION | ";h=function(a){this.username=a.configuration.authorization_user;
this.password=a.configuration.password;this.cnonce=null;this.nc=0;this.ncHex="00000000";this.response=null};h.prototype.authenticate=function(g,f){this.algorithm=f.algorithm;this.realm=f.realm;this.nonce=f.nonce;this.opaque=f.opaque;this.stale=f.stale;if(this.algorithm){if("MD5"!==this.algorithm)return console.warn(c+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return console.warn(c+"challenge without Digest realm, authentication aborted"),
!1;if(!this.nonce)return console.warn(c+"challenge without Digest nonce, authentication aborted"),!1;if(f.qop)if(-1<f.qop.indexOf("auth"))this.qop="auth";else if(-1<f.qop.indexOf("auth-int"))this.qop="auth-int";else return console.warn(c+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this.qop=null;this.method=g.method;this.uri=g.ruri;this.cnonce=a.Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();4294967296===this.nc&&(this.nc=1,this.ncHex=
"00000001");this.calculateResponse();return!0};h.prototype.calculateResponse=function(){var c,f;c=a.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(f=a.Utils.calculateMD5(this.method+":"+this.uri),this.response=a.Utils.calculateMD5(c+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+f)):"auth-int"===this.qop?(f=a.Utils.calculateMD5(this.method+":"+this.uri+":"+a.Utils.calculateMD5(this.body?this.body:"")),this.response=a.Utils.calculateMD5(c+":"+this.nonce+
":"+this.ncHex+":"+this.cnonce+":auth-int:"+f)):null===this.qop&&(f=a.Utils.calculateMD5(this.method+":"+this.uri),this.response=a.Utils.calculateMD5(c+":"+this.nonce+":"+f))};h.prototype.toString=function(){var a=[];if(!this.response)throw Error("response field does not exist, cannot generate Authorization header");a.push("algorithm="+this.algorithm);a.push('username="'+this.username+'"');a.push('realm="'+this.realm+'"');a.push('nonce="'+this.nonce+'"');a.push('uri="'+this.uri+'"');a.push('response="'+
this.response+'"');this.opaque&&a.push('opaque="'+this.opaque+'"');this.qop&&(a.push("qop="+this.qop),a.push('cnonce="'+this.cnonce+'"'),a.push("nc="+this.ncHex));return"Digest "+a.join(", ")};h.prototype.updateNcHex=function(){var a=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-a.length)+a};a.DigestAuthentication=h})(h);(function(a){var h;h={};k.navigator.webkitGetUserMedia?h.getUserMedia=k.navigator.webkitGetUserMedia.bind(navigator):k.navigator.mozGetUserMedia?h.getUserMedia=k.navigator.mozGetUserMedia.bind(navigator):
k.navigator.getUserMedia&&(h.getUserMedia=k.navigator.getUserMedia.bind(navigator));k.webkitRTCPeerConnection?h.RTCPeerConnection=k.webkitRTCPeerConnection:k.mozRTCPeerConnection?h.RTCPeerConnection=k.mozRTCPeerConnection:k.RTCPeerConnection&&(h.RTCPeerConnection=k.RTCPeerConnection);k.webkitRTCSessionDescription?(console.log("webkit"),h.RTCSessionDescription=k.webkitRTCSessionDescription):k.mozRTCSessionDescription?(console.log("moz"),h.RTCSessionDescription=k.mozRTCSessionDescription):k.RTCSessionDescription&&
(console.log("~~sdp"),h.RTCSessionDescription=k.RTCSessionDescription);h.RTCPeerConnection&&h.RTCPeerConnection.prototype&&!h.RTCPeerConnection.prototype.getLocalStreams&&(h.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},h.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams});h.isSupported=h.getUserMedia&&h.RTCPeerConnection&&h.RTCSessionDescription?!0:!1;a.WebRTC=h})(h);k.JsSIP=h})(window);
JsSIP.Grammar=function(){function k(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var h={parse:function(a,h){function c(b){d<Y||(d>Y&&(Y=d,Ga=[]),Ga.push(b))}function g(){var b;"\r\n"===a.substr(d,2)?(b="\r\n",d+=2):(b=null,0===m&&c('"\\r\\n"'));return b}function f(){var b;/^[0-9]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=
null,0===m&&c("[0-9]"));return b}function n(){var b;/^[a-zA-Z]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[a-zA-Z]"));return b}function A(){var b;/^[0-9a-fA-F]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[0-9a-fA-F]"));return b}function v(){var b;b=p();null===b&&(b=r());return b}function l(){var b;/^[\0-\xFF]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[\\0-\\xFF]"));return b}function x(){var b;/^["]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c('["]'));
return b}function p(){var b;32===a.charCodeAt(d)?(b=" ",d++):(b=null,0===m&&c('" "'));return b}function r(){var b;9===a.charCodeAt(d)?(b="\t",d++):(b=null,0===m&&c('"\\t"'));return b}function y(){var b;/^[a-zA-Z0-9]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[a-zA-Z0-9]"));return b}function o(){var b;59===a.charCodeAt(d)?(b=";",d++):(b=null,0===m&&c('";"'));if(null===b&&(47===a.charCodeAt(d)?(b="/",d++):(b=null,0===m&&c('"/"')),null===b))if(63===a.charCodeAt(d)?(b="?",d++):(b=null,0===
m&&c('"?"')),null===b)if(58===a.charCodeAt(d)?(b=":",d++):(b=null,0===m&&c('":"')),null===b)if(64===a.charCodeAt(d)?(b="@",d++):(b=null,0===m&&c('"@"')),null===b)if(38===a.charCodeAt(d)?(b="&",d++):(b=null,0===m&&c('"&"')),null===b)if(61===a.charCodeAt(d)?(b="=",d++):(b=null,0===m&&c('"="')),null===b)if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)if(36===a.charCodeAt(d)?(b="$",d++):(b=null,0===m&&c('"$"')),null===b)44===a.charCodeAt(d)?(b=",",d++):(b=null,0===m&&c('","'));return b}
function w(){var b;b=y();null===b&&(b=z());return b}function z(){var b;45===a.charCodeAt(d)?(b="-",d++):(b=null,0===m&&c('"-"'));if(null===b&&(95===a.charCodeAt(d)?(b="_",d++):(b=null,0===m&&c('"_"')),null===b))if(46===a.charCodeAt(d)?(b=".",d++):(b=null,0===m&&c('"."')),null===b)if(33===a.charCodeAt(d)?(b="!",d++):(b=null,0===m&&c('"!"')),null===b)if(126===a.charCodeAt(d)?(b="~",d++):(b=null,0===m&&c('"~"')),null===b)if(42===a.charCodeAt(d)?(b="*",d++):(b=null,0===m&&c('"*"')),null===b)if(39===a.charCodeAt(d)?
(b="'",d++):(b=null,0===m&&c('"\'"')),null===b)if(40===a.charCodeAt(d)?(b="(",d++):(b=null,0===m&&c('"("')),null===b)41===a.charCodeAt(d)?(b=")",d++):(b=null,0===m&&c('")"'));return b}function t(){var b,j,D,f;f=d;37===a.charCodeAt(d)?(b="%",d++):(b=null,0===m&&c('"%"'));null!==b?(j=A(),null!==j?(D=A(),null!==D?b=[b,j,D]:(b=null,d=f)):(b=null,d=f)):(b=null,d=f);return b}function J(){var b,a,c,f,h;c=h=f=d;b=[];for(a=v();null!==a;)b.push(a),a=v();null!==b?(a=g(),null!==a?b=[b,a]:(b=null,d=c)):(b=null,
d=c);b=null!==b?b:"";if(null!==b){c=v();if(null!==c)for(a=[];null!==c;)a.push(c),c=v();else a=null;null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;null!==b&&(b=" ");null===b&&(d=f);return b}function I(){var b;b=J();return null!==b?b:""}function R(){var b,j,D,f,g;g=f=d;b=[];j=p();for(null===j&&(j=r());null!==j;)b.push(j),j=p(),null===j&&(j=r());null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b=
":");null===b&&(d=f);return b}function H(){var b,j,c,f,g,h,i;h=g=d;j=Q();if(null!==j)for(b=[];null!==j;)b.push(j),j=Q();else b=null;if(null!==b){j=[];i=d;c=[];for(f=J();null!==f;)c.push(f),f=J();null!==c?(f=Q(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;){j.push(c);i=d;c=[];for(f=J();null!==f;)c.push(f),f=J();null!==c?(f=Q(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i)}null!==j?b=[b,j]:(b=null,d=h)}else b=null,d=h;null!==b&&(b=a.substring(d,g));null===b&&(d=g);return b}function Q(){var b;
/^[!-~]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[!-~]"));null===b&&(b=N());return b}function N(){var b;/^[\x80-\uFFFF]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[\\x80-\\uFFFF]"));return b}function L(){var b;/^[\x80-\xBF]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[\\x80-\\xBF]"));return b}function E(){var b,j,D;D=d;j=y();if(null===j&&(45===a.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===a.charCodeAt(d)?(j=".",d++):(j=null,0===m&&
c('"."')),null===j)if(33===a.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===a.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===a.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===a.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===a.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),
null===j)126===a.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"'));if(null!==j)for(b=[];null!==j;){if(b.push(j),j=y(),null===j&&(45===a.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===a.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null===j)if(33===a.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===a.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===a.charCodeAt(d)?
(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===a.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===a.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)126===a.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"'))}else b=null;null!==b&&(b=a.substring(d,D));null===b&&(d=D);return b}function B(){var b,j,D;D=d;j=y();if(null===j&&(45===a.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(33===
a.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===a.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===a.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===a.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===a.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)126===a.charCodeAt(d)?
(j="~",d++):(j=null,0===m&&c('"~"'));if(null!==j)for(b=[];null!==j;){if(b.push(j),j=y(),null===j&&(45===a.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(33===a.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===a.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===a.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),
null===j)if(96===a.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===a.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)126===a.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"'))}else b=null;null!==b&&(b=a.substring(d,D));null===b&&(d=D);return b}function u(){var b,j,D;D=d;j=y();if(null===j&&(45===a.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===a.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null===j)if(33===a.charCodeAt(d)?(j="!",d++):(j=
null,0===m&&c('"!"')),null===j)if(37===a.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===a.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===a.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===a.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)if(126===a.charCodeAt(d)?(j="~",d++):(j=null,0===
m&&c('"~"')),null===j)if(40===a.charCodeAt(d)?(j="(",d++):(j=null,0===m&&c('"("')),null===j)if(41===a.charCodeAt(d)?(j=")",d++):(j=null,0===m&&c('")"')),null===j)if(60===a.charCodeAt(d)?(j="<",d++):(j=null,0===m&&c('"<"')),null===j)if(62===a.charCodeAt(d)?(j=">",d++):(j=null,0===m&&c('">"')),null===j)if(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(92===a.charCodeAt(d)?(j="\\",d++):(j=null,0===m&&c('"\\\\"')),null===j)if(j=x(),null===j&&(47===a.charCodeAt(d)?(j="/",d++):(j=
null,0===m&&c('"/"')),null===j))if(91===a.charCodeAt(d)?(j="[",d++):(j=null,0===m&&c('"["')),null===j)if(93===a.charCodeAt(d)?(j="]",d++):(j=null,0===m&&c('"]"')),null===j)if(63===a.charCodeAt(d)?(j="?",d++):(j=null,0===m&&c('"?"')),null===j)if(123===a.charCodeAt(d)?(j="{",d++):(j=null,0===m&&c('"{"')),null===j)125===a.charCodeAt(d)?(j="}",d++):(j=null,0===m&&c('"}"'));if(null!==j)for(b=[];null!==j;){if(b.push(j),j=y(),null===j&&(45===a.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===
a.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null===j)if(33===a.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===a.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===a.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===a.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===a.charCodeAt(d)?
(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)if(126===a.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"')),null===j)if(40===a.charCodeAt(d)?(j="(",d++):(j=null,0===m&&c('"("')),null===j)if(41===a.charCodeAt(d)?(j=")",d++):(j=null,0===m&&c('")"')),null===j)if(60===a.charCodeAt(d)?(j="<",d++):(j=null,0===m&&c('"<"')),null===j)if(62===a.charCodeAt(d)?(j=">",d++):(j=null,0===m&&c('">"')),null===j)if(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(92===a.charCodeAt(d)?(j="\\",d++):
(j=null,0===m&&c('"\\\\"')),null===j)if(j=x(),null===j&&(47===a.charCodeAt(d)?(j="/",d++):(j=null,0===m&&c('"/"')),null===j))if(91===a.charCodeAt(d)?(j="[",d++):(j=null,0===m&&c('"["')),null===j)if(93===a.charCodeAt(d)?(j="]",d++):(j=null,0===m&&c('"]"')),null===j)if(63===a.charCodeAt(d)?(j="?",d++):(j=null,0===m&&c('"?"')),null===j)if(123===a.charCodeAt(d)?(j="{",d++):(j=null,0===m&&c('"{"')),null===j)125===a.charCodeAt(d)?(j="}",d++):(j=null,0===m&&c('"}"'))}else b=null;null!==b&&(b=a.substring(d,
D));null===b&&(d=D);return b}function S(){var b,j,D,f,g;g=f=d;b=I();null!==b?(42===a.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b="*");null===b&&(d=f);return b}function F(){var b,j,D,f,g;g=f=d;b=I();null!==b?(47===a.charCodeAt(d)?(j="/",d++):(j=null,0===m&&c('"/"')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b="/");null===b&&(d=f);return b}function G(){var b,j,
D,f,g;g=f=d;b=I();null!==b?(61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b="=");null===b&&(d=f);return b}function Z(){var b,j,D,f,g;g=f=d;b=I();null!==b?(40===a.charCodeAt(d)?(j="(",d++):(j=null,0===m&&c('"("')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b="(");null===b&&(d=f);return b}function aa(){var b,j,D,f,g;g=f=d;b=I();null!==b?(41===a.charCodeAt(d)?
(j=")",d++):(j=null,0===m&&c('")"')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b=")");null===b&&(d=f);return b}function O(){var b,j,D,f;f=D=d;62===a.charCodeAt(d)?(b=">",d++):(b=null,0===m&&c('">"'));null!==b?(j=I(),null!==j?b=[b,j]:(b=null,d=f)):(b=null,d=f);null!==b&&(b=">");null===b&&(d=D);return b}function T(){var b,j,D,f;f=D=d;b=I();null!==b?(60===a.charCodeAt(d)?(j="<",d++):(j=null,0===m&&c('"<"')),null!==j)?b=[b,j]:(b=null,d=f):(b=null,d=f);null!==
b&&(b="<");null===b&&(d=D);return b}function q(){var b,j,D,f,g;g=f=d;b=I();null!==b?(44===a.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b=",");null===b&&(d=f);return b}function K(){var b,j,D,f,g;g=f=d;b=I();null!==b?(59===a.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b=";");null===b&&(d=f);return b}function jb(){var b,
j,D,f,g;g=f=d;b=I();null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(D=I(),null!==D?b=[b,j,D]:(b=null,d=g)):(b=null,d=g):(b=null,d=g);null!==b&&(b=":");null===b&&(d=f);return b}function Ia(){var b,a,c,f;f=c=d;b=I();null!==b?(a=x(),null!==a?b=[b,a]:(b=null,d=f)):(b=null,d=f);null!==b&&(b='"');null===b&&(d=c);return b}function Ja(){var b,a,c,f;f=c=d;b=x();null!==b?(a=I(),null!==a?b=[b,a]:(b=null,d=f)):(b=null,d=f);null!==b&&(b='"');null===b&&(d=c);return b}function Ka(){var b,
a,c,f;f=d;b=Z();if(null!==b){a=[];c=La();null===c&&(c=U(),null===c&&(c=Ka()));for(;null!==c;)a.push(c),c=La(),null===c&&(c=U(),null===c&&(c=Ka()));null!==a?(c=aa(),null!==c?b=[b,a,c]:(b=null,d=f)):(b=null,d=f)}else b=null,d=f;return b}function La(){var b;/^[!-']/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[!-']"));if(null===b&&(/^[*-[]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[*-[]")),null===b))if(/^[\]-~]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[\\]-~]")),
null===b)b=N(),null===b&&(b=J());return b}function ba(){var b,c,f,g,h,i;i=h=d;b=I();if(null!==b)if(c=x(),null!==c){f=[];g=ca();for(null===g&&(g=U());null!==g;)f.push(g),g=ca(),null===g&&(g=U());null!==f?(g=x(),null!==g?b=[b,c,f,g]:(b=null,d=i)):(b=null,d=i)}else b=null,d=i;else b=null,d=i;null!==b&&(b=a.substring(d,h));null===b&&(d=h);return b}function ma(){var b,c,f,g,h,i;i=h=d;b=I();if(null!==b)if(c=x(),null!==c){f=[];g=ca();for(null===g&&(g=U());null!==g;)f.push(g),g=ca(),null===g&&(g=U());null!==
f?(g=x(),null!==g?b=[b,c,f,g]:(b=null,d=i)):(b=null,d=i)}else b=null,d=i;else b=null,d=i;null!==b&&(b=a.substring(d-1,h+1));null===b&&(d=h);return b}function ca(){var b;b=J();if(null===b&&(33===a.charCodeAt(d)?(b="!",d++):(b=null,0===m&&c('"!"')),null===b))if(/^[#-[]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[#-[]")),null===b)/^[\]-~]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[\\]-~]")),null===b&&(b=N());return b}function U(){var b,j,f;f=d;92===a.charCodeAt(d)?(b="\\",
d++):(b=null,0===m&&c('"\\\\"'));if(null!==b){/^[\0-\t]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[\\0-\\t]"));if(null===j&&(/^[\x0B-\f]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[\\x0B-\\f]")),null===j))/^[\x0E-\u007f]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[\\x0E-\u007f]"));null!==j?b=[b,j]:(b=null,d=f)}else b=null,d=f;return b}function na(){var b,j,f,g,h,i;i=h=d;b=Ma();null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?
(f=oa(),f=null!==f?f:"",null!==f?(g=pa(),null!==g?b=[b,j,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i):(b=null,d=i);if(null!==b){try{s.uri=new JsSIP.URI(s.scheme,s.user,s.host,s.port),delete s.scheme,delete s.user,delete s.host,delete s.host_type,delete s.port}catch(l){s=-1}b=void 0}null===b&&(d=h);return b}function qa(){var b,j,f,g,Ha,l,n,k;k=n=d;b=Ma();null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=oa(),f=null!==f?f:"",null!==f?(g=pa(),null!==g?(Ha=kb(),null!==
Ha?(l=lb(),l=null!==l?l:"",null!==l?b=[b,j,f,g,Ha,l]:(b=null,d=k)):(b=null,d=k)):(b=null,d=k)):(b=null,d=k)):(b=null,d=k):(b=null,d=k);if(null!==b){try{s.uri=new JsSIP.URI(s.scheme,s.user,s.host,s.port,s.uri_params,s.uri_headers),delete s.scheme,delete s.user,delete s.host,delete s.host_type,delete s.port,delete s.uri_params,"SIP_URI"===h&&(s=s.uri)}catch(o){s=-1}b=void 0}null===b&&(d=n);return b}function Ma(){var b,j;j=d;"sip"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"sip"'));
null!==b&&(s.scheme=b.toLowerCase(),b=void 0);null===b&&(d=j);return b}function oa(){var b,j,f,g,h,i;h=g=d;b=mb();null!==b?(i=d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=nb(),null!==f?j=[j,f]:(j=null,d=i)):(j=null,d=i),j=null!==j?j:"",null!==j)?(64===a.charCodeAt(d)?(f="@",d++):(f=null,0===m&&c('"@"')),null!==f)?b=[b,j,f]:(b=null,d=h):(b=null,d=h):(b=null,d=h);null!==b&&(s.user=window.decodeURIComponent(a.substring(d-1,g)),b=void 0);null===b&&(d=g);return b}function mb(){var b,
d;d=w();null===d&&(d=t(),null===d&&(d=Na()));if(null!==d)for(b=[];null!==d;)b.push(d),d=w(),null===d&&(d=t(),null===d&&(d=Na()));else b=null;return b}function Na(){var b;38===a.charCodeAt(d)?(b="&",d++):(b=null,0===m&&c('"&"'));if(null===b&&(61===a.charCodeAt(d)?(b="=",d++):(b=null,0===m&&c('"="')),null===b))if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)if(36===a.charCodeAt(d)?(b="$",d++):(b=null,0===m&&c('"$"')),null===b)if(44===a.charCodeAt(d)?(b=",",d++):(b=null,0===m&&
c('","')),null===b)if(59===a.charCodeAt(d)?(b=";",d++):(b=null,0===m&&c('";"')),null===b)if(63===a.charCodeAt(d)?(b="?",d++):(b=null,0===m&&c('"?"')),null===b)47===a.charCodeAt(d)?(b="/",d++):(b=null,0===m&&c('"/"'));return b}function nb(){var b,j,f;f=d;b=[];j=w();if(null===j&&(j=t(),null===j&&(38===a.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)))if(61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===
j)if(36===a.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)44===a.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","'));for(;null!==j;)if(b.push(j),j=w(),null===j&&(j=t(),null===j&&(38===a.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)))if(61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)if(43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(36===a.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)44===a.charCodeAt(d)?(j=",",d++):
(j=null,0===m&&c('","'));null!==b&&(s.password=a.substring(d,f),b=void 0);null===b&&(d=f);return b}function pa(){var b,j,f,g,h;g=d;b=da();null!==b?(h=d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=Oa(),null!==f?j=[j,f]:(j=null,d=h)):(j=null,d=h),j=null!==j?j:"",null!==j)?b=[b,j]:(b=null,d=g):(b=null,d=g);return b}function da(){var b,c;c=d;b=Pa();null===b&&(b=V(),null===b&&(b=ra()));null!==b&&(s.host=a.substring(d,c).toLowerCase(),b=s.host);null===b&&(d=c);return b}function Pa(){var b,
j,f,g,h,i;h=g=d;b=[];i=d;j=Qa();null!==j?(46===a.charCodeAt(d)?(f=".",d++):(f=null,0===m&&c('"."')),null!==f)?j=[j,f]:(j=null,d=i):(j=null,d=i);for(;null!==j;)(b.push(j),i=d,j=Qa(),null!==j)?(46===a.charCodeAt(d)?(f=".",d++):(f=null,0===m&&c('"."')),null!==f)?j=[j,f]:(j=null,d=i):(j=null,d=i);null!==b?(j=ob(),null!==j)?(46===a.charCodeAt(d)?(f=".",d++):(f=null,0===m&&c('"."')),f=null!==f?f:"",null!==f)?b=[b,j,f]:(b=null,d=h):(b=null,d=h):(b=null,d=h);null!==b&&(s.host_type="domain",b=a.substring(d,
g));null===b&&(d=g);return b}function Qa(){var b,j;/^[a-zA-Z0-9_\-]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[a-zA-Z0-9_\\-]"));if(null!==j)for(b=[];null!==j;)b.push(j),/^[a-zA-Z0-9_\-]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[a-zA-Z0-9_\\-]"));else b=null;return b}function ob(){var b,j;/^[a-zA-Z_\-]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[a-zA-Z_\\-]"));if(null!==j)for(b=[];null!==j;)b.push(j),/^[a-zA-Z_\-]/.test(a.charAt(d))?(j=a.charAt(d),d++):
(j=null,0===m&&c("[a-zA-Z_\\-]"));else b=null;return b}function ra(){var b,j,f,g,h;h=g=d;91===a.charCodeAt(d)?(b="[",d++):(b=null,0===m&&c('"["'));null!==b?(j=Ra(),null!==j)?(93===a.charCodeAt(d)?(f="]",d++):(f=null,0===m&&c('"]"')),null!==f)?b=[b,j,f]:(b=null,d=h):(b=null,d=h):(b=null,d=h);null!==b&&(s.host_type="IPv6",b=a.substring(d,g));null===b&&(d=g);return b}function Ra(){var b,j,f,g,h,i,l,n,k,o,p,r,T,x,q;q=x=d;b=C();null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==
j)?(f=C(),null!==f)?(58===a.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g)?(h=C(),null!==h)?(58===a.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i)?(l=C(),null!==l)?(58===a.charCodeAt(d)?(n=":",d++):(n=null,0===m&&c('":"')),null!==n)?(k=C(),null!==k)?(58===a.charCodeAt(d)?(o=":",d++):(o=null,0===m&&c('":"')),null!==o)?(p=C(),null!==p)?(58===a.charCodeAt(d)?(r=":",d++):(r=null,0===m&&c('":"')),null!==r)?(T=P(),null!==T?b=[b,j,f,g,h,i,l,n,k,o,p,r,T]:(b=null,d=q)):(b=null,
d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q);if(null===b&&(q=d,"::"===a.substr(d,2)?(b="::",d+=2):(b=null,0===m&&c('"::"')),null!==b?(j=C(),null!==j)?(58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=C(),null!==g)?(58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=C(),null!==i)?(58===a.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=C(),
null!==n)?(58===a.charCodeAt(d)?(k=":",d++):(k=null,0===m&&c('":"')),null!==k)?(o=C(),null!==o)?(58===a.charCodeAt(d)?(p=":",d++):(p=null,0===m&&c('":"')),null!==p)?(r=P(),null!==r?b=[b,j,f,g,h,i,l,n,k,o,p,r]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b))if(q=d,"::"===a.substr(d,2)?(b="::",d+=2):(b=null,0===m&&c('"::"')),null!==b?(j=C(),null!==j)?(58===a.charCodeAt(d)?(f=":",d++):
(f=null,0===m&&c('":"')),null!==f)?(g=C(),null!==g)?(58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=C(),null!==i)?(58===a.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=C(),null!==n)?(58===a.charCodeAt(d)?(k=":",d++):(k=null,0===m&&c('":"')),null!==k)?(o=P(),null!==o?b=[b,j,f,g,h,i,l,n,k,o]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,"::"===a.substr(d,2)?
(b="::",d+=2):(b=null,0===m&&c('"::"')),null!==b?(j=C(),null!==j)?(58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=C(),null!==g)?(58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=C(),null!==i)?(58===a.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=P(),null!==n?b=[b,j,f,g,h,i,l,n]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,"::"===a.substr(d,2)?(b="::",d+=2):(b=
null,0===m&&c('"::"')),null!==b?(j=C(),null!==j)?(58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=C(),null!==g)?(58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=P(),null!==i?b=[b,j,f,g,h,i]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,"::"===a.substr(d,2)?(b="::",d+=2):(b=null,0===m&&c('"::"')),null!==b?(j=C(),null!==j)?(58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=P(),null!==
g?b=[b,j,f,g]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,"::"===a.substr(d,2)?(b="::",d+=2):(b=null,0===m&&c('"::"')),null!==b?(j=P(),null!==j?b=[b,j]:(b=null,d=q)):(b=null,d=q),null===b)if(q=d,"::"===a.substr(d,2)?(b="::",d+=2):(b=null,0===m&&c('"::"')),null!==b?(j=C(),null!==j?b=[b,j]:(b=null,d=q)):(b=null,d=q),null===b)if(q=d,b=C(),null!==b?("::"===a.substr(d,2)?(j="::",d+=2):(j=null,0===m&&c('"::"')),null!==j)?(f=C(),null!==f)?(58===a.charCodeAt(d)?(g=":",d++):(g=null,
0===m&&c('":"')),null!==g)?(h=C(),null!==h)?(58===a.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i)?(l=C(),null!==l)?(58===a.charCodeAt(d)?(n=":",d++):(n=null,0===m&&c('":"')),null!==n)?(k=C(),null!==k)?(58===a.charCodeAt(d)?(o=":",d++):(o=null,0===m&&c('":"')),null!==o)?(p=P(),null!==p?b=[b,j,f,g,h,i,l,n,k,o,p]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,b=C(),null!==b?
(k=d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=C(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?("::"===a.substr(d,2)?(f="::",d+=2):(f=null,0===m&&c('"::"')),null!==f)?(g=C(),null!==g)?(58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=C(),null!==i)?(58===a.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=C(),null!==n)?(58===a.charCodeAt(d)?(k=":",d++):(k=null,0===m&&c('":"')),null!==k)?(o=P(),null!==o?b=[b,j,
f,g,h,i,l,n,k,o]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,b=C(),null!==b?(k=d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=C(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=C(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?("::"===a.substr(d,2)?(g=
"::",d+=2):(g=null,0===m&&c('"::"')),null!==g)?(h=C(),null!==h)?(58===a.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i)?(l=C(),null!==l)?(58===a.charCodeAt(d)?(n=":",d++):(n=null,0===m&&c('":"')),null!==n)?(k=P(),null!==k?b=[b,j,f,g,h,i,l,n,k]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,b=C(),null!==b?(k=d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=C(),null!==f?j=[j,f]:
(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=C(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===a.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g?(h=C(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?("::"===a.substr(d,2)?(h="::",d+=2):(h=null,0===m&&c('"::"')),null!==h)?(i=C(),null!==i)?(58===a.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==
l)?(n=P(),null!==n?b=[b,j,f,g,h,i,l,n]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,b=C(),null!==b?(k=d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=C(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=C(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===a.charCodeAt(d)?(g=
":",d++):(g=null,0===m&&c('":"')),null!==g?(h=C(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?(k=d,58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h?(i=C(),null!==i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?("::"===a.substr(d,2)?(i="::",d+=2):(i=null,0===m&&c('"::"')),null!==i)?(l=P(),null!==l?b=[b,j,f,g,h,i,l]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)if(q=d,b=C(),null!==b?(k=
d,58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=C(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=C(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===a.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g?(h=C(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?(k=d,58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),
null!==h?(i=C(),null!==i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?(k=d,58===a.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i?(l=C(),null!==l?i=[i,l]:(i=null,d=k)):(i=null,d=k),i=null!==i?i:"",null!==i)?("::"===a.substr(d,2)?(l="::",d+=2):(l=null,0===m&&c('"::"')),null!==l)?(n=C(),null!==n?b=[b,j,f,g,h,i,l,n]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q),null===b)(q=d,b=C(),null!==b)?(k=d,58===a.charCodeAt(d)?
(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=C(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=C(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===a.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g?(h=C(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?(k=d,58===a.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h?(i=C(),null!==
i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?(k=d,58===a.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i?(l=C(),null!==l?i=[i,l]:(i=null,d=k)):(i=null,d=k),i=null!==i?i:"",null!==i)?(k=d,58===a.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l?(n=C(),null!==n?l=[l,n]:(l=null,d=k)):(l=null,d=k),l=null!==l?l:"",null!==l)?("::"===a.substr(d,2)?(n="::",d+=2):(n=null,0===m&&c('"::"')),null!==n)?b=[b,j,f,g,h,i,l,n]:(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=
q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q);null!==b&&(s.host_type="IPv6",b=a.substring(d,x));null===b&&(d=x);return b}function C(){var b,a,c,f,g;g=d;b=A();null!==b?(a=A(),a=null!==a?a:"",null!==a?(c=A(),c=null!==c?c:"",null!==c?(f=A(),f=null!==f?f:"",null!==f?b=[b,a,c,f]:(b=null,d=g)):(b=null,d=g)):(b=null,d=g)):(b=null,d=g);return b}function P(){var b,j,f,g;g=d;b=C();null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=C(),null!==f?b=[b,j,f]:(b=null,d=g)):
(b=null,d=g):(b=null,d=g);null===b&&(b=V());return b}function V(){var b,j,f,g,h,i,l,k,q;q=k=d;b=ea();null!==b?(46===a.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null!==j)?(f=ea(),null!==f)?(46===a.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."')),null!==g)?(h=ea(),null!==h)?(46===a.charCodeAt(d)?(i=".",d++):(i=null,0===m&&c('"."')),null!==i)?(l=ea(),null!==l?b=[b,j,f,g,h,i,l]:(b=null,d=q)):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q):(b=null,d=q);null!==b&&(s.host_type=
"IPv4",b=a.substring(d,k));null===b&&(d=k);return b}function ea(){var b,j,g,h;h=d;"25"===a.substr(d,2)?(b="25",d+=2):(b=null,0===m&&c('"25"'));null!==b?(/^[0-5]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[0-5]")),null!==j)?b=[b,j]:(b=null,d=h):(b=null,d=h);if(null===b&&(h=d,50===a.charCodeAt(d)?(b="2",d++):(b=null,0===m&&c('"2"')),null!==b?(/^[0-4]/.test(a.charAt(d))?(j=a.charAt(d),d++):(j=null,0===m&&c("[0-4]")),null!==j)?(g=f(),null!==g?b=[b,j,g]:(b=null,d=h)):(b=null,d=h):(b=null,
d=h),null===b))if(h=d,49===a.charCodeAt(d)?(b="1",d++):(b=null,0===m&&c('"1"')),null!==b?(j=f(),null!==j?(g=f(),null!==g?b=[b,j,g]:(b=null,d=h)):(b=null,d=h)):(b=null,d=h),null===b)h=d,/^[1-9]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[1-9]")),null!==b?(j=f(),null!==j?b=[b,j]:(b=null,d=h)):(b=null,d=h),null===b&&(b=f());return b}function Oa(){var b,a,c,g,h,i,l;l=i=d;b=f();b=null!==b?b:"";null!==b?(a=f(),a=null!==a?a:"",null!==a?(c=f(),c=null!==c?c:"",null!==c?(g=f(),g=null!==g?g:"",
null!==g?(h=f(),h=null!==h?h:"",null!==h?b=[b,a,c,g,h]:(b=null,d=l)):(b=null,d=l)):(b=null,d=l)):(b=null,d=l)):(b=null,d=l);null!==b&&(b=parseInt(b.join("")),s.port=b);null===b&&(d=i);return b}function kb(){var b,j,f,g;b=[];g=d;59===a.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"'));null!==j?(f=Sa(),null!==f?j=[j,f]:(j=null,d=g)):(j=null,d=g);for(;null!==j;)(b.push(j),g=d,59===a.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null!==j)?(f=Sa(),null!==f?j=[j,f]:(j=null,d=g)):(j=null,d=g);return b}
function Sa(){var b;b=pb();null===b&&(b=qb(),null===b&&(b=rb(),null===b&&(b=sb(),null===b&&(b=tb(),null===b&&(b=ub(),null===b&&(b=vb()))))));return b}function pb(){var b,j,f,g;g=f=d;"transport="===a.substr(d,10).toLowerCase()?(b=a.substr(d,10),d+=10):(b=null,0===m&&c('"transport="'));if(null!==b){"udp"===a.substr(d,3).toLowerCase()?(j=a.substr(d,3),d+=3):(j=null,0===m&&c('"udp"'));if(null===j&&("tcp"===a.substr(d,3).toLowerCase()?(j=a.substr(d,3),d+=3):(j=null,0===m&&c('"tcp"')),null===j))if("sctp"===
a.substr(d,4).toLowerCase()?(j=a.substr(d,4),d+=4):(j=null,0===m&&c('"sctp"')),null===j)"tls"===a.substr(d,3).toLowerCase()?(j=a.substr(d,3),d+=3):(j=null,0===m&&c('"tls"')),null===j&&(j=E());null!==j?b=[b,j]:(b=null,d=g)}else b=null,d=g;null!==b&&(b=b[1],s.uri_params||(s.uri_params={}),s.uri_params.transport=b.toLowerCase(),b=void 0);null===b&&(d=f);return b}function qb(){var b,j,f,g;g=f=d;"user="===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"user="'));null!==b?("phone"===
a.substr(d,5).toLowerCase()?(j=a.substr(d,5),d+=5):(j=null,0===m&&c('"phone"')),null===j&&("ip"===a.substr(d,2).toLowerCase()?(j=a.substr(d,2),d+=2):(j=null,0===m&&c('"ip"')),null===j&&(j=E())),null!==j)?b=[b,j]:(b=null,d=g):(b=null,d=g);null!==b&&(b=b[1],s.uri_params||(s.uri_params={}),s.uri_params.user=b.toLowerCase(),b=void 0);null===b&&(d=f);return b}function rb(){var b,j,f,g;g=f=d;"method="===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"method="'));null!==b?(j=sa(),null!==
j?b=[b,j]:(b=null,d=g)):(b=null,d=g);null!==b&&(b=b[1],s.uri_params||(s.uri_params={}),s.uri_params.method=b,b=void 0);null===b&&(d=f);return b}function sb(){var b,j,f,g;g=f=d;"ttl="===a.substr(d,4).toLowerCase()?(b=a.substr(d,4),d+=4):(b=null,0===m&&c('"ttl="'));null!==b?(j=Ta(),null!==j?b=[b,j]:(b=null,d=g)):(b=null,d=g);null!==b&&(b=b[1],s.params||(s.params={}),s.params.ttl=b,b=void 0);null===b&&(d=f);return b}function tb(){var b,j,f,g;g=f=d;"maddr="===a.substr(d,6).toLowerCase()?(b=a.substr(d,
6),d+=6):(b=null,0===m&&c('"maddr="'));null!==b?(j=da(),null!==j?b=[b,j]:(b=null,d=g)):(b=null,d=g);null!==b&&(b=b[1],s.uri_params||(s.uri_params={}),s.uri_params.maddr=b,b=void 0);null===b&&(d=f);return b}function ub(){var b,j,f,g,h,i;h=g=d;"lr"===a.substr(d,2).toLowerCase()?(b=a.substr(d,2),d+=2):(b=null,0===m&&c('"lr"'));null!==b?(i=d,61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j?(f=E(),null!==f?j=[j,f]:(j=null,d=i)):(j=null,d=i),j=null!==j?j:"",null!==j)?b=[b,j]:(b=null,d=
h):(b=null,d=h);null!==b&&(s.uri_params||(s.uri_params={}),b=s.uri_params.lr=void 0);null===b&&(d=g);return b}function vb(){var b,j,f,g,h,i;h=g=d;b=wb();null!==b?(i=d,61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j?(f=xb(),null!==f?j=[j,f]:(j=null,d=i)):(j=null,d=i),j=null!==j?j:"",null!==j)?b=[b,j]:(b=null,d=h):(b=null,d=h);null!==b&&(j=b[0],b=b[1],s.uri_params||(s.uri_params={}),b="undefined"===typeof b?void 0:b[1],s.uri_params[j.toLowerCase()]=b&&b.toLowerCase(),b=void 0);null===
b&&(d=g);return b}function wb(){var b,a,c;c=d;a=fa();if(null!==a)for(b=[];null!==a;)b.push(a),a=fa();else b=null;null!==b&&(b=b.join(""));null===b&&(d=c);return b}function xb(){var b,a,c;c=d;a=fa();if(null!==a)for(b=[];null!==a;)b.push(a),a=fa();else b=null;null!==b&&(b=b.join(""));null===b&&(d=c);return b}function fa(){var b;b=yb();null===b&&(b=w(),null===b&&(b=t()));return b}function yb(){var b;91===a.charCodeAt(d)?(b="[",d++):(b=null,0===m&&c('"["'));if(null===b&&(93===a.charCodeAt(d)?(b="]",d++):
(b=null,0===m&&c('"]"')),null===b))if(47===a.charCodeAt(d)?(b="/",d++):(b=null,0===m&&c('"/"')),null===b)if(58===a.charCodeAt(d)?(b=":",d++):(b=null,0===m&&c('":"')),null===b)if(38===a.charCodeAt(d)?(b="&",d++):(b=null,0===m&&c('"&"')),null===b)if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)36===a.charCodeAt(d)?(b="$",d++):(b=null,0===m&&c('"$"'));return b}function lb(){var b,j,f,g,h,i,l;i=d;63===a.charCodeAt(d)?(b="?",d++):(b=null,0===m&&c('"?"'));if(null!==b)if(j=ta(),null!==
j){f=[];l=d;38===a.charCodeAt(d)?(g="&",d++):(g=null,0===m&&c('"&"'));null!==g?(h=ta(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)(f.push(g),l=d,38===a.charCodeAt(d)?(g="&",d++):(g=null,0===m&&c('"&"')),null!==g)?(h=ta(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?b=[b,j,f]:(b=null,d=i)}else b=null,d=i;else b=null,d=i;return b}function ta(){var b,j,f,g,h;h=g=d;b=zb();null!==b?(61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j)?(f=Ab(),null!==f?b=[b,j,f]:(b=
null,d=h)):(b=null,d=h):(b=null,d=h);null!==b&&(j=b[0],b=b[2],j=j.join("").toLowerCase(),b=b.join(""),s.uri_headers||(s.uri_headers={}),s.uri_headers[j]?s.uri_headers[j].push(b):s.uri_headers[j]=[b],b=void 0);null===b&&(d=g);return b}function zb(){var b,d;d=ga();null===d&&(d=w(),null===d&&(d=t()));if(null!==d)for(b=[];null!==d;)b.push(d),d=ga(),null===d&&(d=w(),null===d&&(d=t()));else b=null;return b}function Ab(){var b,d;b=[];d=ga();null===d&&(d=w(),null===d&&(d=t()));for(;null!==d;)b.push(d),d=
ga(),null===d&&(d=w(),null===d&&(d=t()));return b}function ga(){var b;91===a.charCodeAt(d)?(b="[",d++):(b=null,0===m&&c('"["'));if(null===b&&(93===a.charCodeAt(d)?(b="]",d++):(b=null,0===m&&c('"]"')),null===b))if(47===a.charCodeAt(d)?(b="/",d++):(b=null,0===m&&c('"/"')),null===b)if(63===a.charCodeAt(d)?(b="?",d++):(b=null,0===m&&c('"?"')),null===b)if(58===a.charCodeAt(d)?(b=":",d++):(b=null,0===m&&c('":"')),null===b)if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)36===a.charCodeAt(d)?
(b="$",d++):(b=null,0===m&&c('"$"'));return b}function Bb(){var b,a,c,f,g,h;h=d;b=sa();null!==b?(a=p(),null!==a?(c=Cb(),null!==c?(f=p(),null!==f?(g=Ua(),null!==g?b=[b,a,c,f,g]:(b=null,d=h)):(b=null,d=h)):(b=null,d=h)):(b=null,d=h)):(b=null,d=h);return b}function Cb(){var b;b=qa();null===b&&(b=Va());return b}function Va(){var b,j,f,g;g=d;b=Db();null!==b?(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=Eb(),null===f&&(f=Fb()),null!==f?b=[b,j,f]:(b=null,d=g)):(b=null,d=g):(b=null,
d=g);return b}function Eb(){var b,j,f,g,h;g=d;b=Gb();null===b&&(b=ua());null!==b?(h=d,63===a.charCodeAt(d)?(j="?",d++):(j=null,0===m&&c('"?"')),null!==j?(f=Hb(),null!==f?j=[j,f]:(j=null,d=h)):(j=null,d=h),j=null!==j?j:"",null!==j)?b=[b,j]:(b=null,d=g):(b=null,d=g);return b}function Gb(){var b,j,f,g;g=d;"//"===a.substr(d,2)?(b="//",d+=2):(b=null,0===m&&c('"//"'));null!==b?(j=Ib(),null!==j?(f=ua(),f=null!==f?f:"",null!==f?b=[b,j,f]:(b=null,d=g)):(b=null,d=g)):(b=null,d=g);return b}function ua(){var b,
j,f;f=d;47===a.charCodeAt(d)?(b="/",d++):(b=null,0===m&&c('"/"'));null!==b?(j=Jb(),null!==j?b=[b,j]:(b=null,d=f)):(b=null,d=f);return b}function Fb(){var b,a,c,f;f=d;b=Kb();if(null!==b){a=[];for(c=ha();null!==c;)a.push(c),c=ha();null!==a?b=[b,a]:(b=null,d=f)}else b=null,d=f;return b}function ha(){var b;b=o();null===b&&(b=w(),null===b&&(b=t()));return b}function Kb(){var b;b=w();if(null===b&&(b=t(),null===b&&(59===a.charCodeAt(d)?(b=";",d++):(b=null,0===m&&c('";"')),null===b)))if(63===a.charCodeAt(d)?
(b="?",d++):(b=null,0===m&&c('"?"')),null===b)if(58===a.charCodeAt(d)?(b=":",d++):(b=null,0===m&&c('":"')),null===b)if(64===a.charCodeAt(d)?(b="@",d++):(b=null,0===m&&c('"@"')),null===b)if(38===a.charCodeAt(d)?(b="&",d++):(b=null,0===m&&c('"&"')),null===b)if(61===a.charCodeAt(d)?(b="=",d++):(b=null,0===m&&c('"="')),null===b)if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)if(36===a.charCodeAt(d)?(b="$",d++):(b=null,0===m&&c('"$"')),null===b)44===a.charCodeAt(d)?(b=",",d++):(b=
null,0===m&&c('","'));return b}function Jb(){var b,j,f,g,h,i;h=d;b=va();if(null!==b){j=[];i=d;47===a.charCodeAt(d)?(f="/",d++):(f=null,0===m&&c('"/"'));null!==f?(g=va(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);for(;null!==f;)(j.push(f),i=d,47===a.charCodeAt(d)?(f="/",d++):(f=null,0===m&&c('"/"')),null!==f)?(g=va(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);null!==j?b=[b,j]:(b=null,d=h)}else b=null,d=h;return b}function va(){var b,j,f,g,h,i;h=d;b=[];for(j=ia();null!==j;)b.push(j),j=ia();if(null!==
b){j=[];i=d;59===a.charCodeAt(d)?(f=";",d++):(f=null,0===m&&c('";"'));null!==f?(g=Wa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);for(;null!==f;)(j.push(f),i=d,59===a.charCodeAt(d)?(f=";",d++):(f=null,0===m&&c('";"')),null!==f)?(g=Wa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);null!==j?b=[b,j]:(b=null,d=h)}else b=null,d=h;return b}function Wa(){var b,d;b=[];for(d=ia();null!==d;)b.push(d),d=ia();return b}function ia(){var b;b=w();if(null===b&&(b=t(),null===b&&(58===a.charCodeAt(d)?(b=":",d++):(b=
null,0===m&&c('":"')),null===b)))if(64===a.charCodeAt(d)?(b="@",d++):(b=null,0===m&&c('"@"')),null===b)if(38===a.charCodeAt(d)?(b="&",d++):(b=null,0===m&&c('"&"')),null===b)if(61===a.charCodeAt(d)?(b="=",d++):(b=null,0===m&&c('"="')),null===b)if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)if(36===a.charCodeAt(d)?(b="$",d++):(b=null,0===m&&c('"$"')),null===b)44===a.charCodeAt(d)?(b=",",d++):(b=null,0===m&&c('","'));return b}function Db(){var b,j,g,h,i;i=h=d;b=n();if(null!==b){j=
[];g=n();if(null===g&&(g=f(),null===g&&(43===a.charCodeAt(d)?(g="+",d++):(g=null,0===m&&c('"+"')),null===g)))if(45===a.charCodeAt(d)?(g="-",d++):(g=null,0===m&&c('"-"')),null===g)46===a.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."'));for(;null!==g;)if(j.push(g),g=n(),null===g&&(g=f(),null===g&&(43===a.charCodeAt(d)?(g="+",d++):(g=null,0===m&&c('"+"')),null===g)))if(45===a.charCodeAt(d)?(g="-",d++):(g=null,0===m&&c('"-"')),null===g)46===a.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."'));null!==
j?b=[b,j]:(b=null,d=i)}else b=null,d=i;null!==b&&(s.scheme=a.substring(d,h),b=void 0);null===b&&(d=h);return b}function Ib(){var b;b=Lb();null===b&&(b=ja());return b}function Lb(){var b,j,f,g;g=f=d;b=oa();null!==b?(64===a.charCodeAt(d)?(j="@",d++):(j=null,0===m&&c('"@"')),null!==j)?b=[b,j]:(b=null,d=g):(b=null,d=g);b=null!==b?b:"";null!==b?(j=pa(),null!==j?b=[b,j]:(b=null,d=f)):(b=null,d=f);return null!==b?b:""}function ja(){var b,j;j=w();if(null===j&&(j=t(),null===j&&(36===a.charCodeAt(d)?(j="$",
d++):(j=null,0===m&&c('"$"')),null===j)))if(44===a.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","')),null===j)if(59===a.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null===j)if(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(64===a.charCodeAt(d)?(j="@",d++):(j=null,0===m&&c('"@"')),null===j)if(38===a.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)if(61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)43===a.charCodeAt(d)?(j="+",d++):(j=null,
0===m&&c('"+"'));if(null!==j)for(b=[];null!==j;){if(b.push(j),j=w(),null===j&&(j=t(),null===j&&(36===a.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)))if(44===a.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","')),null===j)if(59===a.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null===j)if(58===a.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(64===a.charCodeAt(d)?(j="@",d++):(j=null,0===m&&c('"@"')),null===j)if(38===a.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),
null===j)if(61===a.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)43===a.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"'))}else b=null;return b}function Hb(){var b,d;b=[];for(d=ha();null!==d;)b.push(d),d=ha();return b}function Ua(){var b,j,g,h,i,l,k,q;q=k=d;"sip"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"SIP"'));if(null!==b)if(47===a.charCodeAt(d)?(j="/",d++):(j=null,0===m&&c('"/"')),null!==j){h=f();if(null!==h)for(g=[];null!==h;)g.push(h),h=f();else g=
null;if(null!==g)if(46===a.charCodeAt(d)?(h=".",d++):(h=null,0===m&&c('"."')),null!==h){l=f();if(null!==l)for(i=[];null!==l;)i.push(l),l=f();else i=null;null!==i?b=[b,j,g,h,i]:(b=null,d=q)}else b=null,d=q;else b=null,d=q}else b=null,d=q;else b=null,d=q;null!==b&&(s.sip_version=a.substring(d,k),b=void 0);null===b&&(d=k);return b}function Mb(){var b;"INVITE"===a.substr(d,6)?(b="INVITE",d+=6):(b=null,0===m&&c('"INVITE"'));return b}function Nb(){var b;"ACK"===a.substr(d,3)?(b="ACK",d+=3):(b=null,0===
m&&c('"ACK"'));return b}function Ob(){var b;"OPTIONS"===a.substr(d,7)?(b="OPTIONS",d+=7):(b=null,0===m&&c('"OPTIONS"'));return b}function Pb(){var b;"BYE"===a.substr(d,3)?(b="BYE",d+=3):(b=null,0===m&&c('"BYE"'));return b}function Qb(){var b;"CANCEL"===a.substr(d,6)?(b="CANCEL",d+=6):(b=null,0===m&&c('"CANCEL"'));return b}function Rb(){var b;"REGISTER"===a.substr(d,8)?(b="REGISTER",d+=8):(b=null,0===m&&c('"REGISTER"'));return b}function Sb(){var b;"SUBSCRIBE"===a.substr(d,9)?(b="SUBSCRIBE",d+=9):
(b=null,0===m&&c('"SUBSCRIBE"'));return b}function Tb(){var b;"NOTIFY"===a.substr(d,6)?(b="NOTIFY",d+=6):(b=null,0===m&&c('"NOTIFY"'));return b}function sa(){var b,c;c=d;b=Mb();null===b&&(b=Nb(),null===b&&(b=Ob(),null===b&&(b=Pb(),null===b&&(b=Qb(),null===b&&(b=Rb(),null===b&&(b=Sb(),null===b&&(b=Tb(),null===b&&(b=E()))))))));null!==b&&(s.method=a.substring(d,c),b=s.method);null===b&&(d=c);return b}function Ub(){var b,a,c,f,g,h;h=d;b=Ua();null!==b?(a=p(),null!==a?(c=Vb(),null!==c?(f=p(),null!==f?
(g=Wb(),null!==g?b=[b,a,c,f,g]:(b=null,d=h)):(b=null,d=h)):(b=null,d=h)):(b=null,d=h)):(b=null,d=h);return b}function Vb(){var b,a;a=d;b=Xb();null!==b&&(s.status_code=parseInt(b.join("")),b=void 0);null===b&&(d=a);return b}function Xb(){var b,a,c,g;g=d;b=f();null!==b?(a=f(),null!==a?(c=f(),null!==c?b=[b,a,c]:(b=null,d=g)):(b=null,d=g)):(b=null,d=g);return b}function Wb(){var b,c,f;f=d;b=[];c=o();null===c&&(c=w(),null===c&&(c=t(),null===c&&(c=N(),null===c&&(c=L(),null===c&&(c=p(),null===c&&(c=r()))))));
for(;null!==c;)b.push(c),c=o(),null===c&&(c=w(),null===c&&(c=t(),null===c&&(c=N(),null===c&&(c=L(),null===c&&(c=p(),null===c&&(c=r()))))));null!==b&&(s.reason_phrase=a.substring(d,f),b=void 0);null===b&&(d=f);return b}function wa(){var b,a,c,f,g,h,i;h=g=d;b=na();null===b&&(b=W());if(null!==b){a=[];i=d;c=K();null!==c?(f=Xa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=K(),null!==c?(f=Xa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=
null,d=h;if(null!==b){var l;s.multi_header||(s.multi_header=[]);try{l=new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params),delete s.uri,delete s.display_name,delete s.params}catch(m){l=null}s.multi_header.push({possition:d,offset:g,parsed:l});b=void 0}null===b&&(d=g);return b}function W(){var b,a,c,f,g;g=d;b=xa();b=null!==b?b:"";null!==b?(a=T(),null!==a?(c=qa(),null!==c?(f=O(),null!==f?b=[b,a,c,f]:(b=null,d=g)):(b=null,d=g)):(b=null,d=g)):(b=null,d=g);return b}function xa(){var b,c,f,g,h,i,l;i=
h=d;b=E();if(null!==b){c=[];l=d;f=J();null!==f?(g=E(),null!==g?f=[f,g]:(f=null,d=l)):(f=null,d=l);for(;null!==f;)c.push(f),l=d,f=J(),null!==f?(g=E(),null!==g?f=[f,g]:(f=null,d=l)):(f=null,d=l);null!==c?b=[b,c]:(b=null,d=i)}else b=null,d=i;null===b&&(b=ba());null!==b&&(b=a.substring(d,h).trim(),'"'===b[0]&&(b=b.substring(1,b.length-1)),s.display_name=b,b=void 0);null===b&&(d=h);return b}function Xa(){var b;b=Yb();null===b&&(b=Zb(),null===b&&(b=M()));return b}function Yb(){var b,f,g,h,i;i=h=d;"q"===
a.substr(d,1).toLowerCase()?(b=a.substr(d,1),d++):(b=null,0===m&&c('"q"'));null!==b?(f=G(),null!==f?(g=$b(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(b=b[2],s.params||(s.params={}),s.params.q=b,b=void 0);null===b&&(d=h);return b}function Zb(){var b,f,g,h,i;i=h=d;"expires"===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"expires"'));null!==b?(f=G(),null!==f?(g=X(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(b=b[2],s.params||
(s.params={}),s.params.expires=b,b=void 0);null===b&&(d=h);return b}function X(){var b,a,c;c=d;a=f();if(null!==a)for(b=[];null!==a;)b.push(a),a=f();else b=null;null!==b&&(b=parseInt(b.join("")));null===b&&(d=c);return b}function $b(){var b,j,g,h,i,l,k,q;k=l=d;48===a.charCodeAt(d)?(b="0",d++):(b=null,0===m&&c('"0"'));null!==b?(q=d,46===a.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null!==j?(g=f(),g=null!==g?g:"",null!==g?(h=f(),h=null!==h?h:"",null!==h?(i=f(),i=null!==i?i:"",null!==i?j=[j,g,
h,i]:(j=null,d=q)):(j=null,d=q)):(j=null,d=q)):(j=null,d=q),j=null!==j?j:"",null!==j)?b=[b,j]:(b=null,d=k):(b=null,d=k);null!==b&&(b=parseFloat(a.substring(d,l)));null===b&&(d=l);return b}function M(){var b,a,c,f,g,h;g=f=d;b=E();null!==b?(h=d,a=G(),null!==a?(c=ac(),null!==c?a=[a,c]:(a=null,d=h)):(a=null,d=h),a=null!==a?a:"",null!==a)?b=[b,a]:(b=null,d=g):(b=null,d=g);null!==b&&(a=b[0],b=b[1],s.params||(s.params={}),b="undefined"===typeof b?void 0:b[1],s.params[a.toLowerCase()]=b,b=void 0);null===
b&&(d=f);return b}function ac(){var b;b=E();null===b&&(b=da(),null===b&&(b=ba()));return b}function bc(){var b;"render"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"render"'));if(null===b&&("session"===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"session"')),null===b))if("icon"===a.substr(d,4).toLowerCase()?(b=a.substr(d,4),d+=4):(b=null,0===m&&c('"icon"')),null===b)"alert"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"alert"')),
null===b&&(b=E());return b}function Ya(){var b;b=cc();null===b&&(b=M());return b}function cc(){var b,f,g,h;h=d;"handling"===a.substr(d,8).toLowerCase()?(b=a.substr(d,8),d+=8):(b=null,0===m&&c('"handling"'));null!==b?(f=G(),null!==f)?("optional"===a.substr(d,8).toLowerCase()?(g=a.substr(d,8),d+=8):(g=null,0===m&&c('"optional"')),null===g&&("required"===a.substr(d,8).toLowerCase()?(g=a.substr(d,8),d+=8):(g=null,0===m&&c('"required"')),null===g&&(g=E())),null!==g)?b=[b,f,g]:(b=null,d=h):(b=null,d=h):
(b=null,d=h);return b}function dc(){var b,a,c,f,g,h,i,l;i=d;b=ec();if(null!==b)if(a=F(),null!==a)if(c=fc(),null!==c){f=[];l=d;g=K();null!==g?(h=Za(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)f.push(g),l=d,g=K(),null!==g?(h=Za(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?b=[b,a,c,f]:(b=null,d=i)}else b=null,d=i;else b=null,d=i;else b=null,d=i;return b}function ec(){var b;b=gc();null===b&&(b=hc());return b}function gc(){var b;"text"===a.substr(d,4).toLowerCase()?(b=a.substr(d,
4),d+=4):(b=null,0===m&&c('"text"'));if(null===b&&("image"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"image"')),null===b))if("audio"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"audio"')),null===b)if("video"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"video"')),null===b)"application"===a.substr(d,11).toLowerCase()?(b=a.substr(d,11),d+=11):(b=null,0===m&&c('"application"')),null===b&&(b=ya());return b}function hc(){var b;
"message"===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"message"'));null===b&&("multipart"===a.substr(d,9).toLowerCase()?(b=a.substr(d,9),d+=9):(b=null,0===m&&c('"multipart"')),null===b&&(b=ya()));return b}function ya(){var b;b=E();null===b&&(b=ic());return b}function ic(){var b,f,g;g=d;"x-"===a.substr(d,2).toLowerCase()?(b=a.substr(d,2),d+=2):(b=null,0===m&&c('"x-"'));null!==b?(f=E(),null!==f?b=[b,f]:(b=null,d=g)):(b=null,d=g);return b}function fc(){var b;b=ya();null===
b&&(b=E());return b}function Za(){var b,a,c,f;f=d;b=E();null!==b?(a=G(),null!==a?(c=jc(),null!==c?b=[b,a,c]:(b=null,d=f)):(b=null,d=f)):(b=null,d=f);return b}function jc(){var b;b=E();null===b&&(b=ba());return b}function kc(){var b,a,c;c=d;a=f();if(null!==a)for(b=[];null!==a;)b.push(a),a=f();else b=null;null!==b&&(s.value=parseInt(b.join("")),b=void 0);null===b&&(d=c);return b}function ka(){var b,f,g,h,i,l;i=d;b=B();if(null!==b){f=[];l=d;46===a.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."'));null!==
g?(h=B(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)(f.push(g),l=d,46===a.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."')),null!==g)?(h=B(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?b=[b,f]:(b=null,d=i)}else b=null,d=i;return b}function $a(){var b;b=ab();null===b&&(b=M());return b}function ab(){var b,f,g,h,i;i=h=d;"tag"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"tag"'));null!==b?(f=G(),null!==f?(g=E(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,
d=i)):(b=null,d=i);null!==b&&(s.tag=b[2],b=void 0);null===b&&(d=h);return b}function bb(){var b,f,g,h,i,l,k,n;k=d;"digest"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"Digest"'));if(null!==b)if(f=J(),null!==f)if(g=za(),null!==g){h=[];n=d;i=q();null!==i?(l=za(),null!==l?i=[i,l]:(i=null,d=n)):(i=null,d=n);for(;null!==i;)h.push(i),n=d,i=q(),null!==i?(l=za(),null!==l?i=[i,l]:(i=null,d=n)):(i=null,d=n);null!==h?b=[b,f,g,h]:(b=null,d=k)}else b=null,d=k;else b=null,d=k;else b=
null,d=k;null===b&&(b=lc());return b}function lc(){var b,a,c,f,g,h,i,l;i=d;b=E();if(null!==b)if(a=J(),null!==a)if(c=la(),null!==c){f=[];l=d;g=q();null!==g?(h=la(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)f.push(g),l=d,g=q(),null!==g?(h=la(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?b=[b,a,c,f]:(b=null,d=i)}else b=null,d=i;else b=null,d=i;else b=null,d=i;return b}function la(){var b,a,c,f;f=d;b=E();null!==b?(a=G(),null!==a?(c=E(),null===c&&(c=ba()),null!==c?b=[b,a,c]:(b=
null,d=f)):(b=null,d=f)):(b=null,d=f);return b}function za(){var b;b=mc();null===b&&(b=nc(),null===b&&(b=oc(),null===b&&(b=pc(),null===b&&(b=qc(),null===b&&(b=rc(),null===b&&(b=sc(),null===b&&(b=la())))))));return b}function mc(){var b,f,g,h;h=d;"realm"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"realm"'));null!==b?(f=G(),null!==f?(g=tc(),null!==g?b=[b,f,g]:(b=null,d=h)):(b=null,d=h)):(b=null,d=h);return b}function tc(){var b,a;a=d;b=ma();null!==b&&(s.realm=b,b=void 0);
null===b&&(d=a);return b}function nc(){var b,f,g,h,i,l,k,q,n;q=d;"domain"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"domain"'));if(null!==b)if(f=G(),null!==f)if(g=Ia(),null!==g)if(h=Aa(),null!==h){i=[];n=d;k=p();if(null!==k)for(l=[];null!==k;)l.push(k),k=p();else l=null;null!==l?(k=Aa(),null!==k?l=[l,k]:(l=null,d=n)):(l=null,d=n);for(;null!==l;){i.push(l);n=d;k=p();if(null!==k)for(l=[];null!==k;)l.push(k),k=p();else l=null;null!==l?(k=Aa(),null!==k?l=[l,k]:(l=null,d=n)):
(l=null,d=n)}null!==i?(l=Ja(),null!==l?b=[b,f,g,h,i,l]:(b=null,d=q)):(b=null,d=q)}else b=null,d=q;else b=null,d=q;else b=null,d=q;else b=null,d=q;return b}function Aa(){var b;b=Va();null===b&&(b=ua());return b}function oc(){var b,f,g,h;h=d;"nonce"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"nonce"'));null!==b?(f=G(),null!==f?(g=uc(),null!==g?b=[b,f,g]:(b=null,d=h)):(b=null,d=h)):(b=null,d=h);return b}function uc(){var b,a;a=d;b=ma();null!==b&&(s.nonce=b,b=void 0);null===
b&&(d=a);return b}function pc(){var b,f,g,h,i;i=h=d;"opaque"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"opaque"'));null!==b?(f=G(),null!==f?(g=ma(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(s.opaque=b[2],b=void 0);null===b&&(d=h);return b}function qc(){var b,f,g,h,i;h=d;"stale"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"stale"'));null!==b?(f=G(),null!==f)?(i=d,"true"===a.substr(d,4).toLowerCase()?(g=a.substr(d,
4),d+=4):(g=null,0===m&&c('"true"')),null!==g&&(s.stale=!0,g=void 0),null===g&&(d=i),null===g&&(i=d,"false"===a.substr(d,5).toLowerCase()?(g=a.substr(d,5),d+=5):(g=null,0===m&&c('"false"')),null!==g&&(s.stale=!1,g=void 0),null===g&&(d=i)),null!==g?b=[b,f,g]:(b=null,d=h)):(b=null,d=h):(b=null,d=h);return b}function rc(){var b,f,g,h,i;i=h=d;"algorithm"===a.substr(d,9).toLowerCase()?(b=a.substr(d,9),d+=9):(b=null,0===m&&c('"algorithm"'));null!==b?(f=G(),null!==f)?("md5"===a.substr(d,3).toLowerCase()?
(g=a.substr(d,3),d+=3):(g=null,0===m&&c('"MD5"')),null===g&&("md5-sess"===a.substr(d,8).toLowerCase()?(g=a.substr(d,8),d+=8):(g=null,0===m&&c('"MD5-sess"')),null===g&&(g=E())),null!==g)?b=[b,f,g]:(b=null,d=i):(b=null,d=i):(b=null,d=i);null!==b&&(s.algorithm=b[2].toUpperCase(),b=void 0);null===b&&(d=h);return b}function sc(){var b,f,g,h,i,l,k,q,n,o;q=d;"qop"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"qop"'));if(null!==b)if(f=G(),null!==f)if(g=Ia(),null!==g){n=d;h=Ba();
if(null!==h){i=[];o=d;44===a.charCodeAt(d)?(l=",",d++):(l=null,0===m&&c('","'));null!==l?(k=Ba(),null!==k?l=[l,k]:(l=null,d=o)):(l=null,d=o);for(;null!==l;)(i.push(l),o=d,44===a.charCodeAt(d)?(l=",",d++):(l=null,0===m&&c('","')),null!==l)?(k=Ba(),null!==k?l=[l,k]:(l=null,d=o)):(l=null,d=o);null!==i?h=[h,i]:(h=null,d=n)}else h=null,d=n;null!==h?(i=Ja(),null!==i?b=[b,f,g,h,i]:(b=null,d=q)):(b=null,d=q)}else b=null,d=q;else b=null,d=q;else b=null,d=q;return b}function Ba(){var b,f;f=d;"auth-int"===a.substr(d,
8).toLowerCase()?(b=a.substr(d,8),d+=8):(b=null,0===m&&c('"auth-int"'));null===b&&("auth"===a.substr(d,4).toLowerCase()?(b=a.substr(d,4),d+=4):(b=null,0===m&&c('"auth"')),null===b&&(b=E()));null!==b&&(s.qop||(s.qop=[]),s.qop.push(b.toLowerCase()),b=void 0);null===b&&(d=f);return b}function Ca(){var b,a,c,f,g,h,i;h=g=d;b=W();if(null!==b){a=[];i=d;c=K();null!==c?(f=M(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=K(),null!==c?(f=M(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,
d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;if(null!==b){var l;s.multi_header||(s.multi_header=[]);try{l=new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params),delete s.uri,delete s.display_name,delete s.params}catch(m){l=null}s.multi_header.push({possition:d,offset:g,parsed:l});b=void 0}null===b&&(d=g);return b}function Da(){var b,a,c,f,g,h;g=d;b=W();if(null!==b){a=[];h=d;c=K();null!==c?(f=M(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=K(),null!==c?(f=M(),
null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b}function vc(){var b,f;f=d;"active"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"active"'));if(null===b&&("pending"===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"pending"')),null===b))"terminated"===a.substr(d,10).toLowerCase()?(b=a.substr(d,10),d+=10):(b=null,0===m&&c('"terminated"')),null===b&&(b=E());null!==b&&(s.state=a.substring(d,f),b=void 0);
null===b&&(d=f);return b}function cb(){var b,f,g,h,i;i=h=d;"reason"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"reason"'));null!==b?(f=G(),null!==f?(g=wc(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(b=function(b,d){if(typeof d!=="undefined")s.reason=d}(h,b[2]));null===b&&(d=h);if(null===b&&(i=h=d,"expires"===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"expires"')),null!==b?(f=G(),null!==f?(g=X(),null!==g?b=[b,f,g]:(b=
null,d=i)):(b=null,d=i)):(b=null,d=i),null!==b&&(b=function(b,d){if(typeof d!=="undefined")s.expires=d}(h,b[2])),null===b&&(d=h),null===b))i=h=d,"retry_after"===a.substr(d,11).toLowerCase()?(b=a.substr(d,11),d+=11):(b=null,0===m&&c('"retry_after"')),null!==b?(f=G(),null!==f?(g=X(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i),null!==b&&(b=function(b,d){if(typeof d!=="undefined")s.retry_after=d}(h,b[2])),null===b&&(d=h),null===b&&(b=M());return b}function wc(){var b;"deactivated"===a.substr(d,
11).toLowerCase()?(b=a.substr(d,11),d+=11):(b=null,0===m&&c('"deactivated"'));if(null===b&&("probation"===a.substr(d,9).toLowerCase()?(b=a.substr(d,9),d+=9):(b=null,0===m&&c('"probation"')),null===b))if("rejected"===a.substr(d,8).toLowerCase()?(b=a.substr(d,8),d+=8):(b=null,0===m&&c('"rejected"')),null===b)if("timeout"===a.substr(d,7).toLowerCase()?(b=a.substr(d,7),d+=7):(b=null,0===m&&c('"timeout"')),null===b)if("giveup"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"giveup"')),
null===b)if("noresource"===a.substr(d,10).toLowerCase()?(b=a.substr(d,10),d+=10):(b=null,0===m&&c('"noresource"')),null===b)"invariant"===a.substr(d,9).toLowerCase()?(b=a.substr(d,9),d+=9):(b=null,0===m&&c('"invariant"')),null===b&&(b=E());return b}function db(){var b;b=ab();null===b&&(b=M());return b}function Ea(){var b,a,c,f,g,h,i,l;i=d;b=xc();if(null!==b)if(a=J(),null!==a)if(c=yc(),null!==c){f=[];l=d;g=K();null!==g?(h=eb(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)f.push(g),l=
d,g=K(),null!==g?(h=eb(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?b=[b,a,c,f]:(b=null,d=i)}else b=null,d=i;else b=null,d=i;else b=null,d=i;return b}function eb(){var b;b=zc();null===b&&(b=Ac(),null===b&&(b=Bc(),null===b&&(b=Cc(),null===b&&(b=Dc(),null===b&&(b=M())))));return b}function zc(){var b,f,g,h,i;i=h=d;"ttl"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"ttl"'));null!==b?(f=G(),null!==f?(g=Ta(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);
null!==b&&(s.ttl=b[2],b=void 0);null===b&&(d=h);return b}function Ac(){var b,f,g,h,i;i=h=d;"maddr"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"maddr"'));null!==b?(f=G(),null!==f?(g=da(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(s.maddr=b[2],b=void 0);null===b&&(d=h);return b}function Bc(){var b,f,g,h,i;i=h=d;"received"===a.substr(d,8).toLowerCase()?(b=a.substr(d,8),d+=8):(b=null,0===m&&c('"received"'));null!==b?(f=G(),null!==f?(g=V(),null===
g&&(g=Ra()),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(s.received=b[2],b=void 0);null===b&&(d=h);return b}function Cc(){var b,f,g,h,i;i=h=d;"branch"===a.substr(d,6).toLowerCase()?(b=a.substr(d,6),d+=6):(b=null,0===m&&c('"branch"'));null!==b?(f=G(),null!==f?(g=E(),null!==g?b=[b,f,g]:(b=null,d=i)):(b=null,d=i)):(b=null,d=i);null!==b&&(s.branch=b[2],b=void 0);null===b&&(d=h);return b}function Dc(){var b,g,h,i,l,k,q;k=l=d;"rport"===a.substr(d,5).toLowerCase()?(b=a.substr(d,
5),d+=5):(b=null,0===m&&c('"rport"'));if(null!==b){q=d;g=G();if(null!==g){h=[];for(i=f();null!==i;)h.push(i),i=f();null!==h?g=[g,h]:(g=null,d=q)}else g=null,d=q;g=null!==g?g:"";null!==g?b=[b,g]:(b=null,d=k)}else b=null,d=k;null!==b&&("undefined"!==typeof response_port&&(s.rport=response_port.join("")),b=void 0);null===b&&(d=l);return b}function xc(){var b,a,c,f,g,h;h=d;b=Ec();null!==b?(a=F(),null!==a?(c=E(),null!==c?(f=F(),null!==f?(g=Fa(),null!==g?b=[b,a,c,f,g]:(b=null,d=h)):(b=null,d=h)):(b=null,
d=h)):(b=null,d=h)):(b=null,d=h);return b}function Ec(){var b,f;f=d;"sip"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"SIP"'));null===b&&(b=E());null!==b&&(s.protocol=b,b=void 0);null===b&&(d=f);return b}function Fa(){var b,f;f=d;"udp"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"UDP"'));if(null===b&&("tcp"===a.substr(d,3).toLowerCase()?(b=a.substr(d,3),d+=3):(b=null,0===m&&c('"TCP"')),null===b))if("tls"===a.substr(d,3).toLowerCase()?(b=a.substr(d,
3),d+=3):(b=null,0===m&&c('"TLS"')),null===b)"sctp"===a.substr(d,4).toLowerCase()?(b=a.substr(d,4),d+=4):(b=null,0===m&&c('"SCTP"')),null===b&&(b=E());null!==b&&(s.transport=b,b=void 0);null===b&&(d=f);return b}function yc(){var b,a,c,f,g;f=d;b=Fc();null!==b?(g=d,a=jb(),null!==a?(c=Gc(),null!==c?a=[a,c]:(a=null,d=g)):(a=null,d=g),a=null!==a?a:"",null!==a)?b=[b,a]:(b=null,d=f):(b=null,d=f);return b}function Fc(){var b,c;c=d;b=Pa();null===b&&(b=V(),null===b&&(b=ra()));null!==b&&(s.host=a.substring(d,
c),b=void 0);null===b&&(d=c);return b}function Gc(){var b,a,c,g,h,i,l;l=i=d;b=f();b=null!==b?b:"";null!==b?(a=f(),a=null!==a?a:"",null!==a?(c=f(),c=null!==c?c:"",null!==c?(g=f(),g=null!==g?g:"",null!==g?(h=f(),h=null!==h?h:"",null!==h?b=[b,a,c,g,h]:(b=null,d=l)):(b=null,d=l)):(b=null,d=l)):(b=null,d=l)):(b=null,d=l);null!==b&&(s.port=parseInt(b.join("")),b=void 0);null===b&&(d=i);return b}function Ta(){var b,a,c,g,h;h=g=d;b=f();null!==b?(a=f(),a=null!==a?a:"",null!==a?(c=f(),c=null!==c?c:"",null!==
c?b=[b,a,c]:(b=null,d=h)):(b=null,d=h)):(b=null,d=h);null!==b&&(b=parseInt(b.join("")));null===b&&(d=g);return b}function Hc(){var b,d;b=[];d=Q();null===d&&(d=L(),null===d&&(d=J()));for(;null!==d;)b.push(d),d=Q(),null===d&&(d=L(),null===d&&(d=J()));return b}function Ic(){var b,f;f=d;"stuns"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"stuns"'));null===b&&("stun"===a.substr(d,4).toLowerCase()?(b=a.substr(d,4),d+=4):(b=null,0===m&&c('"stun"')));null!==b&&(s.scheme=b,b=void 0);
null===b&&(d=f);return b}function fb(){var b,f,g,h,i;h=d;b=Jc();null!==b?(i=d,58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=Oa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i),f=null!==f?f:"",null!==f)?b=[b,f]:(b=null,d=h):(b=null,d=h);return b}function Jc(){var b,a;a=d;b=V();null===b&&(b=ra(),null===b&&(b=ja()));null!==b&&(s.host=b,b=void 0);null===b&&(d=a);return b}function ja(){var b,c,f;f=d;b=[];c=gb();null===c&&(c=t(),null===c&&(c=hb()));for(;null!==c;)b.push(c),c=gb(),null===
c&&(c=t(),null===c&&(c=hb()));null!==b&&(b=a.substring(d,f));null===b&&(d=f);return b}function gb(){var b;b=n();if(null===b&&(b=f(),null===b&&(45===a.charCodeAt(d)?(b="-",d++):(b=null,0===m&&c('"-"')),null===b)))if(46===a.charCodeAt(d)?(b=".",d++):(b=null,0===m&&c('"."')),null===b)if(95===a.charCodeAt(d)?(b="_",d++):(b=null,0===m&&c('"_"')),null===b)126===a.charCodeAt(d)?(b="~",d++):(b=null,0===m&&c('"~"'));return b}function hb(){var b;33===a.charCodeAt(d)?(b="!",d++):(b=null,0===m&&c('"!"'));if(null===
b&&(36===a.charCodeAt(d)?(b="$",d++):(b=null,0===m&&c('"$"')),null===b))if(38===a.charCodeAt(d)?(b="&",d++):(b=null,0===m&&c('"&"')),null===b)if(39===a.charCodeAt(d)?(b="'",d++):(b=null,0===m&&c('"\'"')),null===b)if(40===a.charCodeAt(d)?(b="(",d++):(b=null,0===m&&c('"("')),null===b)if(41===a.charCodeAt(d)?(b=")",d++):(b=null,0===m&&c('")"')),null===b)if(42===a.charCodeAt(d)?(b="*",d++):(b=null,0===m&&c('"*"')),null===b)if(43===a.charCodeAt(d)?(b="+",d++):(b=null,0===m&&c('"+"')),null===b)if(44===
a.charCodeAt(d)?(b=",",d++):(b=null,0===m&&c('","')),null===b)if(59===a.charCodeAt(d)?(b=";",d++):(b=null,0===m&&c('";"')),null===b)61===a.charCodeAt(d)?(b="=",d++):(b=null,0===m&&c('"="'));return b}function Kc(){var b,f;f=d;"turns"===a.substr(d,5).toLowerCase()?(b=a.substr(d,5),d+=5):(b=null,0===m&&c('"turns"'));null===b&&("turn"===a.substr(d,4).toLowerCase()?(b=a.substr(d,4),d+=4):(b=null,0===m&&c('"turn"')));null!==b&&(s.scheme=b,b=void 0);null===b&&(d=f);return b}function Nc(b){b.sort();for(var d=
null,a=[],c=0;c<b.length;c++)b[c]!==d&&(a.push(b[c]),d=b[c]);return a}function Oc(){for(var b=1,c=1,f=!1,g=0;g<Math.max(d,Y);g++){var h=a.charAt(g);"\n"===h?(f||b++,c=1,f=!1):"\r"===h||"\u2028"===h||"\u2029"===h?(b++,c=1,f=!0):(c++,f=!1)}return{line:b,column:c}}var Lc={CRLF:g,DIGIT:f,ALPHA:n,HEXDIG:A,WSP:v,OCTET:l,DQUOTE:x,SP:p,HTAB:r,alphanum:y,reserved:o,unreserved:w,mark:z,escaped:t,LWS:J,SWS:I,HCOLON:R,TEXT_UTF8_TRIM:H,TEXT_UTF8char:Q,UTF8_NONASCII:N,UTF8_CONT:L,LHEX:function(){var b;b=f();null===
b&&(/^[a-f]/.test(a.charAt(d))?(b=a.charAt(d),d++):(b=null,0===m&&c("[a-f]")));return b},token:E,token_nodot:B,separators:function(){var b;40===a.charCodeAt(d)?(b="(",d++):(b=null,0===m&&c('"("'));if(null===b&&(41===a.charCodeAt(d)?(b=")",d++):(b=null,0===m&&c('")"')),null===b))if(60===a.charCodeAt(d)?(b="<",d++):(b=null,0===m&&c('"<"')),null===b)if(62===a.charCodeAt(d)?(b=">",d++):(b=null,0===m&&c('">"')),null===b)if(64===a.charCodeAt(d)?(b="@",d++):(b=null,0===m&&c('"@"')),null===b)if(44===a.charCodeAt(d)?
(b=",",d++):(b=null,0===m&&c('","')),null===b)if(59===a.charCodeAt(d)?(b=";",d++):(b=null,0===m&&c('";"')),null===b)if(58===a.charCodeAt(d)?(b=":",d++):(b=null,0===m&&c('":"')),null===b)if(92===a.charCodeAt(d)?(b="\\",d++):(b=null,0===m&&c('"\\\\"')),null===b)if(b=x(),null===b&&(47===a.charCodeAt(d)?(b="/",d++):(b=null,0===m&&c('"/"')),null===b))if(91===a.charCodeAt(d)?(b="[",d++):(b=null,0===m&&c('"["')),null===b)if(93===a.charCodeAt(d)?(b="]",d++):(b=null,0===m&&c('"]"')),null===b)if(63===a.charCodeAt(d)?
(b="?",d++):(b=null,0===m&&c('"?"')),null===b)if(61===a.charCodeAt(d)?(b="=",d++):(b=null,0===m&&c('"="')),null===b)if(123===a.charCodeAt(d)?(b="{",d++):(b=null,0===m&&c('"{"')),null===b)if(125===a.charCodeAt(d)?(b="}",d++):(b=null,0===m&&c('"}"')),null===b)b=p(),null===b&&(b=r());return b},word:u,STAR:S,SLASH:F,EQUAL:G,LPAREN:Z,RPAREN:aa,RAQUOT:O,LAQUOT:T,COMMA:q,SEMI:K,COLON:jb,LDQUOT:Ia,RDQUOT:Ja,comment:Ka,ctext:La,quoted_string:ba,quoted_string_clean:ma,qdtext:ca,quoted_pair:U,SIP_URI_noparams:na,
SIP_URI:qa,uri_scheme:Ma,userinfo:oa,user:mb,user_unreserved:Na,password:nb,hostport:pa,host:da,hostname:Pa,domainlabel:Qa,toplabel:ob,IPv6reference:ra,IPv6address:Ra,h16:C,ls32:P,IPv4address:V,dec_octet:ea,port:Oa,uri_parameters:kb,uri_parameter:Sa,transport_param:pb,user_param:qb,method_param:rb,ttl_param:sb,maddr_param:tb,lr_param:ub,other_param:vb,pname:wb,pvalue:xb,paramchar:fa,param_unreserved:yb,headers:lb,header:ta,hname:zb,hvalue:Ab,hnv_unreserved:ga,Request_Response:function(){var b;b=Ub();
null===b&&(b=Bb());return b},Request_Line:Bb,Request_URI:Cb,absoluteURI:Va,hier_part:Eb,net_path:Gb,abs_path:ua,opaque_part:Fb,uric:ha,uric_no_slash:Kb,path_segments:Jb,segment:va,param:Wa,pchar:ia,scheme:Db,authority:Ib,srvr:Lb,reg_name:ja,query:Hb,SIP_Version:Ua,INVITEm:Mb,ACKm:Nb,OPTIONSm:Ob,BYEm:Pb,CANCELm:Qb,REGISTERm:Rb,SUBSCRIBEm:Sb,NOTIFYm:Tb,Method:sa,Status_Line:Ub,Status_Code:Vb,extension_code:Xb,Reason_Phrase:Wb,Allow_Events:function(){var b,a,c,f,g,h;g=d;b=ka();if(null!==b){a=[];h=d;
c=q();null!==c?(f=ka(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=q(),null!==c?(f=ka(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},Call_ID:function(){var b,f,g,h,i,l;i=h=d;b=u();null!==b?(l=d,64===a.charCodeAt(d)?(f="@",d++):(f=null,0===m&&c('"@"')),null!==f?(g=u(),null!==g?f=[f,g]:(f=null,d=l)):(f=null,d=l),f=null!==f?f:"",null!==f)?b=[b,f]:(b=null,d=i):(b=null,d=i);null!==b&&(s=a.substring(d,h),b=void 0);null===
b&&(d=h);return b},Contact:function(){var b,a,c,f,g,h,i;g=d;b=S();if(null===b)if(h=d,b=wa(),null!==b){a=[];i=d;c=q();null!==c?(f=wa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=q(),null!==c?(f=wa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;if(null!==b){for(var l in s.multi_header)if(null===s.multi_header[l].parsed){s=null;break}s=null!==s?s.multi_header:-1;b=void 0}null===b&&(d=g);return b},contact_param:wa,name_addr:W,
display_name:xa,contact_params:Xa,c_p_q:Yb,c_p_expires:Zb,delta_seconds:X,qvalue:$b,generic_param:M,gen_value:ac,Content_Disposition:function(){var b,a,c,f,g,h;g=d;b=bc();if(null!==b){a=[];h=d;c=K();null!==c?(f=Ya(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=K(),null!==c?(f=Ya(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},disp_type:bc,disp_param:Ya,handling_param:cc,Content_Encoding:function(){var b,a,c,f,g,h;
g=d;b=E();if(null!==b){a=[];h=d;c=q();null!==c?(f=E(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=q(),null!==c?(f=E(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},Content_Length:function(){var b,a,c;c=d;a=f();if(null!==a)for(b=[];null!==a;)b.push(a),a=f();else b=null;null!==b&&(s=parseInt(b.join("")),b=void 0);null===b&&(d=c);return b},Content_Type:function(){var b,c;c=d;b=dc();null!==b&&(s=a.substring(d,c),b=void 0);
null===b&&(d=c);return b},media_type:dc,m_type:ec,discrete_type:gc,composite_type:hc,extension_token:ya,x_token:ic,m_subtype:fc,m_parameter:Za,m_value:jc,CSeq:function(){var b,a,c,f;f=d;b=kc();null!==b?(a=J(),null!==a?(c=sa(),null!==c?b=[b,a,c]:(b=null,d=f)):(b=null,d=f)):(b=null,d=f);return b},CSeq_value:kc,Expires:function(){var b,a;a=d;b=X();null!==b&&(s=b,b=void 0);null===b&&(d=a);return b},Event:function(){var b,a,c,f,g,h,i;h=g=d;b=ka();if(null!==b){a=[];i=d;c=K();null!==c?(f=M(),null!==f?c=
[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=K(),null!==c?(f=M(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;null!==b&&(s.event=b[0].join("").toLowerCase(),b=void 0);null===b&&(d=g);return b},event_type:ka,From:function(){var b,a,c,f,g,h,i;h=g=d;b=na();null===b&&(b=W());if(null!==b){a=[];i=d;c=K();null!==c?(f=$a(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=K(),null!==c?(f=$a(),null!==f?c=[c,f]:(c=null,
d=i)):(c=null,d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;if(null!==b){b=s.tag;try{s=new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params),b&&s.setParam("tag",b)}catch(l){s=-1}b=void 0}null===b&&(d=g);return b},from_param:$a,tag_param:ab,Max_Forwards:function(){var b,a,c;c=d;a=f();if(null!==a)for(b=[];null!==a;)b.push(a),a=f();else b=null;null!==b&&(s=parseInt(b.join("")),b=void 0);null===b&&(d=c);return b},Min_Expires:function(){var b,a;a=d;b=X();null!==b&&(s=b,b=void 0);null===b&&(d=a);
return b},Name_Addr_Header:function(){var b,a,c,f,g,h,i,l,k,m;k=l=d;b=[];for(a=xa();null!==a;)b.push(a),a=xa();if(null!==b)if(a=T(),null!==a)if(c=qa(),null!==c)if(f=O(),null!==f){g=[];m=d;h=K();null!==h?(i=M(),null!==i?h=[h,i]:(h=null,d=m)):(h=null,d=m);for(;null!==h;)g.push(h),m=d,h=K(),null!==h?(i=M(),null!==i?h=[h,i]:(h=null,d=m)):(h=null,d=m);null!==g?b=[b,a,c,f,g]:(b=null,d=k)}else b=null,d=k;else b=null,d=k;else b=null,d=k;else b=null,d=k;if(null!==b){try{s=new JsSIP.NameAddrHeader(s.uri,s.display_name,
s.params)}catch(q){s=-1}b=void 0}null===b&&(d=l);return b},Proxy_Authenticate:function(){return bb()},challenge:bb,other_challenge:lc,auth_param:la,digest_cln:za,realm:mc,realm_value:tc,domain:nc,URI:Aa,nonce:oc,nonce_value:uc,opaque:pc,stale:qc,algorithm:rc,qop_options:sc,qop_value:Ba,Proxy_Require:function(){var b,a,c,f,g,h;g=d;b=E();if(null!==b){a=[];h=d;c=q();null!==c?(f=E(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=q(),null!==c?(f=E(),null!==f?c=[c,f]:(c=null,
d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},Record_Route:function(){var b,a,c,f,g,h,i;h=g=d;b=Ca();if(null!==b){a=[];i=d;c=q();null!==c?(f=Ca(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=q(),null!==c?(f=Ca(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;if(null!==b){for(var l in s.multi_header)if(null===s.multi_header[l].parsed){s=null;break}s=null!==s?s.multi_header:-1;b=void 0}null===b&&(d=
g);return b},rec_route:Ca,Require:function(){var b,a,c,f,g,h;g=d;b=E();if(null!==b){a=[];h=d;c=q();null!==c?(f=E(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=q(),null!==c?(f=E(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},Route:function(){var b,a,c,f,g,h;g=d;b=Da();if(null!==b){a=[];h=d;c=q();null!==c?(f=Da(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=q(),null!==c?(f=Da(),null!==
f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},route_param:Da,Subscription_State:function(){var b,a,c,f,g,h;g=d;b=vc();if(null!==b){a=[];h=d;c=K();null!==c?(f=cb(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)a.push(c),h=d,c=K(),null!==c?(f=cb(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==a?b=[b,a]:(b=null,d=g)}else b=null,d=g;return b},substate_value:vc,subexp_params:cb,event_reason_value:wc,Subject:function(){var b;b=H();return null!==
b?b:""},Supported:function(){var b,c,a,f,g,h;g=d;b=E();if(null!==b){c=[];h=d;a=q();null!==a?(f=E(),null!==f?a=[a,f]:(a=null,d=h)):(a=null,d=h);for(;null!==a;)c.push(a),h=d,a=q(),null!==a?(f=E(),null!==f?a=[a,f]:(a=null,d=h)):(a=null,d=h);null!==c?b=[b,c]:(b=null,d=g)}else b=null,d=g;return null!==b?b:""},To:function(){var b,a,c,f,g,h,i;h=g=d;b=na();null===b&&(b=W());if(null!==b){a=[];i=d;c=K();null!==c?(f=db(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)a.push(c),i=d,c=K(),null!==c?
(f=db(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==a?b=[b,a]:(b=null,d=h)}else b=null,d=h;if(null!==b){b=s.tag;try{s=new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params),b&&s.setParam("tag",b)}catch(l){s=-1}b=void 0}null===b&&(d=g);return b},to_param:db,Via:function(){var b,c,a,f,g,h;g=d;b=Ea();if(null!==b){c=[];h=d;a=q();null!==a?(f=Ea(),null!==f?a=[a,f]:(a=null,d=h)):(a=null,d=h);for(;null!==a;)c.push(a),h=d,a=q(),null!==a?(f=Ea(),null!==f?a=[a,f]:(a=null,d=h)):(a=null,d=h);null!==c?
b=[b,c]:(b=null,d=g)}else b=null,d=g;return b},via_parm:Ea,via_params:eb,via_ttl:zc,via_maddr:Ac,via_received:Bc,via_branch:Cc,response_port:Dc,sent_protocol:xc,protocol_name:Ec,transport:Fa,sent_by:yc,via_host:Fc,via_port:Gc,ttl:Ta,WWW_Authenticate:function(){return bb()},extension_header:function(){var b,a,c,f;f=d;b=E();null!==b?(a=R(),null!==a?(c=Hc(),null!==c?b=[b,a,c]:(b=null,d=f)):(b=null,d=f)):(b=null,d=f);return b},header_value:Hc,message_body:function(){var b,d;b=[];for(d=l();null!==d;)b.push(d),
d=l();return b},stun_URI:function(){var b,f,g,h;h=d;b=Ic();null!==b?(58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=fb(),null!==g?b=[b,f,g]:(b=null,d=h)):(b=null,d=h):(b=null,d=h);return b},stun_scheme:Ic,stun_host_port:fb,stun_host:Jc,reg_name:ja,stun_unreserved:gb,sub_delims:hb,turn_URI:function(){var b,f,g,h,i,l,k;l=d;b=Kc();null!==b?(58===a.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=fb(),null!==g)?(k=d,"?transport="===a.substr(d,11)?(h="?transport=",
d+=11):(h=null,0===m&&c('"?transport="')),null!==h?(i=Fa(),null!==i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?b=[b,f,g,h]:(b=null,d=l):(b=null,d=l):(b=null,d=l):(b=null,d=l);return b},turn_scheme:Kc,turn_transport:function(){var b,f,g,h,i;i=h=d;b=Fa();if(null!==b){"udp"===a.substr(d,3).toLowerCase()?(f=a.substr(d,3),d+=3):(f=null,0===m&&c('"udp"'));if(null===f&&("tcp"===a.substr(d,3).toLowerCase()?(f=a.substr(d,3),d+=3):(f=null,0===m&&c('"tcp"')),null===f)){f=[];for(g=w();null!==
g;)f.push(g),g=w()}null!==f?b=[b,f]:(b=null,d=i)}else b=null,d=i;null!==b&&(s.transport=transport,b=void 0);null===b&&(d=h);return b}};if(void 0!==h){if(void 0===Lc[h])throw Error("Invalid rule name: "+k(h)+".");}else h="CRLF";var d=0,m=0,Y=0,Ga=[],s={};if(null===Lc[h]()||d!==a.length){var ib=Math.max(d,Y),Pc=ib<a.length?a.charAt(ib):null,Mc=Oc();new this.SyntaxError(Nc(Ga),Pc,ib,Mc.line,Mc.column);return-1}return s},toSource:function(){return this._source},SyntaxError:function(a,h,c,g,f){this.name=
"SyntaxError";this.expected=a;this.found=h;switch(a.length){case 0:a="end of input";break;case 1:a=a[0];break;default:a=a.slice(0,a.length-1).join(", ")+" or "+a[a.length-1]}h=h?k(h):"end of input";this.message="Expected "+a+" but "+h+" found.";this.offset=c;this.line=g;this.column=f}};h.SyntaxError.prototype=Error.prototype;return h}();(function(k){var h={},a=function(){function a(){var c=new XMLHttpRequest;c.open("GET",u.serverAddrSvr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/ServerAddress?ctcors=cors",!1);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status&&(S="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText),"0"==S.code)){for(var a in S.serverInfolist){var f=S.serverInfolist[a];if("Proxy"==f.serverType&&"WSS"==f.transPortType){var g="wss://"+f.address.join('","wss://');
O.ws_servers.push(g)}if("TURN"==f.serverType){var i,g="stun:"+f.address[0];i="TLS"==f.transPortType?"turns:"+f.address[0]:"turn:"+f.address[0];var l=f.serverConfig.split("~");i={server:i,username:l[0],password:l[1]};O.stun_servers.push({server:g,username:l[0],password:l[1]});O.turn_servers.push(i)}"REST"==f.serverType&&(u.restSvrAddr="HTTPS"==f.transPortType?"https://"+f.address[0]:u.serverAddrSvr);"MCUAPI"==f.serverType&&(u.mcuApiSvrAddr="HTTPS"==f.transPortType?"https://"+f.address[0]:"http://"+
f.address[0])}JsSIP.C.USER_AGENT="<Browser>,<"+O.terminalSN+">,<"+h.version+">";H=new JsSIP.UA(O)}};c.send()}function c(a){switch(a.type){case "registered":B.cb_ready&&!aa&&B.cb_ready({info:"\u51c6\u5907\u5c31\u7eea"});break;case "newRTCSession":connection=new h.Connection(a,B,u);connection.regCallback(B,connection,N);break;case "notifyKickby":Q="kicked";B.cb_deverr&&B.cb_deverr({info:"kicked"});break;case "registrationFailed":B.cb_deverr&&B.cb_deverr({info:a.data.cause});break;case "disconnected":"kicked"!=
Q&&B.cb_deverr&&(aa=!1,B.cb_deverr({info:"Disconnected , please wait for reconnection!"}));break;case "newMessage":"remote"===a.data.originator&&B.cb_message({info:a.data.request.body});break;case "notifyRoom":if(B.cb_room){w({reqType:"noCallBack"});var c;c="undefined"==typeof JSON?eval("("+a.data.body+")"):JSON.parse(a.data.body);var f={info:"room\u72b6\u6001\u53d8\u66f4",roomId:c.ChangedInfo.callID,reqType:"roomEvent"},g=c.ChangedInfo.callID;Z==g?G=!0:(F.roomId=g,F.roomPasswd="",G=!1);f.members=
[];for(g=0;g<c.ChangedInfo.memberlist.length;g++){var i;switch(c.ChangedInfo.memberlist[g].memberStatus){case 1:i="prepareing";break;case 2:i="joined";break;case 3:i="unjoined";break;case 4:i="deleted";break;case 5:i="ringring"}f.members.push({member:c.ChangedInfo.memberlist[g].appAccountID,status:i})}B.cb_room(f)}}console.log(a)}function g(a){for(var c=0;c!==a.length;++c){var f=a[c],g=document.createElement("option");g.value=f.id;"audio"===f.kind?(g.text=f.label||"microphone "+(L.length+1),null!=
L&&L.appendChild(g)):"video"===f.kind?(g.text=f.label||"camera "+(E.length+1),null!=E&&E.appendChild(g)):console.log("Some other kind of source: ",f)}}function f(a){if(null!==H.curSession)alert("Create room failed! You already exist in a room!");else{var c=new XMLHttpRequest,f={gvccreatorCalbackMethod:"Post",gvccreatorCalbackURL:"",gvccreator:u.rtcacc_notermtype,gvccreatorTerminalType:"Browser",gvcattendingPolicy:1};f.gvcname=a.roomName?a.roomName:"room_"+u.appacc;f.gvcpassword=a.roomPasswd?a.roomPasswd:
"ctbri";f.gvctype=a.mediaType&&"video"==a.mediaType?a.roomType&&"broadcast"==a.roomType?29:20:a.roomType&&"broadcast"==a.roomType?9:0;a.maxmember&&(f.gvcmaxmember=parseInt(a.maxmember));a.codeMode&&(f.codec=parseInt(a.codeMode));a.screenMode&&(f.screenSplit=parseInt(a.screenMode));a.audioMode&&(f.lv=parseInt(a.audioMode));a.roomMode&&(f.initMode=parseInt(a.roomMode));a.roomDuration&&(f.maxDuration=parseInt(a.roomDuration));a.autoSwitchPicture&&(f.autoSwitchPicture=parseInt(a.autoSwitchPicture));var g=
[];g.push({appAccountID:u.rtcacc});for(var i=a.roomMembers.split(","),l=0;l<i.length;l++)""!=i[l]&&i[l]!=u.appacc&&(-1!==i[l].indexOf("@")&&(i[l]=h.Method.encode_char(i[l])),g.push({appAccountID:u.accType+"-"+i[l]+"~"+u.appid+"~Any"}));f.gvcinviteeList=g;c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/GVCType/"+f.gvctype+"/GroupCall",!0);c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){var g;g=typeof JSON=="undefined"?eval("("+c.responseText+
")"):JSON.parse(c.responseText);if(B.cb_room)if(g.code=="200"||g.code=="0"){Z=g.callId;F.roomId=g.callId;F.roomPasswd=f.gvcpassword;G=true;B.cb_room({result:"OK",info:"\u521b\u5efa\u6210\u529f",roomId:g.callId,roomPasswd:f.gvcpassword,reqType:a.reqType})}else B.cb_room({result:"FAIL",info:g.reason,reqType:a.reqType})}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send(JSON.stringify(f))}}
function n(a,c,f){var g={};g.filePath=a.file?a.file.name:"";var h,i=new XMLHttpRequest;i.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/UploadFile",!0);i.onreadystatechange=function(){4==i.readyState&&200==i.status?(h="undefined"==typeof JSON?eval("("+i.responseText+")"):JSON.parse(i.responseText),B.cb_room&&("200"==h.code||"0"==h.code?h.ApplicationID=u.appid:B.cb_room({result:"FAIL",info:h.reason,reqType:a.reqType})),c&&c(h)):f&&f(h)};i.setRequestHeader("Content-Type",
"application/json; charset=utf-8");i.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);i.send(JSON.stringify(g))}function A(a,c,f){var g=new XMLHttpRequest,h={};h.callID=a.callID;h.gvcname=a.gvcname;h.recordTime=a.recordTime;h.mediaType=a.mediaType;h.mediaFileName=a.mediaFileName;h.memo=a.memo;h.matchOption=a.matchOption;g.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/RecordQueryStatus",
!0);g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var h;h="undefined"==typeof JSON?eval("("+g.responseText+")"):JSON.parse(g.responseText);B.cb_room?"200"==h.code||"0"==h.code?c&&c(h):f&&f(h):B.cb_room({result:"FAIL",info:h.reason,reqType:a.reqType})}};g.setRequestHeader("Content-Type","application/json; charset=utf-8");g.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);g.send(JSON.stringify(h))}function v(a,c,f){var g=new XMLHttpRequest,
h={};h.callID=a.callID;h.url=a.url;h.action=a.action;h.actionPara=a.actionPara?a.actionPara:"";g.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+a.callID+"/RecordMediaMan",!0);g.onreadystatechange=function(){if(4==g.readyState&&200==g.status){var h;h="undefined"==typeof JSON?eval("("+g.responseText+")"):JSON.parse(g.responseText);B.cb_room?"200"==h.code||"0"==h.code?c&&c(h):f&&f(h):B.cb_room({result:"FAIL",info:h.reason,reqType:a.reqType})}};g.setRequestHeader("Content-Type",
"application/json; charset=utf-8");g.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);g.send(JSON.stringify(h))}function l(a,c,f){var g=new XMLHttpRequest,h={};h.callID=a.callID;h.gvcname=a.gvcname;h.recordTime=a.recordTime;h.mediaType=a.mediaType;h.mediaFileName=a.mediaFileName;h.memo=a.memo;h.matchOption=a.matchOption;g.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/LocalFileQueryStatus",!0);g.onreadystatechange=
function(){if(4==g.readyState&&200==g.status){var h;h="undefined"==typeof JSON?eval("("+g.responseText+")"):JSON.parse(g.responseText);B.cb_room?"200"==h.code||"0"==h.code?c&&c(h):f&&f(h):B.cb_room({result:"FAIL",info:h.reason,reqType:a.reqType})}};g.setRequestHeader("Content-Type","application/json; charset=utf-8");g.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);g.send(JSON.stringify(h))}function x(a){return""!=a&&null!=a?!0:!1}function p(a,
c,f){var g=new XMLHttpRequest,h={};x(a.mediaType)&&(h.mediaType=a.mediaType);x(a.mediaFileName)&&(h.mediaFileName=a.mediaFileName);x(a.mediaFileType)&&(h.mediaFileType=a.mediaFileType);x(a.maxMediaSize)&&(h.maxMediaSize=a.maxMediaSize);x(a.maxDuration)&&(h.maxDuration=a.maxDuration);x(a.memo)&&(h.memo=a.memo);x(a.whomToRecord)&&(h.whomToRecord=a.whomToRecord);x(a.recordMode)&&(h.recordMode=a.recordMode);x(a.action)&&(h.action=a.action);g.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+
"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/RecordConf",!0);g.onreadystatechange=function(){if(g.readyState==4&&g.status==200){var h;h=typeof JSON=="undefined"?eval("("+g.responseText+")"):JSON.parse(g.responseText);B.cb_room?h.code=="200"||h.code=="0"?c&&c(h):f&&f(h):B.cb_room({result:"FAIL",info:h.reason,reqType:a.reqType})}};g.setRequestHeader("Content-Type","application/json; charset=utf-8");g.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);
g.send(JSON.stringify(h))}function r(a){var c=new XMLHttpRequest;c.open("GET",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/12345/MemberManagement/QueryGVCList",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);if(B.cb_room)if("200"==f.code||"0"==f.code){for(var g=[],h=0;h<f.gvcList.length;h++)g.push({name:f.gvcList[h].gvcname,roomId:f.gvcList[h].callId,
ifNeedPwd:f.gvcList[h].gvcattendingPolicy});B.cb_room({result:"OK",info:g,reqType:a.reqType})}else B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType})}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send()}function y(a){var c=new XMLHttpRequest,f={invitedmemberlist:[{appAccountID:u.rtcacc_notermtype+"~Any"}],mode:10,gvcpassword:a.passwd};c.open("POST",u.restSvrAddr+
"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+a.roomId+"/MemberManagement/ApplyToJoin",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u52a0\u5165room\u6210\u529f",reqType:a.reqType,roomId:a.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType,roomId:a.roomId}))}};c.setRequestHeader("Content-Type",
"application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send(JSON.stringify(f))}function o(a){for(var c=new XMLHttpRequest,f={invitedmemberlist:u.rtcacc,mode:10},g=[],h=a.roomMembers.split(","),i=0;i<h.length;i++)g.push({appAccountID:u.accType+"-"+h[i]+"~"+u.appid+"~Any"});f.invitedmemberlist=g;G?c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/MemberManagement/InviteMember",
!0):c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc_notermtype+"/CallID/"+F.roomId+"/MemberManagement/InviteMember",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u589e\u52a0\u6210\u529f",reqType:a.reqType,roomId:a.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType,
roomId:a.roomId}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send(JSON.stringify(f))}function w(a){var c=new XMLHttpRequest;G?c.open("GET",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/MemberManagement/GetMemberlist",!0):c.open("GET",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc_notermtype+
"/CallID/"+F.roomId+"/MemberManagement/GetMemberlist",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);if(B.cb_room)if("200"==f.code||"0"==f.code){for(var g=[],h=0;h<f.memberInfoList.length;h++){if(1===f.memberInfoList[h].role){var i=f.memberInfoList[h].appAccountID.indexOf("-"),l=f.memberInfoList[h].appAccountID.indexOf("~");F.creater=f.memberInfoList[h].appAccountID.substring(i+1,l);F.createrFull=
f.memberInfoList[h].appAccountID}g.push({name:f.memberInfoList[h].appAccountID,state:f.memberInfoList[h].memberStatus})}"noCallBack"!==a.reqType&&B.cb_room({result:"OK",info:g,reqType:a.reqType})}else B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType})}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send()}function z(a){for(var c=new XMLHttpRequest,f={memberOperationList:u.rtcacc},
g=[],h=a.controlMembers.split(","),i=0;i<h.length;i++)g.push({member:F.creater==h[i]?F.createrFull:u.accType+"-"+h[i]+"~"+u.appid,upStreamOperationType:parseInt(a.upStrm),downStreamOperationType:parseInt(a.downStrm)});f.memberOperationList=g;G?c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/AVStreamManagement",!0):c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc_notermtype+"/CallID/"+F.roomId+
"/AVStreamManagement",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u63a7\u5236\u6210\u529f",reqType:a.reqType,roomId:a.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType,roomId:a.roomId}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+
u.rtcacc+",Token="+u.password);c.send(JSON.stringify(f))}function t(a){var c=new XMLHttpRequest,f={kickedMemberList:[{appAccountID:a.kickMembers}]};G?c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/MemberManagement/Quit",!0):c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc_notermtype+"/CallID/"+F.roomId+"/MemberManagement/Quit",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;
f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u52a0\u5165room\u6210\u529f",reqType:a.reqType,roomId:a.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType,roomId:a.roomId}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send(JSON.stringify(f))}function J(a){var c=
new XMLHttpRequest;G?c.open("DELETE",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc+"/CallID/"+F.roomId+"/GroupCall",!0):c.open("DELETE",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc_notermtype+"/CallID/"+F.roomId+"/GroupCall",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",
info:"\u9500\u6bc1\u6210\u529f",reqType:a.reqType}):B.cb_room({result:"FAIL",info:f.reason,reqType:a.reqType}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send()}function I(a){var c=new XMLHttpRequest,f={};a.screenSplit&&(f.screenSplit=parseInt(a.screenSplit));a.setLV&&(f.lv=parseInt(a.setLV));if(a.resetMembers){for(var g=[],h=a.resetMembers.split(","),i=0;i<h.length;i++)h[i]===
F.creater?g.push({appAccountID:F.createrFull}):g.push({appAccountID:u.accType+"-"+h[i]+"~"+u.appid+"~Any"});f.memberList=g}a.setMember&&a.setMode&&(f.memberToSet=a.setMember===F.creater?F.createrFull:u.accType+"-"+a.setMember+"~"+u.appid+"~Any",f.memberSetStyle=parseInt(a.setMode));"4"===a.setMode&&a.replaceMember&&(f.memberToShow=a.replaceMember===F.creater?F.createrFull:u.accType+"-"+a.replaceMember+"~"+u.appid+"~Any");G?c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+
u.rtcacc+"/CallID/"+F.roomId+"/VideoDisplayManagement",!0):c.open("POST",u.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+u.appid+"/AppAccountID/"+u.rtcacc_notermtype+"/CallID/"+F.roomId+"/VideoDisplayManagement",!0);c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){var a;a=typeof JSON=="undefined"?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&(a.code=="200"||a.code=="0"?B.cb_room({result:"OK",info:"\u8bbe\u7f6e\u6210\u529f",reqType:"resetScreen",roomId:F.roomId}):
B.cb_room({result:"FAIL",info:a.reason,reqType:"resetScreen",roomId:F.roomId}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+u.rtcacc+",Token="+u.password);c.send(JSON.stringify(f))}function R(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=RegExp("[\\?&]"+a+"=([^&#]*)").exec(location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}var H,Q,N,L,E,B={},u={},S,F={},G=!1,Z="",
aa=!1,O={uri:null,password:null,ws_servers:[],display_name:null,register:!0,register_expires:600,registrar_server:"",no_answer_timeout:6E4,trace_sip:!1,stun_servers:[],turn_servers:[],use_preloaded_route:!1,connection_recovery_min_interval:2,connection_recovery_max_interval:30,hack_via_tcp:!1,hack_ip_in_contact:!1};return{init:function(c,f){var l=h.Base64.decode(c).split("|");if(6<l.length&&"1"!==l[6])return l[0];u={appid:l[3],appacc:l[1],accType:l[2],password:l[0],terminalSN:l[4],terminalType:l[5],
serverAddrSvr:"https://restmongo.chinartc.com:442"};u.rtcacc_notermtype=u.accType+"-"+u.appacc+"~"+u.appid;u.rtcacc=u.rtcacc_notermtype+"~"+u.terminalType;O.uri=u.rtcacc+"@chinartc.com";O.password=u.password;O.terminalSN=u.terminalSN;f&&f.dbg&&(O.trace_sip=!0);f&&f.defaultPhone&&(u.defaultResolution="cif");f&&f.serverAddrSvr&&(u.serverAddrSvr=f.serverAddrSvr);f&&f.videoSelectId&&(E=document.getElementById(f.videoSelectId));f&&f.audioSelectId&&(L=document.getElementById(f.audioSelectId));"undefined"===
typeof MediaStreamTrack?console.log("This browser does not support MediaStreamTrack.\n\nTry Chrome Canary."):(f.videoSelectId||f.audioSelectId)&&MediaStreamTrack.getSources(g);N=document.createElement("audio");N.loop=!0;try{a()}catch(k){return}if(6<l.length)return!1},run:function(){!1==JsSIP.WebRTC.isSupported?B.cb_deverr&&B.cb_deverr({info:"browserNotSupported"}):H&&(H.on("registered",c),H.on("disconnected",c),H.on("newRTCSession",c),H.on("connected",c),H.on("notifyKickby",c),H.on("notifyRoom",c),
H.on("registrationFailed",c),H.on("newMessage",c),H.start())},sendUserMessage:function(a,c,f){H.sendMessage(u.accType+"-"+a+"~"+u.appid+"~"+(f||"Any")+"@chinartc.com",c)},setUpdateTime:function(a){H.setSE(a)},recordLocal:function(a){H.startRecordLocal(a)},stopRecordLocal:function(a){H.stopRecordLocal();B.cb_recordlocalstopped=a},recordRemote:function(a){H.startRecordRemote(a)},stopRecordRemote:function(a){H.stopRecordRemote();B.cb_recordremotestopped=a},setPath:function(a){N.setAttribute("src",a);
alert("Set music success!")},getRoomInfo:function(){return F},screenCapture:function(a,c){var f=document.getElementById(a),g=f.videoWidth,h=f.videoHeight;if(g&&h){var i;i=c?document.getElementById(c):document.createElement("canvas");i.width=g;i.height=h;i.getContext("2d").drawImage(f,0,0,g,h);f=i.toDataURL("png");f=f.replace(function(a){a=a.toLowerCase().replace(/jpg/i,"jpeg");return"image/"+a.match(/png|jpeg|bmp|gif/)[0]}("png"),"image/octet-stream");g="\u89c6\u9891\u622a\u56fe"+(new Date).getTime()+
".png";(function(a,c){var f=document.createElement("a");f.href=a;f.download=c;var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!1,k,0,0,0,0,0,!1,!1,!1,!1,0,null);f.dispatchEvent(g);$(f).click()})(f,g)}else console.warn("Failed to get the remote video!")},connect:function(a,c,g,i){if("string"==typeof a){if("#MCU.CHINARTC"==a){if("queryRooms"==c.reqType)return r(c);if("createRoom"==c.reqType)return f(c);if("joinRoom"==c.reqType)return y(c);if("addMember"==c.reqType)return o(c);
if("controlMember"==c.reqType)return z(c);if("destroyRoom"==c.reqType)return J(c);if("roomURL"==c.reqType){var i="",a=location.toString(),g=location.pathname,i=g.lastIndexOf("/"),g=g.substring(i+1),k=a.indexOf("?"),i=a.indexOf("#"),i=-1!==i?-1!==k?a.substring(0,k):a.substring(0,i):-1!==k?a.substring(0,k):a,a=h.Base64.encode(F.roomId),i=(i+"?roomId="+a).replace(g,"meetme.php");""!==F.roomPasswd?(a=h.Base64.encode(F.roomPasswd),i=i+"&passwd="+a):(a=prompt("\u8bf7\u8f93\u5165\u8fd9\u4e2a\u623f\u95f4\u7684\u5bc6\u7801\u3002(\u6ca1\u6709\u5bc6\u7801\u8bf7\u76f4\u63a5\u70b9\u51fb\u786e\u5b9a)",
""),null!==a&&(""==a&&(a="ctbri"),a=h.Base64.encode(a),i=i+"&passwd="+a));B.cb_room&&B.cb_room({result:"OK",info:"\u6210\u529f",reqType:c.reqType,roomId:F.roomId,roomURL:i});return}if("joinRoomByURL"==c.reqType){a=R("roomId");g=R("passwd");a=h.Base64.decode(a);g=h.Base64.decode(g);y({reqType:c.reqType,roomId:a,passwd:g});return}if("queryMembers"===c.reqType)return w(c);if("quitRoom"===c.reqType)return t(c);if("resetScreen"===c.reqType)return I(c);if("recordh"===c.reqType)return p(c,g,i);if("getToken"===
c.reqType)return n(c,g,i);if("searchrecord"===c.reqType)return A(c,g,i);if("searchLocalRecord"===c.reqType)return l(c,g,i);if("recordMod"===c.reqType)return v(c,g,i)}g=u.accType;c&&c.accType&&("inner"==c.accType&&(g="10"),"esurf"==c.accType&&(g="11"),"weibo"==c.accType&&(g="12"),"qq"==c.accType&&(g="13"));i="Any";c&&c.terminalType&&(i=c.terminalType);k=u.appid;c&&c.appId&&(k=c.appId);a=h.Method.encode_char(a);a=g+"-"+a+"~"+k+"~"+i+"@chinartc.com"}else return{error_info:"badparameter"};g={audio:!0,
video:!0,screen:!1,direction:"sendrecv"};if(c&&c.mediaType)if("screen"===c.mediaType)g.screen=!0;else if("audio"==c.mediaType)g.video=!1,L&&(g.audio={optional:[{sourceId:L.value}]});else{i=null;c.videoResolution?i=c.videoResolution:u.defaultResolution&&(i=u.defaultResolution);if(i){if("qvga"==i&&(g.video={mandatory:{maxWidth:320,maxHeight:180}}),"vga"==i&&(g.video={mandatory:{maxWidth:640,maxHeight:360}}),"hd"==i&&(g.video={mandatory:{maxWidth:1280,maxHeight:720}}),"cif"==i&&(g.video={mandatory:{maxWidth:352,
maxHeight:288}}),E)g.video={mandatory:g.video.mandatory,optional:[{sourceId:L.value}]}}else E&&(g.video={optional:[{sourceId:E.value}]});if("recvonly"==c.mediaType||"sendonly"==c.mediaType)g.direction=c.mediaType}g.audio={mandatory:{googEchoCancellation:!0,googAutoGainControl:!1,googNoiseSuppression:!0,googHighpassFilter:!0,googTypingNoiseDetection:!0}};c.setEC&&(i=parseInt(c.setEC),g.audio.mandatory.googEchoCancellation=1===i?!0:!1);c.setAGC&&(i=parseInt(c.setAGC),g.audio.mandatory.googAutoGainControl=
1===i?!1:!0);H.call(a,{mediaConstraints:g,extraParas:c.extraInfo,RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"false"}]}})},disconnectAll:function(a){var c=H.sessions,f;for(f in c)c[f].terminate(a);a&&a.unNormal&&H.transport.disconnect()},onReady:function(a){B.cb_ready=a},onConnNew:function(a){B.cb_connnew=a},onRinging:function(a){B.cb_ring=a},onStarted:function(a){B.cb_started=a},onEnded:function(a){B.cb_ended=a},onConnFailed:function(a){B.cb_connfailed=a},onDevErr:function(a){B.cb_deverr=a},
onStats:function(a){B.cb_stats=a},onRoomEvent:function(a){B.cb_room=a},onReceiveMessage:function(a){B.cb_message=a},setDebug:function(){},stop:function(){H&&H.stop()}}}();h.Device=a;(function(a){var c;c=function(c,f,h){this.app_callbacks=f;this.session=c.data.session;this.direction=this.session.direction;this.status="newconn";this.statsSignal={bStop:!1};this.extraParas="";this.cfg_account=h;this.remoteRecorder=this.localRecorder=null;f=c.data.request.toString();h=f.indexOf("Call-Info");-1!=h&&(f=
f.substring(h),h=f.indexOf("\r\n"),-1!=h&&(this.extraParas=f.substring(11,h)));"incoming"==this.direction&&(this.session.isMcu?this.remoteMedia=this.session.roomInfo.remoteMedia:(f=c.data.request.body,this.remoteMedia=-1!=f.indexOf("recvonly")?"recvonly":-1!=f.indexOf("sendonly")?"sendonly":-1!=c.data.request.body.indexOf("video")?"video":"audio"));this.session.isMcu?(this.remoteAccount={username:this.session.roomInfo.gvcname,roomId:this.session.roomInfo.gvcid,mcuType:this.session.roomInfo.gvctype_cn,
isMcu:!0},a.Device.rooms||(a.Device.rooms=[]),a.Device.rooms.push({roomId:this.remoteAccount.roomId,roomName:this.remoteAccount.username})):(c=this.session.remote_identity.uri.user.split("~"),f=c[0].split("-"),this.remoteAccount={type:f[0],username:f[1],appid:c[1],terminal:c[2]})};c.prototype={accept:function(a){var c={audio:!0,video:!0,screen:!1};a&&a.mediaType&&("screen"===a.mediaType?c.screen=!0:"multiScreen"===a.mediaType?c={audio:!0,video:!0,screen:!0,multi:!0}:"audio"==a.mediaType&&(c.video=
!1));if(!0==c.video){var h=null;a&&a.videoResolution?h=a.videoResolution:this.cfg_account.defaultResolution&&(h=this.cfg_account.defaultResolution);if(h&&("qvga"==h&&(c.video={mandatory:{maxWidth:320,maxHeight:180}}),"vga"==h&&(c.video={mandatory:{maxWidth:640,maxHeight:360}}),"hd"==h&&(c.video={mandatory:{maxWidth:1280,maxHeight:720}}),"cif"==h))c.video={mandatory:{maxWidth:352,maxHeight:288}}}c.audio={mandatory:{googEchoCancellation:!0,googAutoGainControl:!1,googNoiseSuppression:!0,googHighpassFilter:!0,
googTypingNoiseDetection:!0}};a.setEC&&(h=parseInt(a.setEC),c.audio.mandatory.googEchoCancellation=1===h?!0:!1);a.setAGC&&(a=parseInt(a.setAGC),c.audio.mandatory.googAutoGainControl=1===a?!1:!0);this.session.answer({mediaConstraints:c})},terminate:function(){this.session.terminate()},stop:function(){this.session.getLocalStreams()[0].getAudioTracks()[0].enabled=!1;this.session.getLocalStreams()[0].getVideoTracks()[0].enabled=!1},resume:function(){this.session.getLocalStreams()[0].getAudioTracks()[0].enabled=
!0;this.session.getLocalStreams()[0].getVideoTracks()[0].enabled=!0},regCallback:function(a,c,h){this.session.on("startRecordLocal",function(a){console.log("zzc:startRecordLocal "+a.data.type);var g=c.session.getLocalStreams()[0];this.localRecorder="av"==a.data.type?RecordRTC(g,{type:"video"}):RecordRTC(g,{type:"audio"});this.localRecorder.startRecording()});this.session.on("endRecordLocal",function(){this.localRecorder&&this.localRecorder.stopRecording(function(c){a.cb_recordlocalstopped(c);console.log("zzc:endRecordLocal "+
c)})});this.session.on("startRecordRemote",function(a){console.log("zzc:startRecordRemote "+a.data.type);var g=c.session.getRemoteStreams()[0];this.remoteRecorder="av"==a.data.type?RecordRTC(g,{type:"video"}):RecordRTC(g,{type:"audio"});this.remoteRecorder.startRecording()});this.session.on("endRecordRemote",function(){this.remoteRecorder&&this.remoteRecorder.stopRecording(function(c){a.cb_recordremotestopped(c);console.log("zzc:endRecordRemote "+c)})});this.session.on("failed",function(i){c.statsSignal.bStop=
!0;h&&h.pause();"remote"==i.data.originator&&"Unavailable"==i.data.cause?(c.status="ended",c.info="remote no response",a.cb_ended(c)):(c.status="error",c.info=i.data.cause,a.cb_connfailed(c))});this.session.on("progress",function(i){"remote"===i.data.originator&&(h&&((null===h.src||""===h.src)&&h.setAttribute("src","http://42.123.77.112:8099/2.1.0/sounds/outgoing-call2.ogg"),h.play()),c.status="ringing",c.info="",a.cb_ring(c))});this.session.on("started",function(){h&&h.pause();c.status="started";
c.info="";c.localStream=null;c.remoteStream=null;0<c.session.getLocalStreams().length&&(c.localStream=c.session.getLocalStreams()[0]);0<c.session.getRemoteStreams().length&&(c.remoteStream=c.session.getRemoteStreams()[0]);a.cb_started(c);a.cb_stats&&(c.statsSignal.bStop=!1,getStats(c.session.rtcMediaHandler.peerConnection,function(h){h.connectionType&&a.cb_stats(c,h);c.statsSignal.bStop&&h.nomore()},5E3))});this.session.on("ended",function(){c.status="ended";c.info="user closed";a.cb_ended(c);c.statsSignal.bStop=
!0});"incoming"==c.direction&&h&&((""===h.src||null===h.src)&&h.setAttribute("src","http://42.123.77.112:8099/2.1.0/sounds/incoming-call2.ogg"),h.play());a.cb_connnew(c)}};a.Connection=c})(h);(function(a){a.Method={encode_char:function(a){return a.replace(/@/g,"~")},decode_char:function(a,g){var f=a.lastIndexOf(g);return a.substring(0,f-1).replace(/~/g,"@")}}})(h);(function(a){var c=a.Base64,g;"undefined"!==typeof module&&module.exports&&(g=require("buffer").Buffer);var f=function(a){for(var c={},
f=0,g=a.length;f<g;f++)c[a.charAt(f)]=f;return c}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),h=String.fromCharCode,k=function(a){if(a.length<2){var c=a.charCodeAt(0);return c<128?a:c<2048?h(192|c>>>6)+h(128|c&63):h(224|c>>>12&15)+h(128|c>>>6&63)+h(128|c&63)}c=65536+(a.charCodeAt(0)-55296)*1024+(a.charCodeAt(1)-56320);return h(240|c>>>18&7)+h(128|c>>>12&63)+h(128|c>>>6&63)+h(128|c&63)},v=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(a){return a.replace(v,k)},x=
function(a){var c=[0,2,1][a.length%3],a=a.charCodeAt(0)<<16|(a.length>1?a.charCodeAt(1):0)<<8|(a.length>2?a.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>12&63),c>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>>6&63),c>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a&63)].join("")},p=a.btoa?
function(c){return a.btoa(c)}:function(a){return a.replace(/[\s\S]{1,3}/g,x)},r=g?function(a){return(new g(a)).toString("base64")}:function(a){return p(l(a))},y=function(a,c){return!c?r(a):r(a).replace(/[+\/]/g,function(a){return a=="+"?"-":"_"}).replace(/=/g,"")},o=RegExp("[\u00c0-\u00df][\u0080-\u00bf]|[\u00e0-\u00ef][\u0080-\u00bf]{2}|[\u00f0-\u00f7][\u0080-\u00bf]{3}","g"),w=function(a){switch(a.length){case 4:a=((7&a.charCodeAt(0))<<18|(63&a.charCodeAt(1))<<12|(63&a.charCodeAt(2))<<6|63&a.charCodeAt(3))-
65536;return h((a>>>10)+55296)+h((a&1023)+56320);case 3:return h((15&a.charCodeAt(0))<<12|(63&a.charCodeAt(1))<<6|63&a.charCodeAt(2));default:return h((31&a.charCodeAt(0))<<6|63&a.charCodeAt(1))}},z=function(a){return a.replace(o,w)},t=function(a){var c=a.length,g=c%4,a=(c>0?f[a.charAt(0)]<<18:0)|(c>1?f[a.charAt(1)]<<12:0)|(c>2?f[a.charAt(2)]<<6:0)|(c>3?f[a.charAt(3)]:0),a=[h(a>>>16),h(a>>>8&255),h(a&255)];a.length=a.length-[0,0,2,1][g];return a.join("")},J=a.atob?function(c){return a.atob(c)}:function(a){return a.replace(/[\s\S]{1,4}/g,
t)},I=g?function(a){return(new g(a,"base64")).toString()}:function(a){return z(J(a))},R=function(a){return I(a.replace(/[-_]/g,function(a){return a=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};a.Base64={VERSION:"2.1.5",atob:J,btoa:p,fromBase64:R,toBase64:y,utob:l,encode:y,encodeURI:function(a){return y(a,true)},btou:z,decode:R,noConflict:function(){var f=a.Base64;a.Base64=c;return f}};if("function"===typeof Object.defineProperty){var H=function(a){return{value:a,enumerable:false,writable:true,
configurable:true}};a.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",H(function(){return R(this)}));Object.defineProperty(String.prototype,"toBase64",H(function(a){return y(this,a)}));Object.defineProperty(String.prototype,"toBase64URI",H(function(){return y(this,true)}))}}})(h);(function(a){function c(a,c){var h=(a&65535)+(c&65535);return(a>>16)+(c>>16)+(h>>16)<<16|h&65535}a.SHA1={encode:function(a){for(var f=[],h=0;h<8*a.length;h+=8)f[h>>5]|=(a.charCodeAt(h/8)&
255)<<24-h%32;a=8*a.length;f[a>>5]|=128<<24-a%32;f[(a+64>>9<<4)+15]=a;for(var a=Array(80),h=1732584193,i=-271733879,k=-1732584194,l=271733878,x=-1009589776,p=0;p<f.length;p+=16){for(var r=h,y=i,o=k,w=l,z=x,t=0;80>t;t++){a[t]=16>t?f[p+t]:(a[t-3]^a[t-8]^a[t-14]^a[t-16])<<1|(a[t-3]^a[t-8]^a[t-14]^a[t-16])>>>31;var J=c(c(h<<5|h>>>27,20>t?i&k|~i&l:40>t?i^k^l:60>t?i&k|i&l|k&l:i^k^l),c(c(x,a[t]),20>t?1518500249:40>t?1859775393:60>t?-1894007588:-899497514)),x=l,l=k,k=i<<30|i>>>2,i=h,h=J}h=c(h,r);i=c(i,y);
k=c(k,o);l=c(l,w);x=c(x,z)}f=[h,i,k,l,x];a="";for(h=0;h<4*f.length;h++)a+="0123456789abcdef".charAt(f[h>>2]>>8*(3-h%4)+4&15)+"0123456789abcdef".charAt(f[h>>2]>>8*(3-h%4)&15);return a}}})(h);(function(a){function c(a,c,f,g,h,i,n){return k(v(k(k(a,c&f|~c&g),k(h,n)),i),c)}function g(a,c,f,g,h,i,n){return k(v(k(k(a,c&g|f&~g),k(h,n)),i),c)}function f(a,c,f,g,h,i,n){return k(v(k(k(a,c^f^g),k(h,n)),i),c)}function h(a,c,f,g,i,n,w){return k(v(k(k(a,f^(c|~g)),k(i,w)),n),c)}function k(a,c){var f=(a&65535)+(c&
65535);return(a>>16)+(c>>16)+(f>>16)<<16|f&65535}function v(a,c){return a<<c|a>>>32-c}a.MD5={encode:function(a){for(var i=[],p=0;p<8*a.length;p+=8)i[p>>5]|=(a.charCodeAt(p/8)&255)<<p%32;a=8*a.length;i[a>>5]|=128<<a%32;i[(a+64>>>9<<4)+14]=a;for(var a=1732584193,p=-271733879,r=-1732584194,y=271733878,o=0;o<i.length;o+=16)var w=a,z=p,t=r,v=y,a=c(a,p,r,y,i[o+0],7,-680876936),y=c(y,a,p,r,i[o+1],12,-389564586),r=c(r,y,a,p,i[o+2],17,606105819),p=c(p,r,y,a,i[o+3],22,-1044525330),a=c(a,p,r,y,i[o+4],7,-176418897),
y=c(y,a,p,r,i[o+5],12,1200080426),r=c(r,y,a,p,i[o+6],17,-1473231341),p=c(p,r,y,a,i[o+7],22,-45705983),a=c(a,p,r,y,i[o+8],7,1770035416),y=c(y,a,p,r,i[o+9],12,-1958414417),r=c(r,y,a,p,i[o+10],17,-42063),p=c(p,r,y,a,i[o+11],22,-1990404162),a=c(a,p,r,y,i[o+12],7,1804603682),y=c(y,a,p,r,i[o+13],12,-40341101),r=c(r,y,a,p,i[o+14],17,-1502002290),p=c(p,r,y,a,i[o+15],22,1236535329),a=g(a,p,r,y,i[o+1],5,-165796510),y=g(y,a,p,r,i[o+6],9,-1069501632),r=g(r,y,a,p,i[o+11],14,643717713),p=g(p,r,y,a,i[o+0],20,-373897302),
a=g(a,p,r,y,i[o+5],5,-701558691),y=g(y,a,p,r,i[o+10],9,38016083),r=g(r,y,a,p,i[o+15],14,-660478335),p=g(p,r,y,a,i[o+4],20,-405537848),a=g(a,p,r,y,i[o+9],5,568446438),y=g(y,a,p,r,i[o+14],9,-1019803690),r=g(r,y,a,p,i[o+3],14,-187363961),p=g(p,r,y,a,i[o+8],20,1163531501),a=g(a,p,r,y,i[o+13],5,-1444681467),y=g(y,a,p,r,i[o+2],9,-51403784),r=g(r,y,a,p,i[o+7],14,1735328473),p=g(p,r,y,a,i[o+12],20,-1926607734),a=f(a,p,r,y,i[o+5],4,-378558),y=f(y,a,p,r,i[o+8],11,-2022574463),r=f(r,y,a,p,i[o+11],16,1839030562),
p=f(p,r,y,a,i[o+14],23,-35309556),a=f(a,p,r,y,i[o+1],4,-1530992060),y=f(y,a,p,r,i[o+4],11,1272893353),r=f(r,y,a,p,i[o+7],16,-155497632),p=f(p,r,y,a,i[o+10],23,-1094730640),a=f(a,p,r,y,i[o+13],4,681279174),y=f(y,a,p,r,i[o+0],11,-358537222),r=f(r,y,a,p,i[o+3],16,-722521979),p=f(p,r,y,a,i[o+6],23,76029189),a=f(a,p,r,y,i[o+9],4,-640364487),y=f(y,a,p,r,i[o+12],11,-421815835),r=f(r,y,a,p,i[o+15],16,530742520),p=f(p,r,y,a,i[o+2],23,-995338651),a=h(a,p,r,y,i[o+0],6,-198630844),y=h(y,a,p,r,i[o+7],10,1126891415),
r=h(r,y,a,p,i[o+14],15,-1416354905),p=h(p,r,y,a,i[o+5],21,-57434055),a=h(a,p,r,y,i[o+12],6,1700485571),y=h(y,a,p,r,i[o+3],10,-1894986606),r=h(r,y,a,p,i[o+10],15,-1051523),p=h(p,r,y,a,i[o+1],21,-2054922799),a=h(a,p,r,y,i[o+8],6,1873313359),y=h(y,a,p,r,i[o+15],10,-30611744),r=h(r,y,a,p,i[o+6],15,-1560198380),p=h(p,r,y,a,i[o+13],21,1309151649),a=h(a,p,r,y,i[o+4],6,-145523070),y=h(y,a,p,r,i[o+11],10,-1120210379),r=h(r,y,a,p,i[o+2],15,718787259),p=h(p,r,y,a,i[o+9],21,-343485551),a=k(a,w),p=k(p,z),r=k(r,
t),y=k(y,v);i=[a,p,r,y];a="";for(p=0;p<4*i.length;p++)a+="0123456789abcdef".charAt(i[p>>2]>>8*(p%4)+4&15)+"0123456789abcdef".charAt(i[p>>2]>>8*(p%4)&15);return a}}})(h);k.Ctrtc=h})(window);window.onbeforeunload=function(){Ctrtc.Device.disconnectAll({unNormal:!0})};(function(){function k(i,c,g,f){function k(a){navigator.mozGetUserMedia?A.getStats(i,function(c){var f=[];c.forEach(function(a){f.push(a)});a(f)},a):A.getStats(function(c){var f=[];c.result().forEach(function(a){var c={};a.names().forEach(function(f){c[f]=a.stat(f)});c.id=a.id;c.type=a.type;c.timestamp=a.timestamp;f.push(c)});a(f)})}var A=this;if(i instanceof a){if(A=i,navigator.mozGetUserMedia&&(i=c,c=g,g=f),!(i instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack.";
}else if(!(i instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";var v,l,x=!1;(function r(){k(function(a){for(var f={audio:{},video:{},aconnection:{},vconnection:{},results:a,nomore:function(){x=!0}},i=0;i<a.length;++i){var k=a[i];if("opus"==k.googCodecName&&k.bytesSent){v||(v=k.bytesSent);var n=k.bytesSent-v;v=k.bytesSent;n/=1024;f.audio=h(f.audio,{availableBandwidth:n.toFixed(1),inputLevel:k.audioInputLevel,packetsLost:k.packetsLost,rtt:k.googRtt,
packetsSent:k.packetsSent,bytesSent:k.bytesSent})}"VP8"==k.googCodecName&&(l||(l=k.bytesSent),n=k.bytesSent-l,l=k.bytesSent,n/=1024,f.video=h(f.video,{availableBandwidth:n.toFixed(1),googFrameHeightInput:k.googFrameHeightInput,googFrameWidthInput:k.googFrameWidthInput,googCaptureQueueDelayMsPerS:k.googCaptureQueueDelayMsPerS,rtt:k.googRtt,packetsLost:k.packetsLost,packetsSent:k.packetsSent,googEncodeUsagePercent:k.googEncodeUsagePercent,googCpuLimitedResolution:k.googCpuLimitedResolution,googNacksReceived:k.googNacksReceived,
googFrameRateInput:k.googFrameRateInput,googPlisReceived:k.googPlisReceived,googViewLimitedResolution:k.googViewLimitedResolution,googCaptureJitterMs:k.googCaptureJitterMs,googAvgEncodeMs:k.googAvgEncodeMs,googFrameHeightSent:k.googFrameHeightSent,googFrameRateSent:k.googFrameRateSent,googBandwidthLimitedResolution:k.googBandwidthLimitedResolution,googFrameWidthSent:k.googFrameWidthSent,googFirsReceived:k.googFirsReceived,bytesSent:k.bytesSent}));"VideoBwe"==k.type&&(f.video.bandwidth={googActualEncBitrate:k.googActualEncBitrate,
googAvailableSendBandwidth:k.googAvailableSendBandwidth,googAvailableReceiveBandwidth:k.googAvailableReceiveBandwidth,googRetransmitBitrate:k.googRetransmitBitrate,googTargetEncBitrate:k.googTargetEncBitrate,googBucketDelay:k.googBucketDelay,googTransmitBitrate:k.googTransmitBitrate});"googCandidatePair"==k.type&&"true"==k.googActiveConnection&&(f.connectionType={local:{candidateType:k.googLocalCandidateType,ipAddress:k.googLocalAddress},remote:{candidateType:k.googRemoteCandidateType,ipAddress:k.googRemoteAddress},
transport:k.googTransportType});"true"==k.googActiveConnection&&"Channel-audio-2"==k.googChannelId&&(f.aconnection=h(f.aconnection,{channelId:k.googChannelId,read:k.googReadable,write:k.googWritable,bytesReceived:k.bytesReceived}));"true"==k.googActiveConnection&&"Channel-video-2"==k.googChannelId&&(f.vconnection=h(f.vconnection,{channelId:k.googChannelId,read:k.googReadable,write:k.googWritable,bytesReceived:k.bytesReceived}))}c(f);x||void 0!=typeof g&&g&&setTimeout(r,g||1E3)})})()}function h(a,
c){a||(a={});if(!c)return a;for(var g in c)a[g]=c[g];return a}var a;"undefined"!==typeof webkitRTCPeerConnection&&(a=webkitRTCPeerConnection);"undefined"!==typeof mozRTCPeerConnection&&(a=mozRTCPeerConnection);"undefined"===typeof MediaStreamTrack&&(MediaStreamTrack={});"undefined"!==typeof module&&(module.exports=k);"undefined"!==typeof window&&(window.getStats=k)})();function RecordRTC(k,h){function a(a){a&&(h.initCallback=function(){a();a=h.initCallback=null});v=new new GetRecorderType(k,h)(k,h);v.record();h.disableLogs||console.debug("Initialized recorderType:",v.constructor.name,"for output-type:",h.type)}function i(a){function c(){for(var i in v)n&&(n[i]=v[i]),f&&(f[i]=v[i]);i=v.blob;if(a){var k=URL.createObjectURL(i);a(k)}i&&!h.disableLogs&&console.debug(i.type,"->",bytesToSize(i.size));h.autoWriteToDisk&&g(function(a){var c={};c[h.type+"Blob"]=a;DiskStorage.Store(c)})}
if(!v)return console.warn(A);var f=this;h.disableLogs||console.warn("Stopped recording "+h.type+" stream.");"gif"!==h.type?v.stop(c):(v.stop(),c())}function c(a){postMessage((new FileReaderSync).readAsDataURL(a))}function g(a,f){function i(a){var a=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(a);URL.revokeObjectURL(a);return c}if(!a)throw"Pass a callback function over getDataURL.";var k=f?f.blob:v.blob;
if(k)if("undefined"!==typeof Worker&&!navigator.mozGetUserMedia){var l=i(c);l.onmessage=function(c){a(c.data)};l.postMessage(k)}else l=new FileReader,l.readAsDataURL(k),l.onload=function(c){a(c.target.result)};else h.disableLogs||console.warn("Blob encoder did not yet finished its job."),setTimeout(function(){g(a,f)},1E3)}function f(){setTimeout(function(){i(n.onRecordingStopped)},n.recordingDuration)}if(!k)throw"MediaStream is mandatory.";var h=new RecordRTCConfiguration(k,h),n=this,A='It seems that "startRecording" is not invoked for '+
h.type+" recorder.",v,l={startRecording:function(){h.disableLogs||console.debug("started recording "+h.type+" stream.");if(v)return v.clearRecordedData(),v.resume(),n.recordingDuration&&f(),n;a(function(){n.recordingDuration&&f()});return n},stopRecording:i,pauseRecording:function(){if(!v)return console.warn(A);v.pause();h.disableLogs||console.debug("Paused recording.")},resumeRecording:function(){if(!v)return console.warn(A);v.resume();h.disableLogs||console.debug("Resumed recording.")},initRecorder:a,
setRecordingDuration:function(a,c){if("undefined"===typeof a)throw"milliseconds is required.";if("number"!==typeof a)throw"milliseconds must be a number.";n.recordingDuration=a;n.onRecordingStopped=c||function(){};return{onRecordingStopped:function(a){n.onRecordingStopped=a}}},clearRecordedData:function(){if(!v)return console.warn(A);v.clearRecordedData();h.disableLogs||console.debug("Cleared old recorded data.")},getBlob:function(){return!v?console.warn(A):v.blob},getDataURL:g,toURL:function(){return!v?
console.warn(A):URL.createObjectURL(v.blob)},save:function(a){if(!v)return console.warn(A);invokeSaveAsDialog(v.blob,a)},getFromDisk:function(a){if(!v)return console.warn(A);RecordRTC.getFromDisk(h.type,a)},setAdvertisementArray:function(a){h.advertisement=[];for(var c=a.length,f=0;f<c;f++)h.advertisement.push({duration:f,image:a[f]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return n=l;for(var x in l)this[x]=l[x];n=this;return l}
RecordRTC.getFromDisk=function(k,h){if(!h)throw"callback is mandatory.";console.log("Getting recorded "+("all"===k?"blobs":k+" blob ")+" from disk!");DiskStorage.Fetch(function(a,i){"all"!==k&&i===k+"Blob"&&h&&h(a);"all"===k&&h&&h(a,i.replace("Blob",""))})};
RecordRTC.writeToDisk=function(k){console.log("Writing recorded blob(s) to disk!");k=k||{};k.audio&&k.video&&k.gif?k.audio.getDataURL(function(h){k.video.getDataURL(function(a){k.gif.getDataURL(function(i){DiskStorage.Store({audioBlob:h,videoBlob:a,gifBlob:i})})})}):k.audio&&k.video?k.audio.getDataURL(function(h){k.video.getDataURL(function(a){DiskStorage.Store({audioBlob:h,videoBlob:a})})}):k.audio&&k.gif?k.audio.getDataURL(function(h){k.gif.getDataURL(function(a){DiskStorage.Store({audioBlob:h,
gifBlob:a})})}):k.video&&k.gif?k.video.getDataURL(function(h){k.gif.getDataURL(function(a){DiskStorage.Store({videoBlob:h,gifBlob:a})})}):k.audio?k.audio.getDataURL(function(h){DiskStorage.Store({audioBlob:h})}):k.video?k.video.getDataURL(function(h){DiskStorage.Store({videoBlob:h})}):k.gif&&k.gif.getDataURL(function(h){DiskStorage.Store({gifBlob:h})})};"undefined"!==typeof module&&(module.exports=RecordRTC);"function"===typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC});
function RecordRTCConfiguration(k,h){if(h.recorderType&&!h.type)if(h.recorderType===WhammyRecorder||h.recorderType===CanvasRecorder)h.type="video";else if(h.recorderType===GifRecorder)h.type="gif";else if(h.recorderType===StereoAudioRecorder)h.type="audio";else if(h.recorderType===MediaStreamRecorder)if(k.getAudioTracks().length&&k.getVideoTracks().length)h.type="video";else if(k.getAudioTracks().length&&!k.getVideoTracks().length)h.type="audio";else if(!k.getAudioTracks().length&&k.getVideoTracks().length)h.type=
"audio";if(typeof MediaStreamRecorder!=="undefined"&&typeof MediaRecorder!=="undefined"&&"requestData"in MediaRecorder.prototype){if(!h.mimeType)h.mimeType="video/webm";if(!h.type)h.type=h.mimeType.split("/")[0]}if(!h.type){if(h.mimeType)h.type=h.mimeType.split("/")[0];if(!h.type)h.type="audio"}return h}
function GetRecorderType(k,h){var a;if(isChrome||isEdge||isOpera)a=StereoAudioRecorder;typeof MediaRecorder!=="undefined"&&"requestData"in MediaRecorder.prototype&&!isChrome&&(a=MediaStreamRecorder);if(h.type==="video"&&(isChrome||isOpera))a=WhammyRecorder;h.type==="gif"&&(a=GifRecorder);h.type==="canvas"&&(a=CanvasRecorder);isMediaRecorderCompatible()&&isChrome&&a!==CanvasRecorder&&a!==GifRecorder&&typeof MediaRecorder!=="undefined"&&"requestData"in MediaRecorder.prototype&&k.getVideoTracks().length&&
(a=MediaStreamRecorder);if(h.recorderType)a=h.recorderType;!h.disableLogs&&a&&a.name&&console.debug("Using recorderType:",a.name||a.constructor.name);return a}
function MRecordRTC(k){this.addStream=function(h){h&&(k=h)};this.mediaType={audio:true,video:true};this.startRecording=function(){var h=this.mediaType,a,i=this.mimeType||{audio:null,video:null,gif:null};if(typeof h.audio!=="function"&&isMediaRecorderCompatible()&&k&&k.getAudioTracks&&k.getAudioTracks().length&&k.getVideoTracks().length)this.mediaType.audio=false;if(h.audio){a=null;if(typeof h.audio==="function")a=h.audio;this.audioRecorder=new RecordRTC(k,{type:"audio",bufferSize:this.bufferSize,
sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:a,mimeType:i.audio});h.video||this.audioRecorder.startRecording()}if(h.video){a=null;if(typeof h.video==="function")a=h.video;var c=k;if(isMediaRecorderCompatible()&&h.audio&&typeof h.audio==="function"){var g=k.getVideoTracks()[0];if(navigator.mozGetUserMedia){c=new MediaStream;c.addTrack(g);a&&a===WhammyRecorder&&(a=MediaStreamRecorder)}else c=new MediaStream([g])}this.videoRecorder=
new RecordRTC(c,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:a,mimeType:i.video});h.audio||this.videoRecorder.startRecording()}if(h.audio&&h.video){var f=this;f.videoRecorder.initRecorder(function(){f.audioRecorder.initRecorder(function(){f.videoRecorder.startRecording();f.audioRecorder.startRecording()})})}if(h.gif){a=null;if(typeof h.gif==="function")a=h.gif;this.gifRecorder=new RecordRTC(k,{type:"gif",frameRate:this.frameRate||
200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:a,mimeType:i.gif});this.gifRecorder.startRecording()}};this.stopRecording=function(h){h=h||function(){};this.audioRecorder&&this.audioRecorder.stopRecording(function(a){h(a,"audio")});this.videoRecorder&&this.videoRecorder.stopRecording(function(a){h(a,"video")});this.gifRecorder&&this.gifRecorder.stopRecording(function(a){h(a,"gif")})};this.getBlob=function(h){var a={};if(this.audioRecorder)a.audio=this.audioRecorder.getBlob();
if(this.videoRecorder)a.video=this.videoRecorder.getBlob();if(this.gifRecorder)a.gif=this.gifRecorder.getBlob();h&&h(a);return a};this.getDataURL=function(h){function a(a,g){if(typeof Worker!=="undefined"){var f=i(function(a){postMessage((new FileReaderSync).readAsDataURL(a))});f.onmessage=function(a){g(a.data)};f.postMessage(a)}else{f=new FileReader;f.readAsDataURL(a);f.onload=function(a){g(a.target.result)}}}function i(a){var a=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+
a.name+"(e.data);}"],{type:"application/javascript"})),g=new Worker(a),f;if(typeof URL!=="undefined")f=URL;else if(typeof webkitURL!=="undefined")f=webkitURL;else throw"Neither URL nor webkitURL detected.";f.revokeObjectURL(a);return g}this.getBlob(function(c){a(c.audio,function(g){a(c.video,function(a){h({audio:g,video:a})})})})};this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})};this.save=function(h){h=h||{audio:true,video:true,
gif:true};h.audio&&this.audioRecorder&&this.audioRecorder.save(typeof h.audio==="string"?h.audio:"");h.video&&this.videoRecorder&&this.videoRecorder.save(typeof h.video==="string"?h.video:"");h.gif&&this.gifRecorder&&this.gifRecorder.save(typeof h.gif==="string"?h.gif:"")}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk;MRecordRTC.writeToDisk=RecordRTC.writeToDisk;var requestAnimationFrame=window.requestAnimationFrame;
"undefined"===typeof requestAnimationFrame&&("undefined"!==typeof webkitRequestAnimationFrame&&(requestAnimationFrame=webkitRequestAnimationFrame),"undefined"!==typeof mozRequestAnimationFrame&&(requestAnimationFrame=mozRequestAnimationFrame));var cancelAnimationFrame=window.cancelAnimationFrame;
"undefined"===typeof cancelAnimationFrame&&("undefined"!==typeof webkitCancelAnimationFrame&&(cancelAnimationFrame=webkitCancelAnimationFrame),"undefined"!==typeof mozCancelAnimationFrame&&(cancelAnimationFrame=mozCancelAnimationFrame));var AudioContext=window.AudioContext;"undefined"===typeof AudioContext&&("undefined"!==typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!==typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;
"undefined"===typeof URL&&"undefined"!==typeof webkitURL&&(URL=webkitURL);if("undefined"!==typeof navigator){if("undefined"!==typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!==typeof navigator.mozGetUserMedia)navigator.getUserMedia=navigator.mozGetUserMedia}else throw'Please make sure to define a global variable named as "navigator"';
var isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;"undefined"===typeof MediaStream&&"undefined"!==typeof webkitMediaStream&&(MediaStream=webkitMediaStream);
if("undefined"!==typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var k=[];this.getTracks.forEach(function(h){h.kind.toString().indexOf("video")!==-1&&k.push(h)});return k},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var k=[];this.getTracks.forEach(function(h){h.kind.toString().indexOf("audio")!==-1&&k.push(h)});return k}),!("stop"in MediaStream.prototype)))MediaStream.prototype.stop=
function(){this.getAudioTracks().forEach(function(k){k.stop&&k.stop()});this.getVideoTracks().forEach(function(k){k.stop&&k.stop()})};"undefined"!==typeof location&&0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");function bytesToSize(k){if(k===0)return"0 Bytes";var h=parseInt(Math.floor(Math.log(k)/Math.log(1E3)),10);return(k/Math.pow(1E3,h)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][h]}
function invokeSaveAsDialog(k,h){if(!k)throw"Blob object is required.";if(!k.type)try{k.type="video/webm"}catch(a){}var i=(k.type||"video/webm").split("/")[1];if(h&&h.indexOf(".")!==-1){i=h.split(".");h=i[0];i=i[1]}i=(h||Math.round(Math.random()*9999999999)+888888888)+"."+i;if(typeof navigator.msSaveOrOpenBlob!=="undefined")return navigator.msSaveOrOpenBlob(k,i);if(typeof navigator.msSaveBlob!=="undefined")return navigator.msSaveBlob(k,i);var c=document.createElement("a");c.href=URL.createObjectURL(k);
c.target="_blank";c.download=i;if(navigator.mozGetUserMedia){c.onclick=function(){(document.body||document.documentElement).removeChild(c)};(document.body||document.documentElement).appendChild(c)}i=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});c.dispatchEvent(i);navigator.mozGetUserMedia||URL.revokeObjectURL(c.href)}var Storage={};"undefined"!==typeof AudioContext?Storage.AudioContext=AudioContext:"undefined"!==typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext);
function isMediaRecorderCompatible(){var k=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,h=!!window.chrome&&!k;if(typeof window.InstallTrigger!=="undefined")return true;if(!h)return false;var k=navigator.userAgent,a=""+parseFloat(navigator.appVersion),i=parseInt(navigator.appVersion,10);if(h){a=k.indexOf("Chrome");a=k.substring(a+7)}if((k=a.indexOf(";"))!==-1)a=a.substring(0,k);if((k=a.indexOf(" "))!==-1)a=a.substring(0,k);i=parseInt(""+a,10);if(isNaN(i)){parseFloat(navigator.appVersion);
i=parseInt(navigator.appVersion,10)}return i>=49}
function MediaStreamRecorder(k,h){function a(){if("active"in k){if(!k.active)return false}else if("ended"in k&&k.ended)return false;return true}var i=this,h=h||{mimeType:"video/webm"};if(h.type==="audio"){if(k.getVideoTracks().length&&k.getAudioTracks().length){var c;if(navigator.mozGetUserMedia){c=new MediaStream;c.addTrack(k.getAudioTracks()[0])}else c=new MediaStream(k.getAudioTracks());k=c}if(!h.mimeType||h.mimeType.indexOf("audio")===-1)h.mimeType=isChrome?"audio/webm":"audio/ogg"}this.record=
function(){i.blob=null;var a=h;h.disableLogs||console.log("Passing following config over MediaRecorder API.",a);g&&(g=null);isChrome&&!isMediaRecorderCompatible()&&(a="video/vp8");g=new MediaRecorder(k,a);"canRecordMimeType"in g&&g.canRecordMimeType(h.mimeType)===false&&(h.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",h.mimeType));g.ignoreMutedMedia=h.ignoreMutedMedia||false;g.ondataavailable=function(a){if(!i.dontFireOnDataAvailableEvent&&a.data&&a.data.size&&!(a.data.size<
100||i.blob)){i.blob=h.getNativeBlob?a.data:new Blob([a.data],{type:h.mimeType||"video/webm"});if(i.recordingCallback){i.recordingCallback(i.blob);i.recordingCallback=null}}};g.onerror=function(a){h.disableLogs||(a.name==="InvalidState"?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):a.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):
a.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):a.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):
a.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",a):console.error("MediaRecorder Error",a));g.state!=="inactive"&&g.state!=="stopped"&&g.stop()};g.start(36E5);if(h.onAudioProcessStarted)h.onAudioProcessStarted();h.initCallback&&h.initCallback()};this.stop=function(a){if(g){this.recordingCallback=a||function(){};if(g.state==="recording"){g.requestData();g.stop()}}};this.pause=function(){g&&g.state==="recording"&&g.pause()};this.resume=
function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=false;var a=h.disableLogs;h.disableLogs=true;this.record();h.disableLogs=a}else g&&g.state==="paused"&&g.resume()};this.clearRecordedData=function(){if(g){this.pause();this.dontFireOnDataAvailableEvent=true;this.stop()}};var g,i=this;(function n(){g&&(a()===false?i.stop():setTimeout(n,1E3))})()}
function StereoAudioRecorder(k,h){function a(){if("active"in k){if(!k.active)return false}else if("ended"in k&&k.ended)return false;return true}function i(a,f){function g(a,c){function f(a,c){for(var g=new Float64Array(c),h=0,i=a.length,k=0;k<i;k++){var l=a[k];g.set(l,h);h=h+l.length}return g}function h(a,c){for(var f=a.length+c.length,g=new Float64Array(f),i=0,k=0;k<f;){g[k++]=a[i];g[k++]=c[i];i++}return g}function i(a,c,f){for(var g=f.length,h=0;h<g;h++)a.setUint8(c+h,f.charCodeAt(h))}var k=a.numberOfAudioChannels,
l=a.leftBuffers.slice(0),n=a.rightBuffers.slice(0),o=a.sampleRate,r=a.internalInterleavedLength;if(k===2){l=f(l,r);n=f(n,r)}k===1&&(l=f(l,r));var p;k===2&&(p=h(l,n));k===1&&(p=l);l=p.length;n=new ArrayBuffer(44+l*2);r=new DataView(n);i(r,0,"RIFF");r.setUint32(4,44+l*2,true);i(r,8,"WAVE");i(r,12,"fmt ");r.setUint32(16,16,true);r.setUint16(20,1,true);r.setUint16(22,k,true);r.setUint32(24,o,true);r.setUint32(28,o*2,true);r.setUint16(32,k*2,true);r.setUint16(34,16,true);i(r,36,"data");r.setUint32(40,
l*2,true);k=44;for(o=0;o<l;o++){r.setInt16(k,p[o]*32767,true);k=k+2}if(c)return c({buffer:n,view:r});postMessage({buffer:n,view:r})}if(isChrome){var h=c(g);h.onmessage=function(a){f(a.data.buffer,a.data.view);URL.revokeObjectURL(h.workerURL)};h.postMessage(a)}else g(a,function(a){f(a.buffer,a.view)})}function c(a){var a=URL.createObjectURL(new Blob([a.toString(),";this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(a);c.workerURL=a;return c}if(!k.getAudioTracks().length)throw"Your stream has no audio tracks.";
var h=h||{},g=this,f=[],n=[],A=false,v=0,l,x=2;h.leftChannel===true&&(x=1);h.numberOfAudioChannels===1&&(x=1);h.disableLogs||console.debug("StereoAudioRecorder is set to record number of channels: ",x);this.record=function(){if(a()===false)throw"Please make sure MediaStream is active.";v=f.length=n.length=0;r&&r.connect(l);t=z=false;A=true};this.stop=function(a){A=false;i({sampleRate:w,numberOfAudioChannels:x,internalInterleavedLength:v,leftBuffers:f,rightBuffers:x===1?[]:n},function(c,f){g.blob=
new Blob([f],{type:"audio/wav"});g.buffer=new ArrayBuffer(f);g.view=f;g.sampleRate=w;g.bufferSize=o;g.length=v;a&&a();t=false})};if(!Storage.AudioContextConstructor)Storage.AudioContextConstructor=new Storage.AudioContext;var p=Storage.AudioContextConstructor,r=p.createMediaStreamSource(k),y=[0,256,512,1024,2048,4096,8192,16384],o=typeof h.bufferSize==="undefined"?4096:h.bufferSize;y.indexOf(o)===-1&&(h.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(y,null,"\t")));if(p.createJavaScriptNode)l=
p.createJavaScriptNode(o,x,x);else if(p.createScriptProcessor)l=p.createScriptProcessor(o,x,x);else throw"WebAudio API has no support on this browser.";r.connect(l);if(!h.bufferSize)o=l.bufferSize;var w=typeof h.sampleRate!=="undefined"?h.sampleRate:p.sampleRate||44100;if(w<22050||w>96E3)h.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.");if(!h.disableLogs){console.log("sample-rate",w);console.log("buffer-size",o)}var z=false;this.pause=function(){z=true};this.resume=function(){if(a()===
false)throw"Please make sure MediaStream is active.";if(A)z=false;else{h.disableLogs||console.info("Seems recording has been restarted.");this.record()}};this.clearRecordedData=function(){this.pause();v=f.length=n.length=0};var t=false;l.onaudioprocess=function(c){if(!z){if(a()===false){h.disableLogs||console.error("MediaStream seems stopped.");l.disconnect();A=false}if(A){if(!t){t=true;if(h.onAudioProcessStarted)h.onAudioProcessStarted();h.initCallback&&h.initCallback()}var g=c.inputBuffer.getChannelData(0);
f.push(new Float32Array(g));if(x===2){c=c.inputBuffer.getChannelData(1);n.push(new Float32Array(c))}v=v+o}else r.disconnect()}};l.connect(p.destination)}
function CanvasRecorder(k,h){function a(){var a=document.createElement("canvas"),c=a.getContext("2d");a.width=k.width;a.height=k.height;c.drawImage(k,0,0);return a}function i(){if(A){v=(new Date).getTime();return setTimeout(i,500)}if(k.nodeName.toLowerCase()==="canvas"){var c=(new Date).getTime()-v;v=(new Date).getTime();l.frames.push({image:a(),duration:c});n&&setTimeout(i,h.frameInterval)}else html2canvas(k,{grabMouse:typeof h.showMousePointer==="undefined"||h.showMousePointer,onrendered:function(a){var c=
(new Date).getTime()-v;if(!c)return setTimeout(i,h.frameInterval);v=(new Date).getTime();l.frames.push({image:a.toDataURL("image/webp",1),duration:c});n&&setTimeout(i,h.frameInterval)}})}if(typeof html2canvas==="undefined"&&k.nodeName.toLowerCase()!=="canvas")throw"Please link: //cdn.webrtc-experiment.com/screenshot.js";h=h||{};if(!h.frameInterval)h.frameInterval=10;var c=false;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(a){a in document.createElement("canvas")&&(c=
true)});if(window.webkitRTCPeerConnection||window.webkitGetUserMedia)c=false;var g,f;if(c){h.disableLogs||console.debug("Your browser supports both MediRecorder API and canvas.captureStream!");g=document.createElement("canvas");g.width=k.clientWidth||window.innerWidth;g.height=k.clientHeight||window.innerHeight;g.style="top: -9999999; left: -99999999; visibility:hidden; position:absoluted; display: none;";(document.body||document.documentElement).appendChild(g);g.getContext("2d")}else navigator.mozGetUserMedia&&
(h.disableLogs||alert("Canvas recording is NOT supported in Firefox."));var n;this.record=function(){n=true;if(c){var a;"captureStream"in g?a=g.captureStream(25):"mozCaptureStream"in g?a=g.captureStream(25):"webkitCaptureStream"in g&&(a=g.captureStream(25));try{var k=new MediaStream;k.addTrack(a.getVideoTracks()[0]);a=k}catch(r){}if(!a)throw"captureStream API are NOT available.";f=new MediaStreamRecorder(a,{mimeType:"video/webm"});f.record()}else{l.frames=[];v=(new Date).getTime();i()}h.initCallback&&
h.initCallback()};this.getWebPImages=function(a){if(k.nodeName.toLowerCase()==="canvas"){var c=l.frames.length;l.frames.forEach(function(a,f){var g=c-f;document.title=g+"/"+c+" frames remaining";if(h.onEncodingCallback)h.onEncodingCallback(g,c);g=a.image.toDataURL("image/webp",1);l.frames[f].image=g});document.title="Generating WebM"}a()};this.stop=function(a){n=false;var g=this;c&&f?f.stop(function(){for(var c in f)self[c]=f[c];a&&a(g.blob)}):this.getWebPImages(function(){l.compile(function(c){document.title=
"Recording finished!";g.blob=c;if(g.blob.forEach)g.blob=new Blob([],{type:"video/webm"});a&&a(g.blob);l.frames=[]})})};var A=false;this.pause=function(){A=true};this.resume=function(){A=false};this.clearRecordedData=function(){this.pause();l.frames=[]};var v=(new Date).getTime(),l=new Whammy.Video(100)}
function WhammyRecorder(k,h){function a(c){var c=typeof c!=="undefined"?c:10,h=(new Date).getTime()-l;if(!h)return setTimeout(a,c,c);if(f){l=(new Date).getTime();return setTimeout(a,100)}l=(new Date).getTime();v.paused&&v.play();A.drawImage(v,0,0,n.width,n.height);x.frames.push({duration:h,image:n.toDataURL("image/webp")});g||setTimeout(a,c,c)}function i(a){var c=-1,f=a.length,g=function(){c++;c===f?a.callback():a.functionToLoop(g,c)};g()}function c(a,c,f,g,h){var k=document.createElement("canvas");
k.width=n.width;k.height=n.height;var l=k.getContext("2d"),v=[],x=c===-1,A=c&&c>0&&c<=a.length?c:a.length,H=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),Q=f&&f>=0&&f<=1?f:0,N=g&&g>=0&&g<=1?g:0,L=false;i({length:A,functionToLoop:function(c,f){var g,h,i,k=function(){if(L||!(i-g<=i*N)){x&&(L=true);v.push(a[f])}c()};if(L)k();else{var o=new Image;o.onload=function(){l.drawImage(o,0,0,n.width,n.height);var a=l.getImageData(0,0,n.width,n.height);g=0;h=a.data.length;i=a.data.length/4;for(var c=
0;c<h;c=c+4){var f=a.data[c+1],r=a.data[c+2];Math.sqrt(Math.pow(a.data[c]-0,2)+Math.pow(f-0,2)+Math.pow(r-0,2))<=H*Q&&g++}k()};o.src=a[f].image}},callback:function(){v=v.concat(a.slice(A));v.length<=0&&v.push(a[a.length-1]);h(v)}})}h=h||{};if(!h.frameInterval)h.frameInterval=10;h.disableLogs||console.log("Using frames-interval:",h.frameInterval);this.record=function(){if(!h.width)h.width=320;if(!h.height)h.height=240;if(!h.video)h.video={width:h.width,height:h.height};if(!h.canvas)h.canvas={width:h.width,
height:h.height};n.width=h.canvas.width;n.height=h.canvas.height;A=n.getContext("2d");if(h.video&&h.video instanceof HTMLVideoElement){v=h.video.cloneNode();h.initCallback&&h.initCallback()}else{v=document.createElement("video");typeof v.srcObject!=="undefined"?v.srcObject=k:v.src=URL.createObjectURL(k);v.onloadedmetadata=function(){h.initCallback&&h.initCallback()};v.width=h.video.width;v.height=h.video.height}v.muted=true;v.play();l=(new Date).getTime();x=new Whammy.Video;if(!h.disableLogs){console.log("canvas resolutions",
n.width,"*",n.height);console.log("video width/height",v.width||n.width,"*",v.height||n.height)}a(h.frameInterval)};var g=false;this.stop=function(a){g=true;var f=this;setTimeout(function(){c(x.frames,-1,null,null,function(c){x.frames=c;if(h.advertisement&&h.advertisement.length)x.frames=h.advertisement.concat(x.frames);x.compile(function(c){f.blob=c;if(f.blob.forEach)f.blob=new Blob([],{type:"video/webm"});a&&a(f.blob)})})},10)};var f=false;this.pause=function(){f=true};this.resume=function(){f=
false};this.clearRecordedData=function(){this.pause();x.frames=[]};var n=document.createElement("canvas"),A=n.getContext("2d"),v,l,x}
var Whammy=function(){function k(a){this.frames=[];this.duration=a||1;this.quality=0.8}function h(a){var a=URL.createObjectURL(new Blob([a.toString(),"this.onmessage =  function (e) {"+a.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(a);URL.revokeObjectURL(a);return c}function a(a){function c(a,c,f){return[{data:a,id:231}].concat(f.map(function(a){var f=v({discardable:0,frame:a.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(c)});c=c+a.duration;return{data:f,
id:163}}))}function g(a){for(var c=[];a>0;){c.push(a&255);a=a>>8}return new Uint8Array(c.reverse())}function f(a){return new Uint8Array(a.split("").map(function(a){return a.charCodeAt(0)}))}function h(a){for(var c=[],a=(a.length%8?Array(9-a.length%8).join("0"):"")+a,f=0;f<a.length;f=f+8)c.push(parseInt(a.substr(f,8),2));return new Uint8Array(c)}function k(a){for(var c=[],i=0;i<a.length;i++){var l=a[i].data;typeof l==="object"&&(l=k(l));typeof l==="number"&&(l=h(l.toString(2)));typeof l==="string"&&
(l=f(l));var p=l.size||l.byteLength||l.length,t=Math.ceil(Math.ceil(Math.log(p)/Math.log(2))/8),p=p.toString(2),p=Array(t*7+8-p.length).join("0")+p,t=Array(t).join("0")+"1"+p;c.push(g(a[i].id));c.push(h(t));c.push(l)}return new Blob(c,{type:"video/webm"})}function v(a){var c=0;a.keyframe&&(c=c|128);a.invisible&&(c=c|8);a.lacing&&(c=c|a.lacing<<1);a.discardable&&(c=c|1);if(a.trackNum>127)throw"TrackNumber > 127 not supported";return[a.trackNum|128,a.timecode>>8,a.timecode&255,c].map(function(a){return String.fromCharCode(a)}).join("")+
a.frame}function l(a,c){return parseInt(a.substr(c+4,4).split("").map(function(a){a=a.charCodeAt(0).toString(2);return Array(8-a.length+1).join("0")+a}).join(""),2)}function x(a){for(var c=0,f={};c<a.length;){var g=a.substr(c,4),h=l(a,c),i=a.substr(c+4+4,h),c=c+(8+h);f[g]=f[g]||[];g==="RIFF"||g==="LIST"?f[g].push(x(i)):f[g].push(i)}return f}function p(a){return[].slice.call(new Uint8Array((new Float64Array([a])).buffer),0).map(function(a){return String.fromCharCode(a)}).reverse().join("")}a=new function(a){var f;
if(a[0]){f=a[0].width;for(var g=a[0].height,h=a[0].duration,i=1;i<a.length;i++)h=h+a[i].duration;f={duration:h,width:f,height:g}}else{postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});f=void 0}if(!f)return[];f=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},
{data:"whammy",id:22337},{data:p(f.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:f.width,id:176},{data:f.height,id:186}]}]}]}]}];for(h=g=0;g<a.length;){var l=[],i=0;do{l.push(a[g]);i=i+a[g].duration;g++}while(g<a.length&&i<3E4);l={id:524531317,data:c(h,0,l)};f[1].data.push(l);h=h+i}return k(f)}(a.map(function(a){var c;c=x(atob(a.image.slice(23)));
for(var f=c.RIFF[0].WEBP[0],g=f.indexOf("\u009d\u0001*"),h=0,i=[];h<4;h++)i[h]=f.charCodeAt(g+3+h);h=i[1]<<8|i[0];g=h&16383;h=i[3]<<8|i[2];c={width:g,height:h&16383,data:f,riff:c};c.duration=a.duration;return c}));postMessage(a)}k.prototype.add=function(a,c){if("canvas"in a)a=a.canvas;"toDataURL"in a&&(a=a.toDataURL("image/webp",this.quality));if(!/^data:image\/webp;base64,/ig.test(a))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:a,
duration:c||this.duration})};k.prototype.compile=function(i){var c=h(a);c.onmessage=function(a){a.data.error?console.error(a.data.error):i(a.data)};c.postMessage(this.frames)};return{Video:k}}(),DiskStorage={init:function(){function k(){function a(g){c.objectStore(h.dataStoreName).get(g).onsuccess=function(a){h.callback&&h.callback(a.target.result,g)}}var c=i.transaction([h.dataStoreName],"readwrite");h.videoBlob&&c.objectStore(h.dataStoreName).put(h.videoBlob,"videoBlob");h.gifBlob&&c.objectStore(h.dataStoreName).put(h.gifBlob,
"gifBlob");h.audioBlob&&c.objectStore(h.dataStoreName).put(h.audioBlob,"audioBlob");a("audioBlob");a("videoBlob");a("gifBlob")}var h=this;if(typeof indexedDB==="undefined"||typeof indexedDB.open==="undefined")console.error("IndexedDB API are not available in this browser.");else{typeof webkitIndexedDB!=="undefined"&&(indexedDB=webkitIndexedDB);typeof mozIndexedDB!=="undefined"&&(indexedDB=mozIndexedDB);typeof OIndexedDB!=="undefined"&&(indexedDB=OIndexedDB);typeof msIndexedDB!=="undefined"&&(indexedDB=
msIndexedDB);var a=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),i,c=indexedDB.open(a,1);c.onerror=h.onError;c.onsuccess=function(){i=c.result;i.onerror=h.onError;i.setVersion?i.version!==1?i.setVersion(1).onsuccess=function(){i.createObjectStore(h.dataStoreName);k()}:k():k()};c.onupgradeneeded=function(a){a.target.result.createObjectStore(h.dataStoreName)}}},Fetch:function(k){this.callback=k;this.init();return this},Store:function(k){this.audioBlob=k.audioBlob;this.videoBlob=k.videoBlob;
this.gifBlob=k.gifBlob;this.init();return this},onError:function(k){console.error(JSON.stringify(k,null,"\t"))},dataStoreName:"recordRTC",dbName:null};
function GifRecorder(k,h){if(typeof GIFEncoder==="undefined")throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";var h=h||{},a=k instanceof CanvasRenderingContext2D||k instanceof HTMLCanvasElement;this.record=function(){function l(k){if(i)return setTimeout(function(){l(k)},100);n=requestAnimationFrame(l);typeof A===void 0&&(A=k);if(!(k-A<90)){!a&&f.paused&&f.play();g.drawImage(f,0,0,c.width,c.height);if(h.onGifPreview)h.onGifPreview(c.toDataURL("image/png"));v.addFrame(g);A=k}}if(!a){if(!h.width)h.width=
f.offsetWidth||320;if(!this.height)h.height=f.offsetHeight||240;if(!h.video)h.video={width:h.width,height:h.height};if(!h.canvas)h.canvas={width:h.width,height:h.height};c.width=h.canvas.width;c.height=h.canvas.height;f.width=h.video.width;f.height=h.video.height}v=new GIFEncoder;v.setRepeat(0);v.setDelay(h.frameRate||200);v.setQuality(h.quality||10);v.start();Date.now();n=requestAnimationFrame(l);h.initCallback&&h.initCallback()};this.stop=function(){n&&cancelAnimationFrame(n);Date.now();this.blob=
new Blob([new Uint8Array(v.stream().bin)],{type:"image/gif"});v.stream().bin=[]};var i=false;this.pause=function(){i=true};this.resume=function(){i=false};this.clearRecordedData=function(){if(v){this.pause();v.stream().bin=[]}};var c=document.createElement("canvas"),g=c.getContext("2d");a&&(k instanceof CanvasRenderingContext2D?g=k:k instanceof HTMLCanvasElement&&(g=k.getContext("2d")));if(!a){var f=document.createElement("video");f.muted=true;f.autoplay=true;typeof f.srcObject!=="undefined"?f.srcObject=
k:f.src=URL.createObjectURL(k);f.play()}var n=null,A,v};(function(){function k(a,c){var g={audio:!1,video:{mandatory:{chromeMediaSource:a?"screen":"desktop",maxWidth:1920<window.screen.width?window.screen.width:1920,maxHeight:1080<window.screen.height?window.screen.height:1080},optional:[]}};c&&(g.video.mandatory.chromeMediaSourceId=c);return g}function h(){a.isLoaded?a.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout(h,100)}window.getScreenId=function(a){function c(g){g.data&&(console.log(g.data),g.data.chromeMediaSourceId&&("PermissionDeniedError"===
g.data.chromeMediaSourceId?a("permission-denied"):a(null,g.data.chromeMediaSourceId,k(null,g.data.chromeMediaSourceId))),g.data.chromeExtensionStatus&&a(g.data.chromeExtensionStatus,null,k(g.data.chromeExtensionStatus)),window.removeEventListener("message",c))}navigator.mozGetUserMedia?a(null,"firefox",{video:{mozMediaSource:"window",mediaSource:"window"}}):(h(),window.addEventListener("message",c))};var a=document.createElement("iframe");a.onload=function(){a.isLoaded=!0};a.src="https://www.webrtc-experiment.com/getSourceId/";
a.style.display="none";(document.body||document.documentElement).appendChild(a)})();
