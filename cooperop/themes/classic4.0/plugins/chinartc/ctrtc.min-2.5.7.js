(function(k){var i={};(function(b){var h,c=b.name+" | EVENT EMITTER | ";h=function(){};h.prototype={initEvents:function(b){var f=b.length;this.events={};this.onceNotFired=[];this.maxListeners=10;for(this.events.newListener=function(b){console.log(c+"new listener added to event "+b)};f--;)console.log(c+"adding event "+b[f]),this.events[b[f]]=[]},checkEvent:function(b){if(this.events[b])return!0;console.error(c+"no event named "+b);return!1},addListener:function(b,f){this.checkEvent(b)&&(this.events[b].length>=
this.maxListeners&&console.warn(c+"max listeners exceeded for event "+b),this.events[b].push(f),this.events.newListener.call(null,b))},on:function(b,c){this.addListener(b,c)},once:function(b,c){this.events[b].unshift(c);this.onceNotFired.push(b)},removeListener:function(b,c){if(this.checkEvent(b))for(var n=this.events[b],x=0,v=n.length;x<v;)n[x]&&n[x].toString()===c.toString()?n.splice(x,1):x++},removeAllListener:function(b){this.checkEvent(b)&&(this.events[b]=[])},setMaxListeners:function(b){Number(b)&&
(this.maxListeners=b)},listeners:function(b){return this.events[b]},emit:function(g,f,n){var x,v,l=0;if(this.checkEvent(g)){console.log(c+"emitting event "+g);x=this.events[g];v=x.length;if(f=new b.Event(g,f,n))for(l;l<v;l++)x[l].apply(null,[f]);else for(l;l<v;l++)x[l].call();l=this.onceNotFired.indexOf(g);-1!==l&&(this.onceNotFired.splice(l,1),this.events[g].shift())}},newListener:function(b){this.events.newListener=b}};b.EventEmitter=h;b.Event=function(b,c,n){this.type=b;this.sender=c;this.data=
n}})(i);i.C={USER_AGENT:i.name+" "+i.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",
WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",
BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",
403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",
433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",
493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}};(function(b){var h;h={ConfigurationError:function(){var b=function(b,c){this.code=1;this.name="CONFIGURATION_ERROR";this.parameter=b;this.value=c;this.message=!this.value?
"Missing parameter: "+this.parameter:"Invalid value "+k.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"'};b.prototype=Error();return b}(),InvalidTargetError:function(){var b=function(b){this.code=2;this.name="INVALID_TARGET_ERROR";this.target=b;this.message="Invalid target: "+this.target};b.prototype=Error();return b}(),InvalidStateError:function(){var b=function(b){this.code=3;this.name="INVALID_STATE_ERROR";this.status=b};b.prototype=Error();return b}()};b.Exceptions=h})(i);i.Timers=
{T1:500,T2:4E3,T4:5E3,TIMER_B:32E3,TIMER_D:0,TIMER_F:32E3,TIMER_H:32E3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32E3,TIMER_M:32E3,TIMER_N:90};(function(b){var h,c=b.name+" | TRANSPORT | ";h=function(b,c){this.ua=b;this.ws=null;this.server=c;this.reconnection_attempts=0;this.connected=this.closed=!1;this.reconnectTimer=null;this.lastTransportError={};this.ua.transport=this;this.connect()};h.prototype={send:function(b){b=b.toString();if(this.ws&&this.ws.readyState===WebSocket.OPEN)return!0===this.ua.configuration.trace_sip&&
console.log(Date()+c+"sending WebSocket message:\n\n"+b+"\n"),this.ws.send(b),!0;console.warn(Date()+c+"unable to send message, WebSocket is not open");return!1},disconnect:function(){this.ws&&(this.closed=!0,console.log(Date()+c+"closing WebSocket "+this.server.ws_uri),this.ws.close())},connect:function(){var b=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return console.log(c+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&
this.ws.close();console.log(c+"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new WebSocket(this.server.ws_uri,"sip")}catch(f){console.warn(c+"error connecting to WebSocket "+this.server.ws_uri+": "+f)}this.ws.binaryType="arraybuffer";this.ws.onopen=function(){b.onOpen()};this.ws.onclose=function(c){b.onClose(c)};this.ws.onmessage=function(c){b.onMessage(c)};this.ws.onerror=function(c){b.onError(c)}},onOpen:function(){this.connected=!0;console.log(c+"WebSocket "+this.server.ws_uri+" connected");
k.clearTimeout(this.reconnectTimer);this.closed=!1;this.ua.onTransportConnected(this)},onClose:function(b){var f=this.connected;this.connected=!1;this.lastTransportError.code=b.code;this.lastTransportError.reason=b.reason;console.warn(c+"WebSocket disconnected (code: "+b.code+(b.reason?"| reason: "+b.reason:"")+")");!1===b.wasClean&&console.warn(c+"WebSocket abrupt disconnection");if(!0===f)this.ua.onTransportClosed(this),this.closed||(this.reconnection_attempts=0,this.reConnect()),this.ua.emit("disconnected",
this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason});else this.ua.onTransportError(this)},onMessage:function(g){var f,g=g.data;if("\r\n"===g)!0===this.ua.configuration.trace_sip&&console.log(c+"received WebSocket message with CRLF Keep Alive response");else{if("string"!==typeof g){try{g=String.fromCharCode.apply(null,new Uint8Array(g))}catch(n){console.warn(c+"received WebSocket binary message failed to be converted into string, message discarded");return}!0===
this.ua.configuration.trace_sip&&console.log(c+"received WebSocket binary message:\n\n"+g+"\n")}else!0===this.ua.configuration.trace_sip&&console.log(Date()+c+"received WebSocket text message:\n\n"+g+"\n");g=b.Parser.parseMessage(g);if(!(this.ua.status===b.UA.C.STATUS_USER_CLOSED&&g instanceof b.IncomingRequest)&&g&&b.sanityCheck(g,this.ua,this))if(g instanceof b.IncomingRequest)g.transport=this,this.ua.receiveRequest(g);else if(g instanceof b.IncomingResponse)switch(g.method){case b.C.INVITE:(f=
this.ua.transactions.ict[g.via_branch])&&f.receiveResponse(g);break;case b.C.ACK:break;default:(f=this.ua.transactions.nict[g.via_branch])&&f.receiveResponse(g)}}},onError:function(b){console.warn(c+"WebSocket connection error: "+b)},reConnect:function(){var b=this;this.reconnection_attempts+=1;this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(console.warn(c+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(console.log(c+
"trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=k.setTimeout(function(){b.connect()},1E3*this.ua.configuration.ws_server_reconnection_timeout))}};h.C={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};b.Transport=h})(i);(function(b){var h=b.name+" | PARSER | ";b.Parser={parseMessage:function(c){var g,f,n,x,v=0;f=c.indexOf("\r\n");if(-1===f)console.warn(h+"no CRLF found, not a SIP message, discarded");else if(g=
c.substring(0,f),x=b.Grammar.parse(g,"Request_Response"),-1===x)console.warn(h+'error parsing first line of SIP message: "'+g+'"');else{x.status_code?(g=new b.IncomingResponse,g.status_code=x.status_code,g.reason_phrase=x.reason_phrase):(g=new b.IncomingRequest,g.method=x.method,g.ruri=x.uri);g.data=c;for(v=f+2;;){a:{f=c;x=v;var l=0,w=0;if(f.substring(x,x+2).match(/(^\r\n)/))f=-2;else{for(;0===l;){w=f.indexOf("\r\n",x);if(-1===w){f=w;break a}!f.substring(w+2,w+4).match(/(^\r\n)/)&&f.charAt(w+2).match(/(^\s+)/)?
x=w+2:l=w}f=l}}if(-2===f){n=v+2;break}else if(-1===f)return;x=g;var l=c,q=v,w=f,t=void 0,i=v=void 0,t=l.indexOf(":",q),q=l.substring(q,t).trim(),l=l.substring(t+1,w).trim();switch(q.toLowerCase()){case "via":case "v":x.addHeader("via",l);if(1===x.countHeader("via")){if(i=x.parseHeader("Via"))x.via=i,x.via_branch=i.branch}else i=0;break;case "from":case "f":x.setHeader("from",l);if(i=x.parseHeader("from"))x.from=i,x.from_tag=i.getParam("tag");break;case "to":case "t":x.setHeader("to",l);if(i=x.parseHeader("to"))x.to=
i,x.to_tag=i.getParam("tag");break;case "record-route":i=b.Grammar.parse(l,"Record_Route");-1===i&&(i=void 0);for(v in i)t=i[v],x.addHeader("record-route",l.substring(t.possition,t.offset)),x.headers["Record-Route"][x.countHeader("record-route")-1].parsed=t.parsed;break;case "call-id":case "i":x.setHeader("call-id",l);if(i=x.parseHeader("call-id"))x.call_id=l;break;case "contact":case "m":i=b.Grammar.parse(l,"Contact");-1===i&&(i=void 0);for(v in i)t=i[v],x.addHeader("contact",l.substring(t.possition,
t.offset)),x.headers.Contact[x.countHeader("contact")-1].parsed=t.parsed;break;case "content-length":case "l":x.setHeader("content-length",l);i=x.parseHeader("content-length");break;case "content-type":case "c":x.setHeader("content-type",l);i=x.parseHeader("content-type");break;case "cseq":x.setHeader("cseq",l);if(i=x.parseHeader("cseq"))x.cseq=i.value;x instanceof b.IncomingResponse&&(x.method=i.method);break;case "max-forwards":x.setHeader("max-forwards",l);i=x.parseHeader("max-forwards");break;
case "www-authenticate":x.setHeader("www-authenticate",l);i=x.parseHeader("www-authenticate");break;case "proxy-authenticate":x.setHeader("proxy-authenticate",l);i=x.parseHeader("proxy-authenticate");break;default:x.setHeader(q,l),i=0}x=void 0===i?!1:!0;if(!x)return;v=f+2}g.hasHeader("content-length")?(f=g.getHeader("content-length"),g.body=c.substr(n,f)):g.body=c.substring(n);return g}}}})(i);(function(b){var h,c,g,f,n=b.name+" | SIP MESSAGE | ";h=function(c,f,g,w,q,n){w=w||{};if(!c||!f||!g)return null;
this.headers={};this.method=c;this.ruri=f;this.body=n;this.extraHeaders=q||[];w.route_set?this.setHeader("route",w.route_set):g.configuration.use_preloaded_route&&this.setHeader("route",g.transport.server.sip_uri);this.setHeader("via","");this.setHeader("max-forwards",b.UA.C.MAX_FORWARDS);q=w.to_display_name||0===w.to_display_name?'"'+w.to_display_name+'" ':"";q+="<"+(w.to_uri||f)+">";q+=w.to_tag?";tag="+w.to_tag:"";this.to=new b.NameAddrHeader.parse(q);this.setHeader("to",q);f=w.from_display_name||
0===w.from_display_name?'"'+w.from_display_name+'" ':g.configuration.display_name?'"'+g.configuration.display_name+'" ':"";f+="<"+(w.from_uri||g.configuration.uri)+">;tag=";f+=w.from_tag||b.Utils.newTag();this.from=new b.NameAddrHeader.parse(f);this.setHeader("from",f);this.call_id=g=w.call_id||g.configuration.jssip_id+b.Utils.createRandomToken(15);this.setHeader("call-id",g);this.cseq=w=w.cseq||Math.floor(1E4*Math.random());this.setHeader("cseq",w+" "+c)};h.prototype={setHeader:function(c,f){this.headers[b.Utils.headerize(c)]=
f instanceof Array?f:[f]},toString:function(){var c,f,g;c=""+(this.method+" "+this.ruri+" SIP/2.0\r\n");for(f in this.headers)for(g in this.headers[f])c+=f+": "+this.headers[f][g]+"\r\n";f=this.extraHeaders.length;for(g=0;g<f;g++)c+=this.extraHeaders[g]+"\r\n";c+="Supported: "+b.UA.C.SUPPORTED+"\r\n";c+="User-Agent: "+b.C.USER_AGENT+"\r\n";this.body?(f=b.Utils.str_utf8_length(this.body),c=c+("Content-Length: "+f+"\r\n\r\n")+this.body):c+="Content-Length: 0\r\n\r\n";return c}};c=function(){this.body=
this.to_tag=this.to=this.from_tag=this.from=this.cseq=this.call_id=this.via_branch=this.via=this.method=this.headers=this.data=null};c.prototype={addHeader:function(c,f){var g={raw:f},c=b.Utils.headerize(c);this.headers[c]?this.headers[c].push(g):this.headers[c]=[g]},countHeader:function(c){return(c=this.headers[b.Utils.headerize(c)])?c.length:0},getHeader:function(c,f){var g=this.headers[b.Utils.headerize(c)],f=f||0;if(g&&g[f])return g[f].raw},getHeaderAll:function(c){var f,c=this.headers[b.Utils.headerize(c)],
g=[];if(!c)return[];for(f in c)g.push(c[f].raw);return g},hasHeader:function(c){return this.headers[b.Utils.headerize(c)]?!0:!1},parseHeader:function(c,f){var g,w,q,c=b.Utils.headerize(c),f=f||0;if(this.headers[c])if(f>=this.headers[c].length)console.log(n+'not so many "'+c+'" headers present');else{g=this.headers[c][f];w=g.raw;if(g.parsed)return g.parsed;q=b.Grammar.parse(w,c.replace(/-/g,"_"));if(-1===q)this.headers[c].splice(f,1),console.warn(n+'error parsing "'+c+'" header field with value "'+
w+'"');else return g.parsed=q}else console.log(n+'header "'+c+'" not present')},s:function(b,c){return this.parseHeader(b,c)},setHeader:function(c,f){var g={raw:f};this.headers[b.Utils.headerize(c)]=[g]},toString:function(){return this.data}};g=function(){this.headers={};this.server_transaction=this.transport=this.ruri=null};g.prototype=new c;g.prototype.reply=function(c,f,g,w,n,h){var i,p,r,k;r=this.getHeader("To");k=p=0;c=c||null;f=f||null;if(!c||100>c||699<c)throw new TypeError("Invalid status_code: "+
c);if(f&&"string"!==typeof f&&!(f instanceof String))throw new TypeError("Invalid reason_phrase: "+f);f=f||b.C.REASON_PHRASE[c]||"";g=g||[];f="SIP/2.0 "+c+" "+f+"\r\n";if(this.method===b.C.INVITE&&100<c&&200>=c){i=this.countHeader("record-route");for(p;p<i;p++)f+="Record-Route: "+this.getHeader("record-route",p)+"\r\n"}p=this.countHeader("via");for(k;k<p;k++)f+="Via: "+this.getHeader("via",k)+"\r\n";this.to_tag?this.to_tag&&!this.s("to").hasParam("tag")&&(r+=";tag="+this.to_tag):r+=";tag="+b.Utils.newTag();
f=f+("To: "+r+"\r\n")+("From: "+this.getHeader("From")+"\r\n");f+="Call-ID: "+this.call_id+"\r\n";f+="CSeq: "+this.cseq+" "+this.method+"\r\n";r=g.length;for(k=0;k<r;k++)f+=g[k]+"\r\n";f+="Supported: "+b.UA.C.SUPPORTED+"\r\n";w?(r=b.Utils.str_utf8_length(w),f=f+"Content-Type: application/sdp\r\n"+("Content-Length: "+r+"\r\n\r\n")+w):f+="Content-Length: 0\r\n\r\n";this.server_transaction.receiveResponse(c,f,n,h)};g.prototype.reply_sl=function(c,f){var g,w;g=this.countHeader("via");c=c||null;f=f||null;
if(!c||100>c||699<c)throw new TypeError("Invalid status_code: "+c);if(f&&"string"!==typeof f&&!(f instanceof String))throw new TypeError("Invalid reason_phrase: "+f);f=f||b.C.REASON_PHRASE[c]||"";w="SIP/2.0 "+c+" "+f+"\r\n";for(var n=0;n<g;n++)w+="Via: "+this.getHeader("via",n)+"\r\n";g=this.getHeader("To");this.to_tag?this.to_tag&&!this.s("to").hasParam("tag")&&(g+=";tag="+this.to_tag):g+=";tag="+b.Utils.newTag();w=w+("To: "+g+"\r\n")+("From: "+this.getHeader("From")+"\r\n");w+="Call-ID: "+this.call_id+
"\r\n";w+="CSeq: "+this.cseq+" "+this.method+"\r\n";this.transport.send(w+"Content-Length: 0\r\n\r\n")};f=function(){this.headers={};this.reason_phrase=this.status_code=null};f.prototype=new c;b.OutgoingRequest=h;b.IncomingRequest=g;b.IncomingResponse=f})(i);(function(b){var h;h=function(c,g,f,n,h,i){var l,w;if(!f)throw new TypeError('missing or invalid "host" parameter');c=c||b.C.SIP;this.parameters={};this.headers={};for(l in h)this.setParam(l,h[l]);for(w in i)this.setHeader(w,i[w]);Object.defineProperties(this,
{scheme:{get:function(){return c},set:function(b){c=b.toLowerCase()}},user:{get:function(){return g},set:function(b){g=b}},host:{get:function(){return f},set:function(b){f=b.toLowerCase()}},port:{get:function(){return n},set:function(b){n=0===b?b:parseInt(b,10)||null}}})};h.prototype={setParam:function(b,g){b&&(this.parameters[b.toLowerCase()]="undefined"===typeof g||null===g?null:g.toString().toLowerCase())},getParam:function(b){if(b)return this.parameters[b.toLowerCase()]},hasParam:function(b){if(b)return this.parameters.hasOwnProperty(b.toLowerCase())&&
!0||!1},deleteParam:function(b){var g,b=b.toLowerCase();if(this.parameters.hasOwnProperty(b))return g=this.parameters[b],delete this.parameters[b],g},clearParams:function(){this.parameters={}},setHeader:function(c,g){this.headers[b.Utils.headerize(c)]=g instanceof Array?g:[g]},getHeader:function(c){if(c)return this.headers[b.Utils.headerize(c)]},hasHeader:function(c){if(c)return this.headers.hasOwnProperty(b.Utils.headerize(c))&&!0||!1},deleteHeader:function(c){var g,c=b.Utils.headerize(c);if(this.headers.hasOwnProperty(c))return g=
this.headers[c],delete this.headers[c],g},clearHeaders:function(){this.headers={}},clone:function(){return new h(this.scheme,this.user,this.host,this.port,k.JSON.parse(k.JSON.stringify(this.parameters)),k.JSON.parse(k.JSON.stringify(this.headers)))},toString:function(){var c,g,f,n,h=[];n=this.scheme+":";this.user&&(n+=b.Utils.escapeUser(this.user)+"@");n+=this.host;if(this.port||0===this.port)n+=":"+this.port;for(g in this.parameters)n+=";"+g,null!==this.parameters[g]&&(n+="="+this.parameters[g]);
for(c in this.headers)for(f in this.headers[c])h.push(c+"="+this.headers[c][f]);0<h.length&&(n+="?"+h.join("&"));return n},toAor:function(c){var g;g=this.scheme+":";this.user&&(g+=b.Utils.escapeUser(this.user)+"@");g+=this.host;if(c&&(this.port||0===this.port))g+=":"+this.port;return g}};h.parse=function(c){c=b.Grammar.parse(c,"SIP_URI");if(-1!==c)return c};b.URI=h})(i);(function(b){var h;h=function(c,g,f){var n;if(!c||!(c instanceof b.URI))throw new TypeError('missing or invalid "uri" parameter');
this.uri=c;this.parameters={};for(n in f)this.setParam(n,f[n]);Object.defineProperties(this,{display_name:{get:function(){return g},set:function(b){g=0===b?"0":b}}})};h.prototype={setParam:function(b,g){b&&(this.parameters[b.toLowerCase()]="undefined"===typeof g||null===g?null:g.toString())},getParam:function(b){if(b)return this.parameters[b.toLowerCase()]},hasParam:function(b){if(b)return this.parameters.hasOwnProperty(b.toLowerCase())&&!0||!1},deleteParam:function(b){var g,b=b.toLowerCase();if(this.parameters.hasOwnProperty(b))return g=
this.parameters[b],delete this.parameters[b],g},clearParams:function(){this.parameters={}},clone:function(){return new h(this.uri.clone(),this.display_name,k.JSON.parse(k.JSON.stringify(this.parameters)))},toString:function(){var b,g;b=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"";b+="<"+this.uri.toString()+">";for(g in this.parameters)b+=";"+g,null!==this.parameters[g]&&(b+="="+this.parameters[g]);return b}};h.parse=function(c){c=b.Grammar.parse(c,"Name_Addr_Header");if(-1!==
c)return c};b.NameAddrHeader=h})(i);(function(b){var h,c=b.name+" | TRANSACTION | ",g={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};h={};var f=function(){this.init=function(b,c,f){this.transport=f;this.id="z9hG4bK"+Math.floor(1E7*Math.random());this.request_sender=b;this.request=c;c="SIP/2.0/"+(b.ua.configuration.hack_via_tcp?"TCP":f.server.scheme);c+=" "+b.ua.configuration.via_host+";branch="+this.id;this.request.setHeader("via",
c)}},n=function(){this.send=function(){var c=this;this.state=g.STATUS_TRYING;this.F=k.setTimeout(function(){c.timer_F()},b.Timers.TIMER_F);if(!this.transport.send(this.request))this.onTransportError()};this.onTransportError=function(){console.log(c+"transport error occurred, deleting non-INVITE client transaction "+this.id);k.clearTimeout(this.F);k.clearTimeout(this.K);delete this.request_sender.ua.transactions.nict[this.id];this.request_sender.onTransportError()};this.timer_F=function(){console.log(c+
"Timer F expired for non-INVITE client transaction "+this.id);this.state=g.STATUS_TERMINATED;this.request_sender.onRequestTimeout();delete this.request_sender.ua.transactions.nict[this.id]};this.timer_K=function(){this.state=g.STATUS_TERMINATED;delete this.request_sender.ua.transactions.nict[this.id]};this.receiveResponse=function(c){var f=this,l=c.status_code;if(200>l)switch(this.state){case g.STATUS_TRYING:case g.STATUS_PROCEEDING:this.state=g.STATUS_PROCEEDING,this.request_sender.receiveResponse(c)}else switch(this.state){case g.STATUS_TRYING:case g.STATUS_PROCEEDING:this.state=
g.STATUS_COMPLETED;k.clearTimeout(this.F);if(408===l)this.request_sender.onRequestTimeout();else this.request_sender.receiveResponse(c);this.K=k.setTimeout(function(){f.timer_K()},b.Timers.TIMER_K)}}};n.prototype=new f;var x=function(){this.send=function(){var c=this;this.state=g.STATUS_CALLING;this.B=k.setTimeout(function(){c.timer_B()},b.Timers.TIMER_B);if(!this.transport.send(this.request))this.onTransportError()};this.onTransportError=function(){console.log(c+"transport error occurred, deleting INVITE client transaction "+
this.id);k.clearTimeout(this.B);k.clearTimeout(this.D);k.clearTimeout(this.M);delete this.request_sender.ua.transactions.ict[this.id];this.request_sender.onTransportError()};this.timer_M=function(){console.log(c+"Timer M expired for INVITE client transaction "+this.id);this.state===g.STATUS_ACCEPTED&&(this.state=g.STATUS_TERMINATED,k.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])};this.timer_B=function(){console.log(c+"Timer B expired for INVITE client transaction "+
this.id);this.state===g.STATUS_CALLING&&(this.state=g.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])};this.timer_D=function(){console.log(c+"Timer D expired for INVITE client transaction "+this.id);this.state=g.STATUS_TERMINATED;k.clearTimeout(this.B);delete this.request_sender.ua.transactions.ict[this.id]};this.sendACK=function(c){var f=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n";this.ack+="Via: "+this.request.headers.Via.toString()+
"\r\n";this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n");this.ack+="To: "+c.getHeader("to")+"\r\n";this.ack+="From: "+this.request.headers.From.toString()+"\r\n";this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n";this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0];this.ack+=" ACK\r\n\r\n";this.D=k.setTimeout(function(){f.timer_D()},b.Timers.TIMER_D);this.transport.send(this.ack)};this.cancel_request=function(c,f){var l=
c.request;this.cancel=b.C.CANCEL+" "+l.ruri+" SIP/2.0\r\n";this.cancel+="Via: "+l.headers.Via.toString()+"\r\n";this.request.headers.Route&&(this.cancel+="Route: "+l.headers.Route.toString()+"\r\n");this.cancel+="To: "+l.headers.To.toString()+"\r\n";this.cancel+="From: "+l.headers.From.toString()+"\r\n";this.cancel+="Call-ID: "+l.headers["Call-ID"].toString()+"\r\n";this.cancel+="CSeq: "+l.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n";f&&(this.cancel+="Reason: "+f+"\r\n");this.cancel+="Content-Length: 0\r\n\r\n";
this.state===g.STATUS_PROCEEDING&&this.transport.send(this.cancel)};this.receiveResponse=function(c){var f=this,l=c.status_code;if(100<=l&&199>=l)switch(this.state){case g.STATUS_CALLING:this.state=g.STATUS_PROCEEDING;this.request_sender.receiveResponse(c);this.cancel&&this.transport.send(this.cancel);break;case g.STATUS_PROCEEDING:this.request_sender.receiveResponse(c)}else if(200<=l&&299>=l)switch(this.state){case g.STATUS_CALLING:case g.STATUS_PROCEEDING:this.state=g.STATUS_ACCEPTED;this.M=k.setTimeout(function(){f.timer_M()},
b.Timers.TIMER_M);this.request_sender.receiveResponse(c);break;case g.STATUS_ACCEPTED:this.request_sender.receiveResponse(c)}else if(300<=l&&699>=l)switch(this.state){case g.STATUS_CALLING:case g.STATUS_PROCEEDING:this.state=g.STATUS_COMPLETED;this.sendACK(c);this.request_sender.receiveResponse(c);break;case g.STATUS_COMPLETED:this.sendACK(c)}}};x.prototype=new f;var f=function(){this.init=function(b,c){this.id=b.via_branch;this.request=b;this.transport=b.transport;this.ua=c;this.last_response="";
b.server_transaction=this}},i=function(){this.timer_J=function(){console.log(c+"Timer J expired for non-INVITE server transaction "+this.id);this.state=g.STATUS_TERMINATED;delete this.ua.transactions.nist[this.id]};this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(c+"transport error occurred, deleting non-INVITE server transaction "+this.id),k.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])};this.receiveResponse=function(c,f,l,n){var h=this;
if(100===c)switch(this.state){case g.STATUS_TRYING:this.state=g.STATUS_PROCEEDING;if(!this.transport.send(f))this.onTransportError();break;case g.STATUS_PROCEEDING:this.last_response=f,this.transport.send(f)?l&&l():(this.onTransportError(),n&&n())}else if(200<=c&&699>=c)switch(this.state){case g.STATUS_TRYING:case g.STATUS_PROCEEDING:this.state=g.STATUS_COMPLETED,this.last_response=f,this.J=k.setTimeout(function(){h.timer_J()},b.Timers.TIMER_J),this.transport.send(f)?l&&l():(this.onTransportError(),
n&&n())}}};i.prototype=new f;var l=function(){this.timer_H=function(){console.log(c+"Timer H expired for INVITE server transaction "+this.id);this.state===g.STATUS_COMPLETED&&(console.warn(c+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=g.STATUS_TERMINATED);delete this.ua.transactions.ist[this.id]};this.timer_I=function(){this.state=g.STATUS_TERMINATED;delete this.ua.transactions.ist[this.id]};this.timer_L=function(){console.log(c+"Timer L expired for INVITE server transaction "+
this.id);this.state===g.STATUS_ACCEPTED&&(this.state=g.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])};this.onTransportError=function(){this.transportError||(this.transportError=!0,console.log(c+"transport error occurred, deleting INVITE server transaction "+this.id),k.clearTimeout(this.reliableProvisionalTimer),k.clearTimeout(this.L),k.clearTimeout(this.H),k.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])};this.timer_reliableProvisional=function(c){var f=this,g=this.last_response,
l=b.Timers.T1*Math.pow(2,c+1);if(8<c)k.clearTimeout(this.reliableProvisionalTimer);else{c+=1;if(!this.transport.send(g))this.onTransportError();this.reliableProvisionalTimer=k.setTimeout(function(){f.timer_reliableProvisional(c)},l)}};this.receiveResponse=function(c,f,l,n){var h=this;if(100<=c&&199>=c)switch(this.state){case g.STATUS_PROCEEDING:if(!this.transport.send(f))this.onTransportError();this.last_response=f}if(!(100<c&&199>=c))if(200<=c&&299>=c)switch(this.state){case g.STATUS_PROCEEDING:this.state=
g.STATUS_ACCEPTED,this.last_response=f,this.L=k.setTimeout(function(){h.timer_L()},b.Timers.TIMER_L),k.clearTimeout(this.reliableProvisionalTimer);case g.STATUS_ACCEPTED:this.transport.send(f)?l&&l():(this.onTransportError(),n&&n())}else if(300<=c&&699>=c)switch(this.state){case g.STATUS_PROCEEDING:k.clearTimeout(this.reliableProvisionalTimer),this.transport.send(f)?(this.state=g.STATUS_COMPLETED,this.H=k.setTimeout(function(){h.timer_H()},b.Timers.TIMER_H),l&&l()):(this.onTransportError(),n&&n())}}};
l.prototype=new f;h.NonInviteClientTransaction=function(b,c,f){this.init(b,c,f);this.request_sender.ua.transactions.nict[this.id]=this};h.NonInviteClientTransaction.prototype=new n;h.InviteClientTransaction=function(b,c,f){var g=this;this.init(b,c,f);this.request_sender.ua.transactions.ict[this.id]=this;this.request.cancel=function(b){g.cancel_request(g,b)}};h.InviteClientTransaction.prototype=new x;h.AckClientTransaction=function(b,c,f){this.init(b,c,f);this.send=function(){this.transport.send(c)}};
h.AckClientTransaction.prototype=new n;h.NonInviteServerTransaction=function(b,c){this.init(b,c);this.state=g.STATUS_TRYING;c.transactions.nist[this.id]=this};h.NonInviteServerTransaction.prototype=new i;h.InviteServerTransaction=function(b,c){this.init(b,c);this.state=g.STATUS_PROCEEDING;c.transactions.ist[this.id]=this;this.reliableProvisionalTimer=null;b.reply(100)};h.InviteServerTransaction.prototype=new l;h.checkTransaction=function(c,f){var l;switch(f.method){case b.C.INVITE:if(l=c.transactions.ist[f.via_branch]){switch(l.state){case g.STATUS_PROCEEDING:l.transport.send(l.last_response)}return!0}break;
case b.C.ACK:if(l=c.transactions.ist[f.via_branch]){if(l.state===g.STATUS_ACCEPTED)return!1;if(l.state===g.STATUS_COMPLETED)return l.state=g.STATUS_CONFIRMED,l.I=k.setTimeout(function(){l.timer_I()},b.Timers.TIMER_I),!0}else return!1;break;case b.C.CANCEL:if(l=c.transactions.ist[f.via_branch])return l.state===g.STATUS_PROCEEDING?!1:!0;f.reply_sl(481);return!0;default:if(l=c.transactions.nist[f.via_branch]){switch(l.state){case g.STATUS_PROCEEDING:case g.STATUS_COMPLETED:l.transport.send(l.last_response)}return!0}}};
h.C=g;b.Transactions=h})(i);(function(b){var h,c=b.name+" | DIALOG | ",g={STATUS_EARLY:1,STATUS_CONFIRMED:2};h=function(f,n,h,i){var l;if(!n.hasHeader("contact"))return console.error(c+"unable to create a Dialog without Contact header field"),!1;i=n instanceof b.IncomingResponse?200>n.status_code?g.STATUS_EARLY:g.STATUS_CONFIRMED:i||g.STATUS_CONFIRMED;l=n.parseHeader("contact");"UAS"===h?(this.id={call_id:n.call_id,local_tag:n.to_tag,remote_tag:n.from_tag,toString:function(){return this.call_id+this.local_tag+
this.remote_tag}},this.state=i,this.remote_seqnum=n.cseq,this.local_uri=n.parseHeader("to").uri,this.remote_uri=n.parseHeader("from").uri,this.remote_target=l.uri,this.route_set=n.getHeaderAll("record-route")):"UAC"===h&&(this.id={call_id:n.call_id,local_tag:n.from_tag,remote_tag:n.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=i,this.local_seqnum=n.cseq,this.local_uri=n.parseHeader("from").uri,this.remote_uri=n.parseHeader("to").uri,this.remote_target=
l.uri,this.route_set=n.getHeaderAll("record-route").reverse());this.session=f;f.ua.dialogs[this.id.toString()]=this;console.log(c+"new "+h+" dialog created with status "+(this.state===g.STATUS_EARLY?"EARLY":"CONFIRMED"))};h.prototype={update:function(b,n){this.state=g.STATUS_CONFIRMED;console.log(c+"dialog "+this.id.toString()+"  changed to CONFIRMED state");"UAC"===n&&(this.route_set=b.getHeaderAll("record-route").reverse())},terminate:function(){console.log(c+"dialog "+this.id.toString()+" deleted");
delete this.session.ua.dialogs[this.id.toString()]},createRequest:function(c,g){var h,g=g||[];this.local_seqnum||(this.local_seqnum=Math.floor(1E4*Math.random()));h=c===b.C.CANCEL||c===b.C.ACK?this.local_seqnum:this.local_seqnum+=1;h=new b.OutgoingRequest(c,this.remote_target,this.session.ua,{cseq:h,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},g);h.dialog=this;return h},checkInDialogRequest:function(c){this.remote_seqnum?
c.cseq>this.remote_seqnum&&(this.remote_seqnum=c.cseq):this.remote_seqnum=c.cseq;switch(c.method){case b.C.INVITE:if(c.cseq<this.remote_seqnum){if(this.state===g.STATUS_EARLY){var n=(10*Math.random()|0)+1;c.reply(500,null,["Retry-After:"+n])}else c.reply(500);return!1}if(this.session&&this.session.isMcu)break;if(this.state===g.STATUS_EARLY)return c.reply(491),!1;c.hasHeader("contact")&&(this.remote_target=c.parseHeader("contact").uri);break;case b.C.NOTIFY:c.hasHeader("contact")&&(this.remote_target=
c.parseHeader("contact").uri)}return!0},receiveRequest:function(b){this.checkInDialogRequest(b)&&this.session.receiveRequest(b)}};h.C=g;b.Dialog=h})(i);(function(b){var h,c=b.name+" | REQUEST SENDER | ";h=function(c,f){this.ua=f;this.applicant=c;this.method=c.request.method;this.request=c.request;this.credentials=null;this.staled=this.challenged=!1;if(f.status===b.UA.C.STATUS_USER_CLOSED&&(this.method!==b.C.BYE||this.method!==b.C.ACK))this.onTransportError()};h.prototype={send:function(){switch(this.method){case "INVITE":this.clientTransaction=
new b.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case "ACK":this.clientTransaction=new b.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new b.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(g){var f,
n;n=g.status_code;(401===n||407===n)&&null!==this.ua.configuration.password?(401===g.status_code?(f=g.parseHeader("www-authenticate"),n="authorization"):(f=g.parseHeader("proxy-authenticate"),n="proxy-authorization"),f)?!this.challenged||!this.staled&&!0===f.stale?(this.credentials||(this.credentials=new b.DigestAuthentication(this.ua)),this.credentials.authenticate(this.request,f))?(this.challenged=!0,f.stale&&(this.staled=!0),g.method===b.C.REGISTER?g=this.applicant.cseq+=1:this.request.dialog?
g=this.request.dialog.local_seqnum+=1:(g=this.request.cseq+1,this.request.cseq=g),this.request.setHeader("cseq",g+" "+this.method),this.request.setHeader(n,this.credentials.toString()),this.send()):this.applicant.receiveResponse(g):this.applicant.receiveResponse(g):(console.warn(c+g.status_code+" with wrong or missing challenge, cannot authenticate"),this.applicant.receiveResponse(g)):this.applicant.receiveResponse(g)}};b.RequestSender=h})(i);(function(b){var h;h=function(b){this.applicant=b;this.request=
b.request};h.prototype={send:function(){(new b.RequestSender(this,this.applicant.session.ua)).send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout();this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError();this.applicant.onTransportError()},receiveResponse:function(c){(408===c.status_code||481===c.status_code)&&this.applicant.session.ended("remote",c,b.C.causes.DIALOG_ERROR);this.applicant.receiveResponse(c)}};b.InDialogRequestSender=
h})(i);(function(b){var h,c=b.name+" | REGISTRATOR | ";h=function(c,f){this.ua=c;this.transport=f;this.registrar=c.configuration.registrar_server;this.expires=c.configuration.register_expires;this.min_expires=c.configuration.register_min_expires;this.call_id=b.Utils.createRandomToken(22);this.cseq=80;this.to_uri=c.configuration.uri;this.registrationTimer=null;this.registered=this.registered_before=!1;this.ua.registrator=this;this.contact=this.ua.contact.toString();this.contact+=";reg-id=1";this.contact+=
';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"'};h.prototype={register:function(g){var f,n=this,g=g||{},g=g.extraHeaders||[];g.push("Contact: "+this.contact+";expires="+this.expires);g.push("Allow: "+b.Utils.getAllowedMethods(this.ua));this.request=new b.OutgoingRequest(b.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},g);g=new b.RequestSender(this,this.ua);this.receiveResponse=function(g){var h,l,w=g.countHeader("contact");if(g.cseq===
this.cseq)switch(!0){case /^1[0-9]{2}$/.test(g.status_code):break;case /^2[0-9]{2}$/.test(g.status_code):g.hasHeader("expires")&&(l=g.getHeader("expires"));if(!w){console.warn(c+"no Contact header in response to REGISTER, response ignored");break}for(;w--;)if(h=g.parseHeader("contact",w),h.uri.user===this.ua.contact.uri.user){l=h.getParam("expires");break}else h=null;if(!h){console.warn(c+"no Contact header pointing to us, response ignored");break}l||(l=this.expires);this.registrationTimer=k.setTimeout(function(){n.register()},
1E3*l-3E3);h.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=h.getParam("temp-gruu").replace(/"/g,""));h.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=h.getParam("pub-gruu").replace(/"/g,""));this.registered=!0;this.ua.emit("registered",this.ua,{response:g});break;case /^423$/.test(g.status_code):g.hasHeader("min-expires")?(g=g.getHeader("min-expires"),l=g-this.expires,this.registrationTimer=k.setTimeout(function(){n.register()},1E3*this.expires)):(console.warn(c+"423 response received for REGISTER without Min-Expires"),
this.registrationFailure(g,b.C.causes.SIP_FAILURE_CODE));break;default:f=b.Utils.sipErrorCause(g.status_code),this.registrationFailure(g,f)}};this.onRequestTimeout=function(){this.registrationFailure(null,b.C.causes.REQUEST_TIMEOUT)};this.onTransportError=function(){this.registrationFailure(null,b.C.causes.CONNECTION_ERROR)};g.send()},unregister:function(g){var f;this.registered?(g=g||{},f=g.extraHeaders||[],this.registered=!1,k.clearTimeout(this.registrationTimer),g.all?(f.push("Contact: *"),f.push("Expires: 0")):
f.push("Contact: "+this.contact+";expires=0"),this.request=new b.OutgoingRequest(b.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},f),g=new b.RequestSender(this,this.ua),this.receiveResponse=function(c){var f;switch(true){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):this.unregistered(c);break;default:f=b.Utils.sipErrorCause(c.status_code);this.unregistered(c,f)}},this.onRequestTimeout=function(){this.unregistered(null,
b.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,b.C.causes.CONNECTION_ERROR)},g.send()):console.warn(c+"already unregistered")},registrationFailure:function(b,c){this.ua.emit("registrationFailed",this.ua,{response:b||null,cause:c});this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:b||null,cause:c}))},unregistered:function(b,c){this.registered=!1;this.ua.emit("unregistered",this.ua,{response:b||null,cause:c||null})},onTransportClosed:function(){this.registered_before=
this.registered;k.clearTimeout(this.registrationTimer);this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered;this.unregister()}};b.Registrator=h})(i);(function(b){var h=function(b){var c=function(c,f){this.applicant=c;this.request=f||c.request;this.session=c instanceof b.RTCSession?c:c.session;this.reattempt=!1;this.reatemptTimer=null;this.request_sender=new b.InDialogRequestSender(this)};
c.prototype={receiveResponse:function(c){var f=this,g=c.status_code;c.method===b.C.INVITE&&491===g?this.reattempt?this.applicant.receiveResponse(c):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=k.setTimeout(function(){f.session.status!==b.RTCSession.C.STATUS_TERMINATED&&(f.reattempt=!0,f.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(c)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},
onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}};return c}(b),c=function(b){var c=function(b,c){c=c||{};this.session=b;this.peerConnection=this.localMedia=null;this.init(c)};c.prototype={createOffer:function(b,c,f){var g=this,l=!1;g.offerMediaOptions=f;this.onIceCompleted=function(){if(!l){l=!0;if(g.offerMediaOptions)b(g.mSdp);else{var c=g.peerConnection.localDescription.sdp;
-1!==c.indexOf("tcp")&&(c=c.replace(/a=candidate.*tcp.*\r\n/g,""),c=c.replace(/Content-Length.*\r\n/,"Content-Length= "+c.length+"\r\n"));b(c)}console.log("peerConnetcion.localDescription")}};this.peerConnection.createOffer(function(b){g.setLocalDescription(b,c)},function(b){console.error(n+"unable to create offer");console.error(b);c()})},createAnswer:function(b,c){var f=this,g=!1;this.onIceCompleted=function(){g||(g=!0,b(f.peerConnection.localDescription.sdp))};this.peerConnection.createAnswer(function(b){f.setRemoteDescription(b,
c)},function(b){console.error(n+"unable to create answer");console.error(b);c()})},setLocalDescription:function(b,c){var f=b.sdp;this.offerMediaOptions&&this.offerMediaOptions.video.width&&this.offerMediaOptions.video.height&&-1!=b.sdp.search("VP[89]")&&(f=f.replace(/(a=rtpmap:(\d*) VP[89]\/90000\r\n)/,"$1a=fmtp:$2 max-fr="+this.offerMediaOptions.video.framerate+"; max-fs="+this.offerMediaOptions.video.width*this.offerMediaOptions.video.height/256+"\r\n"),this.mSdp=b.sdp=f);-1!==f.indexOf("UDP/TLS/RTP/SAVPF")&&
(f=f.replace(/UDP\/TLS\/RTP\/SAVPF/g,"RTP/SAVPF"),this.mSdp=b.sdp=f);this.peerConnection.setLocalDescription(b,function(){console.log("Set localDscription success")},function(b){console.error(n+"unable to set local description");console.error(b);c()})},setRemoteDescription:function(b,c){this.peerConnection.setLocalDescription(b,function(){console.log("Create Answer")},function(b){console.error(n+"unable to set remote description");console.error(b);c()})},addStream:function(b,c,f){try{this.peerConnection.addStream(b)}catch(g){console.error(n+
"error adding stream");console.error(g);f();return}c()},init:function(c){var f,g,l,h,i=null,x=this,k=[];for(f in this.session.ua.configuration.stun_servers)g=this.session.ua.configuration.stun_servers[f],h=g.server,l=h.substr(0,h.indexOf(":")),k.push({url:l+":"+g.username+"@"+h.substr(l.length+1),credential:g.password}),console.log(n+"iceServers : "+g.server);for(f in this.session.ua.configuration.turn_servers)g=this.session.ua.configuration.turn_servers[f],h=g.server,l=h.substr(0,h.indexOf(":")),
k.push({url:l+":"+g.username+"@"+h.substr(l.length+1),credential:g.password});this.peerConnection="undefined"!==typeof mozRTCPeerConnection?new b.WebRTC.RTCPeerConnection(k,c):new b.WebRTC.RTCPeerConnection({iceServers:k,RTCBundlePolicy:"max-bundle",RTCIceTransportPolicy:"relay"},c);this.peerConnection.onaddstream=function(b){console.log(n+"stream added: "+b.stream.id)};this.peerConnection.onremovestream=function(b){console.log(n+"stream removed: "+b.stream.id)};this.peerConnection.onicecandidate=
function(b){console.log(b.candidate);b.candidate?(console.log(n+"ICE candidate received: "+b.candidate.candidate),null==i&&(i=setTimeout(function(){console.log("ice gathering timeout !");x.onIceCompleted()},500))):(x.onIceCompleted(),clearTimeout(i))};this.peerConnection.onicegatheringstatechange=function(){console.log(n+'ICE gathering state changed to "'+this.iceGatheringState+'"')};this.peerConnection.oniceconnectionstatechange=function(){console.log(n+'ICE connection state changed to "'+this.iceConnectionState+
'"')};this.peerConnection.onconnectionstatechange=function(){console.log(n+'PeerConnection state changed to "'+this.connectionState+'"')}},close:function(){console.log(n+"closing PeerConnection");this.peerConnection&&(this.peerConnection.close(),this.localMedia&&this.localMedia.active&&(0<this.localMedia.getAudioTracks().length&&this.localMedia.getAudioTracks()[0].stop(),0<this.localMedia.getVideoTracks().length&&this.localMedia.getVideoTracks()[0].stop()))},getUserMedia:function(c,f,g){var l=this;
console.log(n+"requesting access to local media");g&&g.screen?getScreenId(function(h,i,x){g.multi&&(x.video.mandatory.maxWidth=g.video.mandatory.maxWidth,x.video.mandatory.maxHeight=g.video.mandatory.maxHeight,delete g.multi);b.WebRTC.getUserMedia(x,function(b){console.log(n+"got local media stream");l.localMedia=b;c(b)},function(b){alert(JSON.stringify(b,null,"\t"));console.error(n+"unable to get user media");console.error(e);f()})}):(delete g.screen,b.WebRTC.getUserMedia(g,function(b){console.log(n+
"got local media stream");l.localMedia=b;c(b)},function(b){console.error(n+"unable to get user media");console.error(b);f()}))},onMessage:function(c,f,g,l){this.peerConnection.setRemoteDescription(new b.WebRTC.RTCSessionDescription({type:c,sdp:f}),g,l)}};return c}(b),g=function(b){var c,f={MIN_DURATION:70,MAX_DURATION:6E3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};c=function(b){this.session=b;this.duration=this.tone=this.direction=null;this.initEvents(["succeeded","failed"])};
c.prototype=new b.EventEmitter;c.prototype.send=function(c,g){var l,i,x;if(void 0===c)throw new TypeError("Not enough arguments");this.direction="outgoing";if(this.session.status!==b.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==b.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.session.status);g=g||{};x=g.extraHeaders?g.extraHeaders.slice():[];i=g.eventHandlers||{};if("string"===typeof c)c=c.toUpperCase();else if("number"===typeof c)c=c.toString();else throw new TypeError("Invalid tone: "+
c);if(c.match(/^[0-9A-D#*]$/))this.tone=c;else throw new TypeError("Invalid tone: "+c);if(g.duration&&!b.Utils.isDecimal(g.duration))throw new TypeError("Invalid tone duration: "+g.duration);g.duration?g.duration<f.MIN_DURATION?(console.warn(n+'"duration" value is lower than the minimum allowed, setting it to '+f.MIN_DURATION+" milliseconds"),g.duration=f.MIN_DURATION):g.duration>f.MAX_DURATION?(console.warn(n+'"duration" value is greater than the maximum allowed, setting it to '+f.MAX_DURATION+" milliseconds"),
g.duration=f.MAX_DURATION):g.duration=Math.abs(g.duration):g.duration=f.DEFAULT_DURATION;this.duration=g.duration;for(l in i)this.on(l,i[l]);x.push("Content-Type: application/dtmf-relay");this.request=this.session.dialog.createRequest(b.C.INFO,x);this.request.body="Signal= "+this.tone+"\r\n";this.request.body+="Duration= "+this.duration;l=new h(this);this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request});l.send()};c.prototype.receiveResponse=function(c){var f;
switch(!0){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):this.emit("succeeded",this,{originator:"remote",response:c});break;default:f=b.Utils.sipErrorCause(c.status_code),this.emit("failed",this,{originator:"remote",response:c,cause:f})}};c.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:b.C.causes.REQUEST_TIMEOUT})};c.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:b.C.causes.CONNECTION_ERROR})};
c.prototype.init_incoming=function(b){var c,f=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,g=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming";this.request=b;b.reply(200);if(b.body&&(c=b.body.split("\r\n"),2===c.length&&(f.test(c[0])&&(this.tone=c[0].replace(f,"$2")),g.test(c[1]))))this.duration=parseInt(c[1].replace(g,"$2"),10);!this.tone||!this.duration?console.warn(n+"invalid INFO DTMF received, discarded"):this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:b})};
c.C=f;return c}(b),f,n=b.name+" | RTC SESSION | ",i={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_WAITING_FOR_ACK:5,STATUS_CANCELED:6,STATUS_TERMINATED:7,STATUS_CONFIRMED:8};f=function(b){this.ua=b;this.status=i.STATUS_NULL;this.dialog=null;this.earlyDialogs=[];this.rtcMediaHandler=null;this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null,updateTimer:null};this.end_time=this.start_time=this.remote_identity=
this.local_identity=this.direction=null;this.data={};this.initEvents("progress,failed,started,ended,newDTMF,startRecordLocal,endRecordLocal,startRecordRemote,endRecordRemote".split(","))};f.prototype=new b.EventEmitter;f.prototype.terminate=function(c){var c=c||{},f,g=c.status_code,h=c.reason_phrase,t=c.extraHeaders||[],k=c.body;if(this.status===i.STATUS_TERMINATED)throw new b.Exceptions.InvalidStateError(this.status);switch(this.status){case i.STATUS_NULL:case i.STATUS_INVITE_SENT:case i.STATUS_1XX_RECEIVED:console.log(n+
"canceling RTCSession");if(g&&(200>g||700<=g))throw new TypeError("Invalid status_code: "+g);g&&(h=h||b.C.REASON_PHRASE[g]||"",f="SIP ;cause="+g+' ;text="'+h+'"');this.status===i.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=f):this.status===i.STATUS_INVITE_SENT?this.received_100?this.request.cancel(f):(this.isCanceled=!0,this.cancelReason=f):this.status===i.STATUS_1XX_RECEIVED&&this.request.cancel(f);this.failed("local",null,b.C.causes.CANCELED);break;case i.STATUS_WAITING_FOR_ANSWER:console.log(n+
"rejecting RTCSession");g=g||603;if(300>g||700<=g)throw new TypeError("Invalid status_code: "+g);this.request.reply(g,h,t,k);this.failed("local",null,b.C.causes.REJECTED);break;case i.STATUS_WAITING_FOR_ACK:case i.STATUS_CONFIRMED:console.log(n+"terminating RTCSession"),this.sendBye(c),this.ended("local",null,b.C.causes.BYE)}c.unNormal&&!0==c.unNormal&&this.ua.unregister();this.close()};f.prototype.answer=function(c){var c=c||{},f=this,g=this.request,h=c.extraHeaders||[],t=c.mediaConstraints||{audio:!0,
video:!0},y=function(){f.isMcu?"video"==f.roomInfo.remoteMedia&&t.video?f.rtcMediaHandler.createOffer(r,o,{audio:{},video:{width:640,height:480,framerate:30}}):f.rtcMediaHandler.createOffer(r,o):f.rtcMediaHandler.createAnswer(r,o,t)},p=function(){f.status!==i.STATUS_TERMINATED&&f.failed("local",null,b.C.causes.WEBRTC_ERROR)},r=function(c){h.push("Contact: "+f.contact);h.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uac");h.push("Allow: "+b.Utils.getAllowedMethods(f.ua));g.reply(200,null,h,
c,function(){f.status=i.STATUS_WAITING_FOR_ACK;f.timers.invite2xxTimer=k.setTimeout(function F(h){var h=h||1,n=b.Timers.T1*Math.pow(2,h);h*b.Timers.T1<=b.Timers.T2?(h+=1,g.reply(200,null,["Contact: "+f.contact],c),f.timers.invite2xxTimer=k.setTimeout(F(h),n)):k.clearTimeout(f.timers.invite2xxTimer)},b.Timers.T1);f.timers.ackTimer=k.setTimeout(function(){f.status===i.STATUS_WAITING_FOR_ACK&&(console.log(n+"no ACK received, terminating the call"),k.clearTimeout(f.timers.invite2xxTimer),f.sendBye(),
f.ended("remote",null,b.C.causes.NO_ACK))},b.Timers.TIMER_H);f.started("local")},function(){f.failed("system",null,b.C.causes.CONNECTION_ERROR)})},o=function(){f.status!==i.STATUS_TERMINATED&&f.failed("local",null,b.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');if(this.status!==i.STATUS_WAITING_FOR_ANSWER)throw new b.Exceptions.InvalidStateError(this.status);this.createDialog(g,"UAS")?(k.clearTimeout(this.timers.userNoAnswerTimer),
this.rtcMediaHandler.getUserMedia(function(b){f.rtcMediaHandler.addStream(b,y,p)},function(){g.reply(480);f.failed("local",null,b.C.causes.USER_DENIED_MEDIA_ACCESS)},t)):g.reply(500,"Missing Contact header field")};f.prototype.sendDTMF=function(c,f){function h(){var b,n=new g(p);n.on("failed",function(){r=!1});b=c[y];y+=1;n.send(b,f)}var q,t,y=0,p=this,r=!0,f=f||{};t=f.interToneGap||null;if(void 0===c)throw new TypeError("Not enough arguments");if(this.status!==i.STATUS_CONFIRMED&&this.status!==i.STATUS_WAITING_FOR_ACK)throw new b.Exceptions.InvalidStateError(this.status);
if(!c||"string"!==typeof c&&"number"!==typeof c||!c.toString().match(/^[0-9A-D#*]+$/i))throw new TypeError("Invalid tones: "+c);c=c.toString();if(t&&!b.Utils.isDecimal(t))throw new TypeError("Invalid interToneGap: "+t);t?t<g.C.MIN_INTER_TONE_GAP?(console.warn(n+'"interToneGap" value is lower than the minimum allowed, setting it to '+g.C.MIN_INTER_TONE_GAP+" milliseconds"),t=g.C.MIN_INTER_TONE_GAP):t=Math.abs(t):t=g.C.DEFAULT_INTER_TONE_GAP;h();q=k.setInterval(function(){p.status!==i.STATUS_TERMINATED&&
r&&c.length>y?h():k.clearInterval(q)},t)};f.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]};f.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]};f.prototype.init_incoming=function(f,g){var h,q=this,t=f.getHeader("Content-Type");if(f.headers["Alert-Info"]&&-1!=f.headers["Alert-Info"][0].raw.indexOf("gvcname")){this.isMcu=
!0;this.roomInfo={};var y=/^.*gvctype=(.*);gvcid=(.*);gvcname=(.*)$/.exec(f.headers["Alert-Info"][0].raw);this.roomInfo.gvctype=y[1];this.roomInfo.gvcid=y[2];this.roomInfo.gvcname=y[3];switch(this.roomInfo.gvctype){case "0":this.roomInfo.gvctype_cn="\u8bed\u97f3\u7fa4\u804a";break;case "1":this.roomInfo.gvctype_cn="\u8bed\u97f3\u5bf9\u8bb2";break;case "2":this.roomInfo.gvctype_cn="\u4e24\u65b9\u8bed\u97f3";break;case "9":this.roomInfo.gvctype_cn="\u8bed\u97f3\u76f4\u64ad";break;case "20":this.roomInfo.gvctype_cn=
"\u89c6\u9891\u7fa4\u804a";break;case "21":this.roomInfo.gvctype_cn="\u89c6\u9891\u5bf9\u8bb2";break;case "22":this.roomInfo.gvctype_cn="\u4e24\u65b9\u89c6\u9891";break;case "29":this.roomInfo.gvctype_cn="\u89c6\u9891\u76f4\u64ad"}this.roomInfo.remoteMedia=2==this.roomInfo.gvctype.length?"video":"audio"}!this.isMcu&&(!f.body||"application/sdp"!==t)?f.reply(415):(this.status=i.STATUS_INVITE_RECEIVED,this.from_tag=f.from_tag,this.id=f.call_id+this.from_tag,this.request=f,this.contact=this.ua.contact.toString(),
this.ua.sessions[this.id]=this,f.hasHeader("expires")&&(h=1E3*f.getHeader("expires")),f.to_tag=b.Utils.newTag(),this.createDialog(f,"UAS",!0)?this.isMcu?(f.reply(180,null,["Contact: "+q.contact]),q.status=i.STATUS_WAITING_FOR_ANSWER,q.timers.userNoAnswerTimer=k.setTimeout(function(){f.reply(408);q.failed("local",null,b.C.causes.NO_ANSWER)},q.ua.configuration.no_answer_timeout),h&&(q.timers.expiresTimer=k.setTimeout(function(){q.status===i.STATUS_WAITING_FOR_ANSWER&&(f.reply(487),q.failed("system",
null,b.C.causes.EXPIRES))},h)),this.rtcMediaHandler=new c(this),q.newRTCSession("remote",f)):(this.rtcMediaHandler=new c(this,g),this.rtcMediaHandler.onMessage("offer",f.body,function(){f.reply(180,null,["Contact: "+q.contact]);q.status=i.STATUS_WAITING_FOR_ANSWER;q.timers.userNoAnswerTimer=k.setTimeout(function(){f.reply(408);q.failed("local",null,b.C.causes.NO_ANSWER)},q.ua.configuration.no_answer_timeout);h&&(q.timers.expiresTimer=k.setTimeout(function(){q.status===i.STATUS_WAITING_FOR_ANSWER&&
(f.reply(487),q.failed("system",null,b.C.causes.EXPIRES))},h));q.newRTCSession("remote",f)},function(b){console.warn(n+"invalid SDP");console.warn(b);f.reply(488)})):f.reply(500,"Missing Contact header field"))};f.prototype.connect=function(f,g){var g=g||{},h,n=!1,t=g.eventHandlers||{},k=g.extraHeaders||[],p=g.mediaConstraints||{audio:!0,video:!0},r=g.RTCConstraints||{};console.log("RTCConstraints:"+r);if(void 0===f)throw new TypeError("Not enough arguments");if(this.status!==i.STATUS_NULL)throw new b.Exceptions.InvalidStateError(this.status);
for(h in t)this.on(h,t[h]);try{f=b.Utils.normalizeURI(f,this.ua.configuration.hostport_params)}catch(o){f=b.URI.parse(b.C.INVALID_TARGET_URI),n=!0}this.from_tag=b.Utils.newTag();this.rtcMediaHandler=new c(this,r);this.anonymous=g.anonymous;this.received_100=this.isCanceled=!1;h={from_tag:this.from_tag};this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0});this.anonymous&&(h.from_display_name="Anonymous",h.from_uri="sip:anonymous@anonymous.invalid",k.push("P-Preferred-Identity: "+
this.ua.configuration.uri.toString()),k.push("Privacy: id"));k.push("Contact: "+this.contact);k.push("Allow: "+b.Utils.getAllowedMethods(this.ua));k.push("Call-Info: "+g.extraParas);k.push("Content-Type: application/sdp");k.push("Session-Expires: "+b.Timers.TIMER_N);this.request=new b.OutgoingRequest(b.C.INVITE,f,this.ua,h,k);this.id=this.request.call_id+this.from_tag;this.ua.sessions[this.id]=this;this.newRTCSession("local",this.request);n?this.failed("local",null,b.C.causes.INVALID_TARGET):b.WebRTC.isSupported?
this.sendInitialRequest(p):this.failed("local",null,b.C.causes.WEBRTC_NOT_SUPPORTED)};f.prototype.close=function(){var b;if(this.status!==i.STATUS_TERMINATED){console.log(n+"closing INVITE session "+this.id);this.rtcMediaHandler&&this.rtcMediaHandler.close();for(b in this.timers)k.clearTimeout(this.timers[b]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(b in this.earlyDialogs)this.earlyDialogs[b].terminate(),delete this.earlyDialogs[b];this.status=i.STATUS_TERMINATED;this.ua.curSession=
null;delete this.ua.sessions[this.id]}};f.prototype.createDialog=function(c,f,g){var h,n=c.call_id+("UAS"===f?c.to_tag:c.from_tag)+("UAS"===f?c.from_tag:c.to_tag);h=this.earlyDialogs[n];if(g){if(h)return!0;h=new b.Dialog(this,c,f,b.Dialog.C.STATUS_EARLY);if(h.id)return this.earlyDialogs[n]=h,!0;this.failed("remote",c,b.C.causes.INTERNAL_ERROR);return!1}if(h)return h.update(c,f),this.dialog=h,delete this.earlyDialogs[n],!0;f=new b.Dialog(this,c,f);if(f.id)return this.to_tag=c.to_tag,this.dialog=f,
!0;this.failed("remote",c,b.C.causes.INTERNAL_ERROR);return!1};f.prototype.receiveRequest=function(c){var f,h=this;if(c.method===b.C.CANCEL)this.request.reply(487),this.status===i.STATUS_WAITING_FOR_ANSWER&&(this.status=i.STATUS_CANCELED,this.failed("remote",c,b.C.causes.CANCELED));else switch(c.method){case b.C.ACK:if(this.status===i.STATUS_WAITING_FOR_ACK&&(k.clearTimeout(this.timers.ackTimer),k.clearTimeout(this.timers.invite2xxTimer),this.status=i.STATUS_CONFIRMED,h.isMcu))this.rtcMediaHandler.onMessage("answer",
c.body,function(){h.status=i.STATUS_CONFIRMED;h.started("remote")},function(c){console.warn(c);session.acceptAndTerminate(response,488,"Not Acceptable Here");session.failed("remote",response,b.C.causes.BAD_MEDIA_DESCRIPTION)});break;case b.C.BYE:this.status===i.STATUS_CONFIRMED&&(c.reply(200),this.ended("remote",c,b.C.causes.BYE));break;case b.C.INVITE:this.status===i.STATUS_WAITING_FOR_ACK&&c.reply(491);if(this.status===i.STATUS_CONFIRMED||this.isMcu)f=[],f.push("Session-Expires:"+b.Timers.TIMER_N+
";refresher=uac"),f.push("Allow: ACK,CANCEL,BYE,OPTIONS,UPDATE,INVITE"),c.reply(200,null,f,this.rtcMediaHandler.peerConnection.localDescription.sdp),console.log(n+"re-INVITE received");break;case b.C.INFO:if(this.status===i.STATUS_CONFIRMED||this.status===i.STATUS_WAITING_FOR_ACK)(f=c.getHeader("content-type"))&&f.match(/^application\/dtmf-relay/i)&&(new g(this)).init_incoming(c);break;case b.C.UPDATE:f=[];f.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uac");c.reply(200,null,f);k.clearTimeout(this.timers.updateTimer);
this.timers.updateTimer=k.setTimeout(function(c){cause=b.C.causes.UNAVAILABLE;c.failed("remote",null,cause)},2E3*b.Timers.TIMER_N,this);break;case b.C.NOTIFY:-1!=c.body.indexOf("kickedBy")?(this.ua.unregister(),this.ua.emit("notifyKickby",this,{body:c.body})):-1!=c.body.indexOf("multiLogin")&&this.ua.emit("notifyMultiLogin",this,{body:c.body})}};f.prototype.sendInitialRequest=function(c){var f=this,g=new b.RequestSender(f,this.ua),h=function(){f.rtcMediaHandler.createOffer(k,p)},n=function(){f.status!==
i.STATUS_TERMINATED&&f.failed("local",null,b.C.causes.WEBRTC_ERROR)},k=function(b){f.isCanceled||f.status===i.STATUS_TERMINATED||(b=b.replace(/sendrecv/g,c.direction),f.request.body=b,f.status=i.STATUS_INVITE_SENT,g.send())},p=function(){f.status!==i.STATUS_TERMINATED&&f.failed("local",null,b.C.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(function(b){f.rtcMediaHandler.addStream(b,h,n)},function(){f.status!==i.STATUS_TERMINATED&&f.failed("local",null,b.C.causes.USER_DENIED_MEDIA_ACCESS)},
c)};f.prototype.receiveResponse=function(c){var f,g=this;500==c.status_code&&(f=b.C.causes.UNAVAILABLE,this.failed("remote",null,f));403==c.status_code&&this.failed("remote",null,"Forbidden");if(!(this.status!==i.STATUS_INVITE_SENT&&this.status!==i.STATUS_1XX_RECEIVED))if(this.isCanceled)100<=c.status_code&&200>c.status_code?this.request.cancel(this.cancelReason):200<=c.status_code&&299>c.status_code&&this.acceptAndTerminate(c);else switch(!0){case /^100$/.test(c.status_code):this.received_100=!0;
break;case /^1[0-9]{2}$/.test(c.status_code):if(!c.to_tag){console.warn(n+"1xx response received without to tag");break}c.hasHeader("contact")&&this.createDialog(c,"UAC",!0);this.status=i.STATUS_1XX_RECEIVED;this.progress("remote",c);break;case /^2[0-9]{2}$/.test(c.status_code):if(this.dialog||g.status==i.STATUS_CONFIRMED)break;g.status=i.STATUS_CONFIRMED;if(!c.body){this.acceptAndTerminate(c,400,"Missing session description");this.failed("remote",c,b.C.causes.BAD_MEDIA_DESCRIPTION);break}this.rtcMediaHandler.onMessage("answer",
c.body,function(){if(g.createDialog(c,"UAC")){g.sendACK();g.sendUPDATE();g.status=i.STATUS_CONFIRMED;g.started("remote",c)}},function(f){console.warn(f);g.acceptAndTerminate(c,488,"Not Acceptable Here");g.failed("remote",c,b.C.causes.BAD_MEDIA_DESCRIPTION)});break;default:f=b.Utils.sipErrorCause(c.status_code),this.failed("remote",c,f)}};f.prototype.acceptAndTerminate=function(b,c,f){if(this.dialog||this.createDialog(b,"UAC"))this.sendACK(),this.sendBye({status_code:c,reason_phrase:f})};f.prototype.sendACK=
function(){this.sendRequest(this.dialog.createRequest(b.C.ACK))};f.prototype.sendUPDATE=function(){var c=[];c.push("Session-Expires:"+b.Timers.TIMER_N+";refresher=uas");this.sendRequest(this.dialog.createRequest(b.C.UPDATE,c));this.timers.updateTimer=k.setTimeout(function(b){b.sendUPDATE()},1E3*b.Timers.TIMER_N,this)};f.prototype.sendBye=function(c){var c=c||{},f;f=c.status_code;var g=c.reason_phrase||b.C.REASON_PHRASE[f]||"",h=c.extraHeaders||[],c=c.body;if(f&&(200>f||700<=f))throw new TypeError("Invalid status_code: "+
f);f&&h.push("Reason: "+("SIP ;cause="+f+'; text="'+g+'"'));f=this.dialog.createRequest(b.C.BYE,h);f.body=c;this.sendRequest(f)};f.prototype.sendRequest=function(b){(new h(this,b)).send()};f.prototype.onTransportError=function(){this.status!==i.STATUS_TERMINATED&&(this.status===i.STATUS_CONFIRMED?this.ended("system",null,b.C.causes.CONNECTION_ERROR):this.failed("system",null,b.C.causes.CONNECTION_ERROR))};f.prototype.onRequestTimeout=function(){this.status!==i.STATUS_TERMINATED&&(this.status===i.STATUS_CONFIRMED?
this.ended("system",null,b.C.causes.REQUEST_TIMEOUT):this.failed("system",null,b.C.causes.CONNECTION_ERROR))};f.prototype.newRTCSession=function(b,c){"remote"===b?(this.direction="incoming",this.local_identity=c.to,this.remote_identity=c.from):"local"===b&&(this.direction="outgoing",this.local_identity=c.from,this.remote_identity=c.to);this.ua.emit("newRTCSession",this.ua,{originator:b,session:this,request:c})};f.prototype.connecting=function(b,c){this.emit("connecting",this,{originator:"local",request:c})};
f.prototype.progress=function(b,c){this.emit("progress",this,{originator:b,response:c||null})};f.prototype.started=function(b,c){this.start_time=new Date;this.emit("started",this,{response:c||null})};f.prototype.ended=function(b,c,f){this.end_time=new Date;this.emit("ended",this,{originator:b,message:c||null,cause:f});this.close()};f.prototype.failed=function(b,c,f){this.emit("failed",this,{originator:b,message:c||null,cause:f});this.close()};f.C=i;b.RTCSession=f})(i);(function(b){var h;h=function(b){this.ua=
b;this.remote_identity=this.local_identity=this.direction=null;this.data={}};h.prototype=new b.EventEmitter;h.prototype.send=function(c,g,f){var h,i,k,l=!1;if(void 0===c||void 0===g)throw new TypeError("Not enough arguments");this.initEvents(["succeeded","failed"]);f=f||{};k=f.extraHeaders||[];i=f.eventHandlers||{};f=f.contentType||"text/plain";for(h in i)this.on(h,i[h]);try{c=b.Utils.normalizeURI(c,this.ua.configuration.hostport_params)}catch(w){c=b.URI.parse(b.C.INVALID_TARGET_URI),l=!0}this.direction=
"outgoing";this.local_identity=this.ua.configuration.uri;this.remote_identity=c;this.closed=!1;this.ua.applicants[this]=this;k.push("Content-Type: "+f);this.request=new b.OutgoingRequest(b.C.MESSAGE,c,this.ua,null,k);g&&(this.request.body=g);c=new b.RequestSender(this,this.ua);this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request});l?this.emit("failed",this,{originator:"local",cause:b.C.causes.INVALID_TARGET}):c.send()};h.prototype.receiveResponse=function(c){var g;
if(!this.closed)switch(!0){case /^1[0-9]{2}$/.test(c.status_code):break;case /^2[0-9]{2}$/.test(c.status_code):delete this.ua.applicants[this];this.emit("succeeded",this,{originator:"remote",response:c});break;default:delete this.ua.applicants[this],g=b.Utils.sipErrorCause(c.status_code),this.emit("failed",this,{originator:"remote",response:c,cause:g})}};h.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:b.C.causes.REQUEST_TIMEOUT})};h.prototype.onTransportError=
function(){this.closed||this.emit("failed",this,{originator:"system",cause:b.C.causes.CONNECTION_ERROR})};h.prototype.close=function(){this.closed=!0;delete this.ua.applicants[this]};h.prototype.init_incoming=function(c){var g;g=c.getHeader("content-type");this.direction="incoming";this.request=c;this.local_identity=c.to.uri;this.remote_identity=c.from.uri;g&&(g.match(/^text\/plain(\s*;\s*.+)*$/i)||g.match(/^text\/html(\s*;\s*.+)*$/i))?(this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,
request:c}),(g=this.ua.transactions.nist[c.via_branch])&&(g.state===b.Transactions.C.STATUS_TRYING||g.state===b.Transactions.C.STATUS_PROCEEDING)&&c.reply(200)):c.reply(415,null,["Accept: text/plain, text/html"])};h.prototype.accept=function(b){var b=b||{},g=b.extraHeaders||[],b=b.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,g,b)};h.prototype.reject=function(b){var b=b||{},g=b.status_code||480,f=b.reason_phrase,
h=b.extraHeaders||[],b=b.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');if(300>g||700<=g)throw new TypeError("Invalid status_code: "+g);this.request.reply(g,f,h,b)};b.Message=h})(i);(function(b){var h,c=b.name+" | UA | ",g={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE",newMessage:"MESSAGE"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS","UPDATE"],
ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED:"path, outbound, gruu, timer",MAX_FORWARDS:69,TAG_LENGTH:10};h=function(b){var c="connected,disconnected,registered,unregistered,registrationFailed,newRTCSession,newMessage,notifyKickby,notifyMultiLogin,notifyRoom".split(",");g.ACCEPTED_BODY_TYPES=g.ACCEPTED_BODY_TYPES.toString();this.cache={credentials:{}};this.configuration={};this.dialogs={};this.curSession=this.registrator=null;this.applicants={};this.sessions={};this.contact=
this.transport=null;this.status=g.STATUS_INIT;this.error=null;this.transactions={nist:{},nict:{},ist:{},ict:{}};this.transportRecoverAttempts=0;if(void 0===b)throw new TypeError("Not enough arguments");try{this.loadConfig(b),this.initEvents(c)}catch(h){throw this.status=g.STATUS_NOT_READY,this.error=g.CONFIGURATION_ERROR,h;}};h.prototype=new b.EventEmitter;h.prototype.register=function(b){this.configuration.register=!0;this.registrator.register(b)};h.prototype.unregister=function(b){this.configuration.register=
!1;this.registrator.unregister(b)};h.prototype.isRegistered=function(){return this.registrator&&this.registrator.registered?!0:!1};h.prototype.isConnected=function(){return this.transport?this.transport.connected:!1};h.prototype.call=function(c,g){var h;h=new b.RTCSession(this);h.connect(c,g);this.curSession=h};h.prototype.sendMessage=function(c,g,h){(new b.Message(this)).send(c,g,h)};h.prototype.startRecordLocal=function(b){var c=this.curSession;c.emit("startRecordLocal",c,{type:b})};h.prototype.stopRecordLocal=
function(){var b=this.curSession;b.emit("endRecordLocal",b,{response:null})};h.prototype.startRecordRemote=function(b){var c=this.curSession;c.emit("startRecordRemote",c,{type:b})};h.prototype.stopRecordRemote=function(){var b=this.curSession;b.emit("endRecordRemote",b,{response:null})};h.prototype.stop=function(){var b,h,i=this;console.log(c+"user requested closure...");if(this.status===g.STATUS_USER_CLOSED)console.warn("UA already closed");else{this.registrator&&(console.log(c+"closing registrator"),
this.registrator.close());for(b in this.sessions)console.log(c+"closing session "+b),this.sessions[b].terminate();for(h in this.applicants)this.applicants[h].close();this.status=g.STATUS_USER_CLOSED;this.shutdownGraceTimer=k.setTimeout(function(){i.transport.disconnect()},"5000")}};h.prototype.start=function(){var f;console.log(c+"user requested startup...");this.status===g.STATUS_INIT?(f=this.getNextWsServer(),new b.Transport(this,f)):this.status===g.STATUS_USER_CLOSED?(console.log(c+"resuming"),
this.status=g.STATUS_READY,this.transport.connect()):this.status===g.STATUS_READY?console.log(c+"UA is in READY status, not resuming"):console.error("Connection is down. Auto-Recovery system is trying to connect")};h.prototype.saveCredentials=function(b){this.cache.credentials[b.realm]=this.cache.credentials[b.realm]||{};this.cache.credentials[b.realm][b.uri]=b};h.prototype.getCredentials=function(b){var c,g;c=b.ruri.host;this.cache.credentials[c]&&this.cache.credentials[c][b.ruri]&&(g=this.cache.credentials[c][b.ruri],
g.method=b.method);return g};h.prototype.onTransportClosed=function(f){var g,h,i=["nict","ict","nist","ist"];f.server.status=b.Transport.C.STATUS_DISCONNECTED;console.log(c+"connection state set to "+b.Transport.C.STATUS_DISCONNECTED);for(g in i)for(h in this.transactions[i[g]])this.transactions[i[g]][h].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()};h.prototype.onTransportError=function(f){console.log(c+"transport "+f.server.ws_uri+" failed | connection state set to "+
b.Transport.C.STATUS_ERROR);f.server.status=b.Transport.C.STATUS_ERROR;this.emit("disconnected",this,{transport:f,code:f.lastTransportError.code,reason:f.lastTransportError.reason});if(f=this.getNextWsServer())new b.Transport(this,f);else{this.closeSessionsOnTransportError();if(!this.error||this.error!==g.NETWORK_ERROR)this.status=g.STATUS_NOT_READY,this.error=g.NETWORK_ERROR;this.recoverTransport()}};h.prototype.onTransportConnected=function(f){this.transport=f;this.transportRecoverAttempts=0;f.server.status=
b.Transport.C.STATUS_READY;console.log(c+"connection state set to "+b.Transport.C.STATUS_READY);if(this.status!==g.STATUS_USER_CLOSED)if(this.status=g.STATUS_READY,this.error=null,this.emit("connected",this,{transport:f}),this.configuration.register)if(this.registrator)this.registrator.onTransportConnected();else this.registrator=new b.Registrator(this,f),this.register();else this.registrator=new b.Registrator(this,f)};h.prototype.setSE=function(c){b.Timers.TIMER_N=c};h.prototype.receiveRequest=function(f){var h,
i=f.method;if(f.ruri.user!==this.configuration.uri.user&&f.ruri.user!==this.contact.uri.user)console.warn(c+"Request-URI does not point to us"),f.method!==b.C.ACK&&f.reply_sl(404);else if(!b.Transactions.checkTransaction(this,f)){i===b.C.INVITE?new b.Transactions.InviteServerTransaction(f,this):i!==b.C.ACK&&new b.Transactions.NonInviteServerTransaction(f,this);if(i===b.C.OPTIONS)f.reply(200,null,["Allow: "+b.Utils.getAllowedMethods(this),"Accept: "+g.ACCEPTED_BODY_TYPES]);else if(i===b.C.MESSAGE){if(!this.checkEvent("newMessage")||
0===this.listeners("newMessage").length){f.reply(405,null,["Allow: "+b.Utils.getAllowedMethods(this)]);return}h=new b.Message(this);h.init_incoming(f);return}if(f.to_tag)(h=this.findDialog(f))?h.receiveRequest(f):i===b.C.NOTIFY?(h=this.findSession(f))?h.receiveRequest(f):(console.warn(c+"received NOTIFY request for a non existent session"),f.reply(481,"Subscription does not exist")):i!==b.C.ACK&&f.reply(481);else if(this.isRegistered())switch(i){case b.C.INVITE:if(b.WebRTC.isSupported){if(this.curSession){f.reply(486);
break}this.curSession=h=new b.RTCSession(this);h.init_incoming(f,{optional:[{DtlsSrtpKeyAgreement:"false"}]});h=f.headers["Session-Expires"];f=f.getHeader("Min-SE");h=parseInt(h[0].raw);b.Timers.TIMER_N>h?b.Timers.TIMER_N=h:b.Timers.TIMER_N<parseInt(f)&&(b.Timers.TIMER_N=parseInt(f))}else console.warn(c+"INVITE received but WebRTC is not supported"),f.reply(488);break;case b.C.BYE:f.reply(481);break;case b.C.CANCEL:f.reply(200);(h=this.findSession(f))?h.receiveRequest(f):console.warn(c+"received CANCEL request for a non existent session");
break;case b.C.ACK:break;case b.C.NOTIFY:f.reply(200);-1!=f.body.indexOf("kickedBy")?(this.stop(),this.emit("notifyKickby",this,{body:f.body})):-1!=f.body.indexOf("multiLogin")&&this.emit("notifyMultiLogin",this,{body:f.body});-1!=f.body.indexOf("ChangedInfo")&&this.emit("notifyRoom",this,{body:f.body});break;default:f.reply(405)}else f.reply(410)}};h.prototype.findSession=function(b){var c=this.sessions[b.call_id+b.from_tag],b=this.sessions[b.call_id+b.to_tag];return c?c:b?b:null};h.prototype.findDialog=
function(b){var c=b.call_id+b.from_tag+b.to_tag;if(c=this.dialogs[c])return c;c=b.call_id+b.to_tag+b.from_tag;return(c=this.dialogs[c])?c:null};h.prototype.getNextWsServer=function(){var c,g,h=[];for(c in this.configuration.ws_servers)g=this.configuration.ws_servers[c],g.status!==b.Transport.C.STATUS_ERROR&&(0===h.length?h.push(g):g.weight>h[0].weight?h=[g]:g.weight===h[0].weight&&h.push(g));c=Math.floor(Math.random()*h.length);return h[c]};h.prototype.closeSessionsOnTransportError=function(){for(var b in this.sessions)this.sessions[b].onTransportError();
if(this.registrator)this.registrator.onTransportClosed()};h.prototype.recoverTransport=function(f){var g,h,i,f=f||this;h=f.transportRecoverAttempts;for(g in f.configuration.ws_servers)f.configuration.ws_servers[g].status=0;i=f.getNextWsServer();g=Math.floor(Math.random()*Math.pow(2,h)+1)*f.configuration.connection_recovery_min_interval;g>f.configuration.connection_recovery_max_interval&&(console.log(c+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),
g=f.configuration.connection_recovery_min_interval,h=0);console.log(c+"next connection attempt in "+g+" seconds");k.setTimeout(function(){f.transportRecoverAttempts=h+1;new b.Transport(f,i)},1E3*g)};h.prototype.loadConfig=function(f){var g,i,v,l={via_host:b.Utils.createRandomToken(12)+".invalid",password:null,register_expires:600,register_min_expires:120,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,
use_preloaded_route:!1,no_answer_timeout:60,stun_servers:"",turn_servers:"",trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(g in h.configuration_check.mandatory)if(f.hasOwnProperty(g))if(i=f[g],v=h.configuration_check.mandatory[g](i),void 0!==v)l[g]=v;else throw new b.Exceptions.ConfigurationError(g,i);else throw new b.Exceptions.ConfigurationError(g);for(g in h.configuration_check.optional)if(f.hasOwnProperty(g)&&(i=f[g],!(null===i||""===i||void 0===i)&&!("number"===typeof i&&k.isNaN(i))))if(v=
h.configuration_check.optional[g](i),void 0!==v)l[g]=v;else throw new b.Exceptions.ConfigurationError(g,i);if(l.connection_recovery_max_interval<l.connection_recovery_min_interval)throw new b.Exceptions.ConfigurationError("connection_recovery_max_interval",l.connection_recovery_max_interval);0===l.display_name&&(l.display_name="0");l.instance_id=b.Utils.newUUID();l.jssip_id=b.Utils.createRandomToken(5);f=l.uri.clone();f.user=null;l.hostport_params=f.toString().replace(/^sip:/i,"");l.authorization_user||
(l.authorization_user=l.uri.user);l.registrar_server||(f=l.uri.clone(),f.user=null,l.registrar_server=f);l.no_answer_timeout*=1E3;l.hack_ip_in_contact&&(l.via_host=b.Utils.getRandomTestNetIP());this.contact={pub_gruu:null,temp_gruu:null,uri:new b.URI("sip",b.Utils.createRandomToken(8),l.via_host,null,{transport:"ws"}),toString:function(b){var b=b||{},c=b.outbound||null,f="<",f=b.anonymous?f+(this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws"):f+(this.pub_gruu||this.uri.toString());c&&
(f=f+";ob");return f+">"}};console.log(c+"configuration parameters after validation:");for(g in l){switch(g){case "uri":case "registrar_server":!0===l.trace_sip&&console.log("\u00b7 "+g+": "+l[g]);break;case "stun_servers":case "turn_servers":break;default:!0===l.trace_sip&&console.log("\u00b7 "+g+": "+k.JSON.stringify(l[g]))}h.configuration_skeleton[g].value=l[g]}Object.defineProperties(this.configuration,h.configuration_skeleton);for(g in l)h.configuration_skeleton[g].value=""};h.configuration_skeleton=
function(){var b,c,g={},h="instance_id,jssip_id,register_min_expires,ws_server_max_reconnection,ws_server_reconnection_timeout,hostport_params,uri,ws_servers,authorization_user,connection_recovery_max_interval,connection_recovery_min_interval,display_name,hack_via_tcp,hack_ip_in_contact,no_answer_timeout,password,register_expires,registrar_server,stun_servers,trace_sip,turn_servers,use_preloaded_route,via_core_value,via_host".split(",");for(b in h)c=h[b],g[c]={value:"",writable:!1,configurable:!1};
g.register={value:"",writable:!0,configurable:!1};return g}();h.configuration_check={mandatory:{uri:function(c){/^sip:/i.test(c)||(c=b.C.SIP+":"+c);if((c=b.URI.parse(c))&&c.user)return c},ws_servers:function(f){var g,h;if("string"===typeof f)f=[{ws_uri:f}];else if(f instanceof Array)for(g in f)"string"===typeof f[g]&&(f[g]={ws_uri:f[g]});else return;if(0===f.length)return!1;for(g in f){if(!f[g].ws_uri){console.error(c+'missing "ws_uri" attribute in ws_servers parameter');return}if(f[g].weight&&!Number(f[g].weight)){console.error(c+
'"weight" attribute in ws_servers parameter must be a Number');return}h=b.Grammar.parse(f[g].ws_uri,"absoluteURI");if(-1===h){console.error(c+'invalid "ws_uri" attribute in ws_servers parameter: '+f[g].ws_uri);return}if("wss"!==h.scheme&&"ws"!==h.scheme){console.error(c+"invalid URI scheme in ws_servers parameter: "+h.scheme);return}f[g].sip_uri="<sip:"+h.host+(h.port?":"+h.port:"")+";transport=ws;lr>";f[g].weight||(f[g].weight=0);f[g].status=0;f[g].scheme=h.scheme.toUpperCase()}return f}},optional:{authorization_user:function(c){if(-1!==
b.Grammar.parse('"'+c+'"',"quoted_string"))return c},connection_recovery_max_interval:function(c){if(b.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},connection_recovery_min_interval:function(c){if(b.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},display_name:function(c){if(-1!==b.Grammar.parse('"'+c+'"',"display_name"))return c},hack_via_tcp:function(b){if("boolean"===typeof b)return b},hack_ip_in_contact:function(b){if("boolean"===typeof b)return b},no_answer_timeout:function(c){if(b.Utils.isDecimal(c)&&
(c=k.Number(c),0<c))return c},password:function(b){return""+b},register:function(b){if("boolean"===typeof b)return b},register_expires:function(c){if(b.Utils.isDecimal(c)&&(c=k.Number(c),0<c))return c},registrar_server:function(c){/^sip:/i.test(c)||(c=b.C.SIP+":"+c);if((c=b.URI.parse(c))&&!c.user)return c},stun_servers:function(c){var g,h;c instanceof Array||(c=[c]);for(g in c){h=c[g];if(!h.server||!h.username||!h.password)return;/^stuns?:/.test(h.server)||(h.server="stun:"+h.server);if(-1===b.Grammar.parse(h.server,
"stun_URI"))break;else if(-1===b.Grammar.parse(h.username,"user"))break;else if(-1===b.Grammar.parse(h.password,"password"))break}return c},trace_sip:function(b){if("boolean"===typeof b)return b},turn_servers:function(c){var g,h;c instanceof Array||(c=[c]);for(g in c){h=c[g];if(!h.server||!h.username||!h.password)return;/^turns?:/.test(h.server)||(h.server="turn:"+h.server);if(-1===b.Grammar.parse(h.server,"turn_URI"))break;else if(-1===b.Grammar.parse(h.username,"user"))break;else if(-1===b.Grammar.parse(h.password,
"password"))break}return c},use_preloaded_route:function(b){if("boolean"===typeof b)return b}}};h.C=g;b.UA=h})(i);(function(b){b.Utils={str_utf8_length:function(b){return k.unescape(encodeURIComponent(b)).length},isFunction:function(b){return void 0!==b?"[object Function]"===Object.prototype.toString.call(b)?!0:!1:!1},isDecimal:function(b){return!isNaN(b)&&parseFloat(b)===parseInt(b,10)},createRandomToken:function(b,c){var g,f,i="",c=c||32;for(g=0;g<b;g++)f=Math.random()*c|0,i+=f.toString(c);return i},
newTag:function(){return b.Utils.createRandomToken(b.UA.C.TAG_LENGTH)},newUUID:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=16*Math.random()|0;return("x"===b?c:c&3|8).toString(16)})},hostType:function(h){if(h&&(h=b.Grammar.parse(h,"host"),-1!==h))return h.host_type},normalizeURI:function(h,c){var g,f,i=h;if(h){if(h instanceof b.URI)return h;if("string"===typeof h){f=h.split("@");switch(f.length){case 1:if(!c)throw new b.Exceptions.InvalidTargetError(i);
g=h;f=c;break;case 2:g=f[0];f=f[1];break;default:g=f.slice(0,f.length-1).join("@"),f=f[f.length-1]}g=g.replace(/^(sips?|tel):/i,"");/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(g)&&(g=g.replace(/[\-\.\(\)]/g,""));h=b.C.SIP+":"+b.Utils.escapeUser(g)+"@"+f;if(g=b.URI.parse(h))return g}}throw new b.Exceptions.InvalidTargetError(i);},escapeUser:function(b){return k.encodeURIComponent(k.decodeURIComponent(b)).replace(/%3A/ig,":").replace(/%2B/ig,"+").replace(/%3F/ig,"?").replace(/%2F/ig,"/")},headerize:function(b){var c=
{"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},b=b.toLowerCase().replace(/_/g,"-").split("-"),g="",f;for(f in b)"0"!==f&&(g+="-"),g+=b[f].charAt(0).toUpperCase()+b[f].substring(1);c[g]&&(g=c[g]);return g},sipErrorCause:function(h){for(var c in b.C.SIP_ERROR_CAUSES)if(-1!==b.C.SIP_ERROR_CAUSES[c].indexOf(h))return b.C.causes[c];return b.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){return"192.0.2."+k.Math.floor(254*k.Math.random()+1)},getAllowedMethods:function(h){var c,
g=b.UA.C.ALLOWED_METHODS.toString();for(c in b.UA.C.EVENT_METHODS)h.checkEvent(c)&&0<h.listeners(c).length&&(g+=","+b.UA.C.EVENT_METHODS[c]);return g},calculateMD5:function(b){function c(b,c){var f,g,i,h,l;i=b&2147483648;h=c&2147483648;f=b&1073741824;g=c&1073741824;l=(b&1073741823)+(c&1073741823);return f&g?l^2147483648^i^h:f|g?l&1073741824?l^3221225472^i^h:l^1073741824^i^h:l^i^h}function g(b,f,g,i,h,l,n){b=c(b,c(c(f&g|~f&i,h),n));return c(b<<l|b>>>32-l,f)}function f(b,f,g,i,h,l,n){b=c(b,c(c(f&i|
g&~i,h),n));return c(b<<l|b>>>32-l,f)}function i(b,f,g,h,l,n,k){b=c(b,c(c(f^g^h,l),k));return c(b<<n|b>>>32-n,f)}function k(b,f,g,h,i,l,n){b=c(b,c(c(g^(f|~h),i),n));return c(b<<l|b>>>32-l,f)}function v(b){var c="",f="",g;for(g=0;3>=g;g++)f=b>>>8*g&255,f="0"+f.toString(16),c+=f.substr(f.length-2,2);return c}var l=[],w,q,t,y,p,r,o,u,b=function(b){for(var b=b.replace(/\r\n/g,"\n"),c="",f=0;f<b.length;f++){var g=b.charCodeAt(f);128>g?c+=String.fromCharCode(g):(127<g&&2048>g?c+=String.fromCharCode(g>>
6|192):(c+=String.fromCharCode(g>>12|224),c+=String.fromCharCode(g>>6&63|128)),c+=String.fromCharCode(g&63|128))}return c}(b),l=function(b){var c,f=b.length;c=f+8;for(var g=16*((c-c%64)/64+1),h=Array(g-1),i=0,l=0;l<f;)c=(l-l%4)/4,i=8*(l%4),h[c]|=b.charCodeAt(l)<<i,l++;c=(l-l%4)/4;h[c]|=128<<8*(l%4);h[g-2]=f<<3;h[g-1]=f>>>29;return h}(b);p=1732584193;r=4023233417;o=2562383102;u=271733878;for(b=0;b<l.length;b+=16)w=p,q=r,t=o,y=u,p=g(p,r,o,u,l[b+0],7,3614090360),u=g(u,p,r,o,l[b+1],12,3905402710),o=g(o,
u,p,r,l[b+2],17,606105819),r=g(r,o,u,p,l[b+3],22,3250441966),p=g(p,r,o,u,l[b+4],7,4118548399),u=g(u,p,r,o,l[b+5],12,1200080426),o=g(o,u,p,r,l[b+6],17,2821735955),r=g(r,o,u,p,l[b+7],22,4249261313),p=g(p,r,o,u,l[b+8],7,1770035416),u=g(u,p,r,o,l[b+9],12,2336552879),o=g(o,u,p,r,l[b+10],17,4294925233),r=g(r,o,u,p,l[b+11],22,2304563134),p=g(p,r,o,u,l[b+12],7,1804603682),u=g(u,p,r,o,l[b+13],12,4254626195),o=g(o,u,p,r,l[b+14],17,2792965006),r=g(r,o,u,p,l[b+15],22,1236535329),p=f(p,r,o,u,l[b+1],5,4129170786),
u=f(u,p,r,o,l[b+6],9,3225465664),o=f(o,u,p,r,l[b+11],14,643717713),r=f(r,o,u,p,l[b+0],20,3921069994),p=f(p,r,o,u,l[b+5],5,3593408605),u=f(u,p,r,o,l[b+10],9,38016083),o=f(o,u,p,r,l[b+15],14,3634488961),r=f(r,o,u,p,l[b+4],20,3889429448),p=f(p,r,o,u,l[b+9],5,568446438),u=f(u,p,r,o,l[b+14],9,3275163606),o=f(o,u,p,r,l[b+3],14,4107603335),r=f(r,o,u,p,l[b+8],20,1163531501),p=f(p,r,o,u,l[b+13],5,2850285829),u=f(u,p,r,o,l[b+2],9,4243563512),o=f(o,u,p,r,l[b+7],14,1735328473),r=f(r,o,u,p,l[b+12],20,2368359562),
p=i(p,r,o,u,l[b+5],4,4294588738),u=i(u,p,r,o,l[b+8],11,2272392833),o=i(o,u,p,r,l[b+11],16,1839030562),r=i(r,o,u,p,l[b+14],23,4259657740),p=i(p,r,o,u,l[b+1],4,2763975236),u=i(u,p,r,o,l[b+4],11,1272893353),o=i(o,u,p,r,l[b+7],16,4139469664),r=i(r,o,u,p,l[b+10],23,3200236656),p=i(p,r,o,u,l[b+13],4,681279174),u=i(u,p,r,o,l[b+0],11,3936430074),o=i(o,u,p,r,l[b+3],16,3572445317),r=i(r,o,u,p,l[b+6],23,76029189),p=i(p,r,o,u,l[b+9],4,3654602809),u=i(u,p,r,o,l[b+12],11,3873151461),o=i(o,u,p,r,l[b+15],16,530742520),
r=i(r,o,u,p,l[b+2],23,3299628645),p=k(p,r,o,u,l[b+0],6,4096336452),u=k(u,p,r,o,l[b+7],10,1126891415),o=k(o,u,p,r,l[b+14],15,2878612391),r=k(r,o,u,p,l[b+5],21,4237533241),p=k(p,r,o,u,l[b+12],6,1700485571),u=k(u,p,r,o,l[b+3],10,2399980690),o=k(o,u,p,r,l[b+10],15,4293915773),r=k(r,o,u,p,l[b+1],21,2240044497),p=k(p,r,o,u,l[b+8],6,1873313359),u=k(u,p,r,o,l[b+15],10,4264355552),o=k(o,u,p,r,l[b+6],15,2734768916),r=k(r,o,u,p,l[b+13],21,1309151649),p=k(p,r,o,u,l[b+4],6,4149444226),u=k(u,p,r,o,l[b+11],10,3174756917),
o=k(o,u,p,r,l[b+2],15,718787259),r=k(r,o,u,p,l[b+9],21,3951481745),p=c(p,w),r=c(r,q),o=c(o,t),u=c(u,y);return(v(p)+v(r)+v(o)+v(u)).toLowerCase()}}})(i);(function(b){function h(c){var f,c="SIP/2.0 "+c+" "+b.C.REASON_PHRASE[c]+"\r\n";f=g.countHeader("via");var h=0;for(h;h<f;h++)c+="Via: "+g.getHeader("via",h)+"\r\n";f=g.getHeader("To");g.to_tag||(f+=";tag="+b.Utils.newTag());c=c+("To: "+f+"\r\n")+("From: "+g.getHeader("From")+"\r\n");c+="Call-ID: "+g.call_id+"\r\n";c+="CSeq: "+g.cseq+" "+g.method+"\r\n";
i.send(c+"\r\n")}var c=b.name+" | SANITY CHECK | ",g,f,i,k=[],v=[],l=[];k.push(function(){if("sip"!==g.s("to").uri.scheme)return h(416),!1});k.push(function(){if(!g.to_tag&&g.call_id.substr(0,5)===f.configuration.jssip_id)return h(482),!1});k.push(function(){var c=b.Utils.str_utf8_length(g.body),f=g.getHeader("content-length");if(c<f)return h(400),!1});k.push(function(){var c,i,l=g.from_tag,n=g.call_id,k=g.cseq;if(!g.to_tag)if(g.method===b.C.INVITE){if(c=f.transactions.ist[g.via_branch])for(i in f.transactions.ist)if(c=
f.transactions.ist[i],c.request.from_tag===l&&c.request.call_id===n&&c.request.cseq===k)return h(482),!1}else if(c=f.transactions.nist[g.via_branch])for(i in f.transactions.nist)if(c=f.transactions.nist[i],c.request.from_tag===l&&c.request.call_id===n&&c.request.cseq===k)return h(482),!1});v.push(function(){if(1<g.countHeader("via"))return console.warn(c+"More than one Via header field present in the response. Dropping the response"),!1});v.push(function(){if(g.via.host!==f.configuration.via_host)return console.warn(c+
"Via host in the response does not match UA Via host value. Dropping the response"),!1});v.push(function(){var f=b.Utils.str_utf8_length(g.body),h=g.getHeader("content-length");if(f<h)return console.warn(c+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1});l.push(function(){for(var b=["from","to","call_id","cseq","via"],f=b.length;f--;)if(!g.hasHeader(b[f]))return console.warn(c+"Missing mandatory header field : "+b[f]+". Dropping the response"),
!1});b.sanityCheck=function(c,h,t){g=c;f=h;i=t;for(c=l.length;c--;)if(h=l[c](g),!1===h)return!1;if(g instanceof b.IncomingRequest)for(c=k.length;c--;){if(h=k[c](g),!1===h)return!1}else if(g instanceof b.IncomingResponse)for(c=v.length;c--;)if(h=v[c](g),!1===h)return!1;console.log("sanitycheck true");return!0}})(i);(function(b){var h,c=b.name+" | DIGEST AUTHENTICATION | ";h=function(b){this.username=b.configuration.authorization_user;this.password=b.configuration.password;this.cnonce=null;this.nc=
0;this.ncHex="00000000";this.response=null};h.prototype.authenticate=function(g,f){this.algorithm=f.algorithm;this.realm=f.realm;this.nonce=f.nonce;this.opaque=f.opaque;this.stale=f.stale;if(this.algorithm){if("MD5"!==this.algorithm)return console.warn(c+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return console.warn(c+"challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return console.warn(c+"challenge without Digest nonce, authentication aborted"),
!1;if(f.qop)if(-1<f.qop.indexOf("auth"))this.qop="auth";else if(-1<f.qop.indexOf("auth-int"))this.qop="auth-int";else return console.warn(c+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;else this.qop=null;this.method=g.method;this.uri=g.ruri;this.cnonce=b.Utils.createRandomToken(12);this.nc+=1;this.updateNcHex();4294967296===this.nc&&(this.nc=1,this.ncHex="00000001");this.calculateResponse();return!0};h.prototype.calculateResponse=function(){var c,
f;c=b.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password);"auth"===this.qop?(f=b.Utils.calculateMD5(this.method+":"+this.uri),this.response=b.Utils.calculateMD5(c+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+f)):"auth-int"===this.qop?(f=b.Utils.calculateMD5(this.method+":"+this.uri+":"+b.Utils.calculateMD5(this.body?this.body:"")),this.response=b.Utils.calculateMD5(c+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+f)):null===this.qop&&(f=b.Utils.calculateMD5(this.method+
":"+this.uri),this.response=b.Utils.calculateMD5(c+":"+this.nonce+":"+f))};h.prototype.toString=function(){var b=[];if(!this.response)throw Error("response field does not exist, cannot generate Authorization header");b.push("algorithm="+this.algorithm);b.push('username="'+this.username+'"');b.push('realm="'+this.realm+'"');b.push('nonce="'+this.nonce+'"');b.push('uri="'+this.uri+'"');b.push('response="'+this.response+'"');this.opaque&&b.push('opaque="'+this.opaque+'"');this.qop&&(b.push("qop="+this.qop),
b.push('cnonce="'+this.cnonce+'"'),b.push("nc="+this.ncHex));return"Digest "+b.join(", ")};h.prototype.updateNcHex=function(){var b=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-b.length)+b};b.DigestAuthentication=h})(i);(function(b){var h;h={};k.navigator.webkitGetUserMedia?h.getUserMedia=k.navigator.webkitGetUserMedia.bind(navigator):k.navigator.mozGetUserMedia?h.getUserMedia=k.navigator.mozGetUserMedia.bind(navigator):k.navigator.getUserMedia&&(h.getUserMedia=k.navigator.getUserMedia.bind(navigator));
k.webkitRTCPeerConnection?h.RTCPeerConnection=k.webkitRTCPeerConnection:k.mozRTCPeerConnection?h.RTCPeerConnection=k.mozRTCPeerConnection:k.RTCPeerConnection&&(h.RTCPeerConnection=k.RTCPeerConnection);k.webkitRTCSessionDescription?(console.log("webkit"),h.RTCSessionDescription=k.webkitRTCSessionDescription):k.mozRTCSessionDescription?(console.log("moz"),h.RTCSessionDescription=k.mozRTCSessionDescription):k.RTCSessionDescription&&(console.log("~~sdp"),h.RTCSessionDescription=k.RTCSessionDescription);
h.RTCPeerConnection&&h.RTCPeerConnection.prototype&&!h.RTCPeerConnection.prototype.getLocalStreams&&(h.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},h.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams});h.isSupported=h.getUserMedia&&h.RTCPeerConnection&&h.RTCSessionDescription?!0:!1;b.WebRTC=h})(i);k.JsSIP=i})(window);
JsSIP.Grammar=function(){function k(b){return'"'+b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var i={parse:function(b,h){function c(a){d<U||(d>U&&(U=d,Ba=[]),Ba.push(a))}function g(){var a;"\r\n"===b.substr(d,2)?(a="\r\n",d+=2):(a=null,0===m&&c('"\\r\\n"'));return a}function f(){var a;/^[0-9]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=
null,0===m&&c("[0-9]"));return a}function i(){var a;/^[a-zA-Z]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[a-zA-Z]"));return a}function x(){var a;/^[0-9a-fA-F]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[0-9a-fA-F]"));return a}function v(){var a;a=q();null===a&&(a=t());return a}function l(){var a;/^[\0-\xFF]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[\\0-\\xFF]"));return a}function w(){var a;/^["]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c('["]'));
return a}function q(){var a;32===b.charCodeAt(d)?(a=" ",d++):(a=null,0===m&&c('" "'));return a}function t(){var a;9===b.charCodeAt(d)?(a="\t",d++):(a=null,0===m&&c('"\\t"'));return a}function y(){var a;/^[a-zA-Z0-9]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[a-zA-Z0-9]"));return a}function p(){var a;59===b.charCodeAt(d)?(a=";",d++):(a=null,0===m&&c('";"'));if(null===a&&(47===b.charCodeAt(d)?(a="/",d++):(a=null,0===m&&c('"/"')),null===a))if(63===b.charCodeAt(d)?(a="?",d++):(a=null,0===
m&&c('"?"')),null===a)if(58===b.charCodeAt(d)?(a=":",d++):(a=null,0===m&&c('":"')),null===a)if(64===b.charCodeAt(d)?(a="@",d++):(a=null,0===m&&c('"@"')),null===a)if(38===b.charCodeAt(d)?(a="&",d++):(a=null,0===m&&c('"&"')),null===a)if(61===b.charCodeAt(d)?(a="=",d++):(a=null,0===m&&c('"="')),null===a)if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)if(36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"')),null===a)44===b.charCodeAt(d)?(a=",",d++):(a=null,0===m&&c('","'));return a}
function r(){var a;a=y();null===a&&(a=o());return a}function o(){var a;45===b.charCodeAt(d)?(a="-",d++):(a=null,0===m&&c('"-"'));if(null===a&&(95===b.charCodeAt(d)?(a="_",d++):(a=null,0===m&&c('"_"')),null===a))if(46===b.charCodeAt(d)?(a=".",d++):(a=null,0===m&&c('"."')),null===a)if(33===b.charCodeAt(d)?(a="!",d++):(a=null,0===m&&c('"!"')),null===a)if(126===b.charCodeAt(d)?(a="~",d++):(a=null,0===m&&c('"~"')),null===a)if(42===b.charCodeAt(d)?(a="*",d++):(a=null,0===m&&c('"*"')),null===a)if(39===b.charCodeAt(d)?
(a="'",d++):(a=null,0===m&&c('"\'"')),null===a)if(40===b.charCodeAt(d)?(a="(",d++):(a=null,0===m&&c('"("')),null===a)41===b.charCodeAt(d)?(a=")",d++):(a=null,0===m&&c('")"'));return a}function u(){var a,j,C,f;f=d;37===b.charCodeAt(d)?(a="%",d++):(a=null,0===m&&c('"%"'));null!==a?(j=x(),null!==j?(C=x(),null!==C?a=[a,j,C]:(a=null,d=f)):(a=null,d=f)):(a=null,d=f);return a}function G(){var a,b,c,f,h;c=h=f=d;a=[];for(b=v();null!==b;)a.push(b),b=v();null!==a?(b=g(),null!==b?a=[a,b]:(a=null,d=c)):(a=null,
d=c);a=null!==a?a:"";if(null!==a){c=v();if(null!==c)for(b=[];null!==c;)b.push(c),c=v();else b=null;null!==b?a=[a,b]:(a=null,d=h)}else a=null,d=h;null!==a&&(a=" ");null===a&&(d=f);return a}function F(){var a;a=G();return null!==a?a:""}function B(){var a,j,C,f,g;g=f=d;a=[];j=q();for(null===j&&(j=t());null!==j;)a.push(j),j=q(),null===j&&(j=t());null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a=
":");null===a&&(d=f);return a}function z(){var a,j,c,f,g,h,i;h=g=d;j=M();if(null!==j)for(a=[];null!==j;)a.push(j),j=M();else a=null;if(null!==a){j=[];i=d;c=[];for(f=G();null!==f;)c.push(f),f=G();null!==c?(f=M(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;){j.push(c);i=d;c=[];for(f=G();null!==f;)c.push(f),f=G();null!==c?(f=M(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i)}null!==j?a=[a,j]:(a=null,d=h)}else a=null,d=h;null!==a&&(a=b.substring(d,g));null===a&&(d=g);return a}function M(){var a;
/^[!-~]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[!-~]"));null===a&&(a=E());return a}function E(){var a;/^[\x80-\uFFFF]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[\\x80-\\uFFFF]"));return a}function K(){var a;/^[\x80-\xBF]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[\\x80-\\xBF]"));return a}function D(){var a,j,C;C=d;j=y();if(null===j&&(45===b.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===b.charCodeAt(d)?(j=".",d++):(j=null,0===m&&
c('"."')),null===j)if(33===b.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===b.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===b.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===b.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===b.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),
null===j)126===b.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"'));if(null!==j)for(a=[];null!==j;){if(a.push(j),j=y(),null===j&&(45===b.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===b.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null===j)if(33===b.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===b.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===b.charCodeAt(d)?
(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===b.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===b.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)126===b.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"'))}else a=null;null!==a&&(a=b.substring(d,C));null===a&&(d=C);return a}function P(){var a,j,C;C=d;j=y();if(null===j&&(45===b.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(33===
b.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===b.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===b.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===b.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===b.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)126===b.charCodeAt(d)?
(j="~",d++):(j=null,0===m&&c('"~"'));if(null!==j)for(a=[];null!==j;){if(a.push(j),j=y(),null===j&&(45===b.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(33===b.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===b.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===b.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),
null===j)if(96===b.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===b.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)126===b.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"'))}else a=null;null!==a&&(a=b.substring(d,C));null===a&&(d=C);return a}function N(){var a,j,C;C=d;j=y();if(null===j&&(45===b.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===b.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null===j)if(33===b.charCodeAt(d)?(j="!",d++):(j=
null,0===m&&c('"!"')),null===j)if(37===b.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===b.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===b.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===b.charCodeAt(d)?(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)if(126===b.charCodeAt(d)?(j="~",d++):(j=null,0===
m&&c('"~"')),null===j)if(40===b.charCodeAt(d)?(j="(",d++):(j=null,0===m&&c('"("')),null===j)if(41===b.charCodeAt(d)?(j=")",d++):(j=null,0===m&&c('")"')),null===j)if(60===b.charCodeAt(d)?(j="<",d++):(j=null,0===m&&c('"<"')),null===j)if(62===b.charCodeAt(d)?(j=">",d++):(j=null,0===m&&c('">"')),null===j)if(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(92===b.charCodeAt(d)?(j="\\",d++):(j=null,0===m&&c('"\\\\"')),null===j)if(j=w(),null===j&&(47===b.charCodeAt(d)?(j="/",d++):(j=
null,0===m&&c('"/"')),null===j))if(91===b.charCodeAt(d)?(j="[",d++):(j=null,0===m&&c('"["')),null===j)if(93===b.charCodeAt(d)?(j="]",d++):(j=null,0===m&&c('"]"')),null===j)if(63===b.charCodeAt(d)?(j="?",d++):(j=null,0===m&&c('"?"')),null===j)if(123===b.charCodeAt(d)?(j="{",d++):(j=null,0===m&&c('"{"')),null===j)125===b.charCodeAt(d)?(j="}",d++):(j=null,0===m&&c('"}"'));if(null!==j)for(a=[];null!==j;){if(a.push(j),j=y(),null===j&&(45===b.charCodeAt(d)?(j="-",d++):(j=null,0===m&&c('"-"')),null===j))if(46===
b.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null===j)if(33===b.charCodeAt(d)?(j="!",d++):(j=null,0===m&&c('"!"')),null===j)if(37===b.charCodeAt(d)?(j="%",d++):(j=null,0===m&&c('"%"')),null===j)if(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null===j)if(95===b.charCodeAt(d)?(j="_",d++):(j=null,0===m&&c('"_"')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(96===b.charCodeAt(d)?(j="`",d++):(j=null,0===m&&c('"`"')),null===j)if(39===b.charCodeAt(d)?
(j="'",d++):(j=null,0===m&&c('"\'"')),null===j)if(126===b.charCodeAt(d)?(j="~",d++):(j=null,0===m&&c('"~"')),null===j)if(40===b.charCodeAt(d)?(j="(",d++):(j=null,0===m&&c('"("')),null===j)if(41===b.charCodeAt(d)?(j=")",d++):(j=null,0===m&&c('")"')),null===j)if(60===b.charCodeAt(d)?(j="<",d++):(j=null,0===m&&c('"<"')),null===j)if(62===b.charCodeAt(d)?(j=">",d++):(j=null,0===m&&c('">"')),null===j)if(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(92===b.charCodeAt(d)?(j="\\",d++):
(j=null,0===m&&c('"\\\\"')),null===j)if(j=w(),null===j&&(47===b.charCodeAt(d)?(j="/",d++):(j=null,0===m&&c('"/"')),null===j))if(91===b.charCodeAt(d)?(j="[",d++):(j=null,0===m&&c('"["')),null===j)if(93===b.charCodeAt(d)?(j="]",d++):(j=null,0===m&&c('"]"')),null===j)if(63===b.charCodeAt(d)?(j="?",d++):(j=null,0===m&&c('"?"')),null===j)if(123===b.charCodeAt(d)?(j="{",d++):(j=null,0===m&&c('"{"')),null===j)125===b.charCodeAt(d)?(j="}",d++):(j=null,0===m&&c('"}"'))}else a=null;null!==a&&(a=b.substring(d,
C));null===a&&(d=C);return a}function fb(){var a,j,C,f,g;g=f=d;a=F();null!==a?(42===b.charCodeAt(d)?(j="*",d++):(j=null,0===m&&c('"*"')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a="*");null===a&&(d=f);return a}function ga(){var a,j,C,f,g;g=f=d;a=F();null!==a?(47===b.charCodeAt(d)?(j="/",d++):(j=null,0===m&&c('"/"')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a="/");null===a&&(d=f);return a}function H(){var a,
j,C,f,g;g=f=d;a=F();null!==a?(61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a="=");null===a&&(d=f);return a}function gb(){var a,j,C,f,g;g=f=d;a=F();null!==a?(40===b.charCodeAt(d)?(j="(",d++):(j=null,0===m&&c('"("')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a="(");null===a&&(d=f);return a}function hb(){var a,j,C,f,g;g=f=d;a=F();null!==a?(41===b.charCodeAt(d)?
(j=")",d++):(j=null,0===m&&c('")"')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a=")");null===a&&(d=f);return a}function Ca(){var a,j,C,f;f=C=d;62===b.charCodeAt(d)?(a=">",d++):(a=null,0===m&&c('">"'));null!==a?(j=F(),null!==j?a=[a,j]:(a=null,d=f)):(a=null,d=f);null!==a&&(a=">");null===a&&(d=C);return a}function Da(){var a,j,C,f;f=C=d;a=F();null!==a?(60===b.charCodeAt(d)?(j="<",d++):(j=null,0===m&&c('"<"')),null!==j)?a=[a,j]:(a=null,d=f):(a=null,d=f);null!==
a&&(a="<");null===a&&(d=C);return a}function I(){var a,j,C,f,g;g=f=d;a=F();null!==a?(44===b.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a=",");null===a&&(d=f);return a}function J(){var a,j,C,f,g;g=f=d;a=F();null!==a?(59===b.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a=";");null===a&&(d=f);return a}function ib(){var a,
j,C,f,g;g=f=d;a=F();null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(C=F(),null!==C?a=[a,j,C]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);null!==a&&(a=":");null===a&&(d=f);return a}function Ea(){var a,b,c,f;f=c=d;a=F();null!==a?(b=w(),null!==b?a=[a,b]:(a=null,d=f)):(a=null,d=f);null!==a&&(a='"');null===a&&(d=c);return a}function Fa(){var a,b,c,f;f=c=d;a=w();null!==a?(b=F(),null!==b?a=[a,b]:(a=null,d=f)):(a=null,d=f);null!==a&&(a='"');null===a&&(d=c);return a}function Ga(){var a,
b,c,f;f=d;a=gb();if(null!==a){b=[];c=Ha();null===c&&(c=Q(),null===c&&(c=Ga()));for(;null!==c;)b.push(c),c=Ha(),null===c&&(c=Q(),null===c&&(c=Ga()));null!==b?(c=hb(),null!==c?a=[a,b,c]:(a=null,d=f)):(a=null,d=f)}else a=null,d=f;return a}function Ha(){var a;/^[!-']/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[!-']"));if(null===a&&(/^[*-[]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[*-[]")),null===a))if(/^[\]-~]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[\\]-~]")),
null===a)a=E(),null===a&&(a=G());return a}function V(){var a,c,C,f,g,h;h=g=d;a=F();if(null!==a)if(c=w(),null!==c){C=[];f=W();for(null===f&&(f=Q());null!==f;)C.push(f),f=W(),null===f&&(f=Q());null!==C?(f=w(),null!==f?a=[a,c,C,f]:(a=null,d=h)):(a=null,d=h)}else a=null,d=h;else a=null,d=h;null!==a&&(a=b.substring(d,g));null===a&&(d=g);return a}function ha(){var a,c,f,g,h,i;i=h=d;a=F();if(null!==a)if(c=w(),null!==c){f=[];g=W();for(null===g&&(g=Q());null!==g;)f.push(g),g=W(),null===g&&(g=Q());null!==f?
(g=w(),null!==g?a=[a,c,f,g]:(a=null,d=i)):(a=null,d=i)}else a=null,d=i;else a=null,d=i;null!==a&&(a=b.substring(d-1,h+1));null===a&&(d=h);return a}function W(){var a;a=G();if(null===a&&(33===b.charCodeAt(d)?(a="!",d++):(a=null,0===m&&c('"!"')),null===a))if(/^[#-[]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[#-[]")),null===a)/^[\]-~]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[\\]-~]")),null===a&&(a=E());return a}function Q(){var a,j,f;f=d;92===b.charCodeAt(d)?(a="\\",d++):
(a=null,0===m&&c('"\\\\"'));if(null!==a){/^[\0-\t]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[\\0-\\t]"));if(null===j&&(/^[\x0B-\f]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[\\x0B-\\f]")),null===j))/^[\x0E-\u007f]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[\\x0E-\u007f]"));null!==j?a=[a,j]:(a=null,d=f)}else a=null,d=f;return a}function ia(){var a,j,f,g,h,i;i=h=d;a=Ia();null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=ja(),
f=null!==f?f:"",null!==f?(g=ka(),null!==g?a=[a,j,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i):(a=null,d=i);if(null!==a){try{s.uri=new JsSIP.URI(s.scheme,s.user,s.host,s.port),delete s.scheme,delete s.user,delete s.host,delete s.host_type,delete s.port}catch(l){s=-1}a=void 0}null===a&&(d=h);return a}function la(){var a,j,f,g,i,l,n,k;k=n=d;a=Ia();null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=ja(),f=null!==f?f:"",null!==f?(g=ka(),null!==g?(i=jb(),null!==i?(l=kb(),
l=null!==l?l:"",null!==l?a=[a,j,f,g,i,l]:(a=null,d=k)):(a=null,d=k)):(a=null,d=k)):(a=null,d=k)):(a=null,d=k):(a=null,d=k);if(null!==a){try{s.uri=new JsSIP.URI(s.scheme,s.user,s.host,s.port,s.uri_params,s.uri_headers),delete s.scheme,delete s.user,delete s.host,delete s.host_type,delete s.port,delete s.uri_params,"SIP_URI"===h&&(s=s.uri)}catch(p){s=-1}a=void 0}null===a&&(d=n);return a}function Ia(){var a,j;j=d;"sip"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"sip"'));null!==
a&&(s.scheme=a.toLowerCase(),a=void 0);null===a&&(d=j);return a}function ja(){var a,j,f,g,h,i;h=g=d;a=lb();null!==a?(i=d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=mb(),null!==f?j=[j,f]:(j=null,d=i)):(j=null,d=i),j=null!==j?j:"",null!==j)?(64===b.charCodeAt(d)?(f="@",d++):(f=null,0===m&&c('"@"')),null!==f)?a=[a,j,f]:(a=null,d=h):(a=null,d=h):(a=null,d=h);null!==a&&(s.user=window.decodeURIComponent(b.substring(d-1,g)),a=void 0);null===a&&(d=g);return a}function lb(){var a,
d;d=r();null===d&&(d=u(),null===d&&(d=Ja()));if(null!==d)for(a=[];null!==d;)a.push(d),d=r(),null===d&&(d=u(),null===d&&(d=Ja()));else a=null;return a}function Ja(){var a;38===b.charCodeAt(d)?(a="&",d++):(a=null,0===m&&c('"&"'));if(null===a&&(61===b.charCodeAt(d)?(a="=",d++):(a=null,0===m&&c('"="')),null===a))if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)if(36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"')),null===a)if(44===b.charCodeAt(d)?(a=",",d++):(a=null,0===m&&
c('","')),null===a)if(59===b.charCodeAt(d)?(a=";",d++):(a=null,0===m&&c('";"')),null===a)if(63===b.charCodeAt(d)?(a="?",d++):(a=null,0===m&&c('"?"')),null===a)47===b.charCodeAt(d)?(a="/",d++):(a=null,0===m&&c('"/"'));return a}function mb(){var a,j,f;f=d;a=[];j=r();if(null===j&&(j=u(),null===j&&(38===b.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)))if(61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===
j)if(36===b.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)44===b.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","'));for(;null!==j;)if(a.push(j),j=r(),null===j&&(j=u(),null===j&&(38===b.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)))if(61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)if(43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"')),null===j)if(36===b.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)44===b.charCodeAt(d)?(j=",",d++):
(j=null,0===m&&c('","'));null!==a&&(s.password=b.substring(d,f),a=void 0);null===a&&(d=f);return a}function ka(){var a,j,f,g,h;g=d;a=X();null!==a?(h=d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=Ka(),null!==f?j=[j,f]:(j=null,d=h)):(j=null,d=h),j=null!==j?j:"",null!==j)?a=[a,j]:(a=null,d=g):(a=null,d=g);return a}function X(){var a,c;c=d;a=La();null===a&&(a=R(),null===a&&(a=ma()));null!==a&&(s.host=b.substring(d,c).toLowerCase(),a=s.host);null===a&&(d=c);return a}function La(){var a,
j,f,g,h,i;h=g=d;a=[];i=d;j=Ma();null!==j?(46===b.charCodeAt(d)?(f=".",d++):(f=null,0===m&&c('"."')),null!==f)?j=[j,f]:(j=null,d=i):(j=null,d=i);for(;null!==j;)(a.push(j),i=d,j=Ma(),null!==j)?(46===b.charCodeAt(d)?(f=".",d++):(f=null,0===m&&c('"."')),null!==f)?j=[j,f]:(j=null,d=i):(j=null,d=i);null!==a?(j=nb(),null!==j)?(46===b.charCodeAt(d)?(f=".",d++):(f=null,0===m&&c('"."')),f=null!==f?f:"",null!==f)?a=[a,j,f]:(a=null,d=h):(a=null,d=h):(a=null,d=h);null!==a&&(s.host_type="domain",a=b.substring(d,
g));null===a&&(d=g);return a}function Ma(){var a,j;/^[a-zA-Z0-9_\-]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[a-zA-Z0-9_\\-]"));if(null!==j)for(a=[];null!==j;)a.push(j),/^[a-zA-Z0-9_\-]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[a-zA-Z0-9_\\-]"));else a=null;return a}function nb(){var a,j;/^[a-zA-Z_\-]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[a-zA-Z_\\-]"));if(null!==j)for(a=[];null!==j;)a.push(j),/^[a-zA-Z_\-]/.test(b.charAt(d))?(j=b.charAt(d),d++):
(j=null,0===m&&c("[a-zA-Z_\\-]"));else a=null;return a}function ma(){var a,j,f,g,h;h=g=d;91===b.charCodeAt(d)?(a="[",d++):(a=null,0===m&&c('"["'));null!==a?(j=Na(),null!==j)?(93===b.charCodeAt(d)?(f="]",d++):(f=null,0===m&&c('"]"')),null!==f)?a=[a,j,f]:(a=null,d=h):(a=null,d=h):(a=null,d=h);null!==a&&(s.host_type="IPv6",a=b.substring(d,g));null===a&&(d=g);return a}function Na(){var a,j,f,g,h,i,l,n,k,p,q,t,w,r,o;o=r=d;a=A();null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==
j)?(f=A(),null!==f)?(58===b.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g)?(h=A(),null!==h)?(58===b.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i)?(l=A(),null!==l)?(58===b.charCodeAt(d)?(n=":",d++):(n=null,0===m&&c('":"')),null!==n)?(k=A(),null!==k)?(58===b.charCodeAt(d)?(p=":",d++):(p=null,0===m&&c('":"')),null!==p)?(q=A(),null!==q)?(58===b.charCodeAt(d)?(t=":",d++):(t=null,0===m&&c('":"')),null!==t)?(w=O(),null!==w?a=[a,j,f,g,h,i,l,n,k,p,q,t,w]:(a=null,d=o)):(a=null,
d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o);if(null===a&&(o=d,"::"===b.substr(d,2)?(a="::",d+=2):(a=null,0===m&&c('"::"')),null!==a?(j=A(),null!==j)?(58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=A(),null!==g)?(58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=A(),null!==i)?(58===b.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=A(),
null!==n)?(58===b.charCodeAt(d)?(k=":",d++):(k=null,0===m&&c('":"')),null!==k)?(p=A(),null!==p)?(58===b.charCodeAt(d)?(q=":",d++):(q=null,0===m&&c('":"')),null!==q)?(t=O(),null!==t?a=[a,j,f,g,h,i,l,n,k,p,q,t]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a))if(o=d,"::"===b.substr(d,2)?(a="::",d+=2):(a=null,0===m&&c('"::"')),null!==a?(j=A(),null!==j)?(58===b.charCodeAt(d)?(f=":",d++):
(f=null,0===m&&c('":"')),null!==f)?(g=A(),null!==g)?(58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=A(),null!==i)?(58===b.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=A(),null!==n)?(58===b.charCodeAt(d)?(k=":",d++):(k=null,0===m&&c('":"')),null!==k)?(p=O(),null!==p?a=[a,j,f,g,h,i,l,n,k,p]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,"::"===b.substr(d,2)?
(a="::",d+=2):(a=null,0===m&&c('"::"')),null!==a?(j=A(),null!==j)?(58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=A(),null!==g)?(58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=A(),null!==i)?(58===b.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=O(),null!==n?a=[a,j,f,g,h,i,l,n]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,"::"===b.substr(d,2)?(a="::",d+=2):(a=
null,0===m&&c('"::"')),null!==a?(j=A(),null!==j)?(58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=A(),null!==g)?(58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=O(),null!==i?a=[a,j,f,g,h,i]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,"::"===b.substr(d,2)?(a="::",d+=2):(a=null,0===m&&c('"::"')),null!==a?(j=A(),null!==j)?(58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=O(),null!==
g?a=[a,j,f,g]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,"::"===b.substr(d,2)?(a="::",d+=2):(a=null,0===m&&c('"::"')),null!==a?(j=O(),null!==j?a=[a,j]:(a=null,d=o)):(a=null,d=o),null===a)if(o=d,"::"===b.substr(d,2)?(a="::",d+=2):(a=null,0===m&&c('"::"')),null!==a?(j=A(),null!==j?a=[a,j]:(a=null,d=o)):(a=null,d=o),null===a)if(o=d,a=A(),null!==a?("::"===b.substr(d,2)?(j="::",d+=2):(j=null,0===m&&c('"::"')),null!==j)?(f=A(),null!==f)?(58===b.charCodeAt(d)?(g=":",d++):(g=null,
0===m&&c('":"')),null!==g)?(h=A(),null!==h)?(58===b.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i)?(l=A(),null!==l)?(58===b.charCodeAt(d)?(n=":",d++):(n=null,0===m&&c('":"')),null!==n)?(k=A(),null!==k)?(58===b.charCodeAt(d)?(p=":",d++):(p=null,0===m&&c('":"')),null!==p)?(q=O(),null!==q?a=[a,j,f,g,h,i,l,n,k,p,q]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,a=A(),null!==a?
(k=d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=A(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?("::"===b.substr(d,2)?(f="::",d+=2):(f=null,0===m&&c('"::"')),null!==f)?(g=A(),null!==g)?(58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h)?(i=A(),null!==i)?(58===b.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l)?(n=A(),null!==n)?(58===b.charCodeAt(d)?(k=":",d++):(k=null,0===m&&c('":"')),null!==k)?(p=O(),null!==p?a=[a,j,
f,g,h,i,l,n,k,p]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,a=A(),null!==a?(k=d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=A(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=A(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?("::"===b.substr(d,2)?(g=
"::",d+=2):(g=null,0===m&&c('"::"')),null!==g)?(h=A(),null!==h)?(58===b.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i)?(l=A(),null!==l)?(58===b.charCodeAt(d)?(n=":",d++):(n=null,0===m&&c('":"')),null!==n)?(k=O(),null!==k?a=[a,j,f,g,h,i,l,n,k]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,a=A(),null!==a?(k=d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=A(),null!==f?j=[j,f]:
(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=A(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===b.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g?(h=A(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?("::"===b.substr(d,2)?(h="::",d+=2):(h=null,0===m&&c('"::"')),null!==h)?(i=A(),null!==i)?(58===b.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==
l)?(n=O(),null!==n?a=[a,j,f,g,h,i,l,n]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,a=A(),null!==a?(k=d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=A(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=A(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===b.charCodeAt(d)?(g=
":",d++):(g=null,0===m&&c('":"')),null!==g?(h=A(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?(k=d,58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h?(i=A(),null!==i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?("::"===b.substr(d,2)?(i="::",d+=2):(i=null,0===m&&c('"::"')),null!==i)?(l=O(),null!==l?a=[a,j,f,g,h,i,l]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)if(o=d,a=A(),null!==a?(k=
d,58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=A(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=A(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===b.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g?(h=A(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?(k=d,58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),
null!==h?(i=A(),null!==i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?(k=d,58===b.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i?(l=A(),null!==l?i=[i,l]:(i=null,d=k)):(i=null,d=k),i=null!==i?i:"",null!==i)?("::"===b.substr(d,2)?(l="::",d+=2):(l=null,0===m&&c('"::"')),null!==l)?(n=A(),null!==n?a=[a,j,f,g,h,i,l,n]:(a=null,d=o)):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o),null===a)(o=d,a=A(),null!==a)?(k=d,58===b.charCodeAt(d)?
(j=":",d++):(j=null,0===m&&c('":"')),null!==j?(f=A(),null!==f?j=[j,f]:(j=null,d=k)):(j=null,d=k),j=null!==j?j:"",null!==j)?(k=d,58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=A(),null!==g?f=[f,g]:(f=null,d=k)):(f=null,d=k),f=null!==f?f:"",null!==f)?(k=d,58===b.charCodeAt(d)?(g=":",d++):(g=null,0===m&&c('":"')),null!==g?(h=A(),null!==h?g=[g,h]:(g=null,d=k)):(g=null,d=k),g=null!==g?g:"",null!==g)?(k=d,58===b.charCodeAt(d)?(h=":",d++):(h=null,0===m&&c('":"')),null!==h?(i=A(),null!==
i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?(k=d,58===b.charCodeAt(d)?(i=":",d++):(i=null,0===m&&c('":"')),null!==i?(l=A(),null!==l?i=[i,l]:(i=null,d=k)):(i=null,d=k),i=null!==i?i:"",null!==i)?(k=d,58===b.charCodeAt(d)?(l=":",d++):(l=null,0===m&&c('":"')),null!==l?(n=A(),null!==n?l=[l,n]:(l=null,d=k)):(l=null,d=k),l=null!==l?l:"",null!==l)?("::"===b.substr(d,2)?(n="::",d+=2):(n=null,0===m&&c('"::"')),null!==n)?a=[a,j,f,g,h,i,l,n]:(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=
o):(a=null,d=o):(a=null,d=o):(a=null,d=o):(a=null,d=o);null!==a&&(s.host_type="IPv6",a=b.substring(d,r));null===a&&(d=r);return a}function A(){var a,b,c,f,g;g=d;a=x();null!==a?(b=x(),b=null!==b?b:"",null!==b?(c=x(),c=null!==c?c:"",null!==c?(f=x(),f=null!==f?f:"",null!==f?a=[a,b,c,f]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g)):(a=null,d=g);return a}function O(){var a,j,f,g;g=d;a=A();null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=A(),null!==f?a=[a,j,f]:(a=null,d=g)):
(a=null,d=g):(a=null,d=g);null===a&&(a=R());return a}function R(){var a,j,f,g,h,i,l,k,n;n=k=d;a=Y();null!==a?(46===b.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null!==j)?(f=Y(),null!==f)?(46===b.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."')),null!==g)?(h=Y(),null!==h)?(46===b.charCodeAt(d)?(i=".",d++):(i=null,0===m&&c('"."')),null!==i)?(l=Y(),null!==l?a=[a,j,f,g,h,i,l]:(a=null,d=n)):(a=null,d=n):(a=null,d=n):(a=null,d=n):(a=null,d=n):(a=null,d=n):(a=null,d=n);null!==a&&(s.host_type="IPv4",
a=b.substring(d,k));null===a&&(d=k);return a}function Y(){var a,j,g,h;h=d;"25"===b.substr(d,2)?(a="25",d+=2):(a=null,0===m&&c('"25"'));null!==a?(/^[0-5]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[0-5]")),null!==j)?a=[a,j]:(a=null,d=h):(a=null,d=h);if(null===a&&(h=d,50===b.charCodeAt(d)?(a="2",d++):(a=null,0===m&&c('"2"')),null!==a?(/^[0-4]/.test(b.charAt(d))?(j=b.charAt(d),d++):(j=null,0===m&&c("[0-4]")),null!==j)?(g=f(),null!==g?a=[a,j,g]:(a=null,d=h)):(a=null,d=h):(a=null,d=h),null===
a))if(h=d,49===b.charCodeAt(d)?(a="1",d++):(a=null,0===m&&c('"1"')),null!==a?(j=f(),null!==j?(g=f(),null!==g?a=[a,j,g]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h),null===a)h=d,/^[1-9]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[1-9]")),null!==a?(j=f(),null!==j?a=[a,j]:(a=null,d=h)):(a=null,d=h),null===a&&(a=f());return a}function Ka(){var a,b,c,g,h,i,l;l=i=d;a=f();a=null!==a?a:"";null!==a?(b=f(),b=null!==b?b:"",null!==b?(c=f(),c=null!==c?c:"",null!==c?(g=f(),g=null!==g?g:"",null!==g?(h=
f(),h=null!==h?h:"",null!==h?a=[a,b,c,g,h]:(a=null,d=l)):(a=null,d=l)):(a=null,d=l)):(a=null,d=l)):(a=null,d=l);null!==a&&(a=parseInt(a.join("")),s.port=a);null===a&&(d=i);return a}function jb(){var a,j,f,g;a=[];g=d;59===b.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"'));null!==j?(f=Oa(),null!==f?j=[j,f]:(j=null,d=g)):(j=null,d=g);for(;null!==j;)(a.push(j),g=d,59===b.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null!==j)?(f=Oa(),null!==f?j=[j,f]:(j=null,d=g)):(j=null,d=g);return a}function Oa(){var a;
a=ob();null===a&&(a=pb(),null===a&&(a=qb(),null===a&&(a=rb(),null===a&&(a=sb(),null===a&&(a=tb(),null===a&&(a=ub()))))));return a}function ob(){var a,j,f,g;g=f=d;"transport="===b.substr(d,10).toLowerCase()?(a=b.substr(d,10),d+=10):(a=null,0===m&&c('"transport="'));if(null!==a){"udp"===b.substr(d,3).toLowerCase()?(j=b.substr(d,3),d+=3):(j=null,0===m&&c('"udp"'));if(null===j&&("tcp"===b.substr(d,3).toLowerCase()?(j=b.substr(d,3),d+=3):(j=null,0===m&&c('"tcp"')),null===j))if("sctp"===b.substr(d,4).toLowerCase()?
(j=b.substr(d,4),d+=4):(j=null,0===m&&c('"sctp"')),null===j)"tls"===b.substr(d,3).toLowerCase()?(j=b.substr(d,3),d+=3):(j=null,0===m&&c('"tls"')),null===j&&(j=D());null!==j?a=[a,j]:(a=null,d=g)}else a=null,d=g;null!==a&&(a=a[1],s.uri_params||(s.uri_params={}),s.uri_params.transport=a.toLowerCase(),a=void 0);null===a&&(d=f);return a}function pb(){var a,j,f,g;g=f=d;"user="===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"user="'));null!==a?("phone"===b.substr(d,5).toLowerCase()?
(j=b.substr(d,5),d+=5):(j=null,0===m&&c('"phone"')),null===j&&("ip"===b.substr(d,2).toLowerCase()?(j=b.substr(d,2),d+=2):(j=null,0===m&&c('"ip"')),null===j&&(j=D())),null!==j)?a=[a,j]:(a=null,d=g):(a=null,d=g);null!==a&&(a=a[1],s.uri_params||(s.uri_params={}),s.uri_params.user=a.toLowerCase(),a=void 0);null===a&&(d=f);return a}function qb(){var a,j,f,g;g=f=d;"method="===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"method="'));null!==a?(j=na(),null!==j?a=[a,j]:(a=null,d=g)):
(a=null,d=g);null!==a&&(a=a[1],s.uri_params||(s.uri_params={}),s.uri_params.method=a,a=void 0);null===a&&(d=f);return a}function rb(){var a,j,f,g;g=f=d;"ttl="===b.substr(d,4).toLowerCase()?(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"ttl="'));null!==a?(j=Pa(),null!==j?a=[a,j]:(a=null,d=g)):(a=null,d=g);null!==a&&(a=a[1],s.params||(s.params={}),s.params.ttl=a,a=void 0);null===a&&(d=f);return a}function sb(){var a,j,f,g;g=f=d;"maddr="===b.substr(d,6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&
c('"maddr="'));null!==a?(j=X(),null!==j?a=[a,j]:(a=null,d=g)):(a=null,d=g);null!==a&&(a=a[1],s.uri_params||(s.uri_params={}),s.uri_params.maddr=a,a=void 0);null===a&&(d=f);return a}function tb(){var a,j,f,g,h,i;h=g=d;"lr"===b.substr(d,2).toLowerCase()?(a=b.substr(d,2),d+=2):(a=null,0===m&&c('"lr"'));null!==a?(i=d,61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j?(f=D(),null!==f?j=[j,f]:(j=null,d=i)):(j=null,d=i),j=null!==j?j:"",null!==j)?a=[a,j]:(a=null,d=h):(a=null,d=h);null!==a&&
(s.uri_params||(s.uri_params={}),a=s.uri_params.lr=void 0);null===a&&(d=g);return a}function ub(){var a,j,f,g,h,i;h=g=d;a=vb();null!==a?(i=d,61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j?(f=wb(),null!==f?j=[j,f]:(j=null,d=i)):(j=null,d=i),j=null!==j?j:"",null!==j)?a=[a,j]:(a=null,d=h):(a=null,d=h);null!==a&&(j=a[0],a=a[1],s.uri_params||(s.uri_params={}),a="undefined"===typeof a?void 0:a[1],s.uri_params[j.toLowerCase()]=a&&a.toLowerCase(),a=void 0);null===a&&(d=g);return a}function vb(){var a,
b,c;c=d;b=Z();if(null!==b)for(a=[];null!==b;)a.push(b),b=Z();else a=null;null!==a&&(a=a.join(""));null===a&&(d=c);return a}function wb(){var a,b,c;c=d;b=Z();if(null!==b)for(a=[];null!==b;)a.push(b),b=Z();else a=null;null!==a&&(a=a.join(""));null===a&&(d=c);return a}function Z(){var a;a=xb();null===a&&(a=r(),null===a&&(a=u()));return a}function xb(){var a;91===b.charCodeAt(d)?(a="[",d++):(a=null,0===m&&c('"["'));if(null===a&&(93===b.charCodeAt(d)?(a="]",d++):(a=null,0===m&&c('"]"')),null===a))if(47===
b.charCodeAt(d)?(a="/",d++):(a=null,0===m&&c('"/"')),null===a)if(58===b.charCodeAt(d)?(a=":",d++):(a=null,0===m&&c('":"')),null===a)if(38===b.charCodeAt(d)?(a="&",d++):(a=null,0===m&&c('"&"')),null===a)if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"'));return a}function kb(){var a,j,f,g,h,i,l;i=d;63===b.charCodeAt(d)?(a="?",d++):(a=null,0===m&&c('"?"'));if(null!==a)if(j=oa(),null!==j){f=[];l=d;38===b.charCodeAt(d)?(g="&",
d++):(g=null,0===m&&c('"&"'));null!==g?(h=oa(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)(f.push(g),l=d,38===b.charCodeAt(d)?(g="&",d++):(g=null,0===m&&c('"&"')),null!==g)?(h=oa(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?a=[a,j,f]:(a=null,d=i)}else a=null,d=i;else a=null,d=i;return a}function oa(){var a,j,f,g,h;h=g=d;a=yb();null!==a?(61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null!==j)?(f=zb(),null!==f?a=[a,j,f]:(a=null,d=h)):(a=null,d=h):(a=null,d=h);null!==
a&&(j=a[0],a=a[2],j=j.join("").toLowerCase(),a=a.join(""),s.uri_headers||(s.uri_headers={}),s.uri_headers[j]?s.uri_headers[j].push(a):s.uri_headers[j]=[a],a=void 0);null===a&&(d=g);return a}function yb(){var a,d;d=aa();null===d&&(d=r(),null===d&&(d=u()));if(null!==d)for(a=[];null!==d;)a.push(d),d=aa(),null===d&&(d=r(),null===d&&(d=u()));else a=null;return a}function zb(){var a,d;a=[];d=aa();null===d&&(d=r(),null===d&&(d=u()));for(;null!==d;)a.push(d),d=aa(),null===d&&(d=r(),null===d&&(d=u()));return a}
function aa(){var a;91===b.charCodeAt(d)?(a="[",d++):(a=null,0===m&&c('"["'));if(null===a&&(93===b.charCodeAt(d)?(a="]",d++):(a=null,0===m&&c('"]"')),null===a))if(47===b.charCodeAt(d)?(a="/",d++):(a=null,0===m&&c('"/"')),null===a)if(63===b.charCodeAt(d)?(a="?",d++):(a=null,0===m&&c('"?"')),null===a)if(58===b.charCodeAt(d)?(a=":",d++):(a=null,0===m&&c('":"')),null===a)if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"'));return a}
function Ab(){var a,b,c,f,g,h;h=d;a=na();null!==a?(b=q(),null!==b?(c=Bb(),null!==c?(f=q(),null!==f?(g=Qa(),null!==g?a=[a,b,c,f,g]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h)):(a=null,d=h)):(a=null,d=h);return a}function Bb(){var a;a=la();null===a&&(a=Ra());return a}function Ra(){var a,j,f,g;g=d;a=Cb();null!==a?(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null!==j)?(f=Db(),null===f&&(f=Eb()),null!==f?a=[a,j,f]:(a=null,d=g)):(a=null,d=g):(a=null,d=g);return a}function Db(){var a,j,f,g,h;
g=d;a=Fb();null===a&&(a=pa());null!==a?(h=d,63===b.charCodeAt(d)?(j="?",d++):(j=null,0===m&&c('"?"')),null!==j?(f=Gb(),null!==f?j=[j,f]:(j=null,d=h)):(j=null,d=h),j=null!==j?j:"",null!==j)?a=[a,j]:(a=null,d=g):(a=null,d=g);return a}function Fb(){var a,j,f,g;g=d;"//"===b.substr(d,2)?(a="//",d+=2):(a=null,0===m&&c('"//"'));null!==a?(j=Hb(),null!==j?(f=pa(),f=null!==f?f:"",null!==f?a=[a,j,f]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g);return a}function pa(){var a,j,f;f=d;47===b.charCodeAt(d)?(a="/",d++):
(a=null,0===m&&c('"/"'));null!==a?(j=Ib(),null!==j?a=[a,j]:(a=null,d=f)):(a=null,d=f);return a}function Eb(){var a,b,c,f;f=d;a=Jb();if(null!==a){b=[];for(c=ba();null!==c;)b.push(c),c=ba();null!==b?a=[a,b]:(a=null,d=f)}else a=null,d=f;return a}function ba(){var a;a=p();null===a&&(a=r(),null===a&&(a=u()));return a}function Jb(){var a;a=r();if(null===a&&(a=u(),null===a&&(59===b.charCodeAt(d)?(a=";",d++):(a=null,0===m&&c('";"')),null===a)))if(63===b.charCodeAt(d)?(a="?",d++):(a=null,0===m&&c('"?"')),
null===a)if(58===b.charCodeAt(d)?(a=":",d++):(a=null,0===m&&c('":"')),null===a)if(64===b.charCodeAt(d)?(a="@",d++):(a=null,0===m&&c('"@"')),null===a)if(38===b.charCodeAt(d)?(a="&",d++):(a=null,0===m&&c('"&"')),null===a)if(61===b.charCodeAt(d)?(a="=",d++):(a=null,0===m&&c('"="')),null===a)if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)if(36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"')),null===a)44===b.charCodeAt(d)?(a=",",d++):(a=null,0===m&&c('","'));return a}function Ib(){var a,
j,f,g,h,i;h=d;a=qa();if(null!==a){j=[];i=d;47===b.charCodeAt(d)?(f="/",d++):(f=null,0===m&&c('"/"'));null!==f?(g=qa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);for(;null!==f;)(j.push(f),i=d,47===b.charCodeAt(d)?(f="/",d++):(f=null,0===m&&c('"/"')),null!==f)?(g=qa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);null!==j?a=[a,j]:(a=null,d=h)}else a=null,d=h;return a}function qa(){var a,j,f,g,h,i;h=d;a=[];for(j=ca();null!==j;)a.push(j),j=ca();if(null!==a){j=[];i=d;59===b.charCodeAt(d)?(f=";",d++):(f=
null,0===m&&c('";"'));null!==f?(g=Sa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);for(;null!==f;)(j.push(f),i=d,59===b.charCodeAt(d)?(f=";",d++):(f=null,0===m&&c('";"')),null!==f)?(g=Sa(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i);null!==j?a=[a,j]:(a=null,d=h)}else a=null,d=h;return a}function Sa(){var a,d;a=[];for(d=ca();null!==d;)a.push(d),d=ca();return a}function ca(){var a;a=r();if(null===a&&(a=u(),null===a&&(58===b.charCodeAt(d)?(a=":",d++):(a=null,0===m&&c('":"')),null===a)))if(64===b.charCodeAt(d)?
(a="@",d++):(a=null,0===m&&c('"@"')),null===a)if(38===b.charCodeAt(d)?(a="&",d++):(a=null,0===m&&c('"&"')),null===a)if(61===b.charCodeAt(d)?(a="=",d++):(a=null,0===m&&c('"="')),null===a)if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)if(36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"')),null===a)44===b.charCodeAt(d)?(a=",",d++):(a=null,0===m&&c('","'));return a}function Cb(){var a,j,g,h,l;l=h=d;a=i();if(null!==a){j=[];g=i();if(null===g&&(g=f(),null===g&&(43===b.charCodeAt(d)?
(g="+",d++):(g=null,0===m&&c('"+"')),null===g)))if(45===b.charCodeAt(d)?(g="-",d++):(g=null,0===m&&c('"-"')),null===g)46===b.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."'));for(;null!==g;)if(j.push(g),g=i(),null===g&&(g=f(),null===g&&(43===b.charCodeAt(d)?(g="+",d++):(g=null,0===m&&c('"+"')),null===g)))if(45===b.charCodeAt(d)?(g="-",d++):(g=null,0===m&&c('"-"')),null===g)46===b.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."'));null!==j?a=[a,j]:(a=null,d=l)}else a=null,d=l;null!==a&&(s.scheme=
b.substring(d,h),a=void 0);null===a&&(d=h);return a}function Hb(){var a;a=Kb();null===a&&(a=da());return a}function Kb(){var a,j,f,g;g=f=d;a=ja();null!==a?(64===b.charCodeAt(d)?(j="@",d++):(j=null,0===m&&c('"@"')),null!==j)?a=[a,j]:(a=null,d=g):(a=null,d=g);a=null!==a?a:"";null!==a?(j=ka(),null!==j?a=[a,j]:(a=null,d=f)):(a=null,d=f);return null!==a?a:""}function da(){var a,j;j=r();if(null===j&&(j=u(),null===j&&(36===b.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)))if(44===b.charCodeAt(d)?
(j=",",d++):(j=null,0===m&&c('","')),null===j)if(59===b.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null===j)if(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(64===b.charCodeAt(d)?(j="@",d++):(j=null,0===m&&c('"@"')),null===j)if(38===b.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)if(61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&c('"="')),null===j)43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"'));if(null!==j)for(a=[];null!==j;){if(a.push(j),j=
r(),null===j&&(j=u(),null===j&&(36===b.charCodeAt(d)?(j="$",d++):(j=null,0===m&&c('"$"')),null===j)))if(44===b.charCodeAt(d)?(j=",",d++):(j=null,0===m&&c('","')),null===j)if(59===b.charCodeAt(d)?(j=";",d++):(j=null,0===m&&c('";"')),null===j)if(58===b.charCodeAt(d)?(j=":",d++):(j=null,0===m&&c('":"')),null===j)if(64===b.charCodeAt(d)?(j="@",d++):(j=null,0===m&&c('"@"')),null===j)if(38===b.charCodeAt(d)?(j="&",d++):(j=null,0===m&&c('"&"')),null===j)if(61===b.charCodeAt(d)?(j="=",d++):(j=null,0===m&&
c('"="')),null===j)43===b.charCodeAt(d)?(j="+",d++):(j=null,0===m&&c('"+"'))}else a=null;return a}function Gb(){var a,d;a=[];for(d=ba();null!==d;)a.push(d),d=ba();return a}function Qa(){var a,j,g,h,i,l,k,n;n=k=d;"sip"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"SIP"'));if(null!==a)if(47===b.charCodeAt(d)?(j="/",d++):(j=null,0===m&&c('"/"')),null!==j){h=f();if(null!==h)for(g=[];null!==h;)g.push(h),h=f();else g=null;if(null!==g)if(46===b.charCodeAt(d)?(h=".",d++):(h=null,
0===m&&c('"."')),null!==h){l=f();if(null!==l)for(i=[];null!==l;)i.push(l),l=f();else i=null;null!==i?a=[a,j,g,h,i]:(a=null,d=n)}else a=null,d=n;else a=null,d=n}else a=null,d=n;else a=null,d=n;null!==a&&(s.sip_version=b.substring(d,k),a=void 0);null===a&&(d=k);return a}function Lb(){var a;"INVITE"===b.substr(d,6)?(a="INVITE",d+=6):(a=null,0===m&&c('"INVITE"'));return a}function Mb(){var a;"ACK"===b.substr(d,3)?(a="ACK",d+=3):(a=null,0===m&&c('"ACK"'));return a}function Nb(){var a;"OPTIONS"===b.substr(d,
7)?(a="OPTIONS",d+=7):(a=null,0===m&&c('"OPTIONS"'));return a}function Ob(){var a;"BYE"===b.substr(d,3)?(a="BYE",d+=3):(a=null,0===m&&c('"BYE"'));return a}function Pb(){var a;"CANCEL"===b.substr(d,6)?(a="CANCEL",d+=6):(a=null,0===m&&c('"CANCEL"'));return a}function Qb(){var a;"REGISTER"===b.substr(d,8)?(a="REGISTER",d+=8):(a=null,0===m&&c('"REGISTER"'));return a}function Rb(){var a;"SUBSCRIBE"===b.substr(d,9)?(a="SUBSCRIBE",d+=9):(a=null,0===m&&c('"SUBSCRIBE"'));return a}function Sb(){var a;"NOTIFY"===
b.substr(d,6)?(a="NOTIFY",d+=6):(a=null,0===m&&c('"NOTIFY"'));return a}function na(){var a,c;c=d;a=Lb();null===a&&(a=Mb(),null===a&&(a=Nb(),null===a&&(a=Ob(),null===a&&(a=Pb(),null===a&&(a=Qb(),null===a&&(a=Rb(),null===a&&(a=Sb(),null===a&&(a=D()))))))));null!==a&&(s.method=b.substring(d,c),a=s.method);null===a&&(d=c);return a}function Tb(){var a,b,c,f,g,h;h=d;a=Qa();null!==a?(b=q(),null!==b?(c=Ub(),null!==c?(f=q(),null!==f?(g=Vb(),null!==g?a=[a,b,c,f,g]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h)):
(a=null,d=h)):(a=null,d=h);return a}function Ub(){var a,b;b=d;a=Wb();null!==a&&(s.status_code=parseInt(a.join("")),a=void 0);null===a&&(d=b);return a}function Wb(){var a,b,c,g;g=d;a=f();null!==a?(b=f(),null!==b?(c=f(),null!==c?a=[a,b,c]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g);return a}function Vb(){var a,c,f;f=d;a=[];c=p();null===c&&(c=r(),null===c&&(c=u(),null===c&&(c=E(),null===c&&(c=K(),null===c&&(c=q(),null===c&&(c=t()))))));for(;null!==c;)a.push(c),c=p(),null===c&&(c=r(),null===c&&(c=u(),null===
c&&(c=E(),null===c&&(c=K(),null===c&&(c=q(),null===c&&(c=t()))))));null!==a&&(s.reason_phrase=b.substring(d,f),a=void 0);null===a&&(d=f);return a}function ra(){var a,b,c,f,g,h,i;h=g=d;a=ia();null===a&&(a=S());if(null!==a){b=[];i=d;c=J();null!==c?(f=Ta(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)b.push(c),i=d,c=J(),null!==c?(f=Ta(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==b?a=[a,b]:(a=null,d=h)}else a=null,d=h;if(null!==a){var l;s.multi_header||(s.multi_header=[]);try{l=
new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params),delete s.uri,delete s.display_name,delete s.params}catch(m){l=null}s.multi_header.push({possition:d,offset:g,parsed:l});a=void 0}null===a&&(d=g);return a}function S(){var a,b,c,f,g;g=d;a=sa();a=null!==a?a:"";null!==a?(b=Da(),null!==b?(c=la(),null!==c?(f=Ca(),null!==f?a=[a,b,c,f]:(a=null,d=g)):(a=null,d=g)):(a=null,d=g)):(a=null,d=g);return a}function sa(){var a,c,f,g,h,i,l;i=h=d;a=D();if(null!==a){c=[];l=d;f=G();null!==f?(g=D(),null!==g?f=[f,
g]:(f=null,d=l)):(f=null,d=l);for(;null!==f;)c.push(f),l=d,f=G(),null!==f?(g=D(),null!==g?f=[f,g]:(f=null,d=l)):(f=null,d=l);null!==c?a=[a,c]:(a=null,d=i)}else a=null,d=i;null===a&&(a=V());null!==a&&(a=b.substring(d,h).trim(),'"'===a[0]&&(a=a.substring(1,a.length-1)),s.display_name=a,a=void 0);null===a&&(d=h);return a}function Ta(){var a;a=Xb();null===a&&(a=Yb(),null===a&&(a=L()));return a}function Xb(){var a,f,g,h,i;i=h=d;"q"===b.substr(d,1).toLowerCase()?(a=b.substr(d,1),d++):(a=null,0===m&&c('"q"'));
null!==a?(f=H(),null!==f?(g=Zb(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(a=a[2],s.params||(s.params={}),s.params.q=a,a=void 0);null===a&&(d=h);return a}function Yb(){var a,f,g,h,i;i=h=d;"expires"===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"expires"'));null!==a?(f=H(),null!==f?(g=T(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(a=a[2],s.params||(s.params={}),s.params.expires=a,a=void 0);null===a&&(d=h);return a}function T(){var a,
b,c;c=d;b=f();if(null!==b)for(a=[];null!==b;)a.push(b),b=f();else a=null;null!==a&&(a=parseInt(a.join("")));null===a&&(d=c);return a}function Zb(){var a,j,g,h,i,l,k,n;k=l=d;48===b.charCodeAt(d)?(a="0",d++):(a=null,0===m&&c('"0"'));null!==a?(n=d,46===b.charCodeAt(d)?(j=".",d++):(j=null,0===m&&c('"."')),null!==j?(g=f(),g=null!==g?g:"",null!==g?(h=f(),h=null!==h?h:"",null!==h?(i=f(),i=null!==i?i:"",null!==i?j=[j,g,h,i]:(j=null,d=n)):(j=null,d=n)):(j=null,d=n)):(j=null,d=n),j=null!==j?j:"",null!==j)?
a=[a,j]:(a=null,d=k):(a=null,d=k);null!==a&&(a=parseFloat(b.substring(d,l)));null===a&&(d=l);return a}function L(){var a,b,c,f,g,h;g=f=d;a=D();null!==a?(h=d,b=H(),null!==b?(c=$b(),null!==c?b=[b,c]:(b=null,d=h)):(b=null,d=h),b=null!==b?b:"",null!==b)?a=[a,b]:(a=null,d=g):(a=null,d=g);null!==a&&(b=a[0],a=a[1],s.params||(s.params={}),a="undefined"===typeof a?void 0:a[1],s.params[b.toLowerCase()]=a,a=void 0);null===a&&(d=f);return a}function $b(){var a;a=D();null===a&&(a=X(),null===a&&(a=V()));return a}
function ac(){var a;"render"===b.substr(d,6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"render"'));if(null===a&&("session"===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"session"')),null===a))if("icon"===b.substr(d,4).toLowerCase()?(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"icon"')),null===a)"alert"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"alert"')),null===a&&(a=D());return a}function Ua(){var a;a=bc();null===a&&(a=L());return a}
function bc(){var a,f,g,h;h=d;"handling"===b.substr(d,8).toLowerCase()?(a=b.substr(d,8),d+=8):(a=null,0===m&&c('"handling"'));null!==a?(f=H(),null!==f)?("optional"===b.substr(d,8).toLowerCase()?(g=b.substr(d,8),d+=8):(g=null,0===m&&c('"optional"')),null===g&&("required"===b.substr(d,8).toLowerCase()?(g=b.substr(d,8),d+=8):(g=null,0===m&&c('"required"')),null===g&&(g=D())),null!==g)?a=[a,f,g]:(a=null,d=h):(a=null,d=h):(a=null,d=h);return a}function cc(){var a,b,c,f,g,h,i,l;i=d;a=dc();if(null!==a)if(b=
ga(),null!==b)if(c=ec(),null!==c){f=[];l=d;g=J();null!==g?(h=Va(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)f.push(g),l=d,g=J(),null!==g?(h=Va(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?a=[a,b,c,f]:(a=null,d=i)}else a=null,d=i;else a=null,d=i;else a=null,d=i;return a}function dc(){var a;a=fc();null===a&&(a=gc());return a}function fc(){var a;"text"===b.substr(d,4).toLowerCase()?(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"text"'));if(null===a&&("image"===b.substr(d,5).toLowerCase()?
(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"image"')),null===a))if("audio"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"audio"')),null===a)if("video"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"video"')),null===a)"application"===b.substr(d,11).toLowerCase()?(a=b.substr(d,11),d+=11):(a=null,0===m&&c('"application"')),null===a&&(a=ta());return a}function gc(){var a;"message"===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"message"'));
null===a&&("multipart"===b.substr(d,9).toLowerCase()?(a=b.substr(d,9),d+=9):(a=null,0===m&&c('"multipart"')),null===a&&(a=ta()));return a}function ta(){var a;a=D();null===a&&(a=hc());return a}function hc(){var a,f,g;g=d;"x-"===b.substr(d,2).toLowerCase()?(a=b.substr(d,2),d+=2):(a=null,0===m&&c('"x-"'));null!==a?(f=D(),null!==f?a=[a,f]:(a=null,d=g)):(a=null,d=g);return a}function ec(){var a;a=ta();null===a&&(a=D());return a}function Va(){var a,b,c,f;f=d;a=D();null!==a?(b=H(),null!==b?(c=ic(),null!==
c?a=[a,b,c]:(a=null,d=f)):(a=null,d=f)):(a=null,d=f);return a}function ic(){var a;a=D();null===a&&(a=V());return a}function jc(){var a,b,c;c=d;b=f();if(null!==b)for(a=[];null!==b;)a.push(b),b=f();else a=null;null!==a&&(s.value=parseInt(a.join("")),a=void 0);null===a&&(d=c);return a}function ea(){var a,f,g,h,i,l;i=d;a=P();if(null!==a){f=[];l=d;46===b.charCodeAt(d)?(g=".",d++):(g=null,0===m&&c('"."'));null!==g?(h=P(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)(f.push(g),l=d,46===b.charCodeAt(d)?
(g=".",d++):(g=null,0===m&&c('"."')),null!==g)?(h=P(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?a=[a,f]:(a=null,d=i)}else a=null,d=i;return a}function Wa(){var a;a=Xa();null===a&&(a=L());return a}function Xa(){var a,f,g,h,i;i=h=d;"tag"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"tag"'));null!==a?(f=H(),null!==f?(g=D(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(s.tag=a[2],a=void 0);null===a&&(d=h);return a}function Ya(){var a,f,g,h,
i,l,k,n;k=d;"digest"===b.substr(d,6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"Digest"'));if(null!==a)if(f=G(),null!==f)if(g=ua(),null!==g){h=[];n=d;i=I();null!==i?(l=ua(),null!==l?i=[i,l]:(i=null,d=n)):(i=null,d=n);for(;null!==i;)h.push(i),n=d,i=I(),null!==i?(l=ua(),null!==l?i=[i,l]:(i=null,d=n)):(i=null,d=n);null!==h?a=[a,f,g,h]:(a=null,d=k)}else a=null,d=k;else a=null,d=k;else a=null,d=k;null===a&&(a=kc());return a}function kc(){var a,b,c,f,g,h,i,l;i=d;a=D();if(null!==a)if(b=G(),
null!==b)if(c=fa(),null!==c){f=[];l=d;g=I();null!==g?(h=fa(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)f.push(g),l=d,g=I(),null!==g?(h=fa(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?a=[a,b,c,f]:(a=null,d=i)}else a=null,d=i;else a=null,d=i;else a=null,d=i;return a}function fa(){var a,b,c,f;f=d;a=D();null!==a?(b=H(),null!==b?(c=D(),null===c&&(c=V()),null!==c?a=[a,b,c]:(a=null,d=f)):(a=null,d=f)):(a=null,d=f);return a}function ua(){var a;a=lc();null===a&&(a=mc(),null===a&&
(a=nc(),null===a&&(a=oc(),null===a&&(a=pc(),null===a&&(a=qc(),null===a&&(a=rc(),null===a&&(a=fa())))))));return a}function lc(){var a,f,g,h;h=d;"realm"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"realm"'));null!==a?(f=H(),null!==f?(g=sc(),null!==g?a=[a,f,g]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h);return a}function sc(){var a,b;b=d;a=ha();null!==a&&(s.realm=a,a=void 0);null===a&&(d=b);return a}function mc(){var a,f,g,h,i,l,k,n,o;n=d;"domain"===b.substr(d,6).toLowerCase()?
(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"domain"'));if(null!==a)if(f=H(),null!==f)if(g=Ea(),null!==g)if(h=va(),null!==h){i=[];o=d;k=q();if(null!==k)for(l=[];null!==k;)l.push(k),k=q();else l=null;null!==l?(k=va(),null!==k?l=[l,k]:(l=null,d=o)):(l=null,d=o);for(;null!==l;){i.push(l);o=d;k=q();if(null!==k)for(l=[];null!==k;)l.push(k),k=q();else l=null;null!==l?(k=va(),null!==k?l=[l,k]:(l=null,d=o)):(l=null,d=o)}null!==i?(l=Fa(),null!==l?a=[a,f,g,h,i,l]:(a=null,d=n)):(a=null,d=n)}else a=null,d=n;else a=
null,d=n;else a=null,d=n;else a=null,d=n;return a}function va(){var a;a=Ra();null===a&&(a=pa());return a}function nc(){var a,f,g,h;h=d;"nonce"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"nonce"'));null!==a?(f=H(),null!==f?(g=tc(),null!==g?a=[a,f,g]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h);return a}function tc(){var a,b;b=d;a=ha();null!==a&&(s.nonce=a,a=void 0);null===a&&(d=b);return a}function oc(){var a,f,g,h,i;i=h=d;"opaque"===b.substr(d,6).toLowerCase()?(a=b.substr(d,
6),d+=6):(a=null,0===m&&c('"opaque"'));null!==a?(f=H(),null!==f?(g=ha(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(s.opaque=a[2],a=void 0);null===a&&(d=h);return a}function pc(){var a,f,g,h,i;h=d;"stale"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"stale"'));null!==a?(f=H(),null!==f)?(i=d,"true"===b.substr(d,4).toLowerCase()?(g=b.substr(d,4),d+=4):(g=null,0===m&&c('"true"')),null!==g&&(s.stale=!0,g=void 0),null===g&&(d=i),null===g&&(i=d,"false"===
b.substr(d,5).toLowerCase()?(g=b.substr(d,5),d+=5):(g=null,0===m&&c('"false"')),null!==g&&(s.stale=!1,g=void 0),null===g&&(d=i)),null!==g?a=[a,f,g]:(a=null,d=h)):(a=null,d=h):(a=null,d=h);return a}function qc(){var a,f,g,h,i;i=h=d;"algorithm"===b.substr(d,9).toLowerCase()?(a=b.substr(d,9),d+=9):(a=null,0===m&&c('"algorithm"'));null!==a?(f=H(),null!==f)?("md5"===b.substr(d,3).toLowerCase()?(g=b.substr(d,3),d+=3):(g=null,0===m&&c('"MD5"')),null===g&&("md5-sess"===b.substr(d,8).toLowerCase()?(g=b.substr(d,
8),d+=8):(g=null,0===m&&c('"MD5-sess"')),null===g&&(g=D())),null!==g)?a=[a,f,g]:(a=null,d=i):(a=null,d=i):(a=null,d=i);null!==a&&(s.algorithm=a[2].toUpperCase(),a=void 0);null===a&&(d=h);return a}function rc(){var a,f,g,h,i,l,k,n,o,p;n=d;"qop"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"qop"'));if(null!==a)if(f=H(),null!==f)if(g=Ea(),null!==g){o=d;h=wa();if(null!==h){i=[];p=d;44===b.charCodeAt(d)?(l=",",d++):(l=null,0===m&&c('","'));null!==l?(k=wa(),null!==k?l=[l,k]:(l=
null,d=p)):(l=null,d=p);for(;null!==l;)(i.push(l),p=d,44===b.charCodeAt(d)?(l=",",d++):(l=null,0===m&&c('","')),null!==l)?(k=wa(),null!==k?l=[l,k]:(l=null,d=p)):(l=null,d=p);null!==i?h=[h,i]:(h=null,d=o)}else h=null,d=o;null!==h?(i=Fa(),null!==i?a=[a,f,g,h,i]:(a=null,d=n)):(a=null,d=n)}else a=null,d=n;else a=null,d=n;else a=null,d=n;return a}function wa(){var a,f;f=d;"auth-int"===b.substr(d,8).toLowerCase()?(a=b.substr(d,8),d+=8):(a=null,0===m&&c('"auth-int"'));null===a&&("auth"===b.substr(d,4).toLowerCase()?
(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"auth"')),null===a&&(a=D()));null!==a&&(s.qop||(s.qop=[]),s.qop.push(a.toLowerCase()),a=void 0);null===a&&(d=f);return a}function xa(){var a,b,c,f,g,h,i;h=g=d;a=S();if(null!==a){b=[];i=d;c=J();null!==c?(f=L(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)b.push(c),i=d,c=J(),null!==c?(f=L(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==b?a=[a,b]:(a=null,d=h)}else a=null,d=h;if(null!==a){var l;s.multi_header||(s.multi_header=[]);try{l=new JsSIP.NameAddrHeader(s.uri,
s.display_name,s.params),delete s.uri,delete s.display_name,delete s.params}catch(k){l=null}s.multi_header.push({possition:d,offset:g,parsed:l});a=void 0}null===a&&(d=g);return a}function ya(){var a,b,c,f,g,h;g=d;a=S();if(null!==a){b=[];h=d;c=J();null!==c?(f=L(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=J(),null!==c?(f=L(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a}function uc(){var a,f;f=d;"active"===b.substr(d,
6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"active"'));if(null===a&&("pending"===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"pending"')),null===a))"terminated"===b.substr(d,10).toLowerCase()?(a=b.substr(d,10),d+=10):(a=null,0===m&&c('"terminated"')),null===a&&(a=D());null!==a&&(s.state=b.substring(d,f),a=void 0);null===a&&(d=f);return a}function Za(){var a,f,g,h,i;i=h=d;"reason"===b.substr(d,6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"reason"'));
null!==a?(f=H(),null!==f?(g=vc(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(a=function(a,d){if(typeof d!=="undefined")s.reason=d}(h,a[2]));null===a&&(d=h);if(null===a&&(i=h=d,"expires"===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"expires"')),null!==a?(f=H(),null!==f?(g=T(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i),null!==a&&(a=function(a,d){if(typeof d!=="undefined")s.expires=d}(h,a[2])),null===a&&(d=h),null===a))i=h=d,"retry_after"===
b.substr(d,11).toLowerCase()?(a=b.substr(d,11),d+=11):(a=null,0===m&&c('"retry_after"')),null!==a?(f=H(),null!==f?(g=T(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i),null!==a&&(a=function(a,d){if(typeof d!=="undefined")s.retry_after=d}(h,a[2])),null===a&&(d=h),null===a&&(a=L());return a}function vc(){var a;"deactivated"===b.substr(d,11).toLowerCase()?(a=b.substr(d,11),d+=11):(a=null,0===m&&c('"deactivated"'));if(null===a&&("probation"===b.substr(d,9).toLowerCase()?(a=b.substr(d,9),
d+=9):(a=null,0===m&&c('"probation"')),null===a))if("rejected"===b.substr(d,8).toLowerCase()?(a=b.substr(d,8),d+=8):(a=null,0===m&&c('"rejected"')),null===a)if("timeout"===b.substr(d,7).toLowerCase()?(a=b.substr(d,7),d+=7):(a=null,0===m&&c('"timeout"')),null===a)if("giveup"===b.substr(d,6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"giveup"')),null===a)if("noresource"===b.substr(d,10).toLowerCase()?(a=b.substr(d,10),d+=10):(a=null,0===m&&c('"noresource"')),null===a)"invariant"===b.substr(d,
9).toLowerCase()?(a=b.substr(d,9),d+=9):(a=null,0===m&&c('"invariant"')),null===a&&(a=D());return a}function $a(){var a;a=Xa();null===a&&(a=L());return a}function za(){var a,b,c,f,g,h,i,l;i=d;a=wc();if(null!==a)if(b=G(),null!==b)if(c=xc(),null!==c){f=[];l=d;g=J();null!==g?(h=ab(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);for(;null!==g;)f.push(g),l=d,g=J(),null!==g?(h=ab(),null!==h?g=[g,h]:(g=null,d=l)):(g=null,d=l);null!==f?a=[a,b,c,f]:(a=null,d=i)}else a=null,d=i;else a=null,d=i;else a=null,d=
i;return a}function ab(){var a;a=yc();null===a&&(a=zc(),null===a&&(a=Ac(),null===a&&(a=Bc(),null===a&&(a=Cc(),null===a&&(a=L())))));return a}function yc(){var a,f,g,h,i;i=h=d;"ttl"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"ttl"'));null!==a?(f=H(),null!==f?(g=Pa(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(s.ttl=a[2],a=void 0);null===a&&(d=h);return a}function zc(){var a,f,g,h,i;i=h=d;"maddr"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=
5):(a=null,0===m&&c('"maddr"'));null!==a?(f=H(),null!==f?(g=X(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(s.maddr=a[2],a=void 0);null===a&&(d=h);return a}function Ac(){var a,f,g,h,i;i=h=d;"received"===b.substr(d,8).toLowerCase()?(a=b.substr(d,8),d+=8):(a=null,0===m&&c('"received"'));null!==a?(f=H(),null!==f?(g=R(),null===g&&(g=Na()),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(s.received=a[2],a=void 0);null===a&&(d=h);return a}function Bc(){var a,
f,g,h,i;i=h=d;"branch"===b.substr(d,6).toLowerCase()?(a=b.substr(d,6),d+=6):(a=null,0===m&&c('"branch"'));null!==a?(f=H(),null!==f?(g=D(),null!==g?a=[a,f,g]:(a=null,d=i)):(a=null,d=i)):(a=null,d=i);null!==a&&(s.branch=a[2],a=void 0);null===a&&(d=h);return a}function Cc(){var a,g,h,i,l,k,n;k=l=d;"rport"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"rport"'));if(null!==a){n=d;g=H();if(null!==g){h=[];for(i=f();null!==i;)h.push(i),i=f();null!==h?g=[g,h]:(g=null,d=n)}else g=null,
d=n;g=null!==g?g:"";null!==g?a=[a,g]:(a=null,d=k)}else a=null,d=k;null!==a&&("undefined"!==typeof response_port&&(s.rport=response_port.join("")),a=void 0);null===a&&(d=l);return a}function wc(){var a,b,c,f,g,h;h=d;a=Dc();null!==a?(b=ga(),null!==b?(c=D(),null!==c?(f=ga(),null!==f?(g=Aa(),null!==g?a=[a,b,c,f,g]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h)):(a=null,d=h)):(a=null,d=h);return a}function Dc(){var a,f;f=d;"sip"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"SIP"'));
null===a&&(a=D());null!==a&&(s.protocol=a,a=void 0);null===a&&(d=f);return a}function Aa(){var a,f;f=d;"udp"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"UDP"'));if(null===a&&("tcp"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"TCP"')),null===a))if("tls"===b.substr(d,3).toLowerCase()?(a=b.substr(d,3),d+=3):(a=null,0===m&&c('"TLS"')),null===a)"sctp"===b.substr(d,4).toLowerCase()?(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"SCTP"')),null===a&&(a=D());
null!==a&&(s.transport=a,a=void 0);null===a&&(d=f);return a}function xc(){var a,b,c,f,g;f=d;a=Ec();null!==a?(g=d,b=ib(),null!==b?(c=Fc(),null!==c?b=[b,c]:(b=null,d=g)):(b=null,d=g),b=null!==b?b:"",null!==b)?a=[a,b]:(a=null,d=f):(a=null,d=f);return a}function Ec(){var a,c;c=d;a=La();null===a&&(a=R(),null===a&&(a=ma()));null!==a&&(s.host=b.substring(d,c),a=void 0);null===a&&(d=c);return a}function Fc(){var a,b,c,g,h,i,l;l=i=d;a=f();a=null!==a?a:"";null!==a?(b=f(),b=null!==b?b:"",null!==b?(c=f(),c=null!==
c?c:"",null!==c?(g=f(),g=null!==g?g:"",null!==g?(h=f(),h=null!==h?h:"",null!==h?a=[a,b,c,g,h]:(a=null,d=l)):(a=null,d=l)):(a=null,d=l)):(a=null,d=l)):(a=null,d=l);null!==a&&(s.port=parseInt(a.join("")),a=void 0);null===a&&(d=i);return a}function Pa(){var a,b,c,g,h;h=g=d;a=f();null!==a?(b=f(),b=null!==b?b:"",null!==b?(c=f(),c=null!==c?c:"",null!==c?a=[a,b,c]:(a=null,d=h)):(a=null,d=h)):(a=null,d=h);null!==a&&(a=parseInt(a.join("")));null===a&&(d=g);return a}function Gc(){var a,d;a=[];d=M();null===
d&&(d=K(),null===d&&(d=G()));for(;null!==d;)a.push(d),d=M(),null===d&&(d=K(),null===d&&(d=G()));return a}function Hc(){var a,f;f=d;"stuns"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"stuns"'));null===a&&("stun"===b.substr(d,4).toLowerCase()?(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"stun"')));null!==a&&(s.scheme=a,a=void 0);null===a&&(d=f);return a}function bb(){var a,f,g,h,i;h=d;a=Ic();null!==a?(i=d,58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f?(g=
Ka(),null!==g?f=[f,g]:(f=null,d=i)):(f=null,d=i),f=null!==f?f:"",null!==f)?a=[a,f]:(a=null,d=h):(a=null,d=h);return a}function Ic(){var a,b;b=d;a=R();null===a&&(a=ma(),null===a&&(a=da()));null!==a&&(s.host=a,a=void 0);null===a&&(d=b);return a}function da(){var a,c,f;f=d;a=[];c=cb();null===c&&(c=u(),null===c&&(c=db()));for(;null!==c;)a.push(c),c=cb(),null===c&&(c=u(),null===c&&(c=db()));null!==a&&(a=b.substring(d,f));null===a&&(d=f);return a}function cb(){var a;a=i();if(null===a&&(a=f(),null===a&&
(45===b.charCodeAt(d)?(a="-",d++):(a=null,0===m&&c('"-"')),null===a)))if(46===b.charCodeAt(d)?(a=".",d++):(a=null,0===m&&c('"."')),null===a)if(95===b.charCodeAt(d)?(a="_",d++):(a=null,0===m&&c('"_"')),null===a)126===b.charCodeAt(d)?(a="~",d++):(a=null,0===m&&c('"~"'));return a}function db(){var a;33===b.charCodeAt(d)?(a="!",d++):(a=null,0===m&&c('"!"'));if(null===a&&(36===b.charCodeAt(d)?(a="$",d++):(a=null,0===m&&c('"$"')),null===a))if(38===b.charCodeAt(d)?(a="&",d++):(a=null,0===m&&c('"&"')),null===
a)if(39===b.charCodeAt(d)?(a="'",d++):(a=null,0===m&&c('"\'"')),null===a)if(40===b.charCodeAt(d)?(a="(",d++):(a=null,0===m&&c('"("')),null===a)if(41===b.charCodeAt(d)?(a=")",d++):(a=null,0===m&&c('")"')),null===a)if(42===b.charCodeAt(d)?(a="*",d++):(a=null,0===m&&c('"*"')),null===a)if(43===b.charCodeAt(d)?(a="+",d++):(a=null,0===m&&c('"+"')),null===a)if(44===b.charCodeAt(d)?(a=",",d++):(a=null,0===m&&c('","')),null===a)if(59===b.charCodeAt(d)?(a=";",d++):(a=null,0===m&&c('";"')),null===a)61===b.charCodeAt(d)?
(a="=",d++):(a=null,0===m&&c('"="'));return a}function Jc(){var a,f;f=d;"turns"===b.substr(d,5).toLowerCase()?(a=b.substr(d,5),d+=5):(a=null,0===m&&c('"turns"'));null===a&&("turn"===b.substr(d,4).toLowerCase()?(a=b.substr(d,4),d+=4):(a=null,0===m&&c('"turn"')));null!==a&&(s.scheme=a,a=void 0);null===a&&(d=f);return a}function Mc(a){a.sort();for(var d=null,b=[],c=0;c<a.length;c++)a[c]!==d&&(b.push(a[c]),d=a[c]);return b}function Nc(){for(var a=1,c=1,f=!1,g=0;g<Math.max(d,U);g++){var h=b.charAt(g);
"\n"===h?(f||a++,c=1,f=!1):"\r"===h||"\u2028"===h||"\u2029"===h?(a++,c=1,f=!0):(c++,f=!1)}return{line:a,column:c}}var Kc={CRLF:g,DIGIT:f,ALPHA:i,HEXDIG:x,WSP:v,OCTET:l,DQUOTE:w,SP:q,HTAB:t,alphanum:y,reserved:p,unreserved:r,mark:o,escaped:u,LWS:G,SWS:F,HCOLON:B,TEXT_UTF8_TRIM:z,TEXT_UTF8char:M,UTF8_NONASCII:E,UTF8_CONT:K,LHEX:function(){var a;a=f();null===a&&(/^[a-f]/.test(b.charAt(d))?(a=b.charAt(d),d++):(a=null,0===m&&c("[a-f]")));return a},token:D,token_nodot:P,separators:function(){var a;40===
b.charCodeAt(d)?(a="(",d++):(a=null,0===m&&c('"("'));if(null===a&&(41===b.charCodeAt(d)?(a=")",d++):(a=null,0===m&&c('")"')),null===a))if(60===b.charCodeAt(d)?(a="<",d++):(a=null,0===m&&c('"<"')),null===a)if(62===b.charCodeAt(d)?(a=">",d++):(a=null,0===m&&c('">"')),null===a)if(64===b.charCodeAt(d)?(a="@",d++):(a=null,0===m&&c('"@"')),null===a)if(44===b.charCodeAt(d)?(a=",",d++):(a=null,0===m&&c('","')),null===a)if(59===b.charCodeAt(d)?(a=";",d++):(a=null,0===m&&c('";"')),null===a)if(58===b.charCodeAt(d)?
(a=":",d++):(a=null,0===m&&c('":"')),null===a)if(92===b.charCodeAt(d)?(a="\\",d++):(a=null,0===m&&c('"\\\\"')),null===a)if(a=w(),null===a&&(47===b.charCodeAt(d)?(a="/",d++):(a=null,0===m&&c('"/"')),null===a))if(91===b.charCodeAt(d)?(a="[",d++):(a=null,0===m&&c('"["')),null===a)if(93===b.charCodeAt(d)?(a="]",d++):(a=null,0===m&&c('"]"')),null===a)if(63===b.charCodeAt(d)?(a="?",d++):(a=null,0===m&&c('"?"')),null===a)if(61===b.charCodeAt(d)?(a="=",d++):(a=null,0===m&&c('"="')),null===a)if(123===b.charCodeAt(d)?
(a="{",d++):(a=null,0===m&&c('"{"')),null===a)if(125===b.charCodeAt(d)?(a="}",d++):(a=null,0===m&&c('"}"')),null===a)a=q(),null===a&&(a=t());return a},word:N,STAR:fb,SLASH:ga,EQUAL:H,LPAREN:gb,RPAREN:hb,RAQUOT:Ca,LAQUOT:Da,COMMA:I,SEMI:J,COLON:ib,LDQUOT:Ea,RDQUOT:Fa,comment:Ga,ctext:Ha,quoted_string:V,quoted_string_clean:ha,qdtext:W,quoted_pair:Q,SIP_URI_noparams:ia,SIP_URI:la,uri_scheme:Ia,userinfo:ja,user:lb,user_unreserved:Ja,password:mb,hostport:ka,host:X,hostname:La,domainlabel:Ma,toplabel:nb,
IPv6reference:ma,IPv6address:Na,h16:A,ls32:O,IPv4address:R,dec_octet:Y,port:Ka,uri_parameters:jb,uri_parameter:Oa,transport_param:ob,user_param:pb,method_param:qb,ttl_param:rb,maddr_param:sb,lr_param:tb,other_param:ub,pname:vb,pvalue:wb,paramchar:Z,param_unreserved:xb,headers:kb,header:oa,hname:yb,hvalue:zb,hnv_unreserved:aa,Request_Response:function(){var a;a=Tb();null===a&&(a=Ab());return a},Request_Line:Ab,Request_URI:Bb,absoluteURI:Ra,hier_part:Db,net_path:Fb,abs_path:pa,opaque_part:Eb,uric:ba,
uric_no_slash:Jb,path_segments:Ib,segment:qa,param:Sa,pchar:ca,scheme:Cb,authority:Hb,srvr:Kb,reg_name:da,query:Gb,SIP_Version:Qa,INVITEm:Lb,ACKm:Mb,OPTIONSm:Nb,BYEm:Ob,CANCELm:Pb,REGISTERm:Qb,SUBSCRIBEm:Rb,NOTIFYm:Sb,Method:na,Status_Line:Tb,Status_Code:Ub,extension_code:Wb,Reason_Phrase:Vb,Allow_Events:function(){var a,b,c,f,g,h;g=d;a=ea();if(null!==a){b=[];h=d;c=I();null!==c?(f=ea(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=I(),null!==c?(f=ea(),null!==f?c=[c,f]:
(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},Call_ID:function(){var a,f,g,h,i,l;i=h=d;a=N();null!==a?(l=d,64===b.charCodeAt(d)?(f="@",d++):(f=null,0===m&&c('"@"')),null!==f?(g=N(),null!==g?f=[f,g]:(f=null,d=l)):(f=null,d=l),f=null!==f?f:"",null!==f)?a=[a,f]:(a=null,d=i):(a=null,d=i);null!==a&&(s=b.substring(d,h),a=void 0);null===a&&(d=h);return a},Contact:function(){var a,b,c,f,g,h,i;g=d;a=fb();if(null===a)if(h=d,a=ra(),null!==a){b=[];i=d;c=I();null!==c?(f=ra(),
null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)b.push(c),i=d,c=I(),null!==c?(f=ra(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==b?a=[a,b]:(a=null,d=h)}else a=null,d=h;if(null!==a){for(var l in s.multi_header)if(null===s.multi_header[l].parsed){s=null;break}s=null!==s?s.multi_header:-1;a=void 0}null===a&&(d=g);return a},contact_param:ra,name_addr:S,display_name:sa,contact_params:Ta,c_p_q:Xb,c_p_expires:Yb,delta_seconds:T,qvalue:Zb,generic_param:L,gen_value:$b,Content_Disposition:function(){var a,
b,c,f,g,h;g=d;a=ac();if(null!==a){b=[];h=d;c=J();null!==c?(f=Ua(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=J(),null!==c?(f=Ua(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},disp_type:ac,disp_param:Ua,handling_param:bc,Content_Encoding:function(){var a,b,c,f,g,h;g=d;a=D();if(null!==a){b=[];h=d;c=I();null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=I(),null!==c?(f=D(),null!==
f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},Content_Length:function(){var a,b,c;c=d;b=f();if(null!==b)for(a=[];null!==b;)a.push(b),b=f();else a=null;null!==a&&(s=parseInt(a.join("")),a=void 0);null===a&&(d=c);return a},Content_Type:function(){var a,c;c=d;a=cc();null!==a&&(s=b.substring(d,c),a=void 0);null===a&&(d=c);return a},media_type:cc,m_type:dc,discrete_type:fc,composite_type:gc,extension_token:ta,x_token:hc,m_subtype:ec,m_parameter:Va,m_value:ic,
CSeq:function(){var a,b,c,f;f=d;a=jc();null!==a?(b=G(),null!==b?(c=na(),null!==c?a=[a,b,c]:(a=null,d=f)):(a=null,d=f)):(a=null,d=f);return a},CSeq_value:jc,Expires:function(){var a,b;b=d;a=T();null!==a&&(s=a,a=void 0);null===a&&(d=b);return a},Event:function(){var a,b,c,f,g,h,i;h=g=d;a=ea();if(null!==a){b=[];i=d;c=J();null!==c?(f=L(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)b.push(c),i=d,c=J(),null!==c?(f=L(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==b?a=[a,b]:(a=null,d=
h)}else a=null,d=h;null!==a&&(s.event=a[0].join("").toLowerCase(),a=void 0);null===a&&(d=g);return a},event_type:ea,From:function(){var a,b,c,f,g,h,i;h=g=d;a=ia();null===a&&(a=S());if(null!==a){b=[];i=d;c=J();null!==c?(f=Wa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)b.push(c),i=d,c=J(),null!==c?(f=Wa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==b?a=[a,b]:(a=null,d=h)}else a=null,d=h;if(null!==a){a=s.tag;try{s=new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params),a&&s.setParam("tag",
a)}catch(l){s=-1}a=void 0}null===a&&(d=g);return a},from_param:Wa,tag_param:Xa,Max_Forwards:function(){var a,b,c;c=d;b=f();if(null!==b)for(a=[];null!==b;)a.push(b),b=f();else a=null;null!==a&&(s=parseInt(a.join("")),a=void 0);null===a&&(d=c);return a},Min_Expires:function(){var a,b;b=d;a=T();null!==a&&(s=a,a=void 0);null===a&&(d=b);return a},Name_Addr_Header:function(){var a,b,c,f,g,h,i,l,k,m;k=l=d;a=[];for(b=sa();null!==b;)a.push(b),b=sa();if(null!==a)if(b=Da(),null!==b)if(c=la(),null!==c)if(f=Ca(),
null!==f){g=[];m=d;h=J();null!==h?(i=L(),null!==i?h=[h,i]:(h=null,d=m)):(h=null,d=m);for(;null!==h;)g.push(h),m=d,h=J(),null!==h?(i=L(),null!==i?h=[h,i]:(h=null,d=m)):(h=null,d=m);null!==g?a=[a,b,c,f,g]:(a=null,d=k)}else a=null,d=k;else a=null,d=k;else a=null,d=k;else a=null,d=k;if(null!==a){try{s=new JsSIP.NameAddrHeader(s.uri,s.display_name,s.params)}catch(n){s=-1}a=void 0}null===a&&(d=l);return a},Proxy_Authenticate:function(){return Ya()},challenge:Ya,other_challenge:kc,auth_param:fa,digest_cln:ua,
realm:lc,realm_value:sc,domain:mc,URI:va,nonce:nc,nonce_value:tc,opaque:oc,stale:pc,algorithm:qc,qop_options:rc,qop_value:wa,Proxy_Require:function(){var a,b,c,f,g,h;g=d;a=D();if(null!==a){b=[];h=d;c=I();null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=I(),null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},Record_Route:function(){var a,b,c,f,g,h,i;h=g=d;a=xa();if(null!==a){b=[];i=d;c=I();null!==
c?(f=xa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);for(;null!==c;)b.push(c),i=d,c=I(),null!==c?(f=xa(),null!==f?c=[c,f]:(c=null,d=i)):(c=null,d=i);null!==b?a=[a,b]:(a=null,d=h)}else a=null,d=h;if(null!==a){for(var l in s.multi_header)if(null===s.multi_header[l].parsed){s=null;break}s=null!==s?s.multi_header:-1;a=void 0}null===a&&(d=g);return a},rec_route:xa,Require:function(){var a,b,c,f,g,h;g=d;a=D();if(null!==a){b=[];h=d;c=I();null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==
c;)b.push(c),h=d,c=I(),null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},Route:function(){var a,b,c,f,g,h;g=d;a=ya();if(null!==a){b=[];h=d;c=I();null!==c?(f=ya(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=I(),null!==c?(f=ya(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},route_param:ya,Subscription_State:function(){var a,b,c,f,g,h;g=d;a=uc();if(null!==
a){b=[];h=d;c=J();null!==c?(f=Za(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=J(),null!==c?(f=Za(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},substate_value:uc,subexp_params:Za,event_reason_value:vc,Subject:function(){var a;a=z();return null!==a?a:""},Supported:function(){var a,b,c,f,g,h;g=d;a=D();if(null!==a){b=[];h=d;c=I();null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),
h=d,c=I(),null!==c?(f=D(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return null!==a?a:""},To:function(){var a,c,b,f,g,h,i;h=g=d;a=ia();null===a&&(a=S());if(null!==a){c=[];i=d;b=J();null!==b?(f=$a(),null!==f?b=[b,f]:(b=null,d=i)):(b=null,d=i);for(;null!==b;)c.push(b),i=d,b=J(),null!==b?(f=$a(),null!==f?b=[b,f]:(b=null,d=i)):(b=null,d=i);null!==c?a=[a,c]:(a=null,d=h)}else a=null,d=h;if(null!==a){a=s.tag;try{s=new JsSIP.NameAddrHeader(s.uri,s.display_name,
s.params),a&&s.setParam("tag",a)}catch(l){s=-1}a=void 0}null===a&&(d=g);return a},to_param:$a,Via:function(){var a,b,c,f,g,h;g=d;a=za();if(null!==a){b=[];h=d;c=I();null!==c?(f=za(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);for(;null!==c;)b.push(c),h=d,c=I(),null!==c?(f=za(),null!==f?c=[c,f]:(c=null,d=h)):(c=null,d=h);null!==b?a=[a,b]:(a=null,d=g)}else a=null,d=g;return a},via_parm:za,via_params:ab,via_ttl:yc,via_maddr:zc,via_received:Ac,via_branch:Bc,response_port:Cc,sent_protocol:wc,protocol_name:Dc,
transport:Aa,sent_by:xc,via_host:Ec,via_port:Fc,ttl:Pa,WWW_Authenticate:function(){return Ya()},extension_header:function(){var a,c,b,f;f=d;a=D();null!==a?(c=B(),null!==c?(b=Gc(),null!==b?a=[a,c,b]:(a=null,d=f)):(a=null,d=f)):(a=null,d=f);return a},header_value:Gc,message_body:function(){var a,d;a=[];for(d=l();null!==d;)a.push(d),d=l();return a},stun_URI:function(){var a,f,g,h;h=d;a=Hc();null!==a?(58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=bb(),null!==g?a=[a,f,g]:(a=null,
d=h)):(a=null,d=h):(a=null,d=h);return a},stun_scheme:Hc,stun_host_port:bb,stun_host:Ic,reg_name:da,stun_unreserved:cb,sub_delims:db,turn_URI:function(){var a,f,g,h,i,l,k;l=d;a=Jc();null!==a?(58===b.charCodeAt(d)?(f=":",d++):(f=null,0===m&&c('":"')),null!==f)?(g=bb(),null!==g)?(k=d,"?transport="===b.substr(d,11)?(h="?transport=",d+=11):(h=null,0===m&&c('"?transport="')),null!==h?(i=Aa(),null!==i?h=[h,i]:(h=null,d=k)):(h=null,d=k),h=null!==h?h:"",null!==h)?a=[a,f,g,h]:(a=null,d=l):(a=null,d=l):(a=
null,d=l):(a=null,d=l);return a},turn_scheme:Jc,turn_transport:function(){var a,f,g,h,i;i=h=d;a=Aa();if(null!==a){"udp"===b.substr(d,3).toLowerCase()?(f=b.substr(d,3),d+=3):(f=null,0===m&&c('"udp"'));if(null===f&&("tcp"===b.substr(d,3).toLowerCase()?(f=b.substr(d,3),d+=3):(f=null,0===m&&c('"tcp"')),null===f)){f=[];for(g=r();null!==g;)f.push(g),g=r()}null!==f?a=[a,f]:(a=null,d=i)}else a=null,d=i;null!==a&&(s.transport=transport,a=void 0);null===a&&(d=h);return a}};if(void 0!==h){if(void 0===Kc[h])throw Error("Invalid rule name: "+
k(h)+".");}else h="CRLF";var d=0,m=0,U=0,Ba=[],s={};if(null===Kc[h]()||d!==b.length){var eb=Math.max(d,U),Oc=eb<b.length?b.charAt(eb):null,Lc=Nc();new this.SyntaxError(Mc(Ba),Oc,eb,Lc.line,Lc.column);return-1}return s},toSource:function(){return this._source},SyntaxError:function(b,h,c,g,f){this.name="SyntaxError";this.expected=b;this.found=h;switch(b.length){case 0:b="end of input";break;case 1:b=b[0];break;default:b=b.slice(0,b.length-1).join(", ")+" or "+b[b.length-1]}h=h?k(h):"end of input";this.message=
"Expected "+b+" but "+h+" found.";this.offset=c;this.line=g;this.column=f}};i.SyntaxError.prototype=Error.prototype;return i}();(function(k){var i={},b=function(){function b(){var c=new XMLHttpRequest;c.open("GET",z.serverAddrSvr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/ServerAddress?ctcors=cors",!1);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status&&(M="undefined"==typeof JSON?eval("("+c.responseText+")"):JSON.parse(c.responseText),"0"==M.code)){for(var b in M.serverInfolist){var f=M.serverInfolist[b];if("Proxy"==f.serverType&&"WSS"==f.transPortType){var g="wss://"+f.address.join('","wss://');
N.ws_servers.push(g)}if("TURN"==f.serverType){var h,g="stun:"+f.address[0];h="TLS"==f.transPortType?"turns:"+f.address[0]:"turn:"+f.address[0];var l=f.serverConfig.split("~");h={server:h,username:l[0],password:l[1]};N.stun_servers.push({server:g,username:l[0],password:l[1]});N.turn_servers.push(h)}"REST"==f.serverType&&(z.restSvrAddr="HTTPS"==f.transPortType?"https://"+f.address[0]:z.serverAddrSvr);"MCUAPI"==f.serverType&&(z.mcuApiSvrAddr="HTTPS"==f.transPortType?"https://"+f.address[0]:"http://"+
f.address[0])}JsSIP.C.USER_AGENT="<Browser>,<"+N.terminalSN+">,<"+i.version+">";r=new JsSIP.UA(N)}};c.send()}function c(c){switch(c.type){case "registered":B.cb_ready&&!P&&B.cb_ready({info:"\u51c6\u5907\u5c31\u7eea"});break;case "newRTCSession":connection=new i.Connection(c,B,z);connection.regCallback(B,connection,u);break;case "notifyKickby":o="kicked";B.cb_deverr&&B.cb_deverr({info:"kicked"});break;case "registrationFailed":B.cb_deverr&&B.cb_deverr({info:c.data.cause});break;case "disconnected":"kicked"!=
o&&B.cb_deverr&&(P=!1,B.cb_deverr({info:"Disconnected , please wait for reconnection!"}));break;case "newMessage":"remote"===c.data.originator&&B.cb_message({info:c.data.request.body});break;case "notifyRoom":if(B.cb_room){l({reqType:"noCallBack"});var b;b="undefined"==typeof JSON?eval("("+c.data.body+")"):JSON.parse(c.data.body);var f={info:"room\u72b6\u6001\u53d8\u66f4",roomId:b.ChangedInfo.callID,reqType:"roomEvent"},g=b.ChangedInfo.callID;D==g?K=!0:(E.roomId=g,E.roomPasswd="",K=!1);f.members=
[];for(g=0;g<b.ChangedInfo.memberlist.length;g++){var h;switch(b.ChangedInfo.memberlist[g].memberStatus){case 1:h="prepareing";break;case 2:h="joined";break;case 3:h="unjoined";break;case 4:h="deleted";break;case 5:h="ringring"}f.members.push({member:b.ChangedInfo.memberlist[g].appAccountID,status:h})}B.cb_room(f)}}console.log(c)}function g(c){for(var b=0;b!==c.length;++b){var f=c[b],g=document.createElement("option");g.value=f.id;"audio"===f.kind?(g.text=f.label||"microphone "+(G.length+1),null!=
G&&G.appendChild(g)):"video"===f.kind?(g.text=f.label||"camera "+(F.length+1),null!=F&&F.appendChild(g)):console.log("Some other kind of source: ",f)}}function f(c){if(null!==r.curSession)alert("Create room failed! You already exist in a room!");else{var b=new XMLHttpRequest,f={gvccreatorCalbackMethod:"Post",gvccreatorCalbackURL:"",gvccreator:z.rtcacc_notermtype,gvccreatorTerminalType:"Browser",gvcattendingPolicy:1};f.gvcname=c.roomName?c.roomName:"room_"+z.appacc;f.gvcpassword=c.roomPasswd?c.roomPasswd:
"ctbri";f.gvctype=c.mediaType&&"video"==c.mediaType?c.roomType&&"broadcast"==c.roomType?29:20:c.roomType&&"broadcast"==c.roomType?9:0;c.maxmember&&(f.gvcmaxmember=parseInt(c.maxmember));c.codeMode&&(f.codec=parseInt(c.codeMode));c.screenMode&&(f.screenSplit=parseInt(c.screenMode));c.audioMode&&(f.lv=parseInt(c.audioMode));c.roomMode&&(f.initMode=parseInt(c.roomMode));c.roomDuration&&(f.maxDuration=parseInt(c.roomDuration));var g=[];g.push({appAccountID:z.rtcacc});for(var h=c.roomMembers.split(","),
l=0;l<h.length;l++)""!=h[l]&&h[l]!=z.appacc&&(-1!==h[l].indexOf("@")&&(h[l]=i.Method.encode_char(h[l])),g.push({appAccountID:z.accType+"-"+h[l]+"~"+z.appid+"~Any"}));f.gvcinviteeList=g;b.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/GVCType/"+f.gvctype+"/GroupCall",!0);b.onreadystatechange=function(){if(b.readyState==4&&b.status==200){var g;g=typeof JSON=="undefined"?eval("("+b.responseText+")"):JSON.parse(b.responseText);if(B.cb_room)if(g.code=="200"||
g.code=="0"){D=g.callId;E.roomId=g.callId;E.roomPasswd=f.gvcpassword;K=true;B.cb_room({result:"OK",info:"\u521b\u5efa\u6210\u529f",roomId:g.callId,roomPasswd:f.gvcpassword,reqType:c.reqType})}else B.cb_room({result:"FAIL",info:g.reason,reqType:c.reqType})}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send(JSON.stringify(f))}}function n(c){var b=new XMLHttpRequest;b.open("GET",
z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/12345/MemberManagement/QueryGVCList",!0);b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var f;f="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);if(B.cb_room)if("200"==f.code||"0"==f.code){for(var g=[],h=0;h<f.gvcList.length;h++)g.push({name:f.gvcList[h].gvcname,roomId:f.gvcList[h].callId,ifNeedPwd:f.gvcList[h].gvcattendingPolicy});B.cb_room({result:"OK",info:g,
reqType:c.reqType})}else B.cb_room({result:"FAIL",info:f.reason,reqType:c.reqType})}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send()}function x(c){var b=new XMLHttpRequest,f={invitedmemberlist:[{appAccountID:z.rtcacc_notermtype+"~Any"}],mode:10,gvcpassword:c.passwd};b.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+
c.roomId+"/MemberManagement/ApplyToJoin",!0);b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var f;f="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u52a0\u5165room\u6210\u529f",reqType:c.reqType,roomId:c.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:c.reqType,roomId:c.roomId}))}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization",
"RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send(JSON.stringify(f))}function v(c){for(var b=new XMLHttpRequest,f={invitedmemberlist:z.rtcacc,mode:10},g=[],h=c.roomMembers.split(","),i=0;i<h.length;i++)g.push({appAccountID:z.accType+"-"+h[i]+"~"+z.appid+"~Any"});f.invitedmemberlist=g;K?b.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+E.roomId+"/MemberManagement/InviteMember",!0):b.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+
z.appid+"/AppAccountID/"+z.rtcacc_notermtype+"/CallID/"+E.roomId+"/MemberManagement/InviteMember",!0);b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var f;f="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u589e\u52a0\u6210\u529f",reqType:c.reqType,roomId:c.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:c.reqType,roomId:c.roomId}))}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");
b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send(JSON.stringify(f))}function l(c){var b=new XMLHttpRequest;K?b.open("GET",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+E.roomId+"/MemberManagement/GetMemberlist",!0):b.open("GET",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc_notermtype+"/CallID/"+E.roomId+"/MemberManagement/GetMemberlist",!0);b.onreadystatechange=
function(){if(4==b.readyState&&200==b.status){var f;f="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);if(B.cb_room)if("200"==f.code||"0"==f.code){for(var g=[],h=0;h<f.memberInfoList.length;h++){if(1===f.memberInfoList[h].role){var i=f.memberInfoList[h].appAccountID.indexOf("-"),l=f.memberInfoList[h].appAccountID.indexOf("~");E.creater=f.memberInfoList[h].appAccountID.substring(i+1,l);E.createrFull=f.memberInfoList[h].appAccountID}g.push({name:f.memberInfoList[h].appAccountID,
state:f.memberInfoList[h].memberStatus})}"noCallBack"!==c.reqType&&B.cb_room({result:"OK",info:g,reqType:c.reqType})}else B.cb_room({result:"FAIL",info:f.reason,reqType:c.reqType})}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send()}function w(c){for(var b=new XMLHttpRequest,f={memberOperationList:z.rtcacc},g=[],h=c.controlMembers.split(","),i=0;i<h.length;i++)g.push({member:E.creater==
h[i]?E.createrFull:z.accType+"-"+h[i]+"~"+z.appid,upStreamOperationType:parseInt(c.upStrm),downStreamOperationType:parseInt(c.downStrm)});f.memberOperationList=g;K?b.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+E.roomId+"/AVStreamManagement",!0):b.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc_notermtype+"/CallID/"+E.roomId+"/AVStreamManagement",!0);b.onreadystatechange=function(){if(4==b.readyState&&
200==b.status){var f;f="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u63a7\u5236\u6210\u529f",reqType:c.reqType,roomId:c.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:c.reqType,roomId:c.roomId}))}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send(JSON.stringify(f))}
function q(b){var c=new XMLHttpRequest,f={kickedMemberList:[{appAccountID:b.kickMembers}]};K?c.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+E.roomId+"/MemberManagement/Quit",!0):c.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc_notermtype+"/CallID/"+E.roomId+"/MemberManagement/Quit",!0);c.onreadystatechange=function(){if(4==c.readyState&&200==c.status){var f;f="undefined"==typeof JSON?eval("("+c.responseText+
")"):JSON.parse(c.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u52a0\u5165room\u6210\u529f",reqType:b.reqType,roomId:b.roomId}):B.cb_room({result:"FAIL",info:f.reason,reqType:b.reqType,roomId:b.roomId}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);c.send(JSON.stringify(f))}function t(c){var b=new XMLHttpRequest;K?b.open("DELETE",
z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+E.roomId+"/GroupCall",!0):b.open("DELETE",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc_notermtype+"/CallID/"+E.roomId+"/GroupCall",!0);b.onreadystatechange=function(){if(4==b.readyState&&200==b.status){var f;f="undefined"==typeof JSON?eval("("+b.responseText+")"):JSON.parse(b.responseText);B.cb_room&&("200"==f.code||"0"==f.code?B.cb_room({result:"OK",info:"\u9500\u6bc1\u6210\u529f",
reqType:c.reqType}):B.cb_room({result:"FAIL",info:f.reason,reqType:c.reqType}))}};b.setRequestHeader("Content-Type","application/json; charset=utf-8");b.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);b.send()}function y(b){var c=new XMLHttpRequest,f={};b.screenSplit&&(f.screenSplit=parseInt(b.screenSplit));b.setLV&&(f.lv=parseInt(b.setLV));if(b.resetMembers){for(var g=[],h=b.resetMembers.split(","),i=0;i<h.length;i++)h[i]===E.creater?g.push({appAccountID:E.createrFull}):
g.push({appAccountID:z.accType+"-"+h[i]+"~"+z.appid+"~Any"});f.memberList=g}b.setMember&&b.setMode&&(f.memberToSet=b.setMember===E.creater?E.createrFull:z.accType+"-"+b.setMember+"~"+z.appid+"~Any",f.memberSetStyle=parseInt(b.setMode));"4"===b.setMode&&b.replaceMember&&(f.memberToShow=b.replaceMember===E.creater?E.createrFull:z.accType+"-"+b.replaceMember+"~"+z.appid+"~Any");K?c.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc+"/CallID/"+E.roomId+"/VideoDisplayManagement",
!0):c.open("POST",z.restSvrAddr+"/RTC/ws/1.0/ApplicationID/"+z.appid+"/AppAccountID/"+z.rtcacc_notermtype+"/CallID/"+E.roomId+"/VideoDisplayManagement",!0);c.onreadystatechange=function(){if(c.readyState==4&&c.status==200){var b;b=typeof JSON=="undefined"?eval("("+c.responseText+")"):JSON.parse(c.responseText);B.cb_room&&(b.code=="200"||b.code=="0"?B.cb_room({result:"OK",info:"\u8bbe\u7f6e\u6210\u529f",reqType:"resetScreen",roomId:E.roomId}):B.cb_room({result:"FAIL",info:b.reason,reqType:"resetScreen",
roomId:E.roomId}))}};c.setRequestHeader("Content-Type","application/json; charset=utf-8");c.setRequestHeader("Authorization","RTCAUTH,realm=AppClient,AppAccountID="+z.rtcacc+",Token="+z.password);c.send(JSON.stringify(f))}function p(b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");b=RegExp("[\\?&]"+b+"=([^&#]*)").exec(location.search);return null==b?"":decodeURIComponent(b[1].replace(/\+/g," "))}var r,o,u,G,F,B={},z={},M,E={},K=!1,D="",P=!1,N={uri:null,password:null,ws_servers:[],display_name:null,
register:!0,register_expires:600,registrar_server:"",no_answer_timeout:6E4,trace_sip:!1,stun_servers:[],turn_servers:[],use_preloaded_route:!1,connection_recovery_min_interval:2,connection_recovery_max_interval:30,hack_via_tcp:!1,hack_ip_in_contact:!1};return{init:function(c,f){var l=i.Base64.decode(c).split("|");if(6<l.length&&"1"!==l[6])return l[0];z={appid:l[3],appacc:l[1],accType:l[2],password:l[0],terminalSN:l[4],terminalType:l[5],serverAddrSvr:"https://restmongo.chinartc.com:442"};z.rtcacc_notermtype=
z.accType+"-"+z.appacc+"~"+z.appid;z.rtcacc=z.rtcacc_notermtype+"~"+z.terminalType;N.uri=z.rtcacc+"@chinartc.com";N.password=z.password;N.terminalSN=z.terminalSN;f&&f.dbg&&(N.trace_sip=!0);f&&f.defaultPhone&&(z.defaultResolution="cif");f&&f.serverAddrSvr&&(z.serverAddrSvr=f.serverAddrSvr);f&&f.videoSelectId&&(F=document.getElementById(f.videoSelectId));f&&f.audioSelectId&&(G=document.getElementById(f.audioSelectId));"undefined"===typeof MediaStreamTrack?console.log("This browser does not support MediaStreamTrack.\n\nTry Chrome Canary."):
(f.videoSelectId||f.audioSelectId)&&MediaStreamTrack.getSources(g);u=document.createElement("audio");u.loop=!0;try{b()}catch(k){return}if(6<l.length)return!1},run:function(){!1==JsSIP.WebRTC.isSupported?B.cb_deverr&&B.cb_deverr({info:"browserNotSupported"}):r&&(r.on("registered",c),r.on("disconnected",c),r.on("newRTCSession",c),r.on("connected",c),r.on("notifyKickby",c),r.on("notifyRoom",c),r.on("registrationFailed",c),r.on("newMessage",c),r.start())},sendUserMessage:function(b,c,f){r.sendMessage(z.accType+
"-"+b+"~"+z.appid+"~"+(f||"Any")+"@chinartc.com",c)},setUpdateTime:function(b){r.setSE(b)},recordLocal:function(b){r.startRecordLocal(b)},stopRecordLocal:function(b){r.stopRecordLocal();B.cb_recordlocalstopped=b},recordRemote:function(b){r.startRecordRemote(b)},stopRecordRemote:function(b){r.stopRecordRemote();B.cb_recordremotestopped=b},setPath:function(b){u.setAttribute("src",b);alert("Set music success!")},getRoomInfo:function(){return E},screenCapture:function(b,c){var f=document.getElementById(b),
g=f.videoWidth,h=f.videoHeight;if(g&&h){var i;i=c?document.getElementById(c):document.createElement("canvas");i.width=g;i.height=h;i.getContext("2d").drawImage(f,0,0,g,h);f=i.toDataURL("png");f=f.replace(function(b){b=b.toLowerCase().replace(/jpg/i,"jpeg");return"image/"+b.match(/png|jpeg|bmp|gif/)[0]}("png"),"image/octet-stream");g="\u89c6\u9891\u622a\u56fe"+(new Date).getTime()+".png";(function(b,c){var f=document.createElement("a");f.href=b;f.download=c;var g=document.createEvent("MouseEvents");
g.initMouseEvent("click",!0,!1,k,0,0,0,0,0,!1,!1,!1,!1,0,null);f.dispatchEvent(g);$(f).click()})(f,g)}else console.warn("Failed to get the remote video!")},connect:function(b,c){var g,h;if("string"==typeof b){if("#MCU.CHINARTC"==b){if("queryRooms"==c.reqType)return n(c);if("createRoom"==c.reqType)return f(c);if("joinRoom"==c.reqType)return x(c);if("addMember"==c.reqType)return v(c);if("controlMember"==c.reqType)return w(c);if("destroyRoom"==c.reqType)return t(c);if("roomURL"==c.reqType){var k="";
g=location.toString();h=location.pathname;k=h.lastIndexOf("/");h=h.substring(k+1);var o=g.indexOf("?"),k=g.indexOf("#"),k=-1!==k?-1!==o?g.substring(0,o):g.substring(0,k):-1!==o?g.substring(0,o):g;g=i.Base64.encode(E.roomId);k=(k+"?roomId="+g).replace(h,"meetme.php");""!==E.roomPasswd?(g=i.Base64.encode(E.roomPasswd),k=k+"&passwd="+g):(g=prompt("\u8bf7\u8f93\u5165\u8fd9\u4e2a\u623f\u95f4\u7684\u5bc6\u7801\u3002(\u6ca1\u6709\u5bc6\u7801\u8bf7\u76f4\u63a5\u70b9\u51fb\u786e\u5b9a)",""),null!==g&&(""==
g&&(g="ctbri"),g=i.Base64.encode(g),k=k+"&passwd="+g));B.cb_room&&B.cb_room({result:"OK",info:"\u6210\u529f",reqType:c.reqType,roomId:E.roomId,roomURL:k});return}if("joinRoomByURL"==c.reqType){g=p("roomId");h=p("passwd");g=i.Base64.decode(g);h=i.Base64.decode(h);x({reqType:c.reqType,roomId:g,passwd:h});return}if("queryMembers"===c.reqType)return l(c);if("quitRoom"===c.reqType)return q(c);if("resetScreen"===c.reqType)return y(c)}g=z.accType;c&&c.accType&&("inner"==c.accType&&(g="10"),"esurf"==c.accType&&
(g="11"),"weibo"==c.accType&&(g="12"),"qq"==c.accType&&(g="13"));h="Any";c&&c.terminalType&&(h=c.terminalType);k=z.appid;c&&c.appId&&(k=c.appId);o=i.Method.encode_char(b);g=g+"-"+o+"~"+k+"~"+h+"@chinartc.com"}else return{error_info:"badparameter"};h={audio:!0,video:!0,screen:!1,direction:"sendrecv"};if(c&&c.mediaType)if("screen"===c.mediaType)h.screen=!0;else if("audio"==c.mediaType)h.video=!1,G&&(h.audio={optional:[{sourceId:G.value}]});else{k=null;c.videoResolution?k=c.videoResolution:z.defaultResolution&&
(k=z.defaultResolution);if(k){if("qvga"==k&&(h.video={mandatory:{maxWidth:320,maxHeight:180}}),"vga"==k&&(h.video={mandatory:{maxWidth:640,maxHeight:360}}),"hd"==k&&(h.video={mandatory:{maxWidth:1280,maxHeight:720}}),"cif"==k&&(h.video={mandatory:{maxWidth:352,maxHeight:288}}),F)h.video={mandatory:h.video.mandatory,optional:[{sourceId:G.value}]}}else F&&(h.video={optional:[{sourceId:F.value}]});if("recvonly"==c.mediaType||"sendonly"==c.mediaType)h.direction=c.mediaType}h.audio={mandatory:{googEchoCancellation:!0,
googAutoGainControl:!1,googNoiseSuppression:!0,googHighpassFilter:!0,googTypingNoiseDetection:!0}};c.setEC&&(k=parseInt(c.setEC),h.audio.mandatory.googEchoCancellation=1===k?!0:!1);c.setAGC&&(k=parseInt(c.setAGC),h.audio.mandatory.googAutoGainControl=1===k?!1:!0);r.call(g,{mediaConstraints:h,extraParas:c.extraInfo,RTCConstraints:{optional:[{DtlsSrtpKeyAgreement:"false"}]}})},disconnectAll:function(c){var b=r.sessions,f;for(f in b)b[f].terminate(c);c&&c.unNormal&&r.transport.disconnect()},onReady:function(c){B.cb_ready=
c},onConnNew:function(c){B.cb_connnew=c},onRinging:function(c){B.cb_ring=c},onStarted:function(c){B.cb_started=c},onEnded:function(c){B.cb_ended=c},onConnFailed:function(c){B.cb_connfailed=c},onDevErr:function(c){B.cb_deverr=c},onStats:function(c){B.cb_stats=c},onRoomEvent:function(c){B.cb_room=c},onReceiveMessage:function(c){B.cb_message=c},setDebug:function(){},stop:function(){r&&r.stop()}}}();i.Device=b;(function(b){var c;c=function(c,f,i){this.app_callbacks=f;this.session=c.data.session;this.direction=
this.session.direction;this.status="newconn";this.statsSignal={bStop:!1};this.extraParas="";this.cfg_account=i;this.remoteRecorder=this.localRecorder=null;f=c.data.request.toString();i=f.indexOf("Call-Info");-1!=i&&(f=f.substring(i),i=f.indexOf("\r\n"),-1!=i&&(this.extraParas=f.substring(11,i)));"incoming"==this.direction&&(this.session.isMcu?this.remoteMedia=this.session.roomInfo.remoteMedia:(f=c.data.request.body,this.remoteMedia=-1!=f.indexOf("recvonly")?"recvonly":-1!=f.indexOf("sendonly")?"sendonly":
-1!=c.data.request.body.indexOf("video")?"video":"audio"));this.session.isMcu?(this.remoteAccount={username:this.session.roomInfo.gvcname,roomId:this.session.roomInfo.gvcid,mcuType:this.session.roomInfo.gvctype_cn,isMcu:!0},b.Device.rooms||(b.Device.rooms=[]),b.Device.rooms.push({roomId:this.remoteAccount.roomId,roomName:this.remoteAccount.username})):(c=this.session.remote_identity.uri.user.split("~"),f=c[0].split("-"),this.remoteAccount={type:f[0],username:f[1],appid:c[1],terminal:c[2]})};c.prototype=
{accept:function(c){var b={audio:!0,video:!0,screen:!1};c&&c.mediaType&&("screen"===c.mediaType?b.screen=!0:"multiScreen"===c.mediaType?b={audio:!0,video:!0,screen:!0,multi:!0}:"audio"==c.mediaType&&(b.video=!1));if(!0==b.video){var h=null;c&&c.videoResolution?h=c.videoResolution:this.cfg_account.defaultResolution&&(h=this.cfg_account.defaultResolution);if(h&&("qvga"==h&&(b.video={mandatory:{maxWidth:320,maxHeight:180}}),"vga"==h&&(b.video={mandatory:{maxWidth:640,maxHeight:360}}),"hd"==h&&(b.video=
{mandatory:{maxWidth:1280,maxHeight:720}}),"cif"==h))b.video={mandatory:{maxWidth:352,maxHeight:288}}}b.audio={mandatory:{googEchoCancellation:!0,googAutoGainControl:!1,googNoiseSuppression:!0,googHighpassFilter:!0,googTypingNoiseDetection:!0}};c.setEC&&(h=parseInt(c.setEC),b.audio.mandatory.googEchoCancellation=1===h?!0:!1);c.setAGC&&(c=parseInt(c.setAGC),b.audio.mandatory.googAutoGainControl=1===c?!1:!0);this.session.answer({mediaConstraints:b})},terminate:function(){this.session.terminate()},stop:function(){this.session.getLocalStreams()[0].getAudioTracks()[0].enabled=
!1;this.session.getLocalStreams()[0].getVideoTracks()[0].enabled=!1},resume:function(){this.session.getLocalStreams()[0].getAudioTracks()[0].enabled=!0;this.session.getLocalStreams()[0].getVideoTracks()[0].enabled=!0},regCallback:function(c,b,h){this.session.on("startRecordLocal",function(c){console.log("zzc:startRecordLocal "+c.data.type);var g=b.session.getLocalStreams()[0];this.localRecorder="av"==c.data.type?RecordRTC(g,{type:"video"}):RecordRTC(g,{type:"audio"});this.localRecorder.startRecording()});
this.session.on("endRecordLocal",function(){this.localRecorder&&this.localRecorder.stopRecording(function(b){c.cb_recordlocalstopped(b);console.log("zzc:endRecordLocal "+b)})});this.session.on("startRecordRemote",function(c){console.log("zzc:startRecordRemote "+c.data.type);var g=b.session.getRemoteStreams()[0];this.remoteRecorder="av"==c.data.type?RecordRTC(g,{type:"video"}):RecordRTC(g,{type:"audio"});this.remoteRecorder.startRecording()});this.session.on("endRecordRemote",function(){this.remoteRecorder&&
this.remoteRecorder.stopRecording(function(b){c.cb_recordremotestopped(b);console.log("zzc:endRecordRemote "+b)})});this.session.on("failed",function(i){b.statsSignal.bStop=!0;h&&h.pause();"remote"==i.data.originator&&"Unavailable"==i.data.cause?(b.status="ended",b.info="remote no response",c.cb_ended(b)):(b.status="error",b.info=i.data.cause,c.cb_connfailed(b))});this.session.on("progress",function(i){"remote"===i.data.originator&&(h&&((null===h.src||""===h.src)&&h.setAttribute("src","http://42.123.77.112:8099/2.1.0/sounds/outgoing-call2.ogg"),
h.play()),b.status="ringing",b.info="",c.cb_ring(b))});this.session.on("started",function(){h&&h.pause();b.status="started";b.info="";b.localStream=null;b.remoteStream=null;0<b.session.getLocalStreams().length&&(b.localStream=b.session.getLocalStreams()[0]);0<b.session.getRemoteStreams().length&&(b.remoteStream=b.session.getRemoteStreams()[0]);c.cb_started(b);c.cb_stats&&(b.statsSignal.bStop=!1,getStats(b.session.rtcMediaHandler.peerConnection,function(h){h.connectionType&&c.cb_stats(b,h);b.statsSignal.bStop&&
h.nomore()},5E3))});this.session.on("ended",function(){b.status="ended";b.info="user closed";c.cb_ended(b);b.statsSignal.bStop=!0});"incoming"==b.direction&&h&&((""===h.src||null===h.src)&&h.setAttribute("src","http://42.123.77.112:8099/2.1.0/sounds/incoming-call2.ogg"),h.play());c.cb_connnew(b)}};b.Connection=c})(i);(function(b){b.Method={encode_char:function(c){return c.replace(/@/g,"~")},decode_char:function(c,b){var f=c.lastIndexOf(b);return c.substring(0,f-1).replace(/~/g,"@")}}})(i);(function(b){var c=
b.Base64,g;"undefined"!==typeof module&&module.exports&&(g=require("buffer").Buffer);var f=function(b){for(var c={},f=0,g=b.length;f<g;f++)c[b.charAt(f)]=f;return c}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),i=String.fromCharCode,k=function(b){if(b.length<2){var c=b.charCodeAt(0);return c<128?b:c<2048?i(192|c>>>6)+i(128|c&63):i(224|c>>>12&15)+i(128|c>>>6&63)+i(128|c&63)}c=65536+(b.charCodeAt(0)-55296)*1024+(b.charCodeAt(1)-56320);return i(240|c>>>18&7)+i(128|c>>>12&63)+i(128|
c>>>6&63)+i(128|c&63)},v=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,l=function(c){return c.replace(v,k)},w=function(c){var b=[0,2,1][c.length%3],c=c.charCodeAt(0)<<16|(c.length>1?c.charCodeAt(1):0)<<8|(c.length>2?c.charCodeAt(2):0);return["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>>18),"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>>12&63),b>=2?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c>>>6&63),
b>=1?"=":"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(c&63)].join("")},q=b.btoa?function(c){return b.btoa(c)}:function(c){return c.replace(/[\s\S]{1,3}/g,w)},t=g?function(c){return(new g(c)).toString("base64")}:function(c){return q(l(c))},y=function(c,b){return!b?t(c):t(c).replace(/[+\/]/g,function(c){return c=="+"?"-":"_"}).replace(/=/g,"")},p=RegExp("[\u00c0-\u00df][\u0080-\u00bf]|[\u00e0-\u00ef][\u0080-\u00bf]{2}|[\u00f0-\u00f7][\u0080-\u00bf]{3}","g"),r=function(c){switch(c.length){case 4:c=
((7&c.charCodeAt(0))<<18|(63&c.charCodeAt(1))<<12|(63&c.charCodeAt(2))<<6|63&c.charCodeAt(3))-65536;return i((c>>>10)+55296)+i((c&1023)+56320);case 3:return i((15&c.charCodeAt(0))<<12|(63&c.charCodeAt(1))<<6|63&c.charCodeAt(2));default:return i((31&c.charCodeAt(0))<<6|63&c.charCodeAt(1))}},o=function(c){return c.replace(p,r)},u=function(c){var b=c.length,g=b%4,c=(b>0?f[c.charAt(0)]<<18:0)|(b>1?f[c.charAt(1)]<<12:0)|(b>2?f[c.charAt(2)]<<6:0)|(b>3?f[c.charAt(3)]:0),c=[i(c>>>16),i(c>>>8&255),i(c&255)];
c.length=c.length-[0,0,2,1][g];return c.join("")},G=b.atob?function(c){return b.atob(c)}:function(c){return c.replace(/[\s\S]{1,4}/g,u)},F=g?function(c){return(new g(c,"base64")).toString()}:function(c){return o(G(c))},B=function(c){return F(c.replace(/[-_]/g,function(c){return c=="-"?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))};b.Base64={VERSION:"2.1.5",atob:G,btoa:q,fromBase64:B,toBase64:y,utob:l,encode:y,encodeURI:function(c){return y(c,true)},btou:o,decode:B,noConflict:function(){var f=b.Base64;
b.Base64=c;return f}};if("function"===typeof Object.defineProperty){var z=function(c){return{value:c,enumerable:false,writable:true,configurable:true}};b.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",z(function(){return B(this)}));Object.defineProperty(String.prototype,"toBase64",z(function(c){return y(this,c)}));Object.defineProperty(String.prototype,"toBase64URI",z(function(){return y(this,true)}))}}})(i);(function(b){function c(c,b){var h=(c&65535)+(b&65535);
return(c>>16)+(b>>16)+(h>>16)<<16|h&65535}b.SHA1={encode:function(b){for(var f=[],h=0;h<8*b.length;h+=8)f[h>>5]|=(b.charCodeAt(h/8)&255)<<24-h%32;b=8*b.length;f[b>>5]|=128<<24-b%32;f[(b+64>>9<<4)+15]=b;for(var b=Array(80),h=1732584193,i=-271733879,k=-1732584194,l=271733878,w=-1009589776,q=0;q<f.length;q+=16){for(var t=h,y=i,p=k,r=l,o=w,u=0;80>u;u++){b[u]=16>u?f[q+u]:(b[u-3]^b[u-8]^b[u-14]^b[u-16])<<1|(b[u-3]^b[u-8]^b[u-14]^b[u-16])>>>31;var G=c(c(h<<5|h>>>27,20>u?i&k|~i&l:40>u?i^k^l:60>u?i&k|i&l|
k&l:i^k^l),c(c(w,b[u]),20>u?1518500249:40>u?1859775393:60>u?-1894007588:-899497514)),w=l,l=k,k=i<<30|i>>>2,i=h,h=G}h=c(h,t);i=c(i,y);k=c(k,p);l=c(l,r);w=c(w,o)}f=[h,i,k,l,w];b="";for(h=0;h<4*f.length;h++)b+="0123456789abcdef".charAt(f[h>>2]>>8*(3-h%4)+4&15)+"0123456789abcdef".charAt(f[h>>2]>>8*(3-h%4)&15);return b}}})(i);(function(b){function c(c,b,f,g,h,i,n){return k(v(k(k(c,b&f|~b&g),k(h,n)),i),b)}function g(c,b,f,g,h,i,n){return k(v(k(k(c,b&g|f&~g),k(h,n)),i),b)}function f(c,b,f,g,h,i,n){return k(v(k(k(c,
b^f^g),k(h,n)),i),b)}function i(c,b,f,g,h,n,r){return k(v(k(k(c,f^(b|~g)),k(h,r)),n),b)}function k(c,b){var f=(c&65535)+(b&65535);return(c>>16)+(b>>16)+(f>>16)<<16|f&65535}function v(c,b){return c<<b|c>>>32-b}b.MD5={encode:function(b){for(var h=[],q=0;q<8*b.length;q+=8)h[q>>5]|=(b.charCodeAt(q/8)&255)<<q%32;b=8*b.length;h[b>>5]|=128<<b%32;h[(b+64>>>9<<4)+14]=b;for(var b=1732584193,q=-271733879,t=-1732584194,y=271733878,p=0;p<h.length;p+=16)var r=b,o=q,u=t,v=y,b=c(b,q,t,y,h[p+0],7,-680876936),y=c(y,
b,q,t,h[p+1],12,-389564586),t=c(t,y,b,q,h[p+2],17,606105819),q=c(q,t,y,b,h[p+3],22,-1044525330),b=c(b,q,t,y,h[p+4],7,-176418897),y=c(y,b,q,t,h[p+5],12,1200080426),t=c(t,y,b,q,h[p+6],17,-1473231341),q=c(q,t,y,b,h[p+7],22,-45705983),b=c(b,q,t,y,h[p+8],7,1770035416),y=c(y,b,q,t,h[p+9],12,-1958414417),t=c(t,y,b,q,h[p+10],17,-42063),q=c(q,t,y,b,h[p+11],22,-1990404162),b=c(b,q,t,y,h[p+12],7,1804603682),y=c(y,b,q,t,h[p+13],12,-40341101),t=c(t,y,b,q,h[p+14],17,-1502002290),q=c(q,t,y,b,h[p+15],22,1236535329),
b=g(b,q,t,y,h[p+1],5,-165796510),y=g(y,b,q,t,h[p+6],9,-1069501632),t=g(t,y,b,q,h[p+11],14,643717713),q=g(q,t,y,b,h[p+0],20,-373897302),b=g(b,q,t,y,h[p+5],5,-701558691),y=g(y,b,q,t,h[p+10],9,38016083),t=g(t,y,b,q,h[p+15],14,-660478335),q=g(q,t,y,b,h[p+4],20,-405537848),b=g(b,q,t,y,h[p+9],5,568446438),y=g(y,b,q,t,h[p+14],9,-1019803690),t=g(t,y,b,q,h[p+3],14,-187363961),q=g(q,t,y,b,h[p+8],20,1163531501),b=g(b,q,t,y,h[p+13],5,-1444681467),y=g(y,b,q,t,h[p+2],9,-51403784),t=g(t,y,b,q,h[p+7],14,1735328473),
q=g(q,t,y,b,h[p+12],20,-1926607734),b=f(b,q,t,y,h[p+5],4,-378558),y=f(y,b,q,t,h[p+8],11,-2022574463),t=f(t,y,b,q,h[p+11],16,1839030562),q=f(q,t,y,b,h[p+14],23,-35309556),b=f(b,q,t,y,h[p+1],4,-1530992060),y=f(y,b,q,t,h[p+4],11,1272893353),t=f(t,y,b,q,h[p+7],16,-155497632),q=f(q,t,y,b,h[p+10],23,-1094730640),b=f(b,q,t,y,h[p+13],4,681279174),y=f(y,b,q,t,h[p+0],11,-358537222),t=f(t,y,b,q,h[p+3],16,-722521979),q=f(q,t,y,b,h[p+6],23,76029189),b=f(b,q,t,y,h[p+9],4,-640364487),y=f(y,b,q,t,h[p+12],11,-421815835),
t=f(t,y,b,q,h[p+15],16,530742520),q=f(q,t,y,b,h[p+2],23,-995338651),b=i(b,q,t,y,h[p+0],6,-198630844),y=i(y,b,q,t,h[p+7],10,1126891415),t=i(t,y,b,q,h[p+14],15,-1416354905),q=i(q,t,y,b,h[p+5],21,-57434055),b=i(b,q,t,y,h[p+12],6,1700485571),y=i(y,b,q,t,h[p+3],10,-1894986606),t=i(t,y,b,q,h[p+10],15,-1051523),q=i(q,t,y,b,h[p+1],21,-2054922799),b=i(b,q,t,y,h[p+8],6,1873313359),y=i(y,b,q,t,h[p+15],10,-30611744),t=i(t,y,b,q,h[p+6],15,-1560198380),q=i(q,t,y,b,h[p+13],21,1309151649),b=i(b,q,t,y,h[p+4],6,-145523070),
y=i(y,b,q,t,h[p+11],10,-1120210379),t=i(t,y,b,q,h[p+2],15,718787259),q=i(q,t,y,b,h[p+9],21,-343485551),b=k(b,r),q=k(q,o),t=k(t,u),y=k(y,v);h=[b,q,t,y];b="";for(q=0;q<4*h.length;q++)b+="0123456789abcdef".charAt(h[q>>2]>>8*(q%4)+4&15)+"0123456789abcdef".charAt(h[q>>2]>>8*(q%4)&15);return b}}})(i);k.Ctrtc=i})(window);window.onbeforeunload=function(){Ctrtc.Device.disconnectAll({unNormal:!0})};(function(){function k(h,c,g,f){function k(b){navigator.mozGetUserMedia?x.getStats(h,function(c){var f=[];c.forEach(function(b){f.push(b)});b(f)},b):x.getStats(function(c){var f=[];c.result().forEach(function(b){var c={};b.names().forEach(function(f){c[f]=b.stat(f)});c.id=b.id;c.type=b.type;c.timestamp=b.timestamp;f.push(c)});b(f)})}var x=this;if(h instanceof b){if(x=h,navigator.mozGetUserMedia&&(h=c,c=g,g=f),!(h instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"2nd argument is not instance of MediaStreamTrack.";
}else if(!(h instanceof MediaStreamTrack)&&navigator.mozGetUserMedia)throw"1st argument is not instance of MediaStreamTrack.";var v,l,w=!1;(function t(){k(function(b){for(var f={audio:{},video:{},aconnection:{},vconnection:{},results:b,nomore:function(){w=!0}},h=0;h<b.length;++h){var k=b[h];if("opus"==k.googCodecName&&k.bytesSent){v||(v=k.bytesSent);var n=k.bytesSent-v;v=k.bytesSent;n/=1024;f.audio=i(f.audio,{availableBandwidth:n.toFixed(1),inputLevel:k.audioInputLevel,packetsLost:k.packetsLost,rtt:k.googRtt,
packetsSent:k.packetsSent,bytesSent:k.bytesSent})}"VP8"==k.googCodecName&&(l||(l=k.bytesSent),n=k.bytesSent-l,l=k.bytesSent,n/=1024,f.video=i(f.video,{availableBandwidth:n.toFixed(1),googFrameHeightInput:k.googFrameHeightInput,googFrameWidthInput:k.googFrameWidthInput,googCaptureQueueDelayMsPerS:k.googCaptureQueueDelayMsPerS,rtt:k.googRtt,packetsLost:k.packetsLost,packetsSent:k.packetsSent,googEncodeUsagePercent:k.googEncodeUsagePercent,googCpuLimitedResolution:k.googCpuLimitedResolution,googNacksReceived:k.googNacksReceived,
googFrameRateInput:k.googFrameRateInput,googPlisReceived:k.googPlisReceived,googViewLimitedResolution:k.googViewLimitedResolution,googCaptureJitterMs:k.googCaptureJitterMs,googAvgEncodeMs:k.googAvgEncodeMs,googFrameHeightSent:k.googFrameHeightSent,googFrameRateSent:k.googFrameRateSent,googBandwidthLimitedResolution:k.googBandwidthLimitedResolution,googFrameWidthSent:k.googFrameWidthSent,googFirsReceived:k.googFirsReceived,bytesSent:k.bytesSent}));"VideoBwe"==k.type&&(f.video.bandwidth={googActualEncBitrate:k.googActualEncBitrate,
googAvailableSendBandwidth:k.googAvailableSendBandwidth,googAvailableReceiveBandwidth:k.googAvailableReceiveBandwidth,googRetransmitBitrate:k.googRetransmitBitrate,googTargetEncBitrate:k.googTargetEncBitrate,googBucketDelay:k.googBucketDelay,googTransmitBitrate:k.googTransmitBitrate});"googCandidatePair"==k.type&&"true"==k.googActiveConnection&&(f.connectionType={local:{candidateType:k.googLocalCandidateType,ipAddress:k.googLocalAddress},remote:{candidateType:k.googRemoteCandidateType,ipAddress:k.googRemoteAddress},
transport:k.googTransportType});"true"==k.googActiveConnection&&"Channel-audio-2"==k.googChannelId&&(f.aconnection=i(f.aconnection,{channelId:k.googChannelId,read:k.googReadable,write:k.googWritable,bytesReceived:k.bytesReceived}));"true"==k.googActiveConnection&&"Channel-video-2"==k.googChannelId&&(f.vconnection=i(f.vconnection,{channelId:k.googChannelId,read:k.googReadable,write:k.googWritable,bytesReceived:k.bytesReceived}))}c(f);w||void 0!=typeof g&&g&&setTimeout(t,g||1E3)})})()}function i(b,
c){b||(b={});if(!c)return b;for(var g in c)b[g]=c[g];return b}var b;"undefined"!==typeof webkitRTCPeerConnection&&(b=webkitRTCPeerConnection);"undefined"!==typeof mozRTCPeerConnection&&(b=mozRTCPeerConnection);"undefined"===typeof MediaStreamTrack&&(MediaStreamTrack={});"undefined"!==typeof module&&(module.exports=k);"undefined"!==typeof window&&(window.getStats=k)})();function RecordRTC(k,i){function b(b){b&&(i.initCallback=function(){b();b=i.initCallback=null});v=new new GetRecorderType(k,i)(k,i);v.record();i.disableLogs||console.debug("Initialized recorderType:",v.constructor.name,"for output-type:",i.type)}function h(b){function c(){for(var h in v)n&&(n[h]=v[h]),f&&(f[h]=v[h]);h=v.blob;if(b){var k=URL.createObjectURL(h);b(k)}h&&!i.disableLogs&&console.debug(h.type,"->",bytesToSize(h.size));i.autoWriteToDisk&&g(function(b){var c={};c[i.type+"Blob"]=b;DiskStorage.Store(c)})}
if(!v)return console.warn(x);var f=this;i.disableLogs||console.warn("Stopped recording "+i.type+" stream.");"gif"!==i.type?v.stop(c):(v.stop(),c())}function c(b){postMessage((new FileReaderSync).readAsDataURL(b))}function g(b,f){function h(b){var b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);URL.revokeObjectURL(b);return c}if(!b)throw"Pass a callback function over getDataURL.";var k=f?f.blob:v.blob;
if(k)if("undefined"!==typeof Worker&&!navigator.mozGetUserMedia){var l=h(c);l.onmessage=function(c){b(c.data)};l.postMessage(k)}else l=new FileReader,l.readAsDataURL(k),l.onload=function(c){b(c.target.result)};else i.disableLogs||console.warn("Blob encoder did not yet finished its job."),setTimeout(function(){g(b,f)},1E3)}function f(){setTimeout(function(){h(n.onRecordingStopped)},n.recordingDuration)}if(!k)throw"MediaStream is mandatory.";var i=new RecordRTCConfiguration(k,i),n=this,x='It seems that "startRecording" is not invoked for '+
i.type+" recorder.",v,l={startRecording:function(){i.disableLogs||console.debug("started recording "+i.type+" stream.");if(v)return v.clearRecordedData(),v.resume(),n.recordingDuration&&f(),n;b(function(){n.recordingDuration&&f()});return n},stopRecording:h,pauseRecording:function(){if(!v)return console.warn(x);v.pause();i.disableLogs||console.debug("Paused recording.")},resumeRecording:function(){if(!v)return console.warn(x);v.resume();i.disableLogs||console.debug("Resumed recording.")},initRecorder:b,
setRecordingDuration:function(b,c){if("undefined"===typeof b)throw"milliseconds is required.";if("number"!==typeof b)throw"milliseconds must be a number.";n.recordingDuration=b;n.onRecordingStopped=c||function(){};return{onRecordingStopped:function(b){n.onRecordingStopped=b}}},clearRecordedData:function(){if(!v)return console.warn(x);v.clearRecordedData();i.disableLogs||console.debug("Cleared old recorded data.")},getBlob:function(){return!v?console.warn(x):v.blob},getDataURL:g,toURL:function(){return!v?
console.warn(x):URL.createObjectURL(v.blob)},save:function(b){if(!v)return console.warn(x);invokeSaveAsDialog(v.blob,b)},getFromDisk:function(b){if(!v)return console.warn(x);RecordRTC.getFromDisk(i.type,b)},setAdvertisementArray:function(b){i.advertisement=[];for(var c=b.length,f=0;f<c;f++)i.advertisement.push({duration:f,image:b[f]})},blob:null,bufferSize:0,sampleRate:0,buffer:null,view:null};if(!this)return n=l;for(var w in l)this[w]=l[w];n=this;return l}
RecordRTC.getFromDisk=function(k,i){if(!i)throw"callback is mandatory.";console.log("Getting recorded "+("all"===k?"blobs":k+" blob ")+" from disk!");DiskStorage.Fetch(function(b,h){"all"!==k&&h===k+"Blob"&&i&&i(b);"all"===k&&i&&i(b,h.replace("Blob",""))})};
RecordRTC.writeToDisk=function(k){console.log("Writing recorded blob(s) to disk!");k=k||{};k.audio&&k.video&&k.gif?k.audio.getDataURL(function(i){k.video.getDataURL(function(b){k.gif.getDataURL(function(h){DiskStorage.Store({audioBlob:i,videoBlob:b,gifBlob:h})})})}):k.audio&&k.video?k.audio.getDataURL(function(i){k.video.getDataURL(function(b){DiskStorage.Store({audioBlob:i,videoBlob:b})})}):k.audio&&k.gif?k.audio.getDataURL(function(i){k.gif.getDataURL(function(b){DiskStorage.Store({audioBlob:i,
gifBlob:b})})}):k.video&&k.gif?k.video.getDataURL(function(i){k.gif.getDataURL(function(b){DiskStorage.Store({videoBlob:i,gifBlob:b})})}):k.audio?k.audio.getDataURL(function(i){DiskStorage.Store({audioBlob:i})}):k.video?k.video.getDataURL(function(i){DiskStorage.Store({videoBlob:i})}):k.gif&&k.gif.getDataURL(function(i){DiskStorage.Store({gifBlob:i})})};"undefined"!==typeof module&&(module.exports=RecordRTC);"function"===typeof define&&define.amd&&define("RecordRTC",[],function(){return RecordRTC});
function RecordRTCConfiguration(k,i){if(i.recorderType&&!i.type)if(i.recorderType===WhammyRecorder||i.recorderType===CanvasRecorder)i.type="video";else if(i.recorderType===GifRecorder)i.type="gif";else if(i.recorderType===StereoAudioRecorder)i.type="audio";else if(i.recorderType===MediaStreamRecorder)if(k.getAudioTracks().length&&k.getVideoTracks().length)i.type="video";else if(k.getAudioTracks().length&&!k.getVideoTracks().length)i.type="audio";else if(!k.getAudioTracks().length&&k.getVideoTracks().length)i.type=
"audio";if(typeof MediaStreamRecorder!=="undefined"&&typeof MediaRecorder!=="undefined"&&"requestData"in MediaRecorder.prototype){if(!i.mimeType)i.mimeType="video/webm";if(!i.type)i.type=i.mimeType.split("/")[0]}if(!i.type){if(i.mimeType)i.type=i.mimeType.split("/")[0];if(!i.type)i.type="audio"}return i}
function GetRecorderType(k,i){var b;if(isChrome||isEdge||isOpera)b=StereoAudioRecorder;typeof MediaRecorder!=="undefined"&&"requestData"in MediaRecorder.prototype&&!isChrome&&(b=MediaStreamRecorder);if(i.type==="video"&&(isChrome||isOpera))b=WhammyRecorder;i.type==="gif"&&(b=GifRecorder);i.type==="canvas"&&(b=CanvasRecorder);isMediaRecorderCompatible()&&isChrome&&b!==CanvasRecorder&&b!==GifRecorder&&typeof MediaRecorder!=="undefined"&&"requestData"in MediaRecorder.prototype&&k.getVideoTracks().length&&
(b=MediaStreamRecorder);if(i.recorderType)b=i.recorderType;!i.disableLogs&&b&&b.name&&console.debug("Using recorderType:",b.name||b.constructor.name);return b}
function MRecordRTC(k){this.addStream=function(i){i&&(k=i)};this.mediaType={audio:true,video:true};this.startRecording=function(){var i=this.mediaType,b,h=this.mimeType||{audio:null,video:null,gif:null};if(typeof i.audio!=="function"&&isMediaRecorderCompatible()&&k&&k.getAudioTracks&&k.getAudioTracks().length&&k.getVideoTracks().length)this.mediaType.audio=false;if(i.audio){b=null;if(typeof i.audio==="function")b=i.audio;this.audioRecorder=new RecordRTC(k,{type:"audio",bufferSize:this.bufferSize,
sampleRate:this.sampleRate,numberOfAudioChannels:this.numberOfAudioChannels||2,disableLogs:this.disableLogs,recorderType:b,mimeType:h.audio});i.video||this.audioRecorder.startRecording()}if(i.video){b=null;if(typeof i.video==="function")b=i.video;var c=k;if(isMediaRecorderCompatible()&&i.audio&&typeof i.audio==="function"){var g=k.getVideoTracks()[0];if(navigator.mozGetUserMedia){c=new MediaStream;c.addTrack(g);b&&b===WhammyRecorder&&(b=MediaStreamRecorder)}else c=new MediaStream([g])}this.videoRecorder=
new RecordRTC(c,{type:"video",video:this.video,canvas:this.canvas,frameInterval:this.frameInterval||10,disableLogs:this.disableLogs,recorderType:b,mimeType:h.video});i.audio||this.videoRecorder.startRecording()}if(i.audio&&i.video){var f=this;f.videoRecorder.initRecorder(function(){f.audioRecorder.initRecorder(function(){f.videoRecorder.startRecording();f.audioRecorder.startRecording()})})}if(i.gif){b=null;if(typeof i.gif==="function")b=i.gif;this.gifRecorder=new RecordRTC(k,{type:"gif",frameRate:this.frameRate||
200,quality:this.quality||10,disableLogs:this.disableLogs,recorderType:b,mimeType:h.gif});this.gifRecorder.startRecording()}};this.stopRecording=function(i){i=i||function(){};this.audioRecorder&&this.audioRecorder.stopRecording(function(b){i(b,"audio")});this.videoRecorder&&this.videoRecorder.stopRecording(function(b){i(b,"video")});this.gifRecorder&&this.gifRecorder.stopRecording(function(b){i(b,"gif")})};this.getBlob=function(i){var b={};if(this.audioRecorder)b.audio=this.audioRecorder.getBlob();
if(this.videoRecorder)b.video=this.videoRecorder.getBlob();if(this.gifRecorder)b.gif=this.gifRecorder.getBlob();i&&i(b);return b};this.getDataURL=function(i){function b(b,g){if(typeof Worker!=="undefined"){var f=h(function(b){postMessage((new FileReaderSync).readAsDataURL(b))});f.onmessage=function(b){g(b.data)};f.postMessage(b)}else{f=new FileReader;f.readAsDataURL(b);f.onload=function(b){g(b.target.result)}}}function h(b){var b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+
b.name+"(e.data);}"],{type:"application/javascript"})),g=new Worker(b),f;if(typeof URL!=="undefined")f=URL;else if(typeof webkitURL!=="undefined")f=webkitURL;else throw"Neither URL nor webkitURL detected.";f.revokeObjectURL(b);return g}this.getBlob(function(c){b(c.audio,function(g){b(c.video,function(b){i({audio:g,video:b})})})})};this.writeToDisk=function(){RecordRTC.writeToDisk({audio:this.audioRecorder,video:this.videoRecorder,gif:this.gifRecorder})};this.save=function(i){i=i||{audio:true,video:true,
gif:true};i.audio&&this.audioRecorder&&this.audioRecorder.save(typeof i.audio==="string"?i.audio:"");i.video&&this.videoRecorder&&this.videoRecorder.save(typeof i.video==="string"?i.video:"");i.gif&&this.gifRecorder&&this.gifRecorder.save(typeof i.gif==="string"?i.gif:"")}}MRecordRTC.getFromDisk=RecordRTC.getFromDisk;MRecordRTC.writeToDisk=RecordRTC.writeToDisk;var requestAnimationFrame=window.requestAnimationFrame;
"undefined"===typeof requestAnimationFrame&&("undefined"!==typeof webkitRequestAnimationFrame&&(requestAnimationFrame=webkitRequestAnimationFrame),"undefined"!==typeof mozRequestAnimationFrame&&(requestAnimationFrame=mozRequestAnimationFrame));var cancelAnimationFrame=window.cancelAnimationFrame;
"undefined"===typeof cancelAnimationFrame&&("undefined"!==typeof webkitCancelAnimationFrame&&(cancelAnimationFrame=webkitCancelAnimationFrame),"undefined"!==typeof mozCancelAnimationFrame&&(cancelAnimationFrame=mozCancelAnimationFrame));var AudioContext=window.AudioContext;"undefined"===typeof AudioContext&&("undefined"!==typeof webkitAudioContext&&(AudioContext=webkitAudioContext),"undefined"!==typeof mozAudioContext&&(AudioContext=mozAudioContext));var URL=window.URL;
"undefined"===typeof URL&&"undefined"!==typeof webkitURL&&(URL=webkitURL);if("undefined"!==typeof navigator){if("undefined"!==typeof navigator.webkitGetUserMedia&&(navigator.getUserMedia=navigator.webkitGetUserMedia),"undefined"!==typeof navigator.mozGetUserMedia)navigator.getUserMedia=navigator.mozGetUserMedia}else throw'Please make sure to define a global variable named as "navigator"';
var isEdge=-1!==navigator.userAgent.indexOf("Edge")&&(!!navigator.msSaveBlob||!!navigator.msSaveOrOpenBlob),isOpera=!!window.opera||-1!==navigator.userAgent.indexOf("OPR/"),isChrome=!isOpera&&!isEdge&&!!navigator.webkitGetUserMedia,MediaStream=window.MediaStream;"undefined"===typeof MediaStream&&"undefined"!==typeof webkitMediaStream&&(MediaStream=webkitMediaStream);
if("undefined"!==typeof MediaStream&&("getVideoTracks"in MediaStream.prototype||(MediaStream.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var k=[];this.getTracks.forEach(function(i){i.kind.toString().indexOf("video")!==-1&&k.push(i)});return k},MediaStream.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var k=[];this.getTracks.forEach(function(i){i.kind.toString().indexOf("audio")!==-1&&k.push(i)});return k}),!("stop"in MediaStream.prototype)))MediaStream.prototype.stop=
function(){this.getAudioTracks().forEach(function(k){k.stop&&k.stop()});this.getVideoTracks().forEach(function(k){k.stop&&k.stop()})};"undefined"!==typeof location&&0===location.href.indexOf("file:")&&console.error("Please load this HTML file on HTTP or HTTPS.");function bytesToSize(k){if(k===0)return"0 Bytes";var i=parseInt(Math.floor(Math.log(k)/Math.log(1E3)),10);return(k/Math.pow(1E3,i)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][i]}
function invokeSaveAsDialog(k,i){if(!k)throw"Blob object is required.";if(!k.type)try{k.type="video/webm"}catch(b){}var h=(k.type||"video/webm").split("/")[1];if(i&&i.indexOf(".")!==-1){h=i.split(".");i=h[0];h=h[1]}h=(i||Math.round(Math.random()*9999999999)+888888888)+"."+h;if(typeof navigator.msSaveOrOpenBlob!=="undefined")return navigator.msSaveOrOpenBlob(k,h);if(typeof navigator.msSaveBlob!=="undefined")return navigator.msSaveBlob(k,h);var c=document.createElement("a");c.href=URL.createObjectURL(k);
c.target="_blank";c.download=h;if(navigator.mozGetUserMedia){c.onclick=function(){(document.body||document.documentElement).removeChild(c)};(document.body||document.documentElement).appendChild(c)}h=new MouseEvent("click",{view:window,bubbles:true,cancelable:true});c.dispatchEvent(h);navigator.mozGetUserMedia||URL.revokeObjectURL(c.href)}var Storage={};"undefined"!==typeof AudioContext?Storage.AudioContext=AudioContext:"undefined"!==typeof webkitAudioContext&&(Storage.AudioContext=webkitAudioContext);
function isMediaRecorderCompatible(){var k=!!window.opera||navigator.userAgent.indexOf(" OPR/")>=0,i=!!window.chrome&&!k;if(typeof window.InstallTrigger!=="undefined")return true;if(!i)return false;var k=navigator.userAgent,b=""+parseFloat(navigator.appVersion),h=parseInt(navigator.appVersion,10);if(i){b=k.indexOf("Chrome");b=k.substring(b+7)}if((k=b.indexOf(";"))!==-1)b=b.substring(0,k);if((k=b.indexOf(" "))!==-1)b=b.substring(0,k);h=parseInt(""+b,10);if(isNaN(h)){parseFloat(navigator.appVersion);
h=parseInt(navigator.appVersion,10)}return h>=49}
function MediaStreamRecorder(k,i){function b(){if("active"in k){if(!k.active)return false}else if("ended"in k&&k.ended)return false;return true}var h=this,i=i||{mimeType:"video/webm"};if(i.type==="audio"){if(k.getVideoTracks().length&&k.getAudioTracks().length){var c;if(navigator.mozGetUserMedia){c=new MediaStream;c.addTrack(k.getAudioTracks()[0])}else c=new MediaStream(k.getAudioTracks());k=c}if(!i.mimeType||i.mimeType.indexOf("audio")===-1)i.mimeType=isChrome?"audio/webm":"audio/ogg"}this.record=
function(){h.blob=null;var b=i;i.disableLogs||console.log("Passing following config over MediaRecorder API.",b);g&&(g=null);isChrome&&!isMediaRecorderCompatible()&&(b="video/vp8");g=new MediaRecorder(k,b);"canRecordMimeType"in g&&g.canRecordMimeType(i.mimeType)===false&&(i.disableLogs||console.warn("MediaRecorder API seems unable to record mimeType:",i.mimeType));g.ignoreMutedMedia=i.ignoreMutedMedia||false;g.ondataavailable=function(b){if(!h.dontFireOnDataAvailableEvent&&b.data&&b.data.size&&!(b.data.size<
100||h.blob)){h.blob=i.getNativeBlob?b.data:new Blob([b.data],{type:i.mimeType||"video/webm"});if(h.recordingCallback){h.recordingCallback(h.blob);h.recordingCallback=null}}};g.onerror=function(b){i.disableLogs||(b.name==="InvalidState"?console.error("The MediaRecorder is not in a state in which the proposed operation is allowed to be executed."):b.name==="OutOfMemory"?console.error("The UA has exhaused the available memory. User agents SHOULD provide as much additional information as possible in the message attribute."):
b.name==="IllegalStreamModification"?console.error("A modification to the stream has occurred that makes it impossible to continue recording. An example would be the addition of a Track while recording is occurring. User agents SHOULD provide as much additional information as possible in the message attribute."):b.name==="OtherRecordingError"?console.error("Used for an fatal error other than those listed above. User agents SHOULD provide as much additional information as possible in the message attribute."):
b.name==="GenericError"?console.error("The UA cannot provide the codec or recording option that has been requested.",b):console.error("MediaRecorder Error",b));g.state!=="inactive"&&g.state!=="stopped"&&g.stop()};g.start(36E5);if(i.onAudioProcessStarted)i.onAudioProcessStarted();i.initCallback&&i.initCallback()};this.stop=function(b){if(g){this.recordingCallback=b||function(){};if(g.state==="recording"){g.requestData();g.stop()}}};this.pause=function(){g&&g.state==="recording"&&g.pause()};this.resume=
function(){if(this.dontFireOnDataAvailableEvent){this.dontFireOnDataAvailableEvent=false;var b=i.disableLogs;i.disableLogs=true;this.record();i.disableLogs=b}else g&&g.state==="paused"&&g.resume()};this.clearRecordedData=function(){if(g){this.pause();this.dontFireOnDataAvailableEvent=true;this.stop()}};var g,h=this;(function n(){g&&(b()===false?h.stop():setTimeout(n,1E3))})()}
function StereoAudioRecorder(k,i){function b(){if("active"in k){if(!k.active)return false}else if("ended"in k&&k.ended)return false;return true}function h(b,f){function g(b,c){function f(b,c){for(var g=new Float64Array(c),h=0,i=b.length,k=0;k<i;k++){var l=b[k];g.set(l,h);h=h+l.length}return g}function h(b,c){for(var f=b.length+c.length,g=new Float64Array(f),i=0,k=0;k<f;){g[k++]=b[i];g[k++]=c[i];i++}return g}function i(b,c,f){for(var g=f.length,h=0;h<g;h++)b.setUint8(c+h,f.charCodeAt(h))}var k=b.numberOfAudioChannels,
l=b.leftBuffers.slice(0),n=b.rightBuffers.slice(0),o=b.sampleRate,p=b.internalInterleavedLength;if(k===2){l=f(l,p);n=f(n,p)}k===1&&(l=f(l,p));var t;k===2&&(t=h(l,n));k===1&&(t=l);l=t.length;n=new ArrayBuffer(44+l*2);p=new DataView(n);i(p,0,"RIFF");p.setUint32(4,44+l*2,true);i(p,8,"WAVE");i(p,12,"fmt ");p.setUint32(16,16,true);p.setUint16(20,1,true);p.setUint16(22,k,true);p.setUint32(24,o,true);p.setUint32(28,o*2,true);p.setUint16(32,k*2,true);p.setUint16(34,16,true);i(p,36,"data");p.setUint32(40,
l*2,true);k=44;for(o=0;o<l;o++){p.setInt16(k,t[o]*32767,true);k=k+2}if(c)return c({buffer:n,view:p});postMessage({buffer:n,view:p})}if(isChrome){var h=c(g);h.onmessage=function(b){f(b.data.buffer,b.data.view);URL.revokeObjectURL(h.workerURL)};h.postMessage(b)}else g(b,function(b){f(b.buffer,b.view)})}function c(b){var b=URL.createObjectURL(new Blob([b.toString(),";this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);c.workerURL=b;return c}if(!k.getAudioTracks().length)throw"Your stream has no audio tracks.";
var i=i||{},g=this,f=[],n=[],x=false,v=0,l,w=2;i.leftChannel===true&&(w=1);i.numberOfAudioChannels===1&&(w=1);i.disableLogs||console.debug("StereoAudioRecorder is set to record number of channels: ",w);this.record=function(){if(b()===false)throw"Please make sure MediaStream is active.";v=f.length=n.length=0;t&&t.connect(l);u=o=false;x=true};this.stop=function(b){x=false;h({sampleRate:r,numberOfAudioChannels:w,internalInterleavedLength:v,leftBuffers:f,rightBuffers:w===1?[]:n},function(c,f){g.blob=
new Blob([f],{type:"audio/wav"});g.buffer=new ArrayBuffer(f);g.view=f;g.sampleRate=r;g.bufferSize=p;g.length=v;b&&b();u=false})};if(!Storage.AudioContextConstructor)Storage.AudioContextConstructor=new Storage.AudioContext;var q=Storage.AudioContextConstructor,t=q.createMediaStreamSource(k),y=[0,256,512,1024,2048,4096,8192,16384],p=typeof i.bufferSize==="undefined"?4096:i.bufferSize;y.indexOf(p)===-1&&(i.disableLogs||console.warn("Legal values for buffer-size are "+JSON.stringify(y,null,"\t")));if(q.createJavaScriptNode)l=
q.createJavaScriptNode(p,w,w);else if(q.createScriptProcessor)l=q.createScriptProcessor(p,w,w);else throw"WebAudio API has no support on this browser.";t.connect(l);if(!i.bufferSize)p=l.bufferSize;var r=typeof i.sampleRate!=="undefined"?i.sampleRate:q.sampleRate||44100;if(r<22050||r>96E3)i.disableLogs||console.warn("sample-rate must be under range 22050 and 96000.");if(!i.disableLogs){console.log("sample-rate",r);console.log("buffer-size",p)}var o=false;this.pause=function(){o=true};this.resume=function(){if(b()===
false)throw"Please make sure MediaStream is active.";if(x)o=false;else{i.disableLogs||console.info("Seems recording has been restarted.");this.record()}};this.clearRecordedData=function(){this.pause();v=f.length=n.length=0};var u=false;l.onaudioprocess=function(c){if(!o){if(b()===false){i.disableLogs||console.error("MediaStream seems stopped.");l.disconnect();x=false}if(x){if(!u){u=true;if(i.onAudioProcessStarted)i.onAudioProcessStarted();i.initCallback&&i.initCallback()}var g=c.inputBuffer.getChannelData(0);
f.push(new Float32Array(g));if(w===2){c=c.inputBuffer.getChannelData(1);n.push(new Float32Array(c))}v=v+p}else t.disconnect()}};l.connect(q.destination)}
function CanvasRecorder(k,i){function b(){var b=document.createElement("canvas"),c=b.getContext("2d");b.width=k.width;b.height=k.height;c.drawImage(k,0,0);return b}function h(){if(x){v=(new Date).getTime();return setTimeout(h,500)}if(k.nodeName.toLowerCase()==="canvas"){var c=(new Date).getTime()-v;v=(new Date).getTime();l.frames.push({image:b(),duration:c});n&&setTimeout(h,i.frameInterval)}else html2canvas(k,{grabMouse:typeof i.showMousePointer==="undefined"||i.showMousePointer,onrendered:function(b){var c=
(new Date).getTime()-v;if(!c)return setTimeout(h,i.frameInterval);v=(new Date).getTime();l.frames.push({image:b.toDataURL("image/webp",1),duration:c});n&&setTimeout(h,i.frameInterval)}})}if(typeof html2canvas==="undefined"&&k.nodeName.toLowerCase()!=="canvas")throw"Please link: //cdn.webrtc-experiment.com/screenshot.js";i=i||{};if(!i.frameInterval)i.frameInterval=10;var c=false;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(b){b in document.createElement("canvas")&&(c=
true)});if(window.webkitRTCPeerConnection||window.webkitGetUserMedia)c=false;var g,f;if(c){i.disableLogs||console.debug("Your browser supports both MediRecorder API and canvas.captureStream!");g=document.createElement("canvas");g.width=k.clientWidth||window.innerWidth;g.height=k.clientHeight||window.innerHeight;g.style="top: -9999999; left: -99999999; visibility:hidden; position:absoluted; display: none;";(document.body||document.documentElement).appendChild(g);g.getContext("2d")}else navigator.mozGetUserMedia&&
(i.disableLogs||alert("Canvas recording is NOT supported in Firefox."));var n;this.record=function(){n=true;if(c){var b;"captureStream"in g?b=g.captureStream(25):"mozCaptureStream"in g?b=g.captureStream(25):"webkitCaptureStream"in g&&(b=g.captureStream(25));try{var k=new MediaStream;k.addTrack(b.getVideoTracks()[0]);b=k}catch(t){}if(!b)throw"captureStream API are NOT available.";f=new MediaStreamRecorder(b,{mimeType:"video/webm"});f.record()}else{l.frames=[];v=(new Date).getTime();h()}i.initCallback&&
i.initCallback()};this.getWebPImages=function(b){if(k.nodeName.toLowerCase()==="canvas"){var c=l.frames.length;l.frames.forEach(function(b,f){var g=c-f;document.title=g+"/"+c+" frames remaining";if(i.onEncodingCallback)i.onEncodingCallback(g,c);g=b.image.toDataURL("image/webp",1);l.frames[f].image=g});document.title="Generating WebM"}b()};this.stop=function(b){n=false;var g=this;c&&f?f.stop(function(){for(var c in f)self[c]=f[c];b&&b(g.blob)}):this.getWebPImages(function(){l.compile(function(c){document.title=
"Recording finished!";g.blob=c;if(g.blob.forEach)g.blob=new Blob([],{type:"video/webm"});b&&b(g.blob);l.frames=[]})})};var x=false;this.pause=function(){x=true};this.resume=function(){x=false};this.clearRecordedData=function(){this.pause();l.frames=[]};var v=(new Date).getTime(),l=new Whammy.Video(100)}
function WhammyRecorder(k,i){function b(c){var c=typeof c!=="undefined"?c:10,h=(new Date).getTime()-l;if(!h)return setTimeout(b,c,c);if(f){l=(new Date).getTime();return setTimeout(b,100)}l=(new Date).getTime();v.paused&&v.play();x.drawImage(v,0,0,n.width,n.height);w.frames.push({duration:h,image:n.toDataURL("image/webp")});g||setTimeout(b,c,c)}function h(b){var c=-1,f=b.length,g=function(){c++;c===f?b.callback():b.functionToLoop(g,c)};g()}function c(b,c,f,g,i){var k=document.createElement("canvas");
k.width=n.width;k.height=n.height;var l=k.getContext("2d"),v=[],x=c===-1,w=c&&c>0&&c<=b.length?c:b.length,z=Math.sqrt(Math.pow(255,2)+Math.pow(255,2)+Math.pow(255,2)),M=f&&f>=0&&f<=1?f:0,E=g&&g>=0&&g<=1?g:0,K=false;h({length:w,functionToLoop:function(c,f){var g,h,i,k=function(){if(K||!(i-g<=i*E)){x&&(K=true);v.push(b[f])}c()};if(K)k();else{var o=new Image;o.onload=function(){l.drawImage(o,0,0,n.width,n.height);var b=l.getImageData(0,0,n.width,n.height);g=0;h=b.data.length;i=b.data.length/4;for(var c=
0;c<h;c=c+4){var f=b.data[c+1],p=b.data[c+2];Math.sqrt(Math.pow(b.data[c]-0,2)+Math.pow(f-0,2)+Math.pow(p-0,2))<=z*M&&g++}k()};o.src=b[f].image}},callback:function(){v=v.concat(b.slice(w));v.length<=0&&v.push(b[b.length-1]);i(v)}})}i=i||{};if(!i.frameInterval)i.frameInterval=10;i.disableLogs||console.log("Using frames-interval:",i.frameInterval);this.record=function(){if(!i.width)i.width=320;if(!i.height)i.height=240;if(!i.video)i.video={width:i.width,height:i.height};if(!i.canvas)i.canvas={width:i.width,
height:i.height};n.width=i.canvas.width;n.height=i.canvas.height;x=n.getContext("2d");if(i.video&&i.video instanceof HTMLVideoElement){v=i.video.cloneNode();i.initCallback&&i.initCallback()}else{v=document.createElement("video");typeof v.srcObject!=="undefined"?v.srcObject=k:v.src=URL.createObjectURL(k);v.onloadedmetadata=function(){i.initCallback&&i.initCallback()};v.width=i.video.width;v.height=i.video.height}v.muted=true;v.play();l=(new Date).getTime();w=new Whammy.Video;if(!i.disableLogs){console.log("canvas resolutions",
n.width,"*",n.height);console.log("video width/height",v.width||n.width,"*",v.height||n.height)}b(i.frameInterval)};var g=false;this.stop=function(b){g=true;var f=this;setTimeout(function(){c(w.frames,-1,null,null,function(c){w.frames=c;if(i.advertisement&&i.advertisement.length)w.frames=i.advertisement.concat(w.frames);w.compile(function(c){f.blob=c;if(f.blob.forEach)f.blob=new Blob([],{type:"video/webm"});b&&b(f.blob)})})},10)};var f=false;this.pause=function(){f=true};this.resume=function(){f=
false};this.clearRecordedData=function(){this.pause();w.frames=[]};var n=document.createElement("canvas"),x=n.getContext("2d"),v,l,w}
var Whammy=function(){function k(b){this.frames=[];this.duration=b||1;this.quality=0.8}function i(b){var b=URL.createObjectURL(new Blob([b.toString(),"this.onmessage =  function (e) {"+b.name+"(e.data);}"],{type:"application/javascript"})),c=new Worker(b);URL.revokeObjectURL(b);return c}function b(b){function c(b,c,f){return[{data:b,id:231}].concat(f.map(function(b){var f=v({discardable:0,frame:b.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(c)});c=c+b.duration;return{data:f,
id:163}}))}function g(b){for(var c=[];b>0;){c.push(b&255);b=b>>8}return new Uint8Array(c.reverse())}function f(b){return new Uint8Array(b.split("").map(function(b){return b.charCodeAt(0)}))}function i(b){for(var c=[],b=(b.length%8?Array(9-b.length%8).join("0"):"")+b,f=0;f<b.length;f=f+8)c.push(parseInt(b.substr(f,8),2));return new Uint8Array(c)}function k(b){for(var c=[],h=0;h<b.length;h++){var l=b[h].data;typeof l==="object"&&(l=k(l));typeof l==="number"&&(l=i(l.toString(2)));typeof l==="string"&&
(l=f(l));var o=l.size||l.byteLength||l.length,q=Math.ceil(Math.ceil(Math.log(o)/Math.log(2))/8),o=o.toString(2),o=Array(q*7+8-o.length).join("0")+o,q=Array(q).join("0")+"1"+o;c.push(g(b[h].id));c.push(i(q));c.push(l)}return new Blob(c,{type:"video/webm"})}function v(b){var c=0;b.keyframe&&(c=c|128);b.invisible&&(c=c|8);b.lacing&&(c=c|b.lacing<<1);b.discardable&&(c=c|1);if(b.trackNum>127)throw"TrackNumber > 127 not supported";return[b.trackNum|128,b.timecode>>8,b.timecode&255,c].map(function(b){return String.fromCharCode(b)}).join("")+
b.frame}function l(b,c){return parseInt(b.substr(c+4,4).split("").map(function(b){b=b.charCodeAt(0).toString(2);return Array(8-b.length+1).join("0")+b}).join(""),2)}function w(b){for(var c=0,f={};c<b.length;){var g=b.substr(c,4),h=l(b,c),i=b.substr(c+4+4,h),c=c+(8+h);f[g]=f[g]||[];g==="RIFF"||g==="LIST"?f[g].push(w(i)):f[g].push(i)}return f}function q(b){return[].slice.call(new Uint8Array((new Float64Array([b])).buffer),0).map(function(b){return String.fromCharCode(b)}).reverse().join("")}b=new function(b){var f;
if(b[0]){f=b[0].width;for(var g=b[0].height,h=b[0].duration,i=1;i<b.length;i++)h=h+b[i].duration;f={duration:h,width:f,height:g}}else{postMessage({error:"Something went wrong. Maybe WebP format is not supported in the current browser."});f=void 0}if(!f)return[];f=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1E6,id:2807729},{data:"whammy",id:19840},
{data:"whammy",id:22337},{data:q(f.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:f.width,id:176},{data:f.height,id:186}]}]}]}]}];for(h=g=0;g<b.length;){var l=[],i=0;do{l.push(b[g]);i=i+b[g].duration;g++}while(g<b.length&&i<3E4);l={id:524531317,data:c(h,0,l)};f[1].data.push(l);h=h+i}return k(f)}(b.map(function(b){var c;c=w(atob(b.image.slice(23)));
for(var f=c.RIFF[0].WEBP[0],g=f.indexOf("\u009d\u0001*"),h=0,i=[];h<4;h++)i[h]=f.charCodeAt(g+3+h);h=i[1]<<8|i[0];g=h&16383;h=i[3]<<8|i[2];c={width:g,height:h&16383,data:f,riff:c};c.duration=b.duration;return c}));postMessage(b)}k.prototype.add=function(b,c){if("canvas"in b)b=b.canvas;"toDataURL"in b&&(b=b.toDataURL("image/webp",this.quality));if(!/^data:image\/webp;base64,/ig.test(b))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:b,
duration:c||this.duration})};k.prototype.compile=function(h){var c=i(b);c.onmessage=function(b){b.data.error?console.error(b.data.error):h(b.data)};c.postMessage(this.frames)};return{Video:k}}(),DiskStorage={init:function(){function k(){function b(g){c.objectStore(i.dataStoreName).get(g).onsuccess=function(b){i.callback&&i.callback(b.target.result,g)}}var c=h.transaction([i.dataStoreName],"readwrite");i.videoBlob&&c.objectStore(i.dataStoreName).put(i.videoBlob,"videoBlob");i.gifBlob&&c.objectStore(i.dataStoreName).put(i.gifBlob,
"gifBlob");i.audioBlob&&c.objectStore(i.dataStoreName).put(i.audioBlob,"audioBlob");b("audioBlob");b("videoBlob");b("gifBlob")}var i=this;if(typeof indexedDB==="undefined"||typeof indexedDB.open==="undefined")console.error("IndexedDB API are not available in this browser.");else{typeof webkitIndexedDB!=="undefined"&&(indexedDB=webkitIndexedDB);typeof mozIndexedDB!=="undefined"&&(indexedDB=mozIndexedDB);typeof OIndexedDB!=="undefined"&&(indexedDB=OIndexedDB);typeof msIndexedDB!=="undefined"&&(indexedDB=
msIndexedDB);var b=this.dbName||location.href.replace(/\/|:|#|%|\.|\[|\]/g,""),h,c=indexedDB.open(b,1);c.onerror=i.onError;c.onsuccess=function(){h=c.result;h.onerror=i.onError;h.setVersion?h.version!==1?h.setVersion(1).onsuccess=function(){h.createObjectStore(i.dataStoreName);k()}:k():k()};c.onupgradeneeded=function(b){b.target.result.createObjectStore(i.dataStoreName)}}},Fetch:function(k){this.callback=k;this.init();return this},Store:function(k){this.audioBlob=k.audioBlob;this.videoBlob=k.videoBlob;
this.gifBlob=k.gifBlob;this.init();return this},onError:function(k){console.error(JSON.stringify(k,null,"\t"))},dataStoreName:"recordRTC",dbName:null};
function GifRecorder(k,i){if(typeof GIFEncoder==="undefined")throw"Please link: https://cdn.webrtc-experiment.com/gif-recorder.js";var i=i||{},b=k instanceof CanvasRenderingContext2D||k instanceof HTMLCanvasElement;this.record=function(){function k(w){if(h)return setTimeout(function(){k(w)},100);n=requestAnimationFrame(k);typeof x===void 0&&(x=w);if(!(w-x<90)){!b&&f.paused&&f.play();g.drawImage(f,0,0,c.width,c.height);if(i.onGifPreview)i.onGifPreview(c.toDataURL("image/png"));v.addFrame(g);x=w}}if(!b){if(!i.width)i.width=
f.offsetWidth||320;if(!this.height)i.height=f.offsetHeight||240;if(!i.video)i.video={width:i.width,height:i.height};if(!i.canvas)i.canvas={width:i.width,height:i.height};c.width=i.canvas.width;c.height=i.canvas.height;f.width=i.video.width;f.height=i.video.height}v=new GIFEncoder;v.setRepeat(0);v.setDelay(i.frameRate||200);v.setQuality(i.quality||10);v.start();Date.now();n=requestAnimationFrame(k);i.initCallback&&i.initCallback()};this.stop=function(){n&&cancelAnimationFrame(n);Date.now();this.blob=
new Blob([new Uint8Array(v.stream().bin)],{type:"image/gif"});v.stream().bin=[]};var h=false;this.pause=function(){h=true};this.resume=function(){h=false};this.clearRecordedData=function(){if(v){this.pause();v.stream().bin=[]}};var c=document.createElement("canvas"),g=c.getContext("2d");b&&(k instanceof CanvasRenderingContext2D?g=k:k instanceof HTMLCanvasElement&&(g=k.getContext("2d")));if(!b){var f=document.createElement("video");f.muted=true;f.autoplay=true;typeof f.srcObject!=="undefined"?f.srcObject=
k:f.src=URL.createObjectURL(k);f.play()}var n=null,x,v};(function(){function k(b,c){var g={audio:!1,video:{mandatory:{chromeMediaSource:b?"screen":"desktop",maxWidth:1920<window.screen.width?window.screen.width:1920,maxHeight:1080<window.screen.height?window.screen.height:1080},optional:[]}};c&&(g.video.mandatory.chromeMediaSourceId=c);return g}function i(){b.isLoaded?b.contentWindow.postMessage({captureSourceId:!0},"*"):setTimeout(i,100)}window.getScreenId=function(b){function c(g){g.data&&(console.log(g.data),g.data.chromeMediaSourceId&&("PermissionDeniedError"===
g.data.chromeMediaSourceId?b("permission-denied"):b(null,g.data.chromeMediaSourceId,k(null,g.data.chromeMediaSourceId))),g.data.chromeExtensionStatus&&b(g.data.chromeExtensionStatus,null,k(g.data.chromeExtensionStatus)),window.removeEventListener("message",c))}navigator.mozGetUserMedia?b(null,"firefox",{video:{mozMediaSource:"window",mediaSource:"window"}}):(i(),window.addEventListener("message",c))};var b=document.createElement("iframe");b.onload=function(){b.isLoaded=!0};b.src="https://www.webrtc-experiment.com/getSourceId/";
b.style.display="none";(document.body||document.documentElement).appendChild(b)})();
